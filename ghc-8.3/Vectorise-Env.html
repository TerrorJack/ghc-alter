<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Vectorise.Env</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Vectorise-Env.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ghc-8.3: The GHC API</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Vectorise.Env</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Local Environments</a></li><li><a href="#g:2">Global Environments</a></li></ul></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span> <a href="#t:Scope">Scope</a> a b<ul class="subs"><li>= <a href="#v:Global">Global</a> a</li><li>| <a href="#v:Local">Local</a> b</li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:LocalEnv">LocalEnv</a> = <a href="#v:LocalEnv">LocalEnv</a> {<ul class="subs"><li><a href="#v:local_vars">local_vars</a> :: <a href="VarEnv.html#t:VarEnv">VarEnv</a> (<a href="Var.html#t:Var">Var</a>, <a href="Var.html#t:Var">Var</a>)</li><li><a href="#v:local_tyvars">local_tyvars</a> :: [<a href="Var.html#t:TyVar">TyVar</a>]</li><li><a href="#v:local_tyvar_pa">local_tyvar_pa</a> :: <a href="VarEnv.html#t:VarEnv">VarEnv</a> <a href="CoreSyn.html#t:CoreExpr">CoreExpr</a></li><li><a href="#v:local_bind_name">local_bind_name</a> :: <a href="FastString.html#t:FastString">FastString</a></li></ul>}</li><li class="src short"><a href="#v:emptyLocalEnv">emptyLocalEnv</a> :: <a href="Vectorise-Env.html#t:LocalEnv">LocalEnv</a></li><li class="src short"><span class="keyword">data</span> <a href="#t:GlobalEnv">GlobalEnv</a> = <a href="#v:GlobalEnv">GlobalEnv</a> {<ul class="subs"><li><a href="#v:global_vect_avoid">global_vect_avoid</a> :: <a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a></li><li><a href="#v:global_vars">global_vars</a> :: <a href="VarEnv.html#t:VarEnv">VarEnv</a> <a href="Var.html#t:Var">Var</a></li><li><a href="#v:global_parallel_vars">global_parallel_vars</a> :: <a href="VarSet.html#t:DVarSet">DVarSet</a></li><li><a href="#v:global_vect_decls">global_vect_decls</a> :: <a href="VarEnv.html#t:VarEnv">VarEnv</a> (<a href="../base-4.10.0.0/Data-Maybe.html#t:Maybe">Maybe</a> (<a href="Type.html#t:Type">Type</a>, <a href="CoreSyn.html#t:CoreExpr">CoreExpr</a>))</li><li><a href="#v:global_tycons">global_tycons</a> :: <a href="NameEnv.html#t:NameEnv">NameEnv</a> <a href="TyCon.html#t:TyCon">TyCon</a></li><li><a href="#v:global_parallel_tycons">global_parallel_tycons</a> :: <a href="NameSet.html#t:NameSet">NameSet</a></li><li><a href="#v:global_datacons">global_datacons</a> :: <a href="NameEnv.html#t:NameEnv">NameEnv</a> <a href="DataCon.html#t:DataCon">DataCon</a></li><li><a href="#v:global_pa_funs">global_pa_funs</a> :: <a href="NameEnv.html#t:NameEnv">NameEnv</a> <a href="Var.html#t:Var">Var</a></li><li><a href="#v:global_pr_funs">global_pr_funs</a> :: <a href="NameEnv.html#t:NameEnv">NameEnv</a> <a href="Var.html#t:Var">Var</a></li><li><a href="#v:global_inst_env">global_inst_env</a> :: <a href="InstEnv.html#t:InstEnvs">InstEnvs</a></li><li><a href="#v:global_fam_inst_env">global_fam_inst_env</a> :: <a href="FamInstEnv.html#t:FamInstEnvs">FamInstEnvs</a></li><li><a href="#v:global_bindings">global_bindings</a> :: [(<a href="Var.html#t:Var">Var</a>, <a href="CoreSyn.html#t:CoreExpr">CoreExpr</a>)]</li></ul>}</li><li class="src short"><a href="#v:initGlobalEnv">initGlobalEnv</a> :: <a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a> -&gt; <a href="HscTypes.html#t:VectInfo">VectInfo</a> -&gt; [<a href="CoreSyn.html#t:CoreVect">CoreVect</a>] -&gt; <a href="InstEnv.html#t:InstEnvs">InstEnvs</a> -&gt; <a href="FamInstEnv.html#t:FamInstEnvs">FamInstEnvs</a> -&gt; <a href="Vectorise-Env.html#t:GlobalEnv">GlobalEnv</a></li><li class="src short"><a href="#v:extendImportedVarsEnv">extendImportedVarsEnv</a> :: [(<a href="Var.html#t:Var">Var</a>, <a href="Var.html#t:Var">Var</a>)] -&gt; <a href="Vectorise-Env.html#t:GlobalEnv">GlobalEnv</a> -&gt; <a href="Vectorise-Env.html#t:GlobalEnv">GlobalEnv</a></li><li class="src short"><a href="#v:extendFamEnv">extendFamEnv</a> :: [<a href="FamInstEnv.html#t:FamInst">FamInst</a>] -&gt; <a href="Vectorise-Env.html#t:GlobalEnv">GlobalEnv</a> -&gt; <a href="Vectorise-Env.html#t:GlobalEnv">GlobalEnv</a></li><li class="src short"><a href="#v:setPAFunsEnv">setPAFunsEnv</a> :: [(<a href="Name.html#t:Name">Name</a>, <a href="Var.html#t:Var">Var</a>)] -&gt; <a href="Vectorise-Env.html#t:GlobalEnv">GlobalEnv</a> -&gt; <a href="Vectorise-Env.html#t:GlobalEnv">GlobalEnv</a></li><li class="src short"><a href="#v:setPRFunsEnv">setPRFunsEnv</a> :: [(<a href="Name.html#t:Name">Name</a>, <a href="Var.html#t:Var">Var</a>)] -&gt; <a href="Vectorise-Env.html#t:GlobalEnv">GlobalEnv</a> -&gt; <a href="Vectorise-Env.html#t:GlobalEnv">GlobalEnv</a></li><li class="src short"><a href="#v:modVectInfo">modVectInfo</a> :: <a href="Vectorise-Env.html#t:GlobalEnv">GlobalEnv</a> -&gt; [<a href="Var.html#t:Id">Id</a>] -&gt; [<a href="TyCon.html#t:TyCon">TyCon</a>] -&gt; [<a href="CoreSyn.html#t:CoreVect">CoreVect</a>] -&gt; <a href="HscTypes.html#t:VectInfo">VectInfo</a> -&gt; <a href="HscTypes.html#t:VectInfo">VectInfo</a></li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Scope" class="def">Scope</a> a b <a href="src/Vectorise-Env.html#Scope" class="link">Source</a> <a href="#t:Scope" class="selflink">#</a></p><div class="doc"><p>Indicates what scope something (a variable) is in.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Global" class="def">Global</a> a</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a id="v:Local" class="def">Local</a> b</td><td class="doc empty">&nbsp;</td></tr></table></div></div><h1 id="g:1">Local Environments</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:LocalEnv" class="def">LocalEnv</a> <a href="src/Vectorise-Env.html#LocalEnv" class="link">Source</a> <a href="#t:LocalEnv" class="selflink">#</a></p><div class="doc"><p>The local environment.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:LocalEnv" class="def">LocalEnv</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:local_vars" class="def">local_vars</a> :: <a href="VarEnv.html#t:VarEnv">VarEnv</a> (<a href="Var.html#t:Var">Var</a>, <a href="Var.html#t:Var">Var</a>)</dfn><div class="doc"><p>Mapping from local variables to their vectorised and lifted versions.</p></div></li><li><dfn class="src"><a id="v:local_tyvars" class="def">local_tyvars</a> :: [<a href="Var.html#t:TyVar">TyVar</a>]</dfn><div class="doc"><p>In-scope type variables.</p></div></li><li><dfn class="src"><a id="v:local_tyvar_pa" class="def">local_tyvar_pa</a> :: <a href="VarEnv.html#t:VarEnv">VarEnv</a> <a href="CoreSyn.html#t:CoreExpr">CoreExpr</a></dfn><div class="doc"><p>Mapping from tyvars to their PA dictionaries.</p></div></li><li><dfn class="src"><a id="v:local_bind_name" class="def">local_bind_name</a> :: <a href="FastString.html#t:FastString">FastString</a></dfn><div class="doc"><p>Local binding name. This is only used to generate better names for hoisted
 expressions.</p></div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:emptyLocalEnv" class="def">emptyLocalEnv</a> :: <a href="Vectorise-Env.html#t:LocalEnv">LocalEnv</a> <a href="src/Vectorise-Env.html#emptyLocalEnv" class="link">Source</a> <a href="#v:emptyLocalEnv" class="selflink">#</a></p><div class="doc"><p>Create an empty local environment.</p></div></div><h1 id="g:2">Global Environments</h1><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:GlobalEnv" class="def">GlobalEnv</a> <a href="src/Vectorise-Env.html#GlobalEnv" class="link">Source</a> <a href="#t:GlobalEnv" class="selflink">#</a></p><div class="doc"><p>The global environment: entities that exist at top-level.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:GlobalEnv" class="def">GlobalEnv</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:global_vect_avoid" class="def">global_vect_avoid</a> :: <a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a></dfn><div class="doc"><p><code><a href="../base-4.10.0.0/Data-Bool.html#v:True">True</a></code> implies to avoid vectorisation as far as possible.</p></div></li><li><dfn class="src"><a id="v:global_vars" class="def">global_vars</a> :: <a href="VarEnv.html#t:VarEnv">VarEnv</a> <a href="Var.html#t:Var">Var</a></dfn><div class="doc"><p>Mapping from global variables to their vectorised versions &#8212; aka the /vectorisation
 map/.</p></div></li><li><dfn class="src"><a id="v:global_parallel_vars" class="def">global_parallel_vars</a> :: <a href="VarSet.html#t:DVarSet">DVarSet</a></dfn><div class="doc"><p>The domain of <code><a href="Vectorise-Env.html#v:global_vars">global_vars</a></code>.</p><p>This information is not redundant as it is impossible to extract the domain from a
 <code><a href="VarEnv.html#t:VarEnv">VarEnv</a></code> (which is keyed on uniques alone). Moreover, we have mapped variables that
 do not involve parallelism &#8212; e.g., the workers of vectorised, but scalar data types.
 In addition, workers of parallel data types that we could not vectorise also need to
 be tracked.</p></div></li><li><dfn class="src"><a id="v:global_vect_decls" class="def">global_vect_decls</a> :: <a href="VarEnv.html#t:VarEnv">VarEnv</a> (<a href="../base-4.10.0.0/Data-Maybe.html#t:Maybe">Maybe</a> (<a href="Type.html#t:Type">Type</a>, <a href="CoreSyn.html#t:CoreExpr">CoreExpr</a>))</dfn><div class="doc"><p>Mapping from global variables that have a vectorisation declaration to the right-hand
 side of that declaration and its type and mapping variables that have NOVECTORISE
 declarations to <code><a href="../base-4.10.0.0/Data-Maybe.html#v:Nothing">Nothing</a></code>.</p></div></li><li><dfn class="src"><a id="v:global_tycons" class="def">global_tycons</a> :: <a href="NameEnv.html#t:NameEnv">NameEnv</a> <a href="TyCon.html#t:TyCon">TyCon</a></dfn><div class="doc"><p>Mapping from TyCons to their vectorised versions. The vectorised version will be
 identical to the original version if it is not changed by vectorisation. In any case,
 if a tycon appears in the domain of this mapping, it was successfully vectorised.</p></div></li><li><dfn class="src"><a id="v:global_parallel_tycons" class="def">global_parallel_tycons</a> :: <a href="NameSet.html#t:NameSet">NameSet</a></dfn><div class="doc"><p>Type constructors whose definition directly or indirectly includes a parallel type,
 such as '[::]'.</p><p>NB: This information is not redundant as some types have got a mapping in
     <code><a href="Vectorise-Env.html#v:global_tycons">global_tycons</a></code> (to a type other than themselves) and are still not parallel. An
     example is '(-&gt;)'. Moreover, some types have *not* got a mapping in <code><a href="Vectorise-Env.html#v:global_tycons">global_tycons</a></code>
     (because they couldn't be vectorised), but still contain parallel types.</p></div></li><li><dfn class="src"><a id="v:global_datacons" class="def">global_datacons</a> :: <a href="NameEnv.html#t:NameEnv">NameEnv</a> <a href="DataCon.html#t:DataCon">DataCon</a></dfn><div class="doc"><p>Mapping from DataCons to their vectorised versions.</p></div></li><li><dfn class="src"><a id="v:global_pa_funs" class="def">global_pa_funs</a> :: <a href="NameEnv.html#t:NameEnv">NameEnv</a> <a href="Var.html#t:Var">Var</a></dfn><div class="doc"><p>Mapping from TyCons to their PA dfuns.</p></div></li><li><dfn class="src"><a id="v:global_pr_funs" class="def">global_pr_funs</a> :: <a href="NameEnv.html#t:NameEnv">NameEnv</a> <a href="Var.html#t:Var">Var</a></dfn><div class="doc"><p>Mapping from TyCons to their PR dfuns.</p></div></li><li><dfn class="src"><a id="v:global_inst_env" class="def">global_inst_env</a> :: <a href="InstEnv.html#t:InstEnvs">InstEnvs</a></dfn><div class="doc"><p>External package inst-env &amp; home-package inst-env for class instances.</p></div></li><li><dfn class="src"><a id="v:global_fam_inst_env" class="def">global_fam_inst_env</a> :: <a href="FamInstEnv.html#t:FamInstEnvs">FamInstEnvs</a></dfn><div class="doc"><p>External package inst-env &amp; home-package inst-env for family instances.</p></div></li><li><dfn class="src"><a id="v:global_bindings" class="def">global_bindings</a> :: [(<a href="Var.html#t:Var">Var</a>, <a href="CoreSyn.html#t:CoreExpr">CoreExpr</a>)]</dfn><div class="doc"><p>Hoisted bindings &#8212; temporary storage for toplevel bindings during code gen.</p></div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><a id="v:initGlobalEnv" class="def">initGlobalEnv</a> :: <a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a> -&gt; <a href="HscTypes.html#t:VectInfo">VectInfo</a> -&gt; [<a href="CoreSyn.html#t:CoreVect">CoreVect</a>] -&gt; <a href="InstEnv.html#t:InstEnvs">InstEnvs</a> -&gt; <a href="FamInstEnv.html#t:FamInstEnvs">FamInstEnvs</a> -&gt; <a href="Vectorise-Env.html#t:GlobalEnv">GlobalEnv</a> <a href="src/Vectorise-Env.html#initGlobalEnv" class="link">Source</a> <a href="#v:initGlobalEnv" class="selflink">#</a></p><div class="doc"><p>Create an initial global environment.</p><p>We add scalar variables and type constructors identified by vectorisation pragmas already here
 to the global table, so that we can query scalarness during vectorisation, and especially, when
 vectorising the scalar entities' definitions themselves.</p></div></div><div class="top"><p class="src"><a id="v:extendImportedVarsEnv" class="def">extendImportedVarsEnv</a> :: [(<a href="Var.html#t:Var">Var</a>, <a href="Var.html#t:Var">Var</a>)] -&gt; <a href="Vectorise-Env.html#t:GlobalEnv">GlobalEnv</a> -&gt; <a href="Vectorise-Env.html#t:GlobalEnv">GlobalEnv</a> <a href="src/Vectorise-Env.html#extendImportedVarsEnv" class="link">Source</a> <a href="#v:extendImportedVarsEnv" class="selflink">#</a></p><div class="doc"><p>Extend the list of global variables in an environment.</p></div></div><div class="top"><p class="src"><a id="v:extendFamEnv" class="def">extendFamEnv</a> :: [<a href="FamInstEnv.html#t:FamInst">FamInst</a>] -&gt; <a href="Vectorise-Env.html#t:GlobalEnv">GlobalEnv</a> -&gt; <a href="Vectorise-Env.html#t:GlobalEnv">GlobalEnv</a> <a href="src/Vectorise-Env.html#extendFamEnv" class="link">Source</a> <a href="#v:extendFamEnv" class="selflink">#</a></p><div class="doc"><p>Extend the list of type family instances.</p></div></div><div class="top"><p class="src"><a id="v:setPAFunsEnv" class="def">setPAFunsEnv</a> :: [(<a href="Name.html#t:Name">Name</a>, <a href="Var.html#t:Var">Var</a>)] -&gt; <a href="Vectorise-Env.html#t:GlobalEnv">GlobalEnv</a> -&gt; <a href="Vectorise-Env.html#t:GlobalEnv">GlobalEnv</a> <a href="src/Vectorise-Env.html#setPAFunsEnv" class="link">Source</a> <a href="#v:setPAFunsEnv" class="selflink">#</a></p><div class="doc"><p>Set the list of PA functions in an environment.</p></div></div><div class="top"><p class="src"><a id="v:setPRFunsEnv" class="def">setPRFunsEnv</a> :: [(<a href="Name.html#t:Name">Name</a>, <a href="Var.html#t:Var">Var</a>)] -&gt; <a href="Vectorise-Env.html#t:GlobalEnv">GlobalEnv</a> -&gt; <a href="Vectorise-Env.html#t:GlobalEnv">GlobalEnv</a> <a href="src/Vectorise-Env.html#setPRFunsEnv" class="link">Source</a> <a href="#v:setPRFunsEnv" class="selflink">#</a></p><div class="doc"><p>Set the list of PR functions in an environment.</p></div></div><div class="top"><p class="src"><a id="v:modVectInfo" class="def">modVectInfo</a> :: <a href="Vectorise-Env.html#t:GlobalEnv">GlobalEnv</a> -&gt; [<a href="Var.html#t:Id">Id</a>] -&gt; [<a href="TyCon.html#t:TyCon">TyCon</a>] -&gt; [<a href="CoreSyn.html#t:CoreVect">CoreVect</a>] -&gt; <a href="HscTypes.html#t:VectInfo">VectInfo</a> -&gt; <a href="HscTypes.html#t:VectInfo">VectInfo</a> <a href="src/Vectorise-Env.html#modVectInfo" class="link">Source</a> <a href="#v:modVectInfo" class="selflink">#</a></p><div class="doc"><p>Compute vectorisation information that goes into <code><a href="HscTypes.html#t:ModGuts">ModGuts</a></code> (and is stored in interface files).
 The incoming <code>vectInfo</code> is that from the <code><a href="HscTypes.html#t:HscEnv">HscEnv</a></code> and <code><a href="HscTypes.html#v:EPS">EPS</a></code>.  The outgoing one contains only the
 declarations for the currently compiled module; this includes variables, type constructors, and
 data constructors referenced in VECTORISE pragmas, even if they are defined in an imported
 module.</p><p>The variables explicitly include class selectors and dfuns.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.18.2</p></div></body></html>