<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>basicTypes/Unique.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-
<a name="line-2"></a>(c) The University of Glasgow 2006
<a name="line-3"></a>(c) The GRASP/AQUA Project, Glasgow University, 1992-1998
<a name="line-4"></a>
<a name="line-5"></a>
<a name="line-6"></a>@Uniques@ are used to distinguish entities in the compiler (@Ids@,
<a name="line-7"></a>@Classes@, etc.) from each other.  Thus, @Uniques@ are the basic
<a name="line-8"></a>comparison key in the compiler.
<a name="line-9"></a>
<a name="line-10"></a>If there is any single operation that needs to be fast, it is @Unique@
<a name="line-11"></a>
<a name="line-12"></a>comparison.  Unsurprisingly, there is quite a bit of huff-and-puff
<a name="line-13"></a>directed to that end.
<a name="line-14"></a>
<a name="line-15"></a>Some of the other hair in this code is to be able to use a
<a name="line-16"></a>``splittable @UniqueSupply@'' if requested/possible (not standard
<a name="line-17"></a>Haskell).
<a name="line-18"></a>-}</span>
<a name="line-19"></a>
<a name="line-20"></a><span class='hs-comment'>{-# LANGUAGE CPP, BangPatterns, MagicHash #-}</span>
<a name="line-21"></a>
<a name="line-22"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Unique</span> <span class='hs-layout'>(</span>
<a name="line-23"></a>        <span class='hs-comment'>-- * Main data types</span>
<a name="line-24"></a>        <span class='hs-conid'>Unique</span><span class='hs-layout'>,</span> <span class='hs-conid'>Uniquable</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-25"></a>        <span class='hs-varid'>uNIQUE_BITS</span><span class='hs-layout'>,</span>
<a name="line-26"></a>
<a name="line-27"></a>        <span class='hs-comment'>-- ** Constructors, destructors and operations on 'Unique's</span>
<a name="line-28"></a>        <span class='hs-varid'>hasKey</span><span class='hs-layout'>,</span>
<a name="line-29"></a>
<a name="line-30"></a>        <span class='hs-varid'>pprUniqueAlways</span><span class='hs-layout'>,</span>
<a name="line-31"></a>
<a name="line-32"></a>        <span class='hs-varid'>mkUniqueGrimily</span><span class='hs-layout'>,</span>                <span class='hs-comment'>-- Used in UniqSupply only!</span>
<a name="line-33"></a>        <span class='hs-varid'>getKey</span><span class='hs-layout'>,</span>                         <span class='hs-comment'>-- Used in Var, UniqFM, Name only!</span>
<a name="line-34"></a>        <span class='hs-varid'>mkUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>unpkUnique</span><span class='hs-layout'>,</span>           <span class='hs-comment'>-- Used in BinIface only</span>
<a name="line-35"></a>
<a name="line-36"></a>        <span class='hs-varid'>deriveUnique</span><span class='hs-layout'>,</span>                   <span class='hs-comment'>-- Ditto</span>
<a name="line-37"></a>        <span class='hs-varid'>newTagUnique</span><span class='hs-layout'>,</span>                   <span class='hs-comment'>-- Used in CgCase</span>
<a name="line-38"></a>        <span class='hs-varid'>initTyVarUnique</span><span class='hs-layout'>,</span>
<a name="line-39"></a>        <span class='hs-varid'>nonDetCmpUnique</span><span class='hs-layout'>,</span>
<a name="line-40"></a>        <span class='hs-varid'>isValidKnownKeyUnique</span><span class='hs-layout'>,</span>          <span class='hs-comment'>-- Used in PrelInfo.knownKeyNamesOkay</span>
<a name="line-41"></a>
<a name="line-42"></a>        <span class='hs-comment'>-- ** Making built-in uniques</span>
<a name="line-43"></a>
<a name="line-44"></a>        <span class='hs-comment'>-- now all the built-in Uniques (and functions to make them)</span>
<a name="line-45"></a>        <span class='hs-comment'>-- [the Oh-So-Wonderful Haskell module system wins again...]</span>
<a name="line-46"></a>        <span class='hs-varid'>mkAlphaTyVarUnique</span><span class='hs-layout'>,</span>
<a name="line-47"></a>        <span class='hs-varid'>mkPrimOpIdUnique</span><span class='hs-layout'>,</span>
<a name="line-48"></a>        <span class='hs-varid'>mkPreludeMiscIdUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkPreludeDataConUnique</span><span class='hs-layout'>,</span>
<a name="line-49"></a>        <span class='hs-varid'>mkPreludeTyConUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkPreludeClassUnique</span><span class='hs-layout'>,</span>
<a name="line-50"></a>        <span class='hs-varid'>mkPArrDataConUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkCoVarUnique</span><span class='hs-layout'>,</span>
<a name="line-51"></a>
<a name="line-52"></a>        <span class='hs-varid'>mkVarOccUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkDataOccUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkTvOccUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkTcOccUnique</span><span class='hs-layout'>,</span>
<a name="line-53"></a>        <span class='hs-varid'>mkRegSingleUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkRegPairUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkRegClassUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkRegSubUnique</span><span class='hs-layout'>,</span>
<a name="line-54"></a>        <span class='hs-varid'>mkCostCentreUnique</span><span class='hs-layout'>,</span>
<a name="line-55"></a>
<a name="line-56"></a>        <span class='hs-varid'>mkBuiltinUnique</span><span class='hs-layout'>,</span>
<a name="line-57"></a>        <span class='hs-varid'>mkPseudoUniqueD</span><span class='hs-layout'>,</span>
<a name="line-58"></a>        <span class='hs-varid'>mkPseudoUniqueE</span><span class='hs-layout'>,</span>
<a name="line-59"></a>        <span class='hs-varid'>mkPseudoUniqueH</span><span class='hs-layout'>,</span>
<a name="line-60"></a>
<a name="line-61"></a>        <span class='hs-comment'>-- ** Deriving uniques</span>
<a name="line-62"></a>        <span class='hs-comment'>-- *** From TyCon name uniques</span>
<a name="line-63"></a>        <span class='hs-varid'>tyConRepNameUnique</span><span class='hs-layout'>,</span>
<a name="line-64"></a>        <span class='hs-comment'>-- *** From DataCon name uniques</span>
<a name="line-65"></a>        <span class='hs-varid'>dataConWorkerUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>dataConRepNameUnique</span>
<a name="line-66"></a>    <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-67"></a>
<a name="line-68"></a><span class='hs-cpp'>#include "HsVersions.h"</span>
<a name="line-69"></a><span class='hs-cpp'>#include "Unique.h"</span>
<a name="line-70"></a>
<a name="line-71"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>BasicTypes</span>
<a name="line-72"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>FastString</span>
<a name="line-73"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Outputable</span>
<a name="line-74"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Util</span>
<a name="line-75"></a>
<a name="line-76"></a><span class='hs-comment'>-- just for implementing a fast [0,61) -&gt; Char function</span>
<a name="line-77"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC</span><span class='hs-varop'>.</span><span class='hs-conid'>Exts</span> <span class='hs-layout'>(</span><span class='hs-varid'>indexCharOffAddr</span><span class='hs-cpp'>#</span><span class='hs-layout'>,</span> <span class='hs-conid'>Char</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-78"></a>
<a name="line-79"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Char</span>        <span class='hs-layout'>(</span> <span class='hs-varid'>chr</span><span class='hs-layout'>,</span> <span class='hs-varid'>ord</span> <span class='hs-layout'>)</span>
<a name="line-80"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Bits</span>
<a name="line-81"></a>
<a name="line-82"></a><span class='hs-comment'>{-
<a name="line-83"></a>************************************************************************
<a name="line-84"></a>*                                                                      *
<a name="line-85"></a>\subsection[Unique-type]{@Unique@ type and operations}
<a name="line-86"></a>*                                                                      *
<a name="line-87"></a>************************************************************************
<a name="line-88"></a>
<a name="line-89"></a>The @Chars@ are ``tag letters'' that identify the @UniqueSupply@.
<a name="line-90"></a>Fast comparison is everything on @Uniques@:
<a name="line-91"></a>-}</span>
<a name="line-92"></a>
<a name="line-93"></a><a name="Unique"></a><span class='hs-comment'>-- | Unique identifier.</span>
<a name="line-94"></a><a name="Unique"></a><span class='hs-comment'>--</span>
<a name="line-95"></a><a name="Unique"></a><span class='hs-comment'>-- The type of unique identifiers that are used in many places in GHC</span>
<a name="line-96"></a><a name="Unique"></a><span class='hs-comment'>-- for fast ordering and equality tests. You should generate these with</span>
<a name="line-97"></a><a name="Unique"></a><span class='hs-comment'>-- the functions from the 'UniqSupply' module</span>
<a name="line-98"></a><a name="Unique"></a><span class='hs-comment'>--</span>
<a name="line-99"></a><a name="Unique"></a><span class='hs-comment'>-- These are sometimes also referred to as \"keys\" in comments in GHC.</span>
<a name="line-100"></a><a name="Unique"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>MkUnique</span> <span class='hs-conid'>Int</span>
<a name="line-101"></a>
<a name="line-102"></a><a name="uNIQUE_BITS"></a><span class='hs-comment'>{-# INLINE uNIQUE_BITS #-}</span>
<a name="line-103"></a><span class='hs-definition'>uNIQUE_BITS</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span>
<a name="line-104"></a><span class='hs-definition'>uNIQUE_BITS</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>finiteBitSize</span> <span class='hs-layout'>(</span><span class='hs-num'>0</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span> <span class='hs-comment'>-</span> <span class='hs-conid'>UNIQUE_TAG_BITS</span>
<a name="line-105"></a>
<a name="line-106"></a><span class='hs-comment'>{-
<a name="line-107"></a>Now come the functions which construct uniques from their pieces, and vice versa.
<a name="line-108"></a>The stuff about unique *supplies* is handled further down this module.
<a name="line-109"></a>-}</span>
<a name="line-110"></a>
<a name="line-111"></a><a name="unpkUnique"></a><span class='hs-definition'>unpkUnique</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Char</span><span class='hs-layout'>,</span> <span class='hs-conid'>Int</span><span class='hs-layout'>)</span>        <span class='hs-comment'>-- The reverse</span>
<a name="line-112"></a>
<a name="line-113"></a><a name="mkUniqueGrimily"></a><span class='hs-definition'>mkUniqueGrimily</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>                <span class='hs-comment'>-- A trap-door for UniqSupply</span>
<a name="line-114"></a><a name="getKey"></a><span class='hs-definition'>getKey</span>          <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>                <span class='hs-comment'>-- for Var</span>
<a name="line-115"></a>
<a name="line-116"></a><a name="incrUnique"></a><span class='hs-definition'>incrUnique</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-117"></a><a name="stepUnique"></a><span class='hs-definition'>stepUnique</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-118"></a><a name="deriveUnique"></a><span class='hs-definition'>deriveUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-119"></a><a name="newTagUnique"></a><span class='hs-definition'>newTagUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-120"></a>
<a name="line-121"></a><span class='hs-definition'>mkUniqueGrimily</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>MkUnique</span>
<a name="line-122"></a>
<a name="line-123"></a><span class='hs-comment'>{-# INLINE getKey #-}</span>
<a name="line-124"></a><span class='hs-definition'>getKey</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>x</span>
<a name="line-125"></a>
<a name="line-126"></a><span class='hs-definition'>incrUnique</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>MkUnique</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span> <span class='hs-varop'>+</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span>
<a name="line-127"></a><span class='hs-definition'>stepUnique</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>MkUnique</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span> <span class='hs-varop'>+</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-128"></a>
<a name="line-129"></a><span class='hs-comment'>-- deriveUnique uses an 'X' tag so that it won't clash with</span>
<a name="line-130"></a><span class='hs-comment'>-- any of the uniques produced any other way</span>
<a name="line-131"></a><span class='hs-comment'>-- SPJ says: this looks terribly smelly to me!</span>
<a name="line-132"></a><span class='hs-definition'>deriveUnique</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-varid'>delta</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'X'</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span> <span class='hs-varop'>+</span> <span class='hs-varid'>delta</span><span class='hs-layout'>)</span>
<a name="line-133"></a>
<a name="line-134"></a><span class='hs-comment'>-- newTagUnique changes the "domain" of a unique to a different char</span>
<a name="line-135"></a><span class='hs-definition'>newTagUnique</span> <span class='hs-varid'>u</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-varid'>c</span> <span class='hs-varid'>i</span> <span class='hs-keyword'>where</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span><span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unpkUnique</span> <span class='hs-varid'>u</span>
<a name="line-136"></a>
<a name="line-137"></a><a name="uniqueMask"></a><span class='hs-comment'>-- | How many bits are devoted to the unique index (as opposed to the class</span>
<a name="line-138"></a><span class='hs-comment'>-- character).</span>
<a name="line-139"></a><span class='hs-definition'>uniqueMask</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span>
<a name="line-140"></a><span class='hs-definition'>uniqueMask</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-num'>1</span> <span class='hs-varop'>`shiftL`</span> <span class='hs-varid'>uNIQUE_BITS</span><span class='hs-layout'>)</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span>
<a name="line-141"></a>
<a name="line-142"></a><span class='hs-comment'>-- pop the Char in the top 8 bits of the Unique(Supply)</span>
<a name="line-143"></a>
<a name="line-144"></a><span class='hs-comment'>-- No 64-bit bugs here, as long as we have at least 32 bits. --JSM</span>
<a name="line-145"></a>
<a name="line-146"></a><span class='hs-comment'>-- and as long as the Char fits in 8 bits, which we assume anyway!</span>
<a name="line-147"></a>
<a name="line-148"></a><a name="mkUnique"></a><span class='hs-definition'>mkUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>       <span class='hs-comment'>-- Builds a unique from pieces</span>
<a name="line-149"></a><span class='hs-comment'>-- NOT EXPORTED, so that we can see all the Chars that</span>
<a name="line-150"></a><span class='hs-comment'>--               are used in this one module</span>
<a name="line-151"></a><span class='hs-definition'>mkUnique</span> <span class='hs-varid'>c</span> <span class='hs-varid'>i</span>
<a name="line-152"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>MkUnique</span> <span class='hs-layout'>(</span><span class='hs-varid'>tag</span> <span class='hs-varop'>.|.</span> <span class='hs-varid'>bits</span><span class='hs-layout'>)</span>
<a name="line-153"></a>  <span class='hs-keyword'>where</span>
<a name="line-154"></a>    <span class='hs-varid'>tag</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ord</span> <span class='hs-varid'>c</span> <span class='hs-varop'>`shiftL`</span> <span class='hs-varid'>uNIQUE_BITS</span>
<a name="line-155"></a>    <span class='hs-varid'>bits</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>i</span> <span class='hs-varop'>.&amp;.</span> <span class='hs-varid'>uniqueMask</span>
<a name="line-156"></a>
<a name="line-157"></a><span class='hs-definition'>unpkUnique</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>u</span><span class='hs-layout'>)</span>
<a name="line-158"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span>
<a name="line-159"></a>        <span class='hs-comment'>-- as long as the Char may have its eighth bit set, we</span>
<a name="line-160"></a>        <span class='hs-comment'>-- really do need the logical right-shift here!</span>
<a name="line-161"></a>        <span class='hs-varid'>tag</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>chr</span> <span class='hs-layout'>(</span><span class='hs-varid'>u</span> <span class='hs-varop'>`shiftR`</span> <span class='hs-varid'>uNIQUE_BITS</span><span class='hs-layout'>)</span>
<a name="line-162"></a>        <span class='hs-varid'>i</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>u</span> <span class='hs-varop'>.&amp;.</span> <span class='hs-varid'>uniqueMask</span>
<a name="line-163"></a>    <span class='hs-keyword'>in</span>
<a name="line-164"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>tag</span><span class='hs-layout'>,</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span>
<a name="line-165"></a>
<a name="line-166"></a><a name="isValidKnownKeyUnique"></a><span class='hs-comment'>-- | The interface file symbol-table encoding assumes that known-key uniques fit</span>
<a name="line-167"></a><span class='hs-comment'>-- in 30-bits; verify this.</span>
<a name="line-168"></a><span class='hs-comment'>--</span>
<a name="line-169"></a><span class='hs-comment'>-- See Note [Symbol table representation of names] in BinIface for details.</span>
<a name="line-170"></a><span class='hs-definition'>isValidKnownKeyUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-171"></a><span class='hs-definition'>isValidKnownKeyUnique</span> <span class='hs-varid'>u</span> <span class='hs-keyglyph'>=</span>
<a name="line-172"></a>    <span class='hs-keyword'>case</span> <span class='hs-varid'>unpkUnique</span> <span class='hs-varid'>u</span> <span class='hs-keyword'>of</span>
<a name="line-173"></a>      <span class='hs-layout'>(</span><span class='hs-varid'>c</span><span class='hs-layout'>,</span> <span class='hs-varid'>x</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>ord</span> <span class='hs-varid'>c</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>0xff</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>x</span> <span class='hs-varop'>&lt;=</span> <span class='hs-layout'>(</span><span class='hs-num'>1</span> <span class='hs-varop'>`shiftL`</span> <span class='hs-num'>22</span><span class='hs-layout'>)</span>
<a name="line-174"></a>
<a name="line-175"></a><span class='hs-comment'>{-
<a name="line-176"></a>************************************************************************
<a name="line-177"></a>*                                                                      *
<a name="line-178"></a>\subsection[Uniquable-class]{The @Uniquable@ class}
<a name="line-179"></a>*                                                                      *
<a name="line-180"></a>************************************************************************
<a name="line-181"></a>-}</span>
<a name="line-182"></a>
<a name="line-183"></a><span class='hs-comment'>-- | Class of things that we can obtain a 'Unique' from</span>
<a name="line-184"></a><span class='hs-keyword'>class</span> <span class='hs-conid'>Uniquable</span> <span class='hs-varid'>a</span> <span class='hs-keyword'>where</span>
<a name="line-185"></a>    <span class='hs-varid'>getUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-186"></a>
<a name="line-187"></a><a name="hasKey"></a><span class='hs-definition'>hasKey</span>          <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Uniquable</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-188"></a><a name="hasKey"></a><span class='hs-definition'>x</span> <span class='hs-varop'>`hasKey`</span> <span class='hs-varid'>k</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getUnique</span> <span class='hs-varid'>x</span> <span class='hs-varop'>==</span> <span class='hs-varid'>k</span>
<a name="line-189"></a>
<a name="line-190"></a><a name="instance%20Uniquable%20FastString"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Uniquable</span> <span class='hs-conid'>FastString</span> <span class='hs-keyword'>where</span>
<a name="line-191"></a> <span class='hs-varid'>getUnique</span> <span class='hs-varid'>fs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUniqueGrimily</span> <span class='hs-layout'>(</span><span class='hs-varid'>uniqueOfFS</span> <span class='hs-varid'>fs</span><span class='hs-layout'>)</span>
<a name="line-192"></a>
<a name="line-193"></a><a name="instance%20Uniquable%20Int"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Uniquable</span> <span class='hs-conid'>Int</span> <span class='hs-keyword'>where</span>
<a name="line-194"></a> <span class='hs-varid'>getUnique</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUniqueGrimily</span> <span class='hs-varid'>i</span>
<a name="line-195"></a>
<a name="line-196"></a><span class='hs-comment'>{-
<a name="line-197"></a>************************************************************************
<a name="line-198"></a>*                                                                      *
<a name="line-199"></a>\subsection[Unique-instances]{Instance declarations for @Unique@}
<a name="line-200"></a>*                                                                      *
<a name="line-201"></a>************************************************************************
<a name="line-202"></a>
<a name="line-203"></a>And the whole point (besides uniqueness) is fast equality.  We don't
<a name="line-204"></a>use `deriving' because we want {\em precise} control of ordering
<a name="line-205"></a>(equality on @Uniques@ is v common).
<a name="line-206"></a>-}</span>
<a name="line-207"></a>
<a name="line-208"></a><span class='hs-comment'>-- Note [Unique Determinism]</span>
<a name="line-209"></a><span class='hs-comment'>-- ~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<a name="line-210"></a><span class='hs-comment'>-- The order of allocated @Uniques@ is not stable across rebuilds.</span>
<a name="line-211"></a><span class='hs-comment'>-- The main reason for that is that typechecking interface files pulls</span>
<a name="line-212"></a><span class='hs-comment'>-- @Uniques@ from @UniqSupply@ and the interface file for the module being</span>
<a name="line-213"></a><span class='hs-comment'>-- currently compiled can, but doesn't have to exist.</span>
<a name="line-214"></a><span class='hs-comment'>--</span>
<a name="line-215"></a><span class='hs-comment'>-- It gets more complicated if you take into account that the interface</span>
<a name="line-216"></a><span class='hs-comment'>-- files are loaded lazily and that building multiple files at once has to</span>
<a name="line-217"></a><span class='hs-comment'>-- work for any subset of interface files present. When you add parallelism</span>
<a name="line-218"></a><span class='hs-comment'>-- this makes @Uniques@ hopelessly random.</span>
<a name="line-219"></a><span class='hs-comment'>--</span>
<a name="line-220"></a><span class='hs-comment'>-- As such, to get deterministic builds, the order of the allocated</span>
<a name="line-221"></a><span class='hs-comment'>-- @Uniques@ should not affect the final result.</span>
<a name="line-222"></a><span class='hs-comment'>-- see also wiki/DeterministicBuilds</span>
<a name="line-223"></a><span class='hs-comment'>--</span>
<a name="line-224"></a><span class='hs-comment'>-- Note [Unique Determinism and code generation]</span>
<a name="line-225"></a><span class='hs-comment'>-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<a name="line-226"></a><span class='hs-comment'>-- The goal of the deterministic builds (wiki/DeterministicBuilds, #4012)</span>
<a name="line-227"></a><span class='hs-comment'>-- is to get ABI compatible binaries given the same inputs and environment.</span>
<a name="line-228"></a><span class='hs-comment'>-- The motivation behind that is that if the ABI doesn't change the</span>
<a name="line-229"></a><span class='hs-comment'>-- binaries can be safely reused.</span>
<a name="line-230"></a><span class='hs-comment'>-- Note that this is weaker than bit-for-bit identical binaries and getting</span>
<a name="line-231"></a><span class='hs-comment'>-- bit-for-bit identical binaries is not a goal for now.</span>
<a name="line-232"></a><span class='hs-comment'>-- This means that we don't care about nondeterminism that happens after</span>
<a name="line-233"></a><span class='hs-comment'>-- the interface files are created, in particular we don't care about</span>
<a name="line-234"></a><span class='hs-comment'>-- register allocation and code generation.</span>
<a name="line-235"></a><span class='hs-comment'>-- To track progress on bit-for-bit determinism see #12262.</span>
<a name="line-236"></a>
<a name="line-237"></a><a name="eqUnique"></a><span class='hs-definition'>eqUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-238"></a><span class='hs-definition'>eqUnique</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>u1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>u2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>u1</span> <span class='hs-varop'>==</span> <span class='hs-varid'>u2</span>
<a name="line-239"></a>
<a name="line-240"></a><a name="nonDetCmpUnique"></a><span class='hs-comment'>-- Provided here to make it explicit at the call-site that it can</span>
<a name="line-241"></a><span class='hs-comment'>-- introduce non-determinism.</span>
<a name="line-242"></a><span class='hs-comment'>-- See Note [Unique Determinism]</span>
<a name="line-243"></a><span class='hs-comment'>-- See Note [No Ord for Unique]</span>
<a name="line-244"></a><span class='hs-definition'>nonDetCmpUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ordering</span>
<a name="line-245"></a><span class='hs-definition'>nonDetCmpUnique</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>u1</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>MkUnique</span> <span class='hs-varid'>u2</span><span class='hs-layout'>)</span>
<a name="line-246"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>u1</span> <span class='hs-varop'>==</span> <span class='hs-varid'>u2</span> <span class='hs-keyword'>then</span> <span class='hs-conid'>EQ</span> <span class='hs-keyword'>else</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>u1</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>u2</span> <span class='hs-keyword'>then</span> <span class='hs-conid'>LT</span> <span class='hs-keyword'>else</span> <span class='hs-conid'>GT</span>
<a name="line-247"></a>
<a name="line-248"></a><span class='hs-comment'>{-
<a name="line-249"></a>Note [No Ord for Unique]
<a name="line-250"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-251"></a>As explained in Note [Unique Determinism] the relative order of Uniques
<a name="line-252"></a>is nondeterministic. To prevent from accidental use the Ord Unique
<a name="line-253"></a>instance has been removed.
<a name="line-254"></a>This makes it easier to maintain deterministic builds, but comes with some
<a name="line-255"></a>drawbacks.
<a name="line-256"></a>The biggest drawback is that Maps keyed by Uniques can't directly be used.
<a name="line-257"></a>The alternatives are:
<a name="line-258"></a>
<a name="line-259"></a>  1) Use UniqFM or UniqDFM, see Note [Deterministic UniqFM] to decide which
<a name="line-260"></a>  2) Create a newtype wrapper based on Unique ordering where nondeterminism
<a name="line-261"></a>     is controlled. See Module.ModuleEnv
<a name="line-262"></a>  3) Change the algorithm to use nonDetCmpUnique and document why it's still
<a name="line-263"></a>     deterministic
<a name="line-264"></a>  4) Use TrieMap as done in CmmCommonBlockElim.groupByLabel
<a name="line-265"></a>-}</span>
<a name="line-266"></a>
<a name="line-267"></a><a name="instance%20Eq%20Unique"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Eq</span> <span class='hs-conid'>Unique</span> <span class='hs-keyword'>where</span>
<a name="line-268"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>==</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>eqUnique</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-269"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>/=</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>eqUnique</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-270"></a>
<a name="line-271"></a><a name="instance%20Uniquable%20Unique"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Uniquable</span> <span class='hs-conid'>Unique</span> <span class='hs-keyword'>where</span>
<a name="line-272"></a>    <span class='hs-varid'>getUnique</span> <span class='hs-varid'>u</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>u</span>
<a name="line-273"></a>
<a name="line-274"></a><span class='hs-comment'>-- We do sometimes make strings with @Uniques@ in them:</span>
<a name="line-275"></a>
<a name="line-276"></a><a name="showUnique"></a><span class='hs-definition'>showUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-277"></a><span class='hs-definition'>showUnique</span> <span class='hs-varid'>uniq</span>
<a name="line-278"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>unpkUnique</span> <span class='hs-varid'>uniq</span> <span class='hs-keyword'>of</span>
<a name="line-279"></a>      <span class='hs-layout'>(</span><span class='hs-varid'>tag</span><span class='hs-layout'>,</span> <span class='hs-varid'>u</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>finish_show</span> <span class='hs-varid'>tag</span> <span class='hs-varid'>u</span> <span class='hs-layout'>(</span><span class='hs-varid'>iToBase62</span> <span class='hs-varid'>u</span><span class='hs-layout'>)</span>
<a name="line-280"></a>
<a name="line-281"></a><a name="finish_show"></a><span class='hs-definition'>finish_show</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Char</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-282"></a><span class='hs-definition'>finish_show</span> <span class='hs-chr'>'t'</span> <span class='hs-varid'>u</span> <span class='hs-sel'>_pp_u</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>u</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>26</span>
<a name="line-283"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-comment'>-- Special case to make v common tyvars, t1, t2, ...</span>
<a name="line-284"></a>    <span class='hs-comment'>-- come out as a, b, ... (shorter, easier to read)</span>
<a name="line-285"></a>    <span class='hs-keyglyph'>[</span><span class='hs-varid'>chr</span> <span class='hs-layout'>(</span><span class='hs-varid'>ord</span> <span class='hs-chr'>'a'</span> <span class='hs-varop'>+</span> <span class='hs-varid'>u</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-286"></a><span class='hs-definition'>finish_show</span> <span class='hs-varid'>tag</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>pp_u</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tag</span> <span class='hs-conop'>:</span> <span class='hs-varid'>pp_u</span>
<a name="line-287"></a>
<a name="line-288"></a><a name="pprUniqueAlways"></a><span class='hs-definition'>pprUniqueAlways</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-289"></a><span class='hs-comment'>-- The "always" means regardless of -dsuppress-uniques</span>
<a name="line-290"></a><span class='hs-comment'>-- It replaces the old pprUnique to remind callers that</span>
<a name="line-291"></a><span class='hs-comment'>-- they should consider whether they want to consult</span>
<a name="line-292"></a><span class='hs-comment'>-- Opt_SuppressUniques</span>
<a name="line-293"></a><span class='hs-definition'>pprUniqueAlways</span> <span class='hs-varid'>u</span>
<a name="line-294"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-layout'>(</span><span class='hs-varid'>showUnique</span> <span class='hs-varid'>u</span><span class='hs-layout'>)</span>
<a name="line-295"></a>
<a name="line-296"></a><a name="instance%20Outputable%20Unique"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>Unique</span> <span class='hs-keyword'>where</span>
<a name="line-297"></a>    <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprUniqueAlways</span>
<a name="line-298"></a>
<a name="line-299"></a><a name="instance%20Show%20Unique"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Show</span> <span class='hs-conid'>Unique</span> <span class='hs-keyword'>where</span>
<a name="line-300"></a>    <span class='hs-varid'>show</span> <span class='hs-varid'>uniq</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>showUnique</span> <span class='hs-varid'>uniq</span>
<a name="line-301"></a>
<a name="line-302"></a><span class='hs-comment'>{-
<a name="line-303"></a>************************************************************************
<a name="line-304"></a>*                                                                      *
<a name="line-305"></a>\subsection[Utils-base62]{Base-62 numbers}
<a name="line-306"></a>*                                                                      *
<a name="line-307"></a>************************************************************************
<a name="line-308"></a>
<a name="line-309"></a>A character-stingy way to read/write numbers (notably Uniques).
<a name="line-310"></a>The ``62-its'' are \tr{[0-9a-zA-Z]}.  We don't handle negative Ints.
<a name="line-311"></a>Code stolen from Lennart.
<a name="line-312"></a>-}</span>
<a name="line-313"></a>
<a name="line-314"></a><a name="iToBase62"></a><span class='hs-definition'>iToBase62</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-315"></a><span class='hs-definition'>iToBase62</span> <span class='hs-varid'>n_</span>
<a name="line-316"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ASSERT</span><span class='hs-layout'>(</span><span class='hs-varid'>n_</span> <span class='hs-varop'>&gt;=</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span> <span class='hs-varid'>go</span> <span class='hs-varid'>n_</span> <span class='hs-str'>""</span>
<a name="line-317"></a>  <span class='hs-keyword'>where</span>
<a name="line-318"></a>    <span class='hs-varid'>go</span> <span class='hs-varid'>n</span> <span class='hs-varid'>cs</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;</span> <span class='hs-num'>62</span>
<a name="line-319"></a>            <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-varop'>!</span><span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>chooseChar62</span> <span class='hs-varid'>n</span> <span class='hs-keyword'>in</span> <span class='hs-varid'>c</span> <span class='hs-conop'>:</span> <span class='hs-varid'>cs</span>
<a name="line-320"></a>            <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-321"></a>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>go</span> <span class='hs-varid'>q</span> <span class='hs-layout'>(</span><span class='hs-varid'>c</span> <span class='hs-conop'>:</span> <span class='hs-varid'>cs</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span> <span class='hs-layout'>(</span><span class='hs-varid'>q</span><span class='hs-layout'>,</span> <span class='hs-varid'>r</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>quotRem</span> <span class='hs-varid'>n</span> <span class='hs-num'>62</span>
<a name="line-322"></a>                                  <span class='hs-varop'>!</span><span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>chooseChar62</span> <span class='hs-varid'>r</span>
<a name="line-323"></a>
<a name="line-324"></a>    <span class='hs-varid'>chooseChar62</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Char</span>
<a name="line-325"></a>    <span class='hs-comment'>{-# INLINE chooseChar62 #-}</span>
<a name="line-326"></a>    <span class='hs-varid'>chooseChar62</span> <span class='hs-layout'>(</span><span class='hs-conid'>I</span><span class='hs-cpp'>#</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>C</span><span class='hs-cpp'>#</span> <span class='hs-layout'>(</span><span class='hs-varid'>indexCharOffAddr</span><span class='hs-cpp'>#</span> <span class='hs-varid'>chars62</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-327"></a>    <span class='hs-varid'>chars62</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span><span class='hs-cpp'>#</span>
<a name="line-328"></a>
<a name="line-329"></a><span class='hs-comment'>{-
<a name="line-330"></a>************************************************************************
<a name="line-331"></a>*                                                                      *
<a name="line-332"></a>\subsection[Uniques-prelude]{@Uniques@ for wired-in Prelude things}
<a name="line-333"></a>*                                                                      *
<a name="line-334"></a>************************************************************************
<a name="line-335"></a>
<a name="line-336"></a>Allocation of unique supply characters:
<a name="line-337"></a>        v,t,u : for renumbering value-, type- and usage- vars.
<a name="line-338"></a>        B:   builtin
<a name="line-339"></a>        C-E: pseudo uniques     (used in native-code generator)
<a name="line-340"></a>        X:   uniques derived by deriveUnique
<a name="line-341"></a>        _:   unifiable tyvars   (above)
<a name="line-342"></a>        0-9: prelude things below
<a name="line-343"></a>             (no numbers left any more..)
<a name="line-344"></a>        ::   (prelude) parallel array data constructors
<a name="line-345"></a>
<a name="line-346"></a>        other a-z: lower case chars for unique supplies.  Used so far:
<a name="line-347"></a>
<a name="line-348"></a>        d       desugarer
<a name="line-349"></a>        f       AbsC flattener
<a name="line-350"></a>        g       SimplStg
<a name="line-351"></a>        k       constraint tuple tycons
<a name="line-352"></a>        m       constraint tuple datacons
<a name="line-353"></a>        n       Native codegen
<a name="line-354"></a>        r       Hsc name cache
<a name="line-355"></a>        s       simplifier
<a name="line-356"></a>        z       anonymous sums
<a name="line-357"></a>-}</span>
<a name="line-358"></a>
<a name="line-359"></a><a name="mkAlphaTyVarUnique"></a><span class='hs-definition'>mkAlphaTyVarUnique</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-360"></a><a name="mkPreludeClassUnique"></a><span class='hs-definition'>mkPreludeClassUnique</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-361"></a><a name="mkPreludeTyConUnique"></a><span class='hs-definition'>mkPreludeTyConUnique</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-362"></a><a name="mkPreludeDataConUnique"></a><span class='hs-definition'>mkPreludeDataConUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Arity</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-363"></a><a name="mkPrimOpIdUnique"></a><span class='hs-definition'>mkPrimOpIdUnique</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-364"></a><a name="mkPreludeMiscIdUnique"></a><span class='hs-definition'>mkPreludeMiscIdUnique</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-365"></a><a name="mkPArrDataConUnique"></a><span class='hs-definition'>mkPArrDataConUnique</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-366"></a><a name="mkCoVarUnique"></a><span class='hs-definition'>mkCoVarUnique</span>          <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-367"></a>
<a name="line-368"></a><span class='hs-definition'>mkAlphaTyVarUnique</span>   <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'1'</span> <span class='hs-varid'>i</span>
<a name="line-369"></a><span class='hs-definition'>mkCoVarUnique</span>        <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'g'</span> <span class='hs-varid'>i</span>
<a name="line-370"></a><span class='hs-definition'>mkPreludeClassUnique</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'2'</span> <span class='hs-varid'>i</span>
<a name="line-371"></a>
<a name="line-372"></a><span class='hs-comment'>--------------------------------------------------</span>
<a name="line-373"></a><span class='hs-comment'>-- Wired-in type constructor keys occupy *two* slots:</span>
<a name="line-374"></a><span class='hs-comment'>--    * u: the TyCon itself</span>
<a name="line-375"></a><span class='hs-comment'>--    * u+1: the TyConRepName of the TyCon</span>
<a name="line-376"></a><span class='hs-definition'>mkPreludeTyConUnique</span> <span class='hs-varid'>i</span>                <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'3'</span> <span class='hs-layout'>(</span><span class='hs-num'>2</span><span class='hs-varop'>*</span><span class='hs-varid'>i</span><span class='hs-layout'>)</span>
<a name="line-377"></a>
<a name="line-378"></a><a name="tyConRepNameUnique"></a><span class='hs-definition'>tyConRepNameUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-379"></a><span class='hs-definition'>tyConRepNameUnique</span>  <span class='hs-varid'>u</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>incrUnique</span> <span class='hs-varid'>u</span>
<a name="line-380"></a>
<a name="line-381"></a><span class='hs-comment'>-- Data constructor keys occupy *two* slots.  The first is used for the</span>
<a name="line-382"></a><span class='hs-comment'>-- data constructor itself and its wrapper function (the function that</span>
<a name="line-383"></a><span class='hs-comment'>-- evaluates arguments as necessary and calls the worker). The second is</span>
<a name="line-384"></a><span class='hs-comment'>-- used for the worker function (the function that builds the constructor</span>
<a name="line-385"></a><span class='hs-comment'>-- representation).</span>
<a name="line-386"></a>
<a name="line-387"></a><span class='hs-comment'>--------------------------------------------------</span>
<a name="line-388"></a><span class='hs-comment'>-- Wired-in data constructor keys occupy *three* slots:</span>
<a name="line-389"></a><span class='hs-comment'>--    * u: the DataCon itself</span>
<a name="line-390"></a><span class='hs-comment'>--    * u+1: its worker Id</span>
<a name="line-391"></a><span class='hs-comment'>--    * u+2: the TyConRepName of the promoted TyCon</span>
<a name="line-392"></a><span class='hs-comment'>-- Prelude data constructors are too simple to need wrappers.</span>
<a name="line-393"></a>
<a name="line-394"></a><span class='hs-definition'>mkPreludeDataConUnique</span> <span class='hs-varid'>i</span>              <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'6'</span> <span class='hs-layout'>(</span><span class='hs-num'>3</span><span class='hs-varop'>*</span><span class='hs-varid'>i</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- Must be alphabetic</span>
<a name="line-395"></a>
<a name="line-396"></a><a name="dataConRepNameUnique"></a><span class='hs-comment'>--------------------------------------------------</span>
<a name="line-397"></a><span class='hs-definition'>dataConRepNameUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>dataConWorkerUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-398"></a><a name="dataConWorkerUnique"></a><span class='hs-definition'>dataConWorkerUnique</span>  <span class='hs-varid'>u</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>incrUnique</span> <span class='hs-varid'>u</span>
<a name="line-399"></a><span class='hs-definition'>dataConRepNameUnique</span> <span class='hs-varid'>u</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>stepUnique</span> <span class='hs-varid'>u</span> <span class='hs-num'>2</span>
<a name="line-400"></a>
<a name="line-401"></a><span class='hs-comment'>--------------------------------------------------</span>
<a name="line-402"></a><span class='hs-definition'>mkPrimOpIdUnique</span> <span class='hs-varid'>op</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'9'</span> <span class='hs-varid'>op</span>
<a name="line-403"></a><span class='hs-definition'>mkPreludeMiscIdUnique</span>  <span class='hs-varid'>i</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'0'</span> <span class='hs-varid'>i</span>
<a name="line-404"></a>
<a name="line-405"></a><span class='hs-comment'>-- No numbers left anymore, so I pick something different for the character tag</span>
<a name="line-406"></a><span class='hs-definition'>mkPArrDataConUnique</span> <span class='hs-varid'>a</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>':'</span> <span class='hs-layout'>(</span><span class='hs-num'>2</span><span class='hs-varop'>*</span><span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-407"></a>
<a name="line-408"></a><span class='hs-comment'>-- The "tyvar uniques" print specially nicely: a, b, c, etc.</span>
<a name="line-409"></a><span class='hs-comment'>-- See pprUnique for details</span>
<a name="line-410"></a>
<a name="line-411"></a><a name="initTyVarUnique"></a><span class='hs-definition'>initTyVarUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Unique</span>
<a name="line-412"></a><span class='hs-definition'>initTyVarUnique</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'t'</span> <span class='hs-num'>0</span>
<a name="line-413"></a>
<a name="line-414"></a><a name="mkPseudoUniqueD"></a><span class='hs-definition'>mkPseudoUniqueD</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkPseudoUniqueE</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkPseudoUniqueH</span><span class='hs-layout'>,</span>
<a name="line-415"></a>   <span class='hs-varid'>mkBuiltinUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-416"></a>
<a name="line-417"></a><a name="mkBuiltinUnique"></a><span class='hs-definition'>mkBuiltinUnique</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'B'</span> <span class='hs-varid'>i</span>
<a name="line-418"></a><span class='hs-definition'>mkPseudoUniqueD</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'D'</span> <span class='hs-varid'>i</span> <span class='hs-comment'>-- used in NCG for getUnique on RealRegs</span>
<a name="line-419"></a><a name="mkPseudoUniqueE"></a><span class='hs-definition'>mkPseudoUniqueE</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'E'</span> <span class='hs-varid'>i</span> <span class='hs-comment'>-- used in NCG spiller to create spill VirtualRegs</span>
<a name="line-420"></a><a name="mkPseudoUniqueH"></a><span class='hs-definition'>mkPseudoUniqueH</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'H'</span> <span class='hs-varid'>i</span> <span class='hs-comment'>-- used in NCG spiller to create spill VirtualRegs</span>
<a name="line-421"></a>
<a name="line-422"></a><a name="mkRegSingleUnique"></a><span class='hs-definition'>mkRegSingleUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkRegPairUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkRegSubUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkRegClassUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-423"></a><span class='hs-definition'>mkRegSingleUnique</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'R'</span>
<a name="line-424"></a><a name="mkRegSubUnique"></a><span class='hs-definition'>mkRegSubUnique</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'S'</span>
<a name="line-425"></a><a name="mkRegPairUnique"></a><span class='hs-definition'>mkRegPairUnique</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'P'</span>
<a name="line-426"></a><a name="mkRegClassUnique"></a><span class='hs-definition'>mkRegClassUnique</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'L'</span>
<a name="line-427"></a>
<a name="line-428"></a><a name="mkCostCentreUnique"></a><span class='hs-definition'>mkCostCentreUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-429"></a><span class='hs-definition'>mkCostCentreUnique</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'C'</span>
<a name="line-430"></a>
<a name="line-431"></a><a name="mkVarOccUnique"></a><span class='hs-definition'>mkVarOccUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkDataOccUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkTvOccUnique</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkTcOccUnique</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FastString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Unique</span>
<a name="line-432"></a><span class='hs-comment'>-- See Note [The Unique of an OccName] in OccName</span>
<a name="line-433"></a><span class='hs-definition'>mkVarOccUnique</span>  <span class='hs-varid'>fs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'i'</span> <span class='hs-layout'>(</span><span class='hs-varid'>uniqueOfFS</span> <span class='hs-varid'>fs</span><span class='hs-layout'>)</span>
<a name="line-434"></a><a name="mkDataOccUnique"></a><span class='hs-definition'>mkDataOccUnique</span> <span class='hs-varid'>fs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'d'</span> <span class='hs-layout'>(</span><span class='hs-varid'>uniqueOfFS</span> <span class='hs-varid'>fs</span><span class='hs-layout'>)</span>
<a name="line-435"></a><a name="mkTvOccUnique"></a><span class='hs-definition'>mkTvOccUnique</span>   <span class='hs-varid'>fs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'v'</span> <span class='hs-layout'>(</span><span class='hs-varid'>uniqueOfFS</span> <span class='hs-varid'>fs</span><span class='hs-layout'>)</span>
<a name="line-436"></a><a name="mkTcOccUnique"></a><span class='hs-definition'>mkTcOccUnique</span>   <span class='hs-varid'>fs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkUnique</span> <span class='hs-chr'>'c'</span> <span class='hs-layout'>(</span><span class='hs-varid'>uniqueOfFS</span> <span class='hs-varid'>fs</span><span class='hs-layout'>)</span>
</pre></body>
</html>
