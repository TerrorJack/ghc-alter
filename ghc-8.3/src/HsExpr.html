<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>hsSyn/HsExpr.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-
<a name="line-2"></a>(c) The University of Glasgow 2006
<a name="line-3"></a>(c) The GRASP/AQUA Project, Glasgow University, 1992-1998
<a name="line-4"></a>-}</span>
<a name="line-5"></a>
<a name="line-6"></a><span class='hs-comment'>{-# LANGUAGE CPP, DeriveDataTypeable, ScopedTypeVariables #-}</span>
<a name="line-7"></a><span class='hs-comment'>{-# LANGUAGE StandaloneDeriving #-}</span>
<a name="line-8"></a><span class='hs-comment'>{-# LANGUAGE FlexibleContexts #-}</span>
<a name="line-9"></a><span class='hs-comment'>{-# LANGUAGE UndecidableInstances #-}</span> <span class='hs-comment'>-- Note [Pass sensitive types]</span>
<a name="line-10"></a>                                      <span class='hs-comment'>-- in module PlaceHolder</span>
<a name="line-11"></a><span class='hs-comment'>{-# LANGUAGE ConstraintKinds #-}</span>
<a name="line-12"></a><span class='hs-comment'>{-# LANGUAGE ExistentialQuantification #-}</span>
<a name="line-13"></a><span class='hs-comment'>{-# LANGUAGE DeriveFunctor #-}</span>
<a name="line-14"></a>
<a name="line-15"></a><span class='hs-comment'>-- | Abstract Haskell syntax for expressions.</span>
<a name="line-16"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>HsExpr</span> <span class='hs-keyword'>where</span>
<a name="line-17"></a>
<a name="line-18"></a><span class='hs-cpp'>#include "HsVersions.h"</span>
<a name="line-19"></a>
<a name="line-20"></a><span class='hs-comment'>-- friends:</span>
<a name="line-21"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsDecls</span>
<a name="line-22"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsPat</span>
<a name="line-23"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsLit</span>
<a name="line-24"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>PlaceHolder</span> <span class='hs-layout'>(</span> <span class='hs-conid'>NameOrRdrName</span> <span class='hs-layout'>)</span>
<a name="line-25"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsExtension</span>
<a name="line-26"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsTypes</span>
<a name="line-27"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>HsBinds</span>
<a name="line-28"></a>
<a name="line-29"></a><span class='hs-comment'>-- others:</span>
<a name="line-30"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TcEvidence</span>
<a name="line-31"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>CoreSyn</span>
<a name="line-32"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>DynFlags</span> <span class='hs-layout'>(</span> <span class='hs-varid'>gopt</span><span class='hs-layout'>,</span> <span class='hs-conid'>GeneralFlag</span><span class='hs-layout'>(</span><span class='hs-conid'>Opt_PrintExplicitCoercions</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<a name="line-33"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Name</span>
<a name="line-34"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>NameSet</span>
<a name="line-35"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>RdrName</span>  <span class='hs-layout'>(</span> <span class='hs-conid'>GlobalRdrEnv</span> <span class='hs-layout'>)</span>
<a name="line-36"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>BasicTypes</span>
<a name="line-37"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>ConLike</span>
<a name="line-38"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>SrcLoc</span>
<a name="line-39"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Util</span>
<a name="line-40"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Outputable</span>
<a name="line-41"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>FastString</span>
<a name="line-42"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Type</span>
<a name="line-43"></a>
<a name="line-44"></a><span class='hs-comment'>-- libraries:</span>
<a name="line-45"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Data</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-conid'>Fixity</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-46"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Data</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>Fixity</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-47"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>isNothing</span><span class='hs-layout'>)</span>
<a name="line-48"></a>
<a name="line-49"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHCi</span><span class='hs-varop'>.</span><span class='hs-conid'>RemoteTypes</span> <span class='hs-layout'>(</span> <span class='hs-conid'>ForeignRef</span> <span class='hs-layout'>)</span>
<a name="line-50"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Language</span><span class='hs-varop'>.</span><span class='hs-conid'>Haskell</span><span class='hs-varop'>.</span><span class='hs-conid'>TH</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>TH</span> <span class='hs-layout'>(</span><span class='hs-conid'>Q</span><span class='hs-layout'>)</span>
<a name="line-51"></a>
<a name="line-52"></a><span class='hs-comment'>{-
<a name="line-53"></a>************************************************************************
<a name="line-54"></a>*                                                                      *
<a name="line-55"></a>\subsection{Expressions proper}
<a name="line-56"></a>*                                                                      *
<a name="line-57"></a>************************************************************************
<a name="line-58"></a>-}</span>
<a name="line-59"></a>
<a name="line-60"></a><span class='hs-comment'>-- * Expressions proper</span>
<a name="line-61"></a>
<a name="line-62"></a><a name="LHsExpr"></a><span class='hs-comment'>-- | Located Haskell Expression</span>
<a name="line-63"></a><a name="LHsExpr"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-64"></a>  <span class='hs-comment'>-- ^ May have 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnComma' when</span>
<a name="line-65"></a>  <span class='hs-comment'>--   in a list</span>
<a name="line-66"></a>
<a name="line-67"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-68"></a>
<a name="line-69"></a><a name="PostTcExpr"></a><span class='hs-comment'>-------------------------</span>
<a name="line-70"></a><a name="PostTcExpr"></a><span class='hs-comment'>-- | Post-Type checking Expression</span>
<a name="line-71"></a><a name="PostTcExpr"></a><span class='hs-comment'>--</span>
<a name="line-72"></a><a name="PostTcExpr"></a><span class='hs-comment'>-- PostTcExpr is an evidence expression attached to the syntax tree by the</span>
<a name="line-73"></a><a name="PostTcExpr"></a><span class='hs-comment'>-- type checker (c.f. postTcType).</span>
<a name="line-74"></a><a name="PostTcExpr"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>PostTcExpr</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsExpr</span> <span class='hs-conid'>GhcTc</span>
<a name="line-75"></a>
<a name="line-76"></a><a name="PostTcTable"></a><span class='hs-comment'>-- | Post-Type checking Table</span>
<a name="line-77"></a><a name="PostTcTable"></a><span class='hs-comment'>--</span>
<a name="line-78"></a><a name="PostTcTable"></a><span class='hs-comment'>-- We use a PostTcTable where there are a bunch of pieces of evidence, more</span>
<a name="line-79"></a><a name="PostTcTable"></a><span class='hs-comment'>-- than is convenient to keep individually.</span>
<a name="line-80"></a><a name="PostTcTable"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>PostTcTable</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Name</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostTcExpr</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-81"></a>
<a name="line-82"></a><a name="noPostTcExpr"></a><span class='hs-definition'>noPostTcExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PostTcExpr</span>
<a name="line-83"></a><span class='hs-definition'>noPostTcExpr</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsLit</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsString</span> <span class='hs-varid'>noSourceText</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsLit</span> <span class='hs-str'>"noPostTcExpr"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-84"></a>
<a name="line-85"></a><a name="noPostTcTable"></a><span class='hs-definition'>noPostTcTable</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PostTcTable</span>
<a name="line-86"></a><span class='hs-definition'>noPostTcTable</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-87"></a>
<a name="line-88"></a><a name="SyntaxExpr"></a><span class='hs-comment'>-------------------------</span>
<a name="line-89"></a><a name="SyntaxExpr"></a><span class='hs-comment'>-- | Syntax Expression</span>
<a name="line-90"></a><a name="SyntaxExpr"></a><span class='hs-comment'>--</span>
<a name="line-91"></a><a name="SyntaxExpr"></a><span class='hs-comment'>-- SyntaxExpr is like 'PostTcExpr', but it's filled in a little earlier,</span>
<a name="line-92"></a><a name="SyntaxExpr"></a><span class='hs-comment'>-- by the renamer.  It's used for rebindable syntax.</span>
<a name="line-93"></a><a name="SyntaxExpr"></a><span class='hs-comment'>--</span>
<a name="line-94"></a><a name="SyntaxExpr"></a><span class='hs-comment'>-- E.g. @(&gt;&gt;=)@ is filled in before the renamer by the appropriate 'Name' for</span>
<a name="line-95"></a><a name="SyntaxExpr"></a><span class='hs-comment'>--      @(&gt;&gt;=)@, and then instantiated by the type checker with its type args</span>
<a name="line-96"></a><a name="SyntaxExpr"></a><span class='hs-comment'>--      etc</span>
<a name="line-97"></a><a name="SyntaxExpr"></a><span class='hs-comment'>--</span>
<a name="line-98"></a><a name="SyntaxExpr"></a><span class='hs-comment'>-- This should desugar to</span>
<a name="line-99"></a><a name="SyntaxExpr"></a><span class='hs-comment'>--</span>
<a name="line-100"></a><a name="SyntaxExpr"></a><span class='hs-comment'>-- &gt; syn_res_wrap $ syn_expr (syn_arg_wraps[0] arg0)</span>
<a name="line-101"></a><a name="SyntaxExpr"></a><span class='hs-comment'>-- &gt;                         (syn_arg_wraps[1] arg1) ...</span>
<a name="line-102"></a><a name="SyntaxExpr"></a><span class='hs-comment'>--</span>
<a name="line-103"></a><a name="SyntaxExpr"></a><span class='hs-comment'>-- where the actual arguments come from elsewhere in the AST.</span>
<a name="line-104"></a><a name="SyntaxExpr"></a><span class='hs-comment'>-- This could be defined using @PostRn@ and @PostTc@ and such, but it's</span>
<a name="line-105"></a><a name="SyntaxExpr"></a><span class='hs-comment'>-- harder to get it all to work out that way. ('noSyntaxExpr' is hard to</span>
<a name="line-106"></a><a name="SyntaxExpr"></a><span class='hs-comment'>-- write, for example.)</span>
<a name="line-107"></a><a name="SyntaxExpr"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-layout'>{</span> <span class='hs-varid'>syn_expr</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>p</span>
<a name="line-108"></a>                               <span class='hs-layout'>,</span> <span class='hs-varid'>syn_arg_wraps</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>HsWrapper</span><span class='hs-keyglyph'>]</span>
<a name="line-109"></a>                               <span class='hs-layout'>,</span> <span class='hs-varid'>syn_res_wrap</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsWrapper</span> <span class='hs-layout'>}</span>
<a name="line-110"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-111"></a>
<a name="line-112"></a><a name="noExpr"></a><span class='hs-comment'>-- | This is used for rebindable-syntax pieces that are too polymorphic</span>
<a name="line-113"></a><span class='hs-comment'>-- for tcSyntaxOp (trS_fmap and the mzip in ParStmt)</span>
<a name="line-114"></a><span class='hs-definition'>noExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>p</span>
<a name="line-115"></a><span class='hs-definition'>noExpr</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsLit</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsString</span> <span class='hs-layout'>(</span><span class='hs-varid'>sourceText</span>  <span class='hs-str'>"noExpr"</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsLit</span> <span class='hs-str'>"noExpr"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-116"></a>
<a name="line-117"></a><a name="noSyntaxExpr"></a><span class='hs-definition'>noSyntaxExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>p</span>
<a name="line-118"></a>                              <span class='hs-comment'>-- Before renaming, and sometimes after,</span>
<a name="line-119"></a>                              <span class='hs-comment'>-- (if the syntax slot makes no sense)</span>
<a name="line-120"></a><span class='hs-definition'>noSyntaxExpr</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-layout'>{</span> <span class='hs-varid'>syn_expr</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsLit</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsString</span> <span class='hs-varid'>noSourceText</span>
<a name="line-121"></a>                                                        <span class='hs-layout'>(</span><span class='hs-varid'>fsLit</span> <span class='hs-str'>"noSyntaxExpr"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-122"></a>                          <span class='hs-layout'>,</span> <span class='hs-varid'>syn_arg_wraps</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-123"></a>                          <span class='hs-layout'>,</span> <span class='hs-varid'>syn_res_wrap</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>WpHole</span> <span class='hs-layout'>}</span>
<a name="line-124"></a>
<a name="line-125"></a><a name="mkRnSyntaxExpr"></a><span class='hs-comment'>-- | Make a 'SyntaxExpr Name' (the "rn" is because this is used in the</span>
<a name="line-126"></a><span class='hs-comment'>-- renamer), missing its HsWrappers.</span>
<a name="line-127"></a><span class='hs-definition'>mkRnSyntaxExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-conid'>GhcRn</span>
<a name="line-128"></a><span class='hs-definition'>mkRnSyntaxExpr</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-layout'>{</span> <span class='hs-varid'>syn_expr</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsVar</span> <span class='hs-varop'>$</span> <span class='hs-varid'>noLoc</span> <span class='hs-varid'>name</span>
<a name="line-129"></a>                                 <span class='hs-layout'>,</span> <span class='hs-varid'>syn_arg_wraps</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-130"></a>                                 <span class='hs-layout'>,</span> <span class='hs-varid'>syn_res_wrap</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>WpHole</span> <span class='hs-layout'>}</span>
<a name="line-131"></a>  <span class='hs-comment'>-- don't care about filling in syn_arg_wraps because we're clearly</span>
<a name="line-132"></a>  <span class='hs-comment'>-- not past the typechecker</span>
<a name="line-133"></a>
<a name="line-134"></a><a name="instance%20Outputable%20(SyntaxExpr%20p)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-135"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-layout'>{</span> <span class='hs-varid'>syn_expr</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>expr</span>
<a name="line-136"></a>                  <span class='hs-layout'>,</span> <span class='hs-varid'>syn_arg_wraps</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>arg_wraps</span>
<a name="line-137"></a>                  <span class='hs-layout'>,</span> <span class='hs-varid'>syn_res_wrap</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>res_wrap</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-138"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sdocWithDynFlags</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span> <span class='hs-varid'>dflags</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-139"></a>      <span class='hs-varid'>getPprStyle</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-140"></a>      <span class='hs-keyword'>if</span> <span class='hs-varid'>debugStyle</span> <span class='hs-varid'>s</span> <span class='hs-varop'>||</span> <span class='hs-varid'>gopt</span> <span class='hs-conid'>Opt_PrintExplicitCoercions</span> <span class='hs-varid'>dflags</span>
<a name="line-141"></a>      <span class='hs-keyword'>then</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>braces</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprWithCommas</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>arg_wraps</span><span class='hs-layout'>)</span>
<a name="line-142"></a>                    <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>braces</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>res_wrap</span><span class='hs-layout'>)</span>
<a name="line-143"></a>      <span class='hs-keyword'>else</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span>
<a name="line-144"></a>
<a name="line-145"></a><a name="CmdSyntaxTable"></a><span class='hs-comment'>-- | Command Syntax Table (for Arrow syntax)</span>
<a name="line-146"></a><a name="CmdSyntaxTable"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>CmdSyntaxTable</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>Name</span><span class='hs-layout'>,</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-147"></a><span class='hs-comment'>-- See Note [CmdSyntaxTable]</span>
<a name="line-148"></a>
<a name="line-149"></a><span class='hs-comment'>{-
<a name="line-150"></a>Note [CmdSyntaxtable]
<a name="line-151"></a>~~~~~~~~~~~~~~~~~~~~~
<a name="line-152"></a>Used only for arrow-syntax stuff (HsCmdTop), the CmdSyntaxTable keeps
<a name="line-153"></a>track of the methods needed for a Cmd.
<a name="line-154"></a>
<a name="line-155"></a>* Before the renamer, this list is an empty list
<a name="line-156"></a>
<a name="line-157"></a>* After the renamer, it takes the form @[(std_name, HsVar actual_name)]@
<a name="line-158"></a>  For example, for the 'arr' method
<a name="line-159"></a>   * normal case:            (GHC.Control.Arrow.arr, HsVar GHC.Control.Arrow.arr)
<a name="line-160"></a>   * with rebindable syntax: (GHC.Control.Arrow.arr, arr_22)
<a name="line-161"></a>             where @arr_22@ is whatever 'arr' is in scope
<a name="line-162"></a>
<a name="line-163"></a>* After the type checker, it takes the form [(std_name, &lt;expression&gt;)]
<a name="line-164"></a>  where &lt;expression&gt; is the evidence for the method.  This evidence is
<a name="line-165"></a>  instantiated with the class, but is still polymorphic in everything
<a name="line-166"></a>  else.  For example, in the case of 'arr', the evidence has type
<a name="line-167"></a>         forall b c. (b-&gt;c) -&gt; a b c
<a name="line-168"></a>  where 'a' is the ambient type of the arrow.  This polymorphism is
<a name="line-169"></a>  important because the desugarer uses the same evidence at multiple
<a name="line-170"></a>  different types.
<a name="line-171"></a>
<a name="line-172"></a>This is Less Cool than what we normally do for rebindable syntax, which is to
<a name="line-173"></a>make fully-instantiated piece of evidence at every use site.  The Cmd way
<a name="line-174"></a>is Less Cool because
<a name="line-175"></a>  * The renamer has to predict which methods are needed.
<a name="line-176"></a>    See the tedious RnExpr.methodNamesCmd.
<a name="line-177"></a>
<a name="line-178"></a>  * The desugarer has to know the polymorphic type of the instantiated
<a name="line-179"></a>    method. This is checked by Inst.tcSyntaxName, but is less flexible
<a name="line-180"></a>    than the rest of rebindable syntax, where the type is less
<a name="line-181"></a>    pre-ordained.  (And this flexibility is useful; for example we can
<a name="line-182"></a>    typecheck do-notation with (&gt;&gt;=) :: m1 a -&gt; (a -&gt; m2 b) -&gt; m2 b.)
<a name="line-183"></a>-}</span>
<a name="line-184"></a>
<a name="line-185"></a><a name="UnboundVar"></a><span class='hs-comment'>-- | An unbound variable; used for treating out-of-scope variables as</span>
<a name="line-186"></a><a name="UnboundVar"></a><span class='hs-comment'>-- expression holes</span>
<a name="line-187"></a><a name="UnboundVar"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>UnboundVar</span>
<a name="line-188"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>OutOfScope</span> <span class='hs-conid'>OccName</span> <span class='hs-conid'>GlobalRdrEnv</span>  <span class='hs-comment'>-- ^ An (unqualified) out-of-scope</span>
<a name="line-189"></a>                                     <span class='hs-comment'>-- variable, together with the GlobalRdrEnv</span>
<a name="line-190"></a>                                     <span class='hs-comment'>-- with respect to which it is unbound</span>
<a name="line-191"></a>
<a name="line-192"></a>                                     <span class='hs-comment'>-- See Note [OutOfScope and GlobalRdrEnv]</span>
<a name="line-193"></a>
<a name="line-194"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TrueExprHole</span> <span class='hs-conid'>OccName</span>             <span class='hs-comment'>-- ^ A "true" expression hole (_ or _x)</span>
<a name="line-195"></a>
<a name="line-196"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Data</span>
<a name="line-197"></a>
<a name="line-198"></a><a name="instance%20Outputable%20UnboundVar"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>UnboundVar</span> <span class='hs-keyword'>where</span>
<a name="line-199"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutOfScope</span> <span class='hs-varid'>occ</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"OutOfScope"</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>occ</span><span class='hs-layout'>)</span>
<a name="line-200"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>TrueExprHole</span> <span class='hs-varid'>occ</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"ExprHole"</span>   <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>occ</span><span class='hs-layout'>)</span>
<a name="line-201"></a>
<a name="line-202"></a><a name="unboundVarOcc"></a><span class='hs-definition'>unboundVarOcc</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>UnboundVar</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OccName</span>
<a name="line-203"></a><span class='hs-definition'>unboundVarOcc</span> <span class='hs-layout'>(</span><span class='hs-conid'>OutOfScope</span> <span class='hs-varid'>occ</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>occ</span>
<a name="line-204"></a><span class='hs-definition'>unboundVarOcc</span> <span class='hs-layout'>(</span><span class='hs-conid'>TrueExprHole</span> <span class='hs-varid'>occ</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>occ</span>
<a name="line-205"></a>
<a name="line-206"></a><span class='hs-comment'>{-
<a name="line-207"></a>Note [OutOfScope and GlobalRdrEnv]
<a name="line-208"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-209"></a>To understand why we bundle a GlobalRdrEnv with an out-of-scope variable,
<a name="line-210"></a>consider the following module:
<a name="line-211"></a>
<a name="line-212"></a>    module A where
<a name="line-213"></a>
<a name="line-214"></a>    foo :: ()
<a name="line-215"></a>    foo = bar
<a name="line-216"></a>
<a name="line-217"></a>    bat :: [Double]
<a name="line-218"></a>    bat = [1.2, 3.4]
<a name="line-219"></a>
<a name="line-220"></a>    $(return [])
<a name="line-221"></a>
<a name="line-222"></a>    bar = ()
<a name="line-223"></a>    bad = False
<a name="line-224"></a>
<a name="line-225"></a>When A is compiled, the renamer determines that `bar` is not in scope in the
<a name="line-226"></a>declaration of `foo` (since `bar` is declared in the following inter-splice
<a name="line-227"></a>group).  Once it has finished typechecking the entire module, the typechecker
<a name="line-228"></a>then generates the associated error message, which specifies both the type of
<a name="line-229"></a>`bar` and a list of possible in-scope alternatives:
<a name="line-230"></a>
<a name="line-231"></a>    A.hs:6:7: error:
<a name="line-232"></a>        • Variable not in scope: bar :: ()
<a name="line-233"></a>        • ‘bar’ (line 13) is not in scope before the splice on line 11
<a name="line-234"></a>          Perhaps you meant ‘bat’ (line 9)
<a name="line-235"></a>
<a name="line-236"></a>When it calls RnEnv.unknownNameSuggestions to identify these alternatives, the
<a name="line-237"></a>typechecker must provide a GlobalRdrEnv.  If it provided the current one, which
<a name="line-238"></a>contains top-level declarations for the entire module, the error message would
<a name="line-239"></a>incorrectly suggest the out-of-scope `bar` and `bad` as possible alternatives
<a name="line-240"></a>for `bar` (see Trac #11680).  Instead, the typechecker must use the same
<a name="line-241"></a>GlobalRdrEnv the renamer used when it determined that `bar` is out-of-scope.
<a name="line-242"></a>
<a name="line-243"></a>To obtain this GlobalRdrEnv, can the typechecker simply use the out-of-scope
<a name="line-244"></a>`bar`'s location to either reconstruct it (from the current GlobalRdrEnv) or to
<a name="line-245"></a>look it up in some global store?  Unfortunately, no.  The problem is that
<a name="line-246"></a>location information is not always sufficient for this task.  This is most
<a name="line-247"></a>apparent when dealing with the TH function addTopDecls, which adds its
<a name="line-248"></a>declarations to the FOLLOWING inter-splice group.  Consider these declarations:
<a name="line-249"></a>
<a name="line-250"></a>    ex9 = cat               -- cat is NOT in scope here
<a name="line-251"></a>
<a name="line-252"></a>    $(do -------------------------------------------------------------
<a name="line-253"></a>        ds &lt;- [d| f = cab   -- cat and cap are both in scope here
<a name="line-254"></a>                  cat = ()
<a name="line-255"></a>                |]
<a name="line-256"></a>        addTopDecls ds
<a name="line-257"></a>        [d| g = cab         -- only cap is in scope here
<a name="line-258"></a>            cap = True
<a name="line-259"></a>          |])
<a name="line-260"></a>
<a name="line-261"></a>    ex10 = cat              -- cat is NOT in scope here
<a name="line-262"></a>
<a name="line-263"></a>    $(return []) -----------------------------------------------------
<a name="line-264"></a>
<a name="line-265"></a>    ex11 = cat              -- cat is in scope
<a name="line-266"></a>
<a name="line-267"></a>Here, both occurrences of `cab` are out-of-scope, and so the typechecker needs
<a name="line-268"></a>the GlobalRdrEnvs which were used when they were renamed.  These GlobalRdrEnvs
<a name="line-269"></a>are different (`cat` is present only in the GlobalRdrEnv for f's `cab'), but the
<a name="line-270"></a>locations of the two `cab`s are the same (they are both created in the same
<a name="line-271"></a>splice).  Thus, we must include some additional information with each `cab` to
<a name="line-272"></a>allow the typechecker to obtain the correct GlobalRdrEnv.  Clearly, the simplest
<a name="line-273"></a>information to use is the GlobalRdrEnv itself.
<a name="line-274"></a>-}</span>
<a name="line-275"></a>
<a name="line-276"></a><a name="HsExpr"></a><span class='hs-comment'>-- | A Haskell expression.</span>
<a name="line-277"></a><a name="HsExpr"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>p</span>
<a name="line-278"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsVar</span>     <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Variable</span>
<a name="line-279"></a>
<a name="line-280"></a>                             <span class='hs-comment'>-- See Note [Located RdrNames]</span>
<a name="line-281"></a>
<a name="line-282"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsUnboundVar</span> <span class='hs-conid'>UnboundVar</span>  <span class='hs-comment'>-- ^ Unbound variable; also used for "holes"</span>
<a name="line-283"></a>                             <span class='hs-comment'>--   (_ or _x).</span>
<a name="line-284"></a>                             <span class='hs-comment'>-- Turned from HsVar to HsUnboundVar by the</span>
<a name="line-285"></a>                             <span class='hs-comment'>--   renamer, when it finds an out-of-scope</span>
<a name="line-286"></a>                             <span class='hs-comment'>--   variable or hole.</span>
<a name="line-287"></a>                             <span class='hs-comment'>-- Turned into HsVar by type checker, to support</span>
<a name="line-288"></a>                             <span class='hs-comment'>--   deferred type errors.</span>
<a name="line-289"></a>
<a name="line-290"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsConLikeOut</span> <span class='hs-conid'>ConLike</span>     <span class='hs-comment'>-- ^ After typechecker only; must be different</span>
<a name="line-291"></a>                             <span class='hs-comment'>-- HsVar for pretty printing</span>
<a name="line-292"></a>
<a name="line-293"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsRecFld</span> <span class='hs-layout'>(</span><span class='hs-conid'>AmbiguousFieldOcc</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Variable pointing to record selector</span>
<a name="line-294"></a>                                    <span class='hs-comment'>-- Not in use after typechecking</span>
<a name="line-295"></a>
<a name="line-296"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsOverLabel</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-conid'>FastString</span>
<a name="line-297"></a>     <span class='hs-comment'>-- ^ Overloaded label (Note [Overloaded labels] in GHC.OverloadedLabels)</span>
<a name="line-298"></a>     <span class='hs-comment'>--   @Just id@ means @RebindableSyntax@ is in use, and gives the id of the</span>
<a name="line-299"></a>     <span class='hs-comment'>--   in-scope 'fromLabel'.</span>
<a name="line-300"></a>     <span class='hs-comment'>--   NB: Not in use after typechecking</span>
<a name="line-301"></a>
<a name="line-302"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsIPVar</span>   <span class='hs-conid'>HsIPName</span>       <span class='hs-comment'>-- ^ Implicit parameter (not in use after typechecking)</span>
<a name="line-303"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsOverLit</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsOverLit</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- ^ Overloaded literals</span>
<a name="line-304"></a>
<a name="line-305"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsLit</span>     <span class='hs-layout'>(</span><span class='hs-conid'>HsLit</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>      <span class='hs-comment'>-- ^ Simple (non-overloaded) literals</span>
<a name="line-306"></a>
<a name="line-307"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsLam</span>     <span class='hs-layout'>(</span><span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-308"></a>                       <span class='hs-comment'>-- ^ Lambda abstraction. Currently always a single match</span>
<a name="line-309"></a>       <span class='hs-comment'>--</span>
<a name="line-310"></a>       <span class='hs-comment'>-- - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnLam',</span>
<a name="line-311"></a>       <span class='hs-comment'>--       'ApiAnnotation.AnnRarrow',</span>
<a name="line-312"></a>
<a name="line-313"></a>       <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-314"></a>
<a name="line-315"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsLamCase</span> <span class='hs-layout'>(</span><span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Lambda-case</span>
<a name="line-316"></a>       <span class='hs-comment'>--</span>
<a name="line-317"></a>       <span class='hs-comment'>-- - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnLam',</span>
<a name="line-318"></a>       <span class='hs-comment'>--           'ApiAnnotation.AnnCase','ApiAnnotation.AnnOpen',</span>
<a name="line-319"></a>       <span class='hs-comment'>--           'ApiAnnotation.AnnClose'</span>
<a name="line-320"></a>
<a name="line-321"></a>       <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-322"></a>
<a name="line-323"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsApp</span>     <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Application</span>
<a name="line-324"></a>
<a name="line-325"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsAppType</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsWcType</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Visible type application</span>
<a name="line-326"></a>       <span class='hs-comment'>--</span>
<a name="line-327"></a>       <span class='hs-comment'>-- Explicit type argument; e.g  f @Int x y</span>
<a name="line-328"></a>       <span class='hs-comment'>-- NB: Has wildcards, but no implicit quantification</span>
<a name="line-329"></a>       <span class='hs-comment'>--</span>
<a name="line-330"></a>       <span class='hs-comment'>-- - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnAt',</span>
<a name="line-331"></a>
<a name="line-332"></a>  <span class='hs-comment'>-- TODO:AZ: Sort out Name</span>
<a name="line-333"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsAppTypeOut</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsWcType</span> <span class='hs-conid'>GhcRn</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- just for pretty-printing</span>
<a name="line-334"></a>
<a name="line-335"></a>
<a name="line-336"></a>  <span class='hs-comment'>-- | Operator applications:</span>
<a name="line-337"></a>  <span class='hs-comment'>-- NB Bracketed ops such as (+) come out as Vars.</span>
<a name="line-338"></a>
<a name="line-339"></a>  <span class='hs-comment'>-- NB We need an expr for the operator in an OpApp/Section since</span>
<a name="line-340"></a>  <span class='hs-comment'>-- the typechecker may need to apply the operator to a few types.</span>
<a name="line-341"></a>
<a name="line-342"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>OpApp</span>       <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>       <span class='hs-comment'>-- left operand</span>
<a name="line-343"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>       <span class='hs-comment'>-- operator</span>
<a name="line-344"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>PostRn</span> <span class='hs-varid'>p</span> <span class='hs-conid'>Fixity</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- Renamer adds fixity; bottom until then</span>
<a name="line-345"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>       <span class='hs-comment'>-- right operand</span>
<a name="line-346"></a>
<a name="line-347"></a>  <span class='hs-comment'>-- | Negation operator. Contains the negated expression and the name</span>
<a name="line-348"></a>  <span class='hs-comment'>-- of 'negate'</span>
<a name="line-349"></a>  <span class='hs-comment'>--</span>
<a name="line-350"></a>  <span class='hs-comment'>--  - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnMinus'</span>
<a name="line-351"></a>
<a name="line-352"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-353"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NegApp</span>      <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-354"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-355"></a>
<a name="line-356"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpen' @'('@,</span>
<a name="line-357"></a>  <span class='hs-comment'>--             'ApiAnnotation.AnnClose' @')'@</span>
<a name="line-358"></a>
<a name="line-359"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-360"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsPar</span>       <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- ^ Parenthesised expr; see Note [Parens in HsSyn]</span>
<a name="line-361"></a>
<a name="line-362"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SectionL</span>    <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- operand; see Note [Sections in HsSyn]</span>
<a name="line-363"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- operator</span>
<a name="line-364"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>SectionR</span>    <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- operator; see Note [Sections in HsSyn]</span>
<a name="line-365"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- operand</span>
<a name="line-366"></a>
<a name="line-367"></a>  <span class='hs-comment'>-- | Used for explicit tuples and sections thereof</span>
<a name="line-368"></a>  <span class='hs-comment'>--</span>
<a name="line-369"></a>  <span class='hs-comment'>--  - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpen',</span>
<a name="line-370"></a>  <span class='hs-comment'>--         'ApiAnnotation.AnnClose'</span>
<a name="line-371"></a>
<a name="line-372"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-373"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ExplicitTuple</span>
<a name="line-374"></a>        <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsTupArg</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>]</span>
<a name="line-375"></a>        <span class='hs-conid'>Boxity</span>
<a name="line-376"></a>
<a name="line-377"></a>  <span class='hs-comment'>-- | Used for unboxed sum types</span>
<a name="line-378"></a>  <span class='hs-comment'>--</span>
<a name="line-379"></a>  <span class='hs-comment'>--  - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpen' @'(#'@,</span>
<a name="line-380"></a>  <span class='hs-comment'>--          'ApiAnnotation.AnnVbar', 'ApiAnnotation.AnnClose' @'#)'@,</span>
<a name="line-381"></a>  <span class='hs-comment'>--</span>
<a name="line-382"></a>  <span class='hs-comment'>--  There will be multiple 'ApiAnnotation.AnnVbar', (1 - alternative) before</span>
<a name="line-383"></a>  <span class='hs-comment'>--  the expression, (arity - alternative) after it</span>
<a name="line-384"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ExplicitSum</span>
<a name="line-385"></a>          <span class='hs-conid'>ConTag</span> <span class='hs-comment'>--  Alternative (one-based)</span>
<a name="line-386"></a>          <span class='hs-conid'>Arity</span>  <span class='hs-comment'>--  Sum arity</span>
<a name="line-387"></a>          <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-388"></a>          <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- the type arguments</span>
<a name="line-389"></a>
<a name="line-390"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnCase',</span>
<a name="line-391"></a>  <span class='hs-comment'>--       'ApiAnnotation.AnnOf','ApiAnnotation.AnnOpen' @'{'@,</span>
<a name="line-392"></a>  <span class='hs-comment'>--       'ApiAnnotation.AnnClose' @'}'@</span>
<a name="line-393"></a>
<a name="line-394"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-395"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCase</span>      <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-396"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-397"></a>
<a name="line-398"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnIf',</span>
<a name="line-399"></a>  <span class='hs-comment'>--       'ApiAnnotation.AnnSemi',</span>
<a name="line-400"></a>  <span class='hs-comment'>--       'ApiAnnotation.AnnThen','ApiAnnotation.AnnSemi',</span>
<a name="line-401"></a>  <span class='hs-comment'>--       'ApiAnnotation.AnnElse',</span>
<a name="line-402"></a>
<a name="line-403"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-404"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsIf</span>        <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- cond function</span>
<a name="line-405"></a>                                        <span class='hs-comment'>-- Nothing =&gt; use the built-in 'if'</span>
<a name="line-406"></a>                                        <span class='hs-comment'>-- See Note [Rebindable if]</span>
<a name="line-407"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>    <span class='hs-comment'>--  predicate</span>
<a name="line-408"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>    <span class='hs-comment'>--  then part</span>
<a name="line-409"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>    <span class='hs-comment'>--  else part</span>
<a name="line-410"></a>
<a name="line-411"></a>  <span class='hs-comment'>-- | Multi-way if</span>
<a name="line-412"></a>  <span class='hs-comment'>--</span>
<a name="line-413"></a>  <span class='hs-comment'>-- - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnIf'</span>
<a name="line-414"></a>  <span class='hs-comment'>--       'ApiAnnotation.AnnOpen','ApiAnnotation.AnnClose',</span>
<a name="line-415"></a>
<a name="line-416"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-417"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsMultiIf</span>   <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>p</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LGRHS</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-418"></a>
<a name="line-419"></a>  <span class='hs-comment'>-- | let(rec)</span>
<a name="line-420"></a>  <span class='hs-comment'>--</span>
<a name="line-421"></a>  <span class='hs-comment'>-- - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnLet',</span>
<a name="line-422"></a>  <span class='hs-comment'>--       'ApiAnnotation.AnnOpen' @'{'@,</span>
<a name="line-423"></a>  <span class='hs-comment'>--       'ApiAnnotation.AnnClose' @'}'@,'ApiAnnotation.AnnIn'</span>
<a name="line-424"></a>
<a name="line-425"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-426"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsLet</span>       <span class='hs-layout'>(</span><span class='hs-conid'>LHsLocalBinds</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-427"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span>  <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-428"></a>
<a name="line-429"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnDo',</span>
<a name="line-430"></a>  <span class='hs-comment'>--             'ApiAnnotation.AnnOpen', 'ApiAnnotation.AnnSemi',</span>
<a name="line-431"></a>  <span class='hs-comment'>--             'ApiAnnotation.AnnVbar',</span>
<a name="line-432"></a>  <span class='hs-comment'>--             'ApiAnnotation.AnnClose'</span>
<a name="line-433"></a>
<a name="line-434"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-435"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsDo</span>        <span class='hs-layout'>(</span><span class='hs-conid'>HsStmtContext</span> <span class='hs-conid'>Name</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- The parameterisation is unimportant</span>
<a name="line-436"></a>                                         <span class='hs-comment'>-- because in this context we never use</span>
<a name="line-437"></a>                                         <span class='hs-comment'>-- the PatGuard or ParStmt variant</span>
<a name="line-438"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ExprLStmt</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- "do":one or more stmts</span>
<a name="line-439"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>p</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span>         <span class='hs-comment'>-- Type of the whole expression</span>
<a name="line-440"></a>
<a name="line-441"></a>  <span class='hs-comment'>-- | Syntactic list: [a,b,c,...]</span>
<a name="line-442"></a>  <span class='hs-comment'>--</span>
<a name="line-443"></a>  <span class='hs-comment'>--  - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpen' @'['@,</span>
<a name="line-444"></a>  <span class='hs-comment'>--              'ApiAnnotation.AnnClose' @']'@</span>
<a name="line-445"></a>
<a name="line-446"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-447"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ExplicitList</span>
<a name="line-448"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>p</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span>        <span class='hs-comment'>-- Gives type of components of list</span>
<a name="line-449"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-450"></a>                                   <span class='hs-comment'>-- For OverloadedLists, the fromListN witness</span>
<a name="line-451"></a>                <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>]</span>
<a name="line-452"></a>
<a name="line-453"></a>  <span class='hs-comment'>-- | Syntactic parallel array: [:e1, ..., en:]</span>
<a name="line-454"></a>  <span class='hs-comment'>--</span>
<a name="line-455"></a>  <span class='hs-comment'>--  - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpen' @'[:'@,</span>
<a name="line-456"></a>  <span class='hs-comment'>--              'ApiAnnotation.AnnDotdot','ApiAnnotation.AnnComma',</span>
<a name="line-457"></a>  <span class='hs-comment'>--              'ApiAnnotation.AnnVbar'</span>
<a name="line-458"></a>  <span class='hs-comment'>--              'ApiAnnotation.AnnClose' @':]'@</span>
<a name="line-459"></a>
<a name="line-460"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-461"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ExplicitPArr</span>
<a name="line-462"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>p</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- type of elements of the parallel array</span>
<a name="line-463"></a>                <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>]</span>
<a name="line-464"></a>
<a name="line-465"></a>  <span class='hs-comment'>-- | Record construction</span>
<a name="line-466"></a>  <span class='hs-comment'>--</span>
<a name="line-467"></a>  <span class='hs-comment'>--  - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpen' @'{'@,</span>
<a name="line-468"></a>  <span class='hs-comment'>--         'ApiAnnotation.AnnDotdot','ApiAnnotation.AnnClose' @'}'@</span>
<a name="line-469"></a>
<a name="line-470"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-471"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>RecordCon</span>
<a name="line-472"></a>      <span class='hs-layout'>{</span> <span class='hs-varid'>rcon_con_name</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- The constructor name;</span>
<a name="line-473"></a>                                            <span class='hs-comment'>--  not used after type checking</span>
<a name="line-474"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>rcon_con_like</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PostTc</span> <span class='hs-varid'>p</span> <span class='hs-conid'>ConLike</span>
<a name="line-475"></a>                                      <span class='hs-comment'>-- The data constructor or pattern synonym</span>
<a name="line-476"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>rcon_con_expr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PostTcExpr</span>         <span class='hs-comment'>-- Instantiated constructor function</span>
<a name="line-477"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>rcon_flds</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsRecordBinds</span> <span class='hs-varid'>p</span> <span class='hs-layout'>}</span>  <span class='hs-comment'>-- The fields</span>
<a name="line-478"></a>
<a name="line-479"></a>  <span class='hs-comment'>-- | Record update</span>
<a name="line-480"></a>  <span class='hs-comment'>--</span>
<a name="line-481"></a>  <span class='hs-comment'>--  - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpen' @'{'@,</span>
<a name="line-482"></a>  <span class='hs-comment'>--         'ApiAnnotation.AnnDotdot','ApiAnnotation.AnnClose' @'}'@</span>
<a name="line-483"></a>
<a name="line-484"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-485"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>RecordUpd</span>
<a name="line-486"></a>      <span class='hs-layout'>{</span> <span class='hs-varid'>rupd_expr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span>
<a name="line-487"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>rupd_flds</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsRecUpdField</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>]</span>
<a name="line-488"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>rupd_cons</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PostTc</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ConLike</span><span class='hs-keyglyph'>]</span>
<a name="line-489"></a>                <span class='hs-comment'>-- Filled in by the type checker to the</span>
<a name="line-490"></a>                <span class='hs-comment'>-- _non-empty_ list of DataCons that have</span>
<a name="line-491"></a>                <span class='hs-comment'>-- all the upd'd fields</span>
<a name="line-492"></a>
<a name="line-493"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>rupd_in_tys</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PostTc</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- Argument types of *input* record type</span>
<a name="line-494"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>rupd_out_tys</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PostTc</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>--             and  *output* record type</span>
<a name="line-495"></a>                                       <span class='hs-comment'>-- The original type can be reconstructed</span>
<a name="line-496"></a>                                       <span class='hs-comment'>-- with conLikeResTy</span>
<a name="line-497"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>rupd_wrap</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PostTc</span> <span class='hs-varid'>p</span> <span class='hs-conid'>HsWrapper</span>  <span class='hs-comment'>-- See note [Record Update HsWrapper]</span>
<a name="line-498"></a>      <span class='hs-layout'>}</span>
<a name="line-499"></a>  <span class='hs-comment'>-- For a type family, the arg types are of the *instance* tycon,</span>
<a name="line-500"></a>  <span class='hs-comment'>-- not the family tycon</span>
<a name="line-501"></a>
<a name="line-502"></a>  <span class='hs-comment'>-- | Expression with an explicit type signature. @e :: type@</span>
<a name="line-503"></a>  <span class='hs-comment'>--</span>
<a name="line-504"></a>  <span class='hs-comment'>--  - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnDcolon'</span>
<a name="line-505"></a>
<a name="line-506"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-507"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ExprWithTySig</span>
<a name="line-508"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-509"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsSigWcType</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-510"></a>
<a name="line-511"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ExprWithTySigOut</span>              <span class='hs-comment'>-- Post typechecking</span>
<a name="line-512"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-513"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsSigWcType</span> <span class='hs-conid'>GhcRn</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- Retain the signature,</span>
<a name="line-514"></a>                                     <span class='hs-comment'>-- as HsSigType Name, for</span>
<a name="line-515"></a>                                     <span class='hs-comment'>-- round-tripping purposes</span>
<a name="line-516"></a>
<a name="line-517"></a>  <span class='hs-comment'>-- | Arithmetic sequence</span>
<a name="line-518"></a>  <span class='hs-comment'>--</span>
<a name="line-519"></a>  <span class='hs-comment'>--  - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpen' @'['@,</span>
<a name="line-520"></a>  <span class='hs-comment'>--              'ApiAnnotation.AnnComma','ApiAnnotation.AnnDotdot',</span>
<a name="line-521"></a>  <span class='hs-comment'>--              'ApiAnnotation.AnnClose' @']'@</span>
<a name="line-522"></a>
<a name="line-523"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-524"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ArithSeq</span>
<a name="line-525"></a>                <span class='hs-conid'>PostTcExpr</span>
<a name="line-526"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-527"></a>                                  <span class='hs-comment'>-- For OverloadedLists, the fromList witness</span>
<a name="line-528"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>ArithSeqInfo</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-529"></a>
<a name="line-530"></a>  <span class='hs-comment'>-- | Arithmetic sequence for parallel array</span>
<a name="line-531"></a>  <span class='hs-comment'>--</span>
<a name="line-532"></a>  <span class='hs-comment'>-- &gt; [:e1..e2:] or [:e1, e2..e3:]</span>
<a name="line-533"></a>  <span class='hs-comment'>--</span>
<a name="line-534"></a>  <span class='hs-comment'>--  - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpen' @'[:'@,</span>
<a name="line-535"></a>  <span class='hs-comment'>--              'ApiAnnotation.AnnComma','ApiAnnotation.AnnDotdot',</span>
<a name="line-536"></a>  <span class='hs-comment'>--              'ApiAnnotation.AnnVbar',</span>
<a name="line-537"></a>  <span class='hs-comment'>--              'ApiAnnotation.AnnClose' @':]'@</span>
<a name="line-538"></a>
<a name="line-539"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-540"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PArrSeq</span>
<a name="line-541"></a>                <span class='hs-conid'>PostTcExpr</span>
<a name="line-542"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>ArithSeqInfo</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-543"></a>
<a name="line-544"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpen' @'{-\# SCC'@,</span>
<a name="line-545"></a>  <span class='hs-comment'>--             'ApiAnnotation.AnnVal' or 'ApiAnnotation.AnnValStr',</span>
<a name="line-546"></a>  <span class='hs-comment'>--              'ApiAnnotation.AnnClose' @'\#-}'@</span>
<a name="line-547"></a>
<a name="line-548"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-549"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsSCC</span>       <span class='hs-conid'>SourceText</span>            <span class='hs-comment'>-- Note [Pragma source text] in BasicTypes</span>
<a name="line-550"></a>                <span class='hs-conid'>StringLiteral</span>         <span class='hs-comment'>-- "set cost centre" SCC pragma</span>
<a name="line-551"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>           <span class='hs-comment'>-- expr whose cost is to be measured</span>
<a name="line-552"></a>
<a name="line-553"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpen' @'{-\# CORE'@,</span>
<a name="line-554"></a>  <span class='hs-comment'>--             'ApiAnnotation.AnnVal', 'ApiAnnotation.AnnClose' @'\#-}'@</span>
<a name="line-555"></a>
<a name="line-556"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-557"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCoreAnn</span>   <span class='hs-conid'>SourceText</span>            <span class='hs-comment'>-- Note [Pragma source text] in BasicTypes</span>
<a name="line-558"></a>                <span class='hs-conid'>StringLiteral</span>         <span class='hs-comment'>-- hdaume: core annotation</span>
<a name="line-559"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-560"></a>
<a name="line-561"></a>  <span class='hs-comment'>-----------------------------------------------------------</span>
<a name="line-562"></a>  <span class='hs-comment'>-- MetaHaskell Extensions</span>
<a name="line-563"></a>
<a name="line-564"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpen',</span>
<a name="line-565"></a>  <span class='hs-comment'>--         'ApiAnnotation.AnnOpenE','ApiAnnotation.AnnOpenEQ',</span>
<a name="line-566"></a>  <span class='hs-comment'>--         'ApiAnnotation.AnnClose','ApiAnnotation.AnnCloseQ'</span>
<a name="line-567"></a>
<a name="line-568"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-569"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsBracket</span>    <span class='hs-layout'>(</span><span class='hs-conid'>HsBracket</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-570"></a>
<a name="line-571"></a>    <span class='hs-comment'>-- See Note [Pending Splices]</span>
<a name="line-572"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsRnBracketOut</span>
<a name="line-573"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>HsBracket</span> <span class='hs-conid'>GhcRn</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- Output of the renamer is the *original* renamed</span>
<a name="line-574"></a>                           <span class='hs-comment'>-- expression, plus</span>
<a name="line-575"></a>      <span class='hs-keyglyph'>[</span><span class='hs-conid'>PendingRnSplice</span><span class='hs-keyglyph'>]</span>    <span class='hs-comment'>-- _renamed_ splices to be type checked</span>
<a name="line-576"></a>
<a name="line-577"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsTcBracketOut</span>
<a name="line-578"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>HsBracket</span> <span class='hs-conid'>GhcRn</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- Output of the type checker is the *original*</span>
<a name="line-579"></a>                           <span class='hs-comment'>-- renamed expression, plus</span>
<a name="line-580"></a>      <span class='hs-keyglyph'>[</span><span class='hs-conid'>PendingTcSplice</span><span class='hs-keyglyph'>]</span>    <span class='hs-comment'>-- _typechecked_ splices to be</span>
<a name="line-581"></a>                           <span class='hs-comment'>-- pasted back in by the desugarer</span>
<a name="line-582"></a>
<a name="line-583"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpen',</span>
<a name="line-584"></a>  <span class='hs-comment'>--         'ApiAnnotation.AnnClose'</span>
<a name="line-585"></a>
<a name="line-586"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-587"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsSpliceE</span>  <span class='hs-layout'>(</span><span class='hs-conid'>HsSplice</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-588"></a>
<a name="line-589"></a>  <span class='hs-comment'>-----------------------------------------------------------</span>
<a name="line-590"></a>  <span class='hs-comment'>-- Arrow notation extension</span>
<a name="line-591"></a>
<a name="line-592"></a>  <span class='hs-comment'>-- | @proc@ notation for Arrows</span>
<a name="line-593"></a>  <span class='hs-comment'>--</span>
<a name="line-594"></a>  <span class='hs-comment'>--  - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnProc',</span>
<a name="line-595"></a>  <span class='hs-comment'>--          'ApiAnnotation.AnnRarrow'</span>
<a name="line-596"></a>
<a name="line-597"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-598"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsProc</span>      <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>               <span class='hs-comment'>-- arrow abstraction, proc</span>
<a name="line-599"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmdTop</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>          <span class='hs-comment'>-- body of the abstraction</span>
<a name="line-600"></a>                                       <span class='hs-comment'>-- always has an empty stack</span>
<a name="line-601"></a>
<a name="line-602"></a>  <span class='hs-comment'>---------------------------------------</span>
<a name="line-603"></a>  <span class='hs-comment'>-- static pointers extension</span>
<a name="line-604"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnStatic',</span>
<a name="line-605"></a>
<a name="line-606"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-607"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsStatic</span> <span class='hs-layout'>(</span><span class='hs-conid'>PostRn</span> <span class='hs-varid'>p</span> <span class='hs-conid'>NameSet</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- Free variables of the body</span>
<a name="line-608"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>        <span class='hs-comment'>-- Body</span>
<a name="line-609"></a>
<a name="line-610"></a>  <span class='hs-comment'>---------------------------------------</span>
<a name="line-611"></a>  <span class='hs-comment'>-- The following are commands, not expressions proper</span>
<a name="line-612"></a>  <span class='hs-comment'>-- They are only used in the parsing stage and are removed</span>
<a name="line-613"></a>  <span class='hs-comment'>--    immediately in parser.RdrHsSyn.checkCommand</span>
<a name="line-614"></a>
<a name="line-615"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.Annlarrowtail',</span>
<a name="line-616"></a>  <span class='hs-comment'>--          'ApiAnnotation.Annrarrowtail','ApiAnnotation.AnnLarrowtail',</span>
<a name="line-617"></a>  <span class='hs-comment'>--          'ApiAnnotation.AnnRarrowtail'</span>
<a name="line-618"></a>
<a name="line-619"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-620"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsArrApp</span>             <span class='hs-comment'>-- Arrow tail, or arrow application (f -&lt; arg)</span>
<a name="line-621"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- arrow expression, f</span>
<a name="line-622"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- input expression, arg</span>
<a name="line-623"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>p</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- type of the arrow expressions f,</span>
<a name="line-624"></a>                        <span class='hs-comment'>-- of the form a t t', where arg :: t</span>
<a name="line-625"></a>        <span class='hs-conid'>HsArrAppType</span>    <span class='hs-comment'>-- higher-order (-&lt;&lt;) or first-order (-&lt;)</span>
<a name="line-626"></a>        <span class='hs-conid'>Bool</span>            <span class='hs-comment'>-- True =&gt; right-to-left (f -&lt; arg)</span>
<a name="line-627"></a>                        <span class='hs-comment'>-- False =&gt; left-to-right (arg &gt;- f)</span>
<a name="line-628"></a>
<a name="line-629"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpenB' @'(|'@,</span>
<a name="line-630"></a>  <span class='hs-comment'>--         'ApiAnnotation.AnnCloseB' @'|)'@</span>
<a name="line-631"></a>
<a name="line-632"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-633"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsArrForm</span>            <span class='hs-comment'>-- Command formation,  (| e cmd1 .. cmdn |)</span>
<a name="line-634"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>      <span class='hs-comment'>-- the operator</span>
<a name="line-635"></a>                         <span class='hs-comment'>-- after type-checking, a type abstraction to be</span>
<a name="line-636"></a>                         <span class='hs-comment'>-- applied to the type of the local environment tuple</span>
<a name="line-637"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>Fixity</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- fixity (filled in by the renamer), for forms that</span>
<a name="line-638"></a>                         <span class='hs-comment'>-- were converted from OpApp's by the renamer</span>
<a name="line-639"></a>        <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsCmdTop</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>]</span>    <span class='hs-comment'>-- argument commands</span>
<a name="line-640"></a>
<a name="line-641"></a>  <span class='hs-comment'>---------------------------------------</span>
<a name="line-642"></a>  <span class='hs-comment'>-- Haskell program coverage (Hpc) Support</span>
<a name="line-643"></a>
<a name="line-644"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsTick</span>
<a name="line-645"></a>     <span class='hs-layout'>(</span><span class='hs-conid'>Tickish</span> <span class='hs-layout'>(</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-646"></a>     <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>                       <span class='hs-comment'>-- sub-expression</span>
<a name="line-647"></a>
<a name="line-648"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsBinTick</span>
<a name="line-649"></a>     <span class='hs-conid'>Int</span>                                <span class='hs-comment'>-- module-local tick number for True</span>
<a name="line-650"></a>     <span class='hs-conid'>Int</span>                                <span class='hs-comment'>-- module-local tick number for False</span>
<a name="line-651"></a>     <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>                        <span class='hs-comment'>-- sub-expression</span>
<a name="line-652"></a>
<a name="line-653"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpen',</span>
<a name="line-654"></a>  <span class='hs-comment'>--       'ApiAnnotation.AnnOpen' @'{-\# GENERATED'@,</span>
<a name="line-655"></a>  <span class='hs-comment'>--       'ApiAnnotation.AnnVal','ApiAnnotation.AnnVal',</span>
<a name="line-656"></a>  <span class='hs-comment'>--       'ApiAnnotation.AnnColon','ApiAnnotation.AnnVal',</span>
<a name="line-657"></a>  <span class='hs-comment'>--       'ApiAnnotation.AnnMinus',</span>
<a name="line-658"></a>  <span class='hs-comment'>--       'ApiAnnotation.AnnVal','ApiAnnotation.AnnColon',</span>
<a name="line-659"></a>  <span class='hs-comment'>--       'ApiAnnotation.AnnVal',</span>
<a name="line-660"></a>  <span class='hs-comment'>--       'ApiAnnotation.AnnClose' @'\#-}'@</span>
<a name="line-661"></a>
<a name="line-662"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-663"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsTickPragma</span>                      <span class='hs-comment'>-- A pragma introduced tick</span>
<a name="line-664"></a>     <span class='hs-conid'>SourceText</span>                       <span class='hs-comment'>-- Note [Pragma source text] in BasicTypes</span>
<a name="line-665"></a>     <span class='hs-layout'>(</span><span class='hs-conid'>StringLiteral</span><span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-666"></a>                                      <span class='hs-comment'>-- external span for this tick</span>
<a name="line-667"></a>     <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>SourceText</span><span class='hs-layout'>,</span><span class='hs-conid'>SourceText</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-conid'>SourceText</span><span class='hs-layout'>,</span><span class='hs-conid'>SourceText</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-668"></a>        <span class='hs-comment'>-- Source text for the four integers used in the span.</span>
<a name="line-669"></a>        <span class='hs-comment'>-- See note [Pragma source text] in BasicTypes</span>
<a name="line-670"></a>     <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-671"></a>
<a name="line-672"></a>  <span class='hs-comment'>---------------------------------------</span>
<a name="line-673"></a>  <span class='hs-comment'>-- These constructors only appear temporarily in the parser.</span>
<a name="line-674"></a>  <span class='hs-comment'>-- The renamer translates them into the Right Thing.</span>
<a name="line-675"></a>
<a name="line-676"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>EWildPat</span>                 <span class='hs-comment'>-- wildcard</span>
<a name="line-677"></a>
<a name="line-678"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnAt'</span>
<a name="line-679"></a>
<a name="line-680"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-681"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>EAsPat</span>      <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- as pattern</span>
<a name="line-682"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-683"></a>
<a name="line-684"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnRarrow'</span>
<a name="line-685"></a>
<a name="line-686"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-687"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>EViewPat</span>    <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- view pattern</span>
<a name="line-688"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-689"></a>
<a name="line-690"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnTilde'</span>
<a name="line-691"></a>
<a name="line-692"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-693"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ELazyPat</span>    <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ~ pattern</span>
<a name="line-694"></a>
<a name="line-695"></a>
<a name="line-696"></a>  <span class='hs-comment'>---------------------------------------</span>
<a name="line-697"></a>  <span class='hs-comment'>-- Finally, HsWrap appears only in typechecker output</span>
<a name="line-698"></a>  <span class='hs-comment'>-- The contained Expr is *NOT* itself an HsWrap.</span>
<a name="line-699"></a>  <span class='hs-comment'>-- See Note [Detecting forced eta expansion] in DsExpr. This invariant</span>
<a name="line-700"></a>  <span class='hs-comment'>-- is maintained by HsUtils.mkHsWrap.</span>
<a name="line-701"></a>
<a name="line-702"></a>  <span class='hs-keyglyph'>|</span>  <span class='hs-conid'>HsWrap</span>     <span class='hs-conid'>HsWrapper</span>    <span class='hs-comment'>-- TRANSLATION</span>
<a name="line-703"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>HsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-704"></a>
<a name="line-705"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-706"></a>
<a name="line-707"></a><a name="LHsTupArg"></a><span class='hs-comment'>-- | Located Haskell Tuple Argument</span>
<a name="line-708"></a><a name="LHsTupArg"></a><span class='hs-comment'>--</span>
<a name="line-709"></a><a name="LHsTupArg"></a><span class='hs-comment'>-- 'HsTupArg' is used for tuple sections</span>
<a name="line-710"></a><a name="LHsTupArg"></a><span class='hs-comment'>-- @(,a,)@ is represented by</span>
<a name="line-711"></a><a name="LHsTupArg"></a><span class='hs-comment'>-- @ExplicitTuple [Missing ty1, Present a, Missing ty3]@</span>
<a name="line-712"></a><a name="LHsTupArg"></a><span class='hs-comment'>-- Which in turn stands for @(\x:ty1 \y:ty2. (x,a,y))@</span>
<a name="line-713"></a><a name="LHsTupArg"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LHsTupArg</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTupArg</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-714"></a><span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnComma'</span>
<a name="line-715"></a>
<a name="line-716"></a><span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-717"></a>
<a name="line-718"></a><a name="HsTupArg"></a><span class='hs-comment'>-- | Haskell Tuple Argument</span>
<a name="line-719"></a><a name="HsTupArg"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsTupArg</span> <span class='hs-varid'>id</span>
<a name="line-720"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Present</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- ^ The argument</span>
<a name="line-721"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Missing</span> <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>id</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ The argument is missing, but this is its type</span>
<a name="line-722"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataId</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTupArg</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-723"></a>
<a name="line-724"></a><a name="tupArgPresent"></a><span class='hs-definition'>tupArgPresent</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsTupArg</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-725"></a><span class='hs-definition'>tupArgPresent</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Present</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-726"></a><span class='hs-definition'>tupArgPresent</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Missing</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-727"></a>
<a name="line-728"></a><span class='hs-comment'>{-
<a name="line-729"></a>Note [Parens in HsSyn]
<a name="line-730"></a>~~~~~~~~~~~~~~~~~~~~~~
<a name="line-731"></a>HsPar (and ParPat in patterns, HsParTy in types) is used as follows
<a name="line-732"></a>
<a name="line-733"></a>  * HsPar is required; the pretty printer does not add parens.
<a name="line-734"></a>
<a name="line-735"></a>  * HsPars are respected when rearranging operator fixities.
<a name="line-736"></a>    So   a * (b + c)  means what it says (where the parens are an HsPar)
<a name="line-737"></a>
<a name="line-738"></a>  * For ParPat and HsParTy the pretty printer does add parens but this should be
<a name="line-739"></a>    a no-op for ParsedSource, based on the pretty printer round trip feature
<a name="line-740"></a>    introduced in
<a name="line-741"></a>    https://phabricator.haskell.org/rGHC499e43824bda967546ebf95ee33ec1f84a114a7c
<a name="line-742"></a>
<a name="line-743"></a>  * ParPat and HsParTy are pretty printed as '( .. )' regardless of whether or
<a name="line-744"></a>    not they are strictly necessary. This should be addressed when #13238 is
<a name="line-745"></a>    completed, to be treated the same as HsPar.
<a name="line-746"></a>
<a name="line-747"></a>
<a name="line-748"></a>Note [Sections in HsSyn]
<a name="line-749"></a>~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-750"></a>Sections should always appear wrapped in an HsPar, thus
<a name="line-751"></a>         HsPar (SectionR ...)
<a name="line-752"></a>The parser parses sections in a wider variety of situations
<a name="line-753"></a>(See Note [Parsing sections]), but the renamer checks for those
<a name="line-754"></a>parens.  This invariant makes pretty-printing easier; we don't need
<a name="line-755"></a>a special case for adding the parens round sections.
<a name="line-756"></a>
<a name="line-757"></a>Note [Rebindable if]
<a name="line-758"></a>~~~~~~~~~~~~~~~~~~~~
<a name="line-759"></a>The rebindable syntax for 'if' is a bit special, because when
<a name="line-760"></a>rebindable syntax is *off* we do not want to treat
<a name="line-761"></a>   (if c then t else e)
<a name="line-762"></a>as if it was an application (ifThenElse c t e).  Why not?
<a name="line-763"></a>Because we allow an 'if' to return *unboxed* results, thus
<a name="line-764"></a>  if blah then 3# else 4#
<a name="line-765"></a>whereas that would not be possible using a all to a polymorphic function
<a name="line-766"></a>(because you can't call a polymorphic function at an unboxed type).
<a name="line-767"></a>
<a name="line-768"></a>So we use Nothing to mean "use the old built-in typing rule".
<a name="line-769"></a>
<a name="line-770"></a>Note [Record Update HsWrapper]
<a name="line-771"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-772"></a>There is a wrapper in RecordUpd which is used for the *required*
<a name="line-773"></a>constraints for pattern synonyms. This wrapper is created in the
<a name="line-774"></a>typechecking and is then directly used in the desugaring without
<a name="line-775"></a>modification.
<a name="line-776"></a>
<a name="line-777"></a>For example, if we have the record pattern synonym P,
<a name="line-778"></a>  pattern P :: (Show a) =&gt; a -&gt; Maybe a
<a name="line-779"></a>  pattern P{x} = Just x
<a name="line-780"></a>
<a name="line-781"></a>  foo = (Just True) { x = False }
<a name="line-782"></a>then `foo` desugars to something like
<a name="line-783"></a>  foo = case Just True of
<a name="line-784"></a>          P x -&gt; P False
<a name="line-785"></a>hence we need to provide the correct dictionaries to P's matcher on
<a name="line-786"></a>the RHS so that we can build the expression.
<a name="line-787"></a>
<a name="line-788"></a>Note [Located RdrNames]
<a name="line-789"></a>~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-790"></a>A number of syntax elements have seemingly redundant locations attached to them.
<a name="line-791"></a>This is deliberate, to allow transformations making use of the API Annotations
<a name="line-792"></a>to easily correlate a Located Name in the RenamedSource with a Located RdrName
<a name="line-793"></a>in the ParsedSource.
<a name="line-794"></a>
<a name="line-795"></a>There are unfortunately enough differences between the ParsedSource and the
<a name="line-796"></a>RenamedSource that the API Annotations cannot be used directly with
<a name="line-797"></a>RenamedSource, so this allows a simple mapping to be used based on the location.
<a name="line-798"></a>-}</span>
<a name="line-799"></a>
<a name="line-800"></a><a name="instance%20Outputable%20(HsExpr%20p)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-801"></a>    <span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprExpr</span> <span class='hs-varid'>expr</span>
<a name="line-802"></a>
<a name="line-803"></a><a name="pprLExpr"></a><span class='hs-comment'>-----------------------</span>
<a name="line-804"></a><span class='hs-comment'>-- pprExpr, pprLExpr, pprBinds call pprDeeper;</span>
<a name="line-805"></a><span class='hs-comment'>-- the underscore versions do not</span>
<a name="line-806"></a><span class='hs-definition'>pprLExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-807"></a><span class='hs-definition'>pprLExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprExpr</span> <span class='hs-varid'>e</span>
<a name="line-808"></a>
<a name="line-809"></a><a name="pprExpr"></a><span class='hs-definition'>pprExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-810"></a><span class='hs-definition'>pprExpr</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isAtomicHsExpr</span> <span class='hs-varid'>e</span> <span class='hs-varop'>||</span> <span class='hs-varid'>isQuietHsExpr</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span>            <span class='hs-varid'>ppr_expr</span> <span class='hs-varid'>e</span>
<a name="line-811"></a>          <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>                           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprDeeper</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_expr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-812"></a>
<a name="line-813"></a><a name="isQuietHsExpr"></a><span class='hs-definition'>isQuietHsExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-814"></a><span class='hs-comment'>-- Parentheses do display something, but it gives little info and</span>
<a name="line-815"></a><span class='hs-comment'>-- if we go deeper when we go inside them then we get ugly things</span>
<a name="line-816"></a><span class='hs-comment'>-- like (...)</span>
<a name="line-817"></a><span class='hs-definition'>isQuietHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsPar</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-818"></a><span class='hs-comment'>-- applications don't display anything themselves</span>
<a name="line-819"></a><span class='hs-definition'>isQuietHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsApp</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-820"></a><span class='hs-definition'>isQuietHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsAppType</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-821"></a><span class='hs-definition'>isQuietHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsAppTypeOut</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-822"></a><span class='hs-definition'>isQuietHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>OpApp</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-823"></a><span class='hs-definition'>isQuietHsExpr</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-824"></a>
<a name="line-825"></a><a name="pprBinds"></a><span class='hs-definition'>pprBinds</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span>
<a name="line-826"></a>             <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span>
<a name="line-827"></a>         <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsLocalBindsLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-828"></a><span class='hs-definition'>pprBinds</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprDeeper</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
<a name="line-829"></a>
<a name="line-830"></a><a name="ppr_lexpr"></a><span class='hs-comment'>-----------------------</span>
<a name="line-831"></a><span class='hs-definition'>ppr_lexpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-832"></a><span class='hs-definition'>ppr_lexpr</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-833"></a>
<a name="line-834"></a><a name="ppr_expr"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>p</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-835"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVar</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPrefixOcc</span> <span class='hs-varid'>v</span>
<a name="line-836"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsUnboundVar</span> <span class='hs-varid'>uv</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPrefixOcc</span> <span class='hs-layout'>(</span><span class='hs-varid'>unboundVarOcc</span> <span class='hs-varid'>uv</span><span class='hs-layout'>)</span>
<a name="line-837"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsConLikeOut</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPrefixOcc</span> <span class='hs-varid'>c</span>
<a name="line-838"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsIPVar</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>v</span>
<a name="line-839"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsOverLabel</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>=</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'#'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>l</span>
<a name="line-840"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLit</span> <span class='hs-varid'>lit</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>lit</span>
<a name="line-841"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsOverLit</span> <span class='hs-varid'>lit</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>lit</span>
<a name="line-842"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsPar</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-843"></a>
<a name="line-844"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCoreAnn</span> <span class='hs-varid'>stc</span> <span class='hs-layout'>(</span><span class='hs-conid'>StringLiteral</span> <span class='hs-varid'>sta</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-845"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprWithSourceText</span> <span class='hs-varid'>stc</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"{-# CORE"</span><span class='hs-layout'>)</span>
<a name="line-846"></a>          <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprWithSourceText</span> <span class='hs-varid'>sta</span> <span class='hs-layout'>(</span><span class='hs-varid'>doubleQuotes</span> <span class='hs-varop'>$</span> <span class='hs-varid'>ftext</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"#-}"</span>
<a name="line-847"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span>
<a name="line-848"></a>
<a name="line-849"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-varid'>e</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>HsApp</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_apps</span> <span class='hs-varid'>e</span> <span class='hs-conid'>[]</span>
<a name="line-850"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-varid'>e</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>HsAppType</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_apps</span> <span class='hs-varid'>e</span> <span class='hs-conid'>[]</span>
<a name="line-851"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-varid'>e</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>HsAppTypeOut</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_apps</span> <span class='hs-varid'>e</span> <span class='hs-conid'>[]</span>
<a name="line-852"></a>
<a name="line-853"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>OpApp</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>op</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span>
<a name="line-854"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>pp_op</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>should_print_infix</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span>
<a name="line-855"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pp_infixly</span> <span class='hs-varid'>pp_op</span>
<a name="line-856"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-857"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pp_prefixly</span>
<a name="line-858"></a>
<a name="line-859"></a>  <span class='hs-keyword'>where</span>
<a name="line-860"></a>    <span class='hs-varid'>should_print_infix</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVar</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprInfixOcc</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span>
<a name="line-861"></a>    <span class='hs-varid'>should_print_infix</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsConLikeOut</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprInfixOcc</span> <span class='hs-layout'>(</span><span class='hs-varid'>conLikeName</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-862"></a>    <span class='hs-varid'>should_print_infix</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecFld</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprInfixOcc</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span>
<a name="line-863"></a>    <span class='hs-varid'>should_print_infix</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsUnboundVar</span> <span class='hs-varid'>h</span><span class='hs-keyglyph'>@</span><span class='hs-conid'>TrueExprHole</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-864"></a>                                       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprInfixOcc</span> <span class='hs-layout'>(</span><span class='hs-varid'>unboundVarOcc</span> <span class='hs-varid'>h</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-865"></a>    <span class='hs-varid'>should_print_infix</span> <span class='hs-conid'>EWildPat</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"`_`"</span><span class='hs-layout'>)</span>
<a name="line-866"></a>    <span class='hs-varid'>should_print_infix</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsWrap</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>should_print_infix</span> <span class='hs-varid'>e</span>
<a name="line-867"></a>    <span class='hs-varid'>should_print_infix</span> <span class='hs-keyword'>_</span>               <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-868"></a>
<a name="line-869"></a>    <span class='hs-varid'>pp_e1</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprDebugParendExpr</span> <span class='hs-varid'>e1</span>   <span class='hs-comment'>-- In debug mode, add parens</span>
<a name="line-870"></a>    <span class='hs-varid'>pp_e2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprDebugParendExpr</span> <span class='hs-varid'>e2</span>   <span class='hs-comment'>-- to make precedence clear</span>
<a name="line-871"></a>
<a name="line-872"></a>    <span class='hs-varid'>pp_prefixly</span>
<a name="line-873"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pp_e1</span><span class='hs-layout'>,</span> <span class='hs-varid'>pp_e2</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-874"></a>
<a name="line-875"></a>    <span class='hs-varid'>pp_infixly</span> <span class='hs-varid'>pp_op</span>
<a name="line-876"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-varid'>pp_e1</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pp_op</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-varid'>pp_e2</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-877"></a>
<a name="line-878"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>NegApp</span> <span class='hs-varid'>e</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'-'</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprDebugParendExpr</span> <span class='hs-varid'>e</span>
<a name="line-879"></a>
<a name="line-880"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>SectionL</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span>
<a name="line-881"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>unLoc</span> <span class='hs-varid'>op</span> <span class='hs-keyword'>of</span>
<a name="line-882"></a>      <span class='hs-conid'>HsVar</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_infixly</span> <span class='hs-varid'>v</span>
<a name="line-883"></a>      <span class='hs-conid'>HsConLikeOut</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_infixly</span> <span class='hs-layout'>(</span><span class='hs-varid'>conLikeName</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-884"></a>      <span class='hs-keyword'>_</span>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_prefixly</span>
<a name="line-885"></a>  <span class='hs-keyword'>where</span>
<a name="line-886"></a>    <span class='hs-varid'>pp_expr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprDebugParendExpr</span> <span class='hs-varid'>expr</span>
<a name="line-887"></a>
<a name="line-888"></a>    <span class='hs-varid'>pp_prefixly</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>" \\ x_ -&gt;"</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>op</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-889"></a>                       <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pp_expr</span><span class='hs-layout'>,</span> <span class='hs-varid'>text</span> <span class='hs-str'>"x_ )"</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-890"></a>    <span class='hs-varid'>pp_infixly</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pp_expr</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprInfixOcc</span> <span class='hs-varid'>v</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-891"></a>
<a name="line-892"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>SectionR</span> <span class='hs-varid'>op</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-893"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>unLoc</span> <span class='hs-varid'>op</span> <span class='hs-keyword'>of</span>
<a name="line-894"></a>      <span class='hs-conid'>HsVar</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_infixly</span> <span class='hs-varid'>v</span>
<a name="line-895"></a>      <span class='hs-conid'>HsConLikeOut</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_infixly</span> <span class='hs-layout'>(</span><span class='hs-varid'>conLikeName</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-896"></a>      <span class='hs-keyword'>_</span>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_prefixly</span>
<a name="line-897"></a>  <span class='hs-keyword'>where</span>
<a name="line-898"></a>    <span class='hs-varid'>pp_expr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprDebugParendExpr</span> <span class='hs-varid'>expr</span>
<a name="line-899"></a>
<a name="line-900"></a>    <span class='hs-varid'>pp_prefixly</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"( \\ x_ -&gt;"</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>op</span><span class='hs-layout'>,</span> <span class='hs-varid'>text</span> <span class='hs-str'>"x_"</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-901"></a>                       <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>pp_expr</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>rparen</span><span class='hs-layout'>)</span>
<a name="line-902"></a>    <span class='hs-varid'>pp_infixly</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprInfixOcc</span> <span class='hs-varid'>v</span><span class='hs-layout'>,</span> <span class='hs-varid'>pp_expr</span><span class='hs-keyglyph'>]</span>
<a name="line-903"></a>
<a name="line-904"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExplicitTuple</span> <span class='hs-varid'>exprs</span> <span class='hs-varid'>boxity</span><span class='hs-layout'>)</span>
<a name="line-905"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tupleParens</span> <span class='hs-layout'>(</span><span class='hs-varid'>boxityTupleSort</span> <span class='hs-varid'>boxity</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>fcat</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_tup_args</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-varid'>unLoc</span> <span class='hs-varid'>exprs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-906"></a>  <span class='hs-keyword'>where</span>
<a name="line-907"></a>    <span class='hs-varid'>ppr_tup_args</span> <span class='hs-conid'>[]</span>               <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-908"></a>    <span class='hs-varid'>ppr_tup_args</span> <span class='hs-layout'>(</span><span class='hs-conid'>Present</span> <span class='hs-varid'>e</span> <span class='hs-conop'>:</span> <span class='hs-varid'>es</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>e</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>punc</span> <span class='hs-varid'>es</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>ppr_tup_args</span> <span class='hs-varid'>es</span>
<a name="line-909"></a>    <span class='hs-varid'>ppr_tup_args</span> <span class='hs-layout'>(</span><span class='hs-conid'>Missing</span> <span class='hs-keyword'>_</span> <span class='hs-conop'>:</span> <span class='hs-varid'>es</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>punc</span> <span class='hs-varid'>es</span> <span class='hs-conop'>:</span> <span class='hs-varid'>ppr_tup_args</span> <span class='hs-varid'>es</span>
<a name="line-910"></a>
<a name="line-911"></a>    <span class='hs-varid'>punc</span> <span class='hs-layout'>(</span><span class='hs-conid'>Present</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-conop'>:</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>comma</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>space</span>
<a name="line-912"></a>    <span class='hs-varid'>punc</span> <span class='hs-layout'>(</span><span class='hs-conid'>Missing</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-conop'>:</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>comma</span>
<a name="line-913"></a>    <span class='hs-varid'>punc</span> <span class='hs-conid'>[]</span>               <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<a name="line-914"></a>
<a name="line-915"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExplicitSum</span> <span class='hs-varid'>alt</span> <span class='hs-varid'>arity</span> <span class='hs-varid'>expr</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
<a name="line-916"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"(#"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr_bars</span> <span class='hs-layout'>(</span><span class='hs-varid'>alt</span> <span class='hs-comment'>-</span> <span class='hs-num'>1</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr_bars</span> <span class='hs-layout'>(</span><span class='hs-varid'>arity</span> <span class='hs-comment'>-</span> <span class='hs-varid'>alt</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"#)"</span>
<a name="line-917"></a>  <span class='hs-keyword'>where</span>
<a name="line-918"></a>    <span class='hs-varid'>ppr_bars</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-layout'>(</span><span class='hs-varid'>replicate</span> <span class='hs-varid'>n</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'|'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-919"></a>
<a name="line-920"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLam</span> <span class='hs-varid'>matches</span><span class='hs-layout'>)</span>
<a name="line-921"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprMatches</span> <span class='hs-varid'>matches</span>
<a name="line-922"></a>
<a name="line-923"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLamCase</span> <span class='hs-varid'>matches</span><span class='hs-layout'>)</span>
<a name="line-924"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"\\case"</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-925"></a>          <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprMatches</span> <span class='hs-varid'>matches</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>]</span>
<a name="line-926"></a>
<a name="line-927"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCase</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>matches</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>MG</span> <span class='hs-layout'>{</span> <span class='hs-varid'>mg_alts</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>[</span><span class='hs-keyword'>_</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-928"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"case"</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"of {"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-929"></a>          <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprMatches</span> <span class='hs-varid'>matches</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'}'</span><span class='hs-keyglyph'>]</span>
<a name="line-930"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCase</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>matches</span><span class='hs-layout'>)</span>
<a name="line-931"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"case"</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"of"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-932"></a>          <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprMatches</span> <span class='hs-varid'>matches</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>]</span>
<a name="line-933"></a>
<a name="line-934"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsIf</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span> <span class='hs-varid'>e3</span><span class='hs-layout'>)</span>
<a name="line-935"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"if"</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e1</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"then"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-936"></a>         <span class='hs-varid'>nest</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-937"></a>         <span class='hs-varid'>text</span> <span class='hs-str'>"else"</span><span class='hs-layout'>,</span>
<a name="line-938"></a>         <span class='hs-varid'>nest</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e3</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-939"></a>
<a name="line-940"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsMultiIf</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>alts</span><span class='hs-layout'>)</span>
<a name="line-941"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"if"</span><span class='hs-layout'>)</span> <span class='hs-num'>3</span>  <span class='hs-layout'>(</span><span class='hs-varid'>vcat</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr_alt</span> <span class='hs-varid'>alts</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-942"></a>  <span class='hs-keyword'>where</span> <span class='hs-varid'>ppr_alt</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>GRHS</span> <span class='hs-varid'>guards</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-943"></a>          <span class='hs-varid'>hang</span> <span class='hs-varid'>vbar</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_one</span> <span class='hs-varid'>one_alt</span><span class='hs-layout'>)</span>
<a name="line-944"></a>          <span class='hs-keyword'>where</span>
<a name="line-945"></a>            <span class='hs-varid'>ppr_one</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"ppr_exp HsMultiIf"</span>
<a name="line-946"></a>            <span class='hs-varid'>ppr_one</span> <span class='hs-layout'>(</span><span class='hs-varid'>h</span><span class='hs-conop'>:</span><span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-varid'>h</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-947"></a>            <span class='hs-varid'>one_alt</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>interpp'SP</span> <span class='hs-varid'>guards</span>
<a name="line-948"></a>                      <span class='hs-layout'>,</span> <span class='hs-varid'>text</span> <span class='hs-str'>"-&gt;"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprDeeper</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>]</span>
<a name="line-949"></a>
<a name="line-950"></a><span class='hs-comment'>-- special case: let ... in let ...</span>
<a name="line-951"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLet</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span> <span class='hs-varid'>expr</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLet</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-952"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"let"</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprBinds</span> <span class='hs-varid'>binds</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"in"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-953"></a>         <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>expr</span><span class='hs-keyglyph'>]</span>
<a name="line-954"></a>
<a name="line-955"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLet</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-956"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"let"</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprBinds</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-957"></a>         <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"in"</span><span class='hs-layout'>)</span>  <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-958"></a>
<a name="line-959"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsDo</span> <span class='hs-varid'>do_or_list_comp</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>stmts</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprDo</span> <span class='hs-varid'>do_or_list_comp</span> <span class='hs-varid'>stmts</span>
<a name="line-960"></a>
<a name="line-961"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExplicitList</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>exprs</span><span class='hs-layout'>)</span>
<a name="line-962"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>brackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprDeeperList</span> <span class='hs-varid'>fsep</span> <span class='hs-layout'>(</span><span class='hs-varid'>punctuate</span> <span class='hs-varid'>comma</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>exprs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-963"></a>
<a name="line-964"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExplicitPArr</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>exprs</span><span class='hs-layout'>)</span>
<a name="line-965"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>paBrackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprDeeperList</span> <span class='hs-varid'>fsep</span> <span class='hs-layout'>(</span><span class='hs-varid'>punctuate</span> <span class='hs-varid'>comma</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>exprs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-966"></a>
<a name="line-967"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>RecordCon</span> <span class='hs-layout'>{</span> <span class='hs-varid'>rcon_con_name</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>con_id</span><span class='hs-layout'>,</span> <span class='hs-varid'>rcon_flds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rbinds</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-968"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>con_id</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>rbinds</span><span class='hs-layout'>)</span>
<a name="line-969"></a>
<a name="line-970"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>RecordUpd</span> <span class='hs-layout'>{</span> <span class='hs-varid'>rupd_expr</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>aexp</span><span class='hs-layout'>,</span> <span class='hs-varid'>rupd_flds</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rbinds</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-971"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>aexp</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>braces</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsep</span> <span class='hs-layout'>(</span><span class='hs-varid'>punctuate</span> <span class='hs-varid'>comma</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>rbinds</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-972"></a>
<a name="line-973"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExprWithTySig</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>sig</span><span class='hs-layout'>)</span>
<a name="line-974"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>dcolon</span><span class='hs-layout'>)</span>
<a name="line-975"></a>         <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>sig</span><span class='hs-layout'>)</span>
<a name="line-976"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExprWithTySigOut</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>sig</span><span class='hs-layout'>)</span>
<a name="line-977"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>dcolon</span><span class='hs-layout'>)</span>
<a name="line-978"></a>         <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>sig</span><span class='hs-layout'>)</span>
<a name="line-979"></a>
<a name="line-980"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ArithSeq</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>info</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>brackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>info</span><span class='hs-layout'>)</span>
<a name="line-981"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>PArrSeq</span>  <span class='hs-keyword'>_</span> <span class='hs-varid'>info</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>paBrackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>info</span><span class='hs-layout'>)</span>
<a name="line-982"></a>
<a name="line-983"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-conid'>EWildPat</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'_'</span>
<a name="line-984"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ELazyPat</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'~'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span>
<a name="line-985"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>EAsPat</span> <span class='hs-varid'>v</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>v</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'@'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span>
<a name="line-986"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>EViewPat</span> <span class='hs-varid'>p</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>p</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"-&gt;"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span>
<a name="line-987"></a>
<a name="line-988"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsSCC</span> <span class='hs-varid'>st</span> <span class='hs-layout'>(</span><span class='hs-conid'>StringLiteral</span> <span class='hs-varid'>stl</span> <span class='hs-varid'>lbl</span><span class='hs-layout'>)</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-989"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>pprWithSourceText</span> <span class='hs-varid'>st</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"{-# SCC"</span><span class='hs-layout'>)</span>
<a name="line-990"></a>         <span class='hs-comment'>-- no doublequotes if stl empty, for the case where the SCC was written</span>
<a name="line-991"></a>         <span class='hs-comment'>-- without quotes.</span>
<a name="line-992"></a>          <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprWithSourceText</span> <span class='hs-varid'>stl</span> <span class='hs-layout'>(</span><span class='hs-varid'>ftext</span> <span class='hs-varid'>lbl</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"#-}"</span><span class='hs-layout'>,</span>
<a name="line-993"></a>          <span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span> <span class='hs-keyglyph'>]</span>
<a name="line-994"></a>
<a name="line-995"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsWrap</span> <span class='hs-varid'>co_fn</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-996"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprHsWrapper</span> <span class='hs-varid'>co_fn</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>parens</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>parens</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>pprExpr</span> <span class='hs-varid'>e</span>
<a name="line-997"></a>                                             <span class='hs-keyword'>else</span> <span class='hs-varid'>pprExpr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-998"></a>
<a name="line-999"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsSpliceE</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprSplice</span> <span class='hs-varid'>s</span>
<a name="line-1000"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsBracket</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprHsBracket</span> <span class='hs-varid'>b</span>
<a name="line-1001"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRnBracketOut</span> <span class='hs-varid'>e</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span>
<a name="line-1002"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRnBracketOut</span> <span class='hs-varid'>e</span> <span class='hs-varid'>ps</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>text</span> <span class='hs-str'>"pending(rn)"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ps</span>
<a name="line-1003"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTcBracketOut</span> <span class='hs-varid'>e</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span>
<a name="line-1004"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTcBracketOut</span> <span class='hs-varid'>e</span> <span class='hs-varid'>ps</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>text</span> <span class='hs-str'>"pending(tc)"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ps</span>
<a name="line-1005"></a>
<a name="line-1006"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsProc</span> <span class='hs-varid'>pat</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdTop</span> <span class='hs-varid'>cmd</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1007"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"proc"</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>pat</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"-&gt;"</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>cmd</span><span class='hs-keyglyph'>]</span>
<a name="line-1008"></a>
<a name="line-1009"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsStatic</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-1010"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"static"</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span>
<a name="line-1011"></a>
<a name="line-1012"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTick</span> <span class='hs-varid'>tickish</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span>
<a name="line-1013"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprTicks</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-1014"></a>    <span class='hs-varid'>ppr</span> <span class='hs-varid'>tickish</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>exp</span>
<a name="line-1015"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsBinTick</span> <span class='hs-varid'>tickIdTrue</span> <span class='hs-varid'>tickIdFalse</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span>
<a name="line-1016"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprTicks</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-1017"></a>    <span class='hs-varid'>hcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"bintick&lt;"</span><span class='hs-layout'>,</span>
<a name="line-1018"></a>          <span class='hs-varid'>ppr</span> <span class='hs-varid'>tickIdTrue</span><span class='hs-layout'>,</span>
<a name="line-1019"></a>          <span class='hs-varid'>text</span> <span class='hs-str'>","</span><span class='hs-layout'>,</span>
<a name="line-1020"></a>          <span class='hs-varid'>ppr</span> <span class='hs-varid'>tickIdFalse</span><span class='hs-layout'>,</span>
<a name="line-1021"></a>          <span class='hs-varid'>text</span> <span class='hs-str'>"&gt;("</span><span class='hs-layout'>,</span>
<a name="line-1022"></a>          <span class='hs-varid'>ppr</span> <span class='hs-varid'>exp</span><span class='hs-layout'>,</span> <span class='hs-varid'>text</span> <span class='hs-str'>")"</span><span class='hs-keyglyph'>]</span>
<a name="line-1023"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTickPragma</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>externalSrcLoc</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span>
<a name="line-1024"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprTicks</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>exp</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-1025"></a>    <span class='hs-varid'>hcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"tickpragma&lt;"</span><span class='hs-layout'>,</span>
<a name="line-1026"></a>          <span class='hs-varid'>pprExternalSrcLoc</span> <span class='hs-varid'>externalSrcLoc</span><span class='hs-layout'>,</span>
<a name="line-1027"></a>          <span class='hs-varid'>text</span> <span class='hs-str'>"&gt;("</span><span class='hs-layout'>,</span>
<a name="line-1028"></a>          <span class='hs-varid'>ppr</span> <span class='hs-varid'>exp</span><span class='hs-layout'>,</span>
<a name="line-1029"></a>          <span class='hs-varid'>text</span> <span class='hs-str'>")"</span><span class='hs-keyglyph'>]</span>
<a name="line-1030"></a>
<a name="line-1031"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsArrApp</span> <span class='hs-varid'>arrow</span> <span class='hs-varid'>arg</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>HsFirstOrderApp</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span>
<a name="line-1032"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arrow</span><span class='hs-layout'>,</span> <span class='hs-varid'>larrowt</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arg</span><span class='hs-keyglyph'>]</span>
<a name="line-1033"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsArrApp</span> <span class='hs-varid'>arrow</span> <span class='hs-varid'>arg</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>HsFirstOrderApp</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span>
<a name="line-1034"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arg</span><span class='hs-layout'>,</span> <span class='hs-varid'>arrowt</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arrow</span><span class='hs-keyglyph'>]</span>
<a name="line-1035"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsArrApp</span> <span class='hs-varid'>arrow</span> <span class='hs-varid'>arg</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>HsHigherOrderApp</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span>
<a name="line-1036"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arrow</span><span class='hs-layout'>,</span> <span class='hs-varid'>larrowtt</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arg</span><span class='hs-keyglyph'>]</span>
<a name="line-1037"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsArrApp</span> <span class='hs-varid'>arrow</span> <span class='hs-varid'>arg</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>HsHigherOrderApp</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span>
<a name="line-1038"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arg</span><span class='hs-layout'>,</span> <span class='hs-varid'>arrowtt</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arrow</span><span class='hs-keyglyph'>]</span>
<a name="line-1039"></a>
<a name="line-1040"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsArrForm</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVar</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>arg1</span><span class='hs-layout'>,</span> <span class='hs-varid'>arg2</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1041"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprCmdArg</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>arg1</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprInfixOcc</span> <span class='hs-varid'>v</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprCmdArg</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>arg2</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span>
<a name="line-1042"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsArrForm</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsConLikeOut</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>arg1</span><span class='hs-layout'>,</span> <span class='hs-varid'>arg2</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1043"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprCmdArg</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>arg1</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprInfixOcc</span> <span class='hs-layout'>(</span><span class='hs-varid'>conLikeName</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprCmdArg</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>arg2</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-keyglyph'>]</span>
<a name="line-1044"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsArrForm</span> <span class='hs-varid'>op</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-1045"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"(|"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span>
<a name="line-1046"></a>         <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprCmdArg</span><span class='hs-varop'>.</span><span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"|)"</span><span class='hs-layout'>)</span>
<a name="line-1047"></a><span class='hs-definition'>ppr_expr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecFld</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>f</span>
<a name="line-1048"></a>
<a name="line-1049"></a><a name="LHsWcTypeX"></a><span class='hs-comment'>-- We must tiresomely make the "id" parameter to the LHsWcType existential</span>
<a name="line-1050"></a><a name="LHsWcTypeX"></a><span class='hs-comment'>-- because it's different in the HsAppType case and the HsAppTypeOut case</span>
<a name="line-1051"></a><a name="LHsWcTypeX"></a><span class='hs-comment'>-- | Located Haskell Wildcard Type Expression</span>
<a name="line-1052"></a><a name="LHsWcTypeX"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LHsWcTypeX</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>p</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-1053"></a>                       <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LHsWcTypeX</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsWcType</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-1054"></a>
<a name="line-1055"></a><a name="ppr_apps"></a><span class='hs-definition'>ppr_apps</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>p</span>
<a name="line-1056"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Either</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-conid'>LHsWcTypeX</span><span class='hs-keyglyph'>]</span>
<a name="line-1057"></a>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-1058"></a><span class='hs-definition'>ppr_apps</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsApp</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>fun</span><span class='hs-layout'>)</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span>        <span class='hs-varid'>args</span>
<a name="line-1059"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_apps</span> <span class='hs-varid'>fun</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-varid'>arg</span> <span class='hs-conop'>:</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-1060"></a><span class='hs-definition'>ppr_apps</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsAppType</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>fun</span><span class='hs-layout'>)</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span>    <span class='hs-varid'>args</span>
<a name="line-1061"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_apps</span> <span class='hs-varid'>fun</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsWcTypeX</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-1062"></a><span class='hs-definition'>ppr_apps</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsAppTypeOut</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>fun</span><span class='hs-layout'>)</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span> <span class='hs-varid'>args</span>
<a name="line-1063"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_apps</span> <span class='hs-varid'>fun</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsWcTypeX</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-1064"></a><span class='hs-definition'>ppr_apps</span> <span class='hs-varid'>fun</span> <span class='hs-varid'>args</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_expr</span> <span class='hs-varid'>fun</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>pp</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1065"></a>  <span class='hs-keyword'>where</span>
<a name="line-1066"></a>    <span class='hs-varid'>pp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span>                             <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>arg</span>
<a name="line-1067"></a>    <span class='hs-varid'>pp</span> <span class='hs-layout'>(</span><span class='hs-conid'>Right</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsWcTypeX</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsWC</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hswc_body</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>arg</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1068"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'@'</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>pprHsType</span> <span class='hs-varid'>arg</span>
<a name="line-1069"></a>
<a name="line-1070"></a><a name="pprExternalSrcLoc"></a><span class='hs-definition'>pprExternalSrcLoc</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>StringLiteral</span><span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-conid'>Int</span><span class='hs-layout'>,</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-1071"></a><span class='hs-definition'>pprExternalSrcLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>StringLiteral</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>src</span><span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-varid'>n1</span><span class='hs-layout'>,</span><span class='hs-varid'>n2</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-varid'>n3</span><span class='hs-layout'>,</span><span class='hs-varid'>n4</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1072"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-varid'>src</span><span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-varid'>n1</span><span class='hs-layout'>,</span><span class='hs-varid'>n2</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span><span class='hs-layout'>(</span><span class='hs-varid'>n3</span><span class='hs-layout'>,</span><span class='hs-varid'>n4</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1073"></a>
<a name="line-1074"></a><span class='hs-comment'>{-
<a name="line-1075"></a>HsSyn records exactly where the user put parens, with HsPar.
<a name="line-1076"></a>So generally speaking we print without adding any parens.
<a name="line-1077"></a>However, some code is internally generated, and in some places
<a name="line-1078"></a>parens are absolutely required; so for these places we use
<a name="line-1079"></a>pprParendLExpr (but don't print double parens of course).
<a name="line-1080"></a>
<a name="line-1081"></a>For operator applications we don't add parens, because the operator
<a name="line-1082"></a>fixities should do the job, except in debug mode (-dppr-debug) so we
<a name="line-1083"></a>can see the structure of the parse tree.
<a name="line-1084"></a>-}</span>
<a name="line-1085"></a>
<a name="line-1086"></a><a name="pprDebugParendExpr"></a><span class='hs-definition'>pprDebugParendExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-1087"></a><span class='hs-definition'>pprDebugParendExpr</span> <span class='hs-varid'>expr</span>
<a name="line-1088"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getPprStyle</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>sty</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1089"></a>    <span class='hs-keyword'>if</span> <span class='hs-varid'>debugStyle</span> <span class='hs-varid'>sty</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>pprParendLExpr</span> <span class='hs-varid'>expr</span>
<a name="line-1090"></a>                      <span class='hs-keyword'>else</span> <span class='hs-varid'>pprLExpr</span>      <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-1091"></a>
<a name="line-1092"></a><a name="pprParendLExpr"></a><span class='hs-definition'>pprParendLExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-1093"></a><span class='hs-definition'>pprParendLExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprParendExpr</span> <span class='hs-varid'>e</span>
<a name="line-1094"></a>
<a name="line-1095"></a><a name="pprParendExpr"></a><span class='hs-definition'>pprParendExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-1096"></a><span class='hs-definition'>pprParendExpr</span> <span class='hs-varid'>expr</span>
<a name="line-1097"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>hsExprNeedsParens</span> <span class='hs-varid'>expr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprExpr</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span>
<a name="line-1098"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>              <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprExpr</span> <span class='hs-varid'>expr</span>
<a name="line-1099"></a>        <span class='hs-comment'>-- Using pprLExpr makes sure that we go 'deeper'</span>
<a name="line-1100"></a>        <span class='hs-comment'>-- I think that is usually (always?) right</span>
<a name="line-1101"></a>
<a name="line-1102"></a><a name="hsExprNeedsParens"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-1103"></a><span class='hs-comment'>-- True of expressions for which '(e)' and 'e'</span>
<a name="line-1104"></a><span class='hs-comment'>-- mean the same thing</span>
<a name="line-1105"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>ArithSeq</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1106"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>PArrSeq</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1107"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLit</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1108"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsOverLit</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1109"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVar</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1110"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsUnboundVar</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1111"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsConLikeOut</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1112"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsIPVar</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1113"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsOverLabel</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1114"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExplicitTuple</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1115"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExplicitList</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1116"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExplicitPArr</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1117"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsPar</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1118"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsBracket</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1119"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRnBracketOut</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1120"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTcBracketOut</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1121"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsDo</span> <span class='hs-varid'>sc</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
<a name="line-1122"></a>       <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isListCompExpr</span> <span class='hs-varid'>sc</span>            <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1123"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecFld</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1124"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>RecordCon</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1125"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsSpliceE</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1126"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>RecordUpd</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1127"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsWrap</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsExprNeedsParens</span> <span class='hs-varid'>e</span>
<a name="line-1128"></a><span class='hs-definition'>hsExprNeedsParens</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-1129"></a>
<a name="line-1130"></a>
<a name="line-1131"></a><a name="isAtomicHsExpr"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-1132"></a><span class='hs-comment'>-- True of a single token</span>
<a name="line-1133"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVar</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-1134"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsConLikeOut</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-1135"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsLit</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-1136"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsOverLit</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-1137"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsIPVar</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-1138"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsOverLabel</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-1139"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsUnboundVar</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-1140"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsWrap</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isAtomicHsExpr</span> <span class='hs-varid'>e</span>
<a name="line-1141"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsPar</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isAtomicHsExpr</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-1142"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsRecFld</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-1143"></a><span class='hs-definition'>isAtomicHsExpr</span> <span class='hs-keyword'>_</span>                 <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1144"></a>
<a name="line-1145"></a><span class='hs-comment'>{-
<a name="line-1146"></a>************************************************************************
<a name="line-1147"></a>*                                                                      *
<a name="line-1148"></a>\subsection{Commands (in arrow abstractions)}
<a name="line-1149"></a>*                                                                      *
<a name="line-1150"></a>************************************************************************
<a name="line-1151"></a>
<a name="line-1152"></a>We re-use HsExpr to represent these.
<a name="line-1153"></a>-}</span>
<a name="line-1154"></a>
<a name="line-1155"></a><a name="LHsCmd"></a><span class='hs-comment'>-- | Located Haskell Command (for arrow syntax)</span>
<a name="line-1156"></a><a name="LHsCmd"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LHsCmd</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmd</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-1157"></a>
<a name="line-1158"></a><a name="HsCmd"></a><span class='hs-comment'>-- | Haskell Command (e.g. a "statement" in an Arrow proc block)</span>
<a name="line-1159"></a><a name="HsCmd"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsCmd</span> <span class='hs-varid'>id</span>
<a name="line-1160"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.Annlarrowtail',</span>
<a name="line-1161"></a>  <span class='hs-comment'>--          'ApiAnnotation.Annrarrowtail','ApiAnnotation.AnnLarrowtail',</span>
<a name="line-1162"></a>  <span class='hs-comment'>--          'ApiAnnotation.AnnRarrowtail'</span>
<a name="line-1163"></a>
<a name="line-1164"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-1165"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsCmdArrApp</span>          <span class='hs-comment'>-- Arrow tail, or arrow application (f -&lt; arg)</span>
<a name="line-1166"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- arrow expression, f</span>
<a name="line-1167"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- input expression, arg</span>
<a name="line-1168"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>id</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- type of the arrow expressions f,</span>
<a name="line-1169"></a>                         <span class='hs-comment'>-- of the form a t t', where arg :: t</span>
<a name="line-1170"></a>        <span class='hs-conid'>HsArrAppType</span>     <span class='hs-comment'>-- higher-order (-&lt;&lt;) or first-order (-&lt;)</span>
<a name="line-1171"></a>        <span class='hs-conid'>Bool</span>             <span class='hs-comment'>-- True =&gt; right-to-left (f -&lt; arg)</span>
<a name="line-1172"></a>                         <span class='hs-comment'>-- False =&gt; left-to-right (arg &gt;- f)</span>
<a name="line-1173"></a>
<a name="line-1174"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpenB' @'(|'@,</span>
<a name="line-1175"></a>  <span class='hs-comment'>--         'ApiAnnotation.AnnCloseB' @'|)'@</span>
<a name="line-1176"></a>
<a name="line-1177"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-1178"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCmdArrForm</span>         <span class='hs-comment'>-- Command formation,  (| e cmd1 .. cmdn |)</span>
<a name="line-1179"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- The operator.</span>
<a name="line-1180"></a>                         <span class='hs-comment'>-- After type-checking, a type abstraction to be</span>
<a name="line-1181"></a>                         <span class='hs-comment'>-- applied to the type of the local environment tuple</span>
<a name="line-1182"></a>        <span class='hs-conid'>LexicalFixity</span>    <span class='hs-comment'>-- Whether the operator appeared prefix or infix when</span>
<a name="line-1183"></a>                         <span class='hs-comment'>-- parsed.</span>
<a name="line-1184"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>Fixity</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- fixity (filled in by the renamer), for forms that</span>
<a name="line-1185"></a>                         <span class='hs-comment'>-- were converted from OpApp's by the renamer</span>
<a name="line-1186"></a>        <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsCmdTop</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span>   <span class='hs-comment'>-- argument commands</span>
<a name="line-1187"></a>
<a name="line-1188"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCmdApp</span>    <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmd</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-1189"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-1190"></a>
<a name="line-1191"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCmdLam</span>    <span class='hs-layout'>(</span><span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmd</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- kappa</span>
<a name="line-1192"></a>       <span class='hs-comment'>-- ^ - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnLam',</span>
<a name="line-1193"></a>       <span class='hs-comment'>--       'ApiAnnotation.AnnRarrow',</span>
<a name="line-1194"></a>
<a name="line-1195"></a>       <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-1196"></a>
<a name="line-1197"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCmdPar</span>    <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmd</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>                     <span class='hs-comment'>-- parenthesised command</span>
<a name="line-1198"></a>    <span class='hs-comment'>-- ^ - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnOpen' @'('@,</span>
<a name="line-1199"></a>    <span class='hs-comment'>--             'ApiAnnotation.AnnClose' @')'@</span>
<a name="line-1200"></a>
<a name="line-1201"></a>    <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-1202"></a>
<a name="line-1203"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCmdCase</span>   <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-1204"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmd</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- bodies are HsCmd's</span>
<a name="line-1205"></a>    <span class='hs-comment'>-- ^ - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnCase',</span>
<a name="line-1206"></a>    <span class='hs-comment'>--       'ApiAnnotation.AnnOf','ApiAnnotation.AnnOpen' @'{'@,</span>
<a name="line-1207"></a>    <span class='hs-comment'>--       'ApiAnnotation.AnnClose' @'}'@</span>
<a name="line-1208"></a>
<a name="line-1209"></a>    <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-1210"></a>
<a name="line-1211"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCmdIf</span>     <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>         <span class='hs-comment'>-- cond function</span>
<a name="line-1212"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>                    <span class='hs-comment'>-- predicate</span>
<a name="line-1213"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmd</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>                     <span class='hs-comment'>-- then part</span>
<a name="line-1214"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmd</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>                     <span class='hs-comment'>-- else part</span>
<a name="line-1215"></a>    <span class='hs-comment'>-- ^ - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnIf',</span>
<a name="line-1216"></a>    <span class='hs-comment'>--       'ApiAnnotation.AnnSemi',</span>
<a name="line-1217"></a>    <span class='hs-comment'>--       'ApiAnnotation.AnnThen','ApiAnnotation.AnnSemi',</span>
<a name="line-1218"></a>    <span class='hs-comment'>--       'ApiAnnotation.AnnElse',</span>
<a name="line-1219"></a>
<a name="line-1220"></a>    <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-1221"></a>
<a name="line-1222"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCmdLet</span>    <span class='hs-layout'>(</span><span class='hs-conid'>LHsLocalBinds</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>      <span class='hs-comment'>-- let(rec)</span>
<a name="line-1223"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmd</span>  <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-1224"></a>    <span class='hs-comment'>-- ^ - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnLet',</span>
<a name="line-1225"></a>    <span class='hs-comment'>--       'ApiAnnotation.AnnOpen' @'{'@,</span>
<a name="line-1226"></a>    <span class='hs-comment'>--       'ApiAnnotation.AnnClose' @'}'@,'ApiAnnotation.AnnIn'</span>
<a name="line-1227"></a>
<a name="line-1228"></a>    <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-1229"></a>
<a name="line-1230"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCmdDo</span>     <span class='hs-layout'>(</span><span class='hs-conid'>Located</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>CmdLStmt</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1231"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>id</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span>                <span class='hs-comment'>-- Type of the whole expression</span>
<a name="line-1232"></a>    <span class='hs-comment'>-- ^ - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnDo',</span>
<a name="line-1233"></a>    <span class='hs-comment'>--             'ApiAnnotation.AnnOpen', 'ApiAnnotation.AnnSemi',</span>
<a name="line-1234"></a>    <span class='hs-comment'>--             'ApiAnnotation.AnnVbar',</span>
<a name="line-1235"></a>    <span class='hs-comment'>--             'ApiAnnotation.AnnClose'</span>
<a name="line-1236"></a>
<a name="line-1237"></a>    <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-1238"></a>
<a name="line-1239"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsCmdWrap</span>   <span class='hs-conid'>HsWrapper</span>
<a name="line-1240"></a>                <span class='hs-layout'>(</span><span class='hs-conid'>HsCmd</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- If   cmd :: arg1 --&gt; res</span>
<a name="line-1241"></a>                               <span class='hs-comment'>--      wrap :: arg1 "-&gt;" arg2</span>
<a name="line-1242"></a>                               <span class='hs-comment'>-- Then (HsCmdWrap wrap cmd) :: arg2 --&gt; res</span>
<a name="line-1243"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataId</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmd</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-1244"></a>
<a name="line-1245"></a><a name="HsArrAppType"></a><span class='hs-comment'>-- | Haskell Array Application Type</span>
<a name="line-1246"></a><a name="HsArrAppType"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsArrAppType</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsHigherOrderApp</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsFirstOrderApp</span>
<a name="line-1247"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Data</span>
<a name="line-1248"></a>
<a name="line-1249"></a>
<a name="line-1250"></a><span class='hs-comment'>{- | Top-level command, introducing a new arrow.
<a name="line-1251"></a>This may occur inside a proc (where the stack is empty) or as an
<a name="line-1252"></a>argument of a command-forming operator.
<a name="line-1253"></a>-}</span>
<a name="line-1254"></a>
<a name="line-1255"></a><a name="LHsCmdTop"></a><span class='hs-comment'>-- | Located Haskell Top-level Command</span>
<a name="line-1256"></a><a name="LHsCmdTop"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LHsCmdTop</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdTop</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-1257"></a>
<a name="line-1258"></a><a name="HsCmdTop"></a><span class='hs-comment'>-- | Haskell Top-level Command</span>
<a name="line-1259"></a><a name="HsCmdTop"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsCmdTop</span> <span class='hs-varid'>p</span>
<a name="line-1260"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsCmdTop</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmd</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-1261"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>p</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- Nested tuple of inputs on the command's stack</span>
<a name="line-1262"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>p</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- return type of the command</span>
<a name="line-1263"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>CmdSyntaxTable</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- See Note [CmdSyntaxTable]</span>
<a name="line-1264"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdTop</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-1265"></a>
<a name="line-1266"></a><a name="instance%20Outputable%20(HsCmd%20p)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmd</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1267"></a>    <span class='hs-varid'>ppr</span> <span class='hs-varid'>cmd</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprCmd</span> <span class='hs-varid'>cmd</span>
<a name="line-1268"></a>
<a name="line-1269"></a><a name="pprLCmd"></a><span class='hs-comment'>-----------------------</span>
<a name="line-1270"></a><span class='hs-comment'>-- pprCmd and pprLCmd call pprDeeper;</span>
<a name="line-1271"></a><span class='hs-comment'>-- the underscore versions do not</span>
<a name="line-1272"></a><span class='hs-definition'>pprLCmd</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LHsCmd</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-1273"></a><span class='hs-definition'>pprLCmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprCmd</span> <span class='hs-varid'>c</span>
<a name="line-1274"></a>
<a name="line-1275"></a><a name="pprCmd"></a><span class='hs-definition'>pprCmd</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsCmd</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-1276"></a><span class='hs-definition'>pprCmd</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isQuietHsCmd</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span>            <span class='hs-varid'>ppr_cmd</span> <span class='hs-varid'>c</span>
<a name="line-1277"></a>         <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprDeeper</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_cmd</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-1278"></a>
<a name="line-1279"></a><a name="isQuietHsCmd"></a><span class='hs-definition'>isQuietHsCmd</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsCmd</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-1280"></a><span class='hs-comment'>-- Parentheses do display something, but it gives little info and</span>
<a name="line-1281"></a><span class='hs-comment'>-- if we go deeper when we go inside them then we get ugly things</span>
<a name="line-1282"></a><span class='hs-comment'>-- like (...)</span>
<a name="line-1283"></a><span class='hs-definition'>isQuietHsCmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdPar</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-1284"></a><span class='hs-comment'>-- applications don't display anything themselves</span>
<a name="line-1285"></a><span class='hs-definition'>isQuietHsCmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdApp</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-1286"></a><span class='hs-definition'>isQuietHsCmd</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1287"></a>
<a name="line-1288"></a><a name="ppr_lcmd"></a><span class='hs-comment'>-----------------------</span>
<a name="line-1289"></a><span class='hs-definition'>ppr_lcmd</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LHsCmd</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-1290"></a><span class='hs-definition'>ppr_lcmd</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-1291"></a>
<a name="line-1292"></a><a name="ppr_cmd"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>p</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsCmd</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-1293"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdPar</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_lcmd</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-1294"></a>
<a name="line-1295"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdApp</span> <span class='hs-varid'>c</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-1296"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <span class='hs-layout'>(</span><span class='hs-varid'>fun</span><span class='hs-layout'>,</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collect_args</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>e</span><span class='hs-keyglyph'>]</span> <span class='hs-keyword'>in</span>
<a name="line-1297"></a>    <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_lcmd</span> <span class='hs-varid'>fun</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1298"></a>  <span class='hs-keyword'>where</span>
<a name="line-1299"></a>    <span class='hs-varid'>collect_args</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdApp</span> <span class='hs-varid'>fun</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>args</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>collect_args</span> <span class='hs-varid'>fun</span> <span class='hs-layout'>(</span><span class='hs-varid'>arg</span><span class='hs-conop'>:</span><span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-1300"></a>    <span class='hs-varid'>collect_args</span> <span class='hs-varid'>fun</span> <span class='hs-varid'>args</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>fun</span><span class='hs-layout'>,</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-1301"></a>
<a name="line-1302"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdLam</span> <span class='hs-varid'>matches</span><span class='hs-layout'>)</span>
<a name="line-1303"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprMatches</span> <span class='hs-varid'>matches</span>
<a name="line-1304"></a>
<a name="line-1305"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdCase</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>matches</span><span class='hs-layout'>)</span>
<a name="line-1306"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"case"</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"of"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-1307"></a>          <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprMatches</span> <span class='hs-varid'>matches</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>]</span>
<a name="line-1308"></a>
<a name="line-1309"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdIf</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e</span> <span class='hs-varid'>ct</span> <span class='hs-varid'>ce</span><span class='hs-layout'>)</span>
<a name="line-1310"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"if"</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"then"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-1311"></a>         <span class='hs-varid'>nest</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>ct</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-1312"></a>         <span class='hs-varid'>text</span> <span class='hs-str'>"else"</span><span class='hs-layout'>,</span>
<a name="line-1313"></a>         <span class='hs-varid'>nest</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>ce</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-1314"></a>
<a name="line-1315"></a><span class='hs-comment'>-- special case: let ... in let ...</span>
<a name="line-1316"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdLet</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span> <span class='hs-varid'>cmd</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdLet</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1317"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"let"</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprBinds</span> <span class='hs-varid'>binds</span><span class='hs-layout'>,</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"in"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-1318"></a>         <span class='hs-varid'>ppr_lcmd</span> <span class='hs-varid'>cmd</span><span class='hs-keyglyph'>]</span>
<a name="line-1319"></a>
<a name="line-1320"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdLet</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span> <span class='hs-varid'>cmd</span><span class='hs-layout'>)</span>
<a name="line-1321"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"let"</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprBinds</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-1322"></a>         <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"in"</span><span class='hs-layout'>)</span>  <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>cmd</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-1323"></a>
<a name="line-1324"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdDo</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>stmts</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprDo</span> <span class='hs-conid'>ArrowExpr</span> <span class='hs-varid'>stmts</span>
<a name="line-1325"></a>
<a name="line-1326"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdWrap</span> <span class='hs-varid'>w</span> <span class='hs-varid'>cmd</span><span class='hs-layout'>)</span>
<a name="line-1327"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprHsWrapper</span> <span class='hs-varid'>w</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_cmd</span> <span class='hs-varid'>cmd</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1328"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdArrApp</span> <span class='hs-varid'>arrow</span> <span class='hs-varid'>arg</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>HsFirstOrderApp</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span>
<a name="line-1329"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arrow</span><span class='hs-layout'>,</span> <span class='hs-varid'>larrowt</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arg</span><span class='hs-keyglyph'>]</span>
<a name="line-1330"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdArrApp</span> <span class='hs-varid'>arrow</span> <span class='hs-varid'>arg</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>HsFirstOrderApp</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span>
<a name="line-1331"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arg</span><span class='hs-layout'>,</span> <span class='hs-varid'>arrowt</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arrow</span><span class='hs-keyglyph'>]</span>
<a name="line-1332"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdArrApp</span> <span class='hs-varid'>arrow</span> <span class='hs-varid'>arg</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>HsHigherOrderApp</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span>
<a name="line-1333"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arrow</span><span class='hs-layout'>,</span> <span class='hs-varid'>larrowtt</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arg</span><span class='hs-keyglyph'>]</span>
<a name="line-1334"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdArrApp</span> <span class='hs-varid'>arrow</span> <span class='hs-varid'>arg</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>HsHigherOrderApp</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span>
<a name="line-1335"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arg</span><span class='hs-layout'>,</span> <span class='hs-varid'>arrowtt</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>arrow</span><span class='hs-keyglyph'>]</span>
<a name="line-1336"></a>
<a name="line-1337"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdArrForm</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVar</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>arg1</span><span class='hs-layout'>,</span> <span class='hs-varid'>arg2</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1338"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprCmdArg</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>arg1</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>pprInfixOcc</span> <span class='hs-varid'>v</span>
<a name="line-1339"></a>                                         <span class='hs-layout'>,</span> <span class='hs-varid'>pprCmdArg</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>arg2</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1340"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdArrForm</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsVar</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-conid'>Infix</span> <span class='hs-keyword'>_</span>    <span class='hs-keyglyph'>[</span><span class='hs-varid'>arg1</span><span class='hs-layout'>,</span> <span class='hs-varid'>arg2</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1341"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprCmdArg</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>arg1</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>pprInfixOcc</span> <span class='hs-varid'>v</span>
<a name="line-1342"></a>                                         <span class='hs-layout'>,</span> <span class='hs-varid'>pprCmdArg</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>arg2</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1343"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdArrForm</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsConLikeOut</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>arg1</span><span class='hs-layout'>,</span> <span class='hs-varid'>arg2</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1344"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprCmdArg</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>arg1</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>pprInfixOcc</span> <span class='hs-layout'>(</span><span class='hs-varid'>conLikeName</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-1345"></a>                                         <span class='hs-layout'>,</span> <span class='hs-varid'>pprCmdArg</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>arg2</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1346"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdArrForm</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsConLikeOut</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-conid'>Infix</span> <span class='hs-keyword'>_</span>    <span class='hs-keyglyph'>[</span><span class='hs-varid'>arg1</span><span class='hs-layout'>,</span> <span class='hs-varid'>arg2</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1347"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprCmdArg</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>arg1</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>pprInfixOcc</span> <span class='hs-layout'>(</span><span class='hs-varid'>conLikeName</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-1348"></a>                                         <span class='hs-layout'>,</span> <span class='hs-varid'>pprCmdArg</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>arg2</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1349"></a><span class='hs-definition'>ppr_cmd</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdArrForm</span> <span class='hs-varid'>op</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span>
<a name="line-1350"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"(|"</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr_lexpr</span> <span class='hs-varid'>op</span><span class='hs-layout'>)</span>
<a name="line-1351"></a>         <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprCmdArg</span><span class='hs-varop'>.</span><span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"|)"</span><span class='hs-layout'>)</span>
<a name="line-1352"></a>
<a name="line-1353"></a><a name="pprCmdArg"></a><span class='hs-definition'>pprCmdArg</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsCmdTop</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-1354"></a><span class='hs-definition'>pprCmdArg</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdTop</span> <span class='hs-varid'>cmd</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
<a name="line-1355"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_lcmd</span> <span class='hs-varid'>cmd</span>
<a name="line-1356"></a>
<a name="line-1357"></a><a name="instance%20Outputable%20(HsCmdTop%20p)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsCmdTop</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1358"></a>    <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprCmdArg</span>
<a name="line-1359"></a>
<a name="line-1360"></a><span class='hs-comment'>{-
<a name="line-1361"></a>************************************************************************
<a name="line-1362"></a>*                                                                      *
<a name="line-1363"></a>\subsection{Record binds}
<a name="line-1364"></a>*                                                                      *
<a name="line-1365"></a>************************************************************************
<a name="line-1366"></a>-}</span>
<a name="line-1367"></a>
<a name="line-1368"></a><a name="HsRecordBinds"></a><span class='hs-comment'>-- | Haskell Record Bindings</span>
<a name="line-1369"></a><a name="HsRecordBinds"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>HsRecordBinds</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsRecFields</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-1370"></a>
<a name="line-1371"></a><span class='hs-comment'>{-
<a name="line-1372"></a>************************************************************************
<a name="line-1373"></a>*                                                                      *
<a name="line-1374"></a>\subsection{@Match@, @GRHSs@, and @GRHS@ datatypes}
<a name="line-1375"></a>*                                                                      *
<a name="line-1376"></a>************************************************************************
<a name="line-1377"></a>
<a name="line-1378"></a>@Match@es are sets of pattern bindings and right hand sides for
<a name="line-1379"></a>functions, patterns or case branches. For example, if a function @g@
<a name="line-1380"></a>is defined as:
<a name="line-1381"></a>\begin{verbatim}
<a name="line-1382"></a>g (x,y) = y
<a name="line-1383"></a>g ((x:ys),y) = y+1,
<a name="line-1384"></a>\end{verbatim}
<a name="line-1385"></a>then \tr{g} has two @Match@es: @(x,y) = y@ and @((x:ys),y) = y+1@.
<a name="line-1386"></a>
<a name="line-1387"></a>It is always the case that each element of an @[Match]@ list has the
<a name="line-1388"></a>same number of @pats@s inside it.  This corresponds to saying that
<a name="line-1389"></a>a function defined by pattern matching must have the same number of
<a name="line-1390"></a>patterns in each equation.
<a name="line-1391"></a>-}</span>
<a name="line-1392"></a>
<a name="line-1393"></a><a name="MatchGroup"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>p</span> <span class='hs-varid'>body</span>
<a name="line-1394"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>MG</span> <span class='hs-layout'>{</span> <span class='hs-varid'>mg_alts</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LMatch</span> <span class='hs-varid'>p</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span>  <span class='hs-comment'>-- The alternatives</span>
<a name="line-1395"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>mg_arg_tys</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>p</span> <span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span>  <span class='hs-comment'>-- Types of the arguments, t1..tn</span>
<a name="line-1396"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>mg_res_ty</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PostTc</span> <span class='hs-varid'>p</span> <span class='hs-conid'>Type</span>    <span class='hs-comment'>-- Type of the result, tr</span>
<a name="line-1397"></a>       <span class='hs-layout'>,</span> <span class='hs-varid'>mg_origin</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Origin</span> <span class='hs-layout'>}</span>
<a name="line-1398"></a>     <span class='hs-comment'>-- The type is the type of the entire group</span>
<a name="line-1399"></a>     <span class='hs-comment'>--      t1 -&gt; ... -&gt; tn -&gt; tr</span>
<a name="line-1400"></a>     <span class='hs-comment'>-- where there are n patterns</span>
<a name="line-1401"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span> <span class='hs-varid'>body</span><span class='hs-layout'>,</span><span class='hs-conid'>DataId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>p</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1402"></a>
<a name="line-1403"></a><a name="LMatch"></a><span class='hs-comment'>-- | Located Match</span>
<a name="line-1404"></a><a name="LMatch"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LMatch</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>Match</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1405"></a><span class='hs-comment'>-- ^ May have 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnSemi' when in a</span>
<a name="line-1406"></a><span class='hs-comment'>--   list</span>
<a name="line-1407"></a>
<a name="line-1408"></a><a name="Match"></a><span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-1409"></a><a name="Match"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Match</span> <span class='hs-varid'>p</span> <span class='hs-varid'>body</span>
<a name="line-1410"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Match</span> <span class='hs-layout'>{</span>
<a name="line-1411"></a>        <span class='hs-varid'>m_ctxt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-layout'>(</span><span class='hs-conid'>NameOrRdrName</span> <span class='hs-layout'>(</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-1412"></a>          <span class='hs-comment'>-- See note [m_ctxt in Match]</span>
<a name="line-1413"></a>        <span class='hs-varid'>m_pats</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- The patterns</span>
<a name="line-1414"></a>        <span class='hs-varid'>m_type</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-1415"></a>                                 <span class='hs-comment'>-- A type signature for the result of the match</span>
<a name="line-1416"></a>                                 <span class='hs-comment'>-- Nothing after typechecking</span>
<a name="line-1417"></a>                                 <span class='hs-comment'>-- NB: No longer supported</span>
<a name="line-1418"></a>        <span class='hs-varid'>m_grhss</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>GRHSs</span> <span class='hs-varid'>p</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1419"></a>  <span class='hs-layout'>}</span>
<a name="line-1420"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span> <span class='hs-varid'>body</span><span class='hs-layout'>,</span><span class='hs-conid'>DataId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>Match</span> <span class='hs-varid'>p</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1421"></a>
<a name="line-1422"></a><a name="instance%20Outputable%20(Match%20idR%20body)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1423"></a>            <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>Match</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1424"></a>  <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprMatch</span>
<a name="line-1425"></a>
<a name="line-1426"></a><span class='hs-comment'>{-
<a name="line-1427"></a>Note [m_ctxt in Match]
<a name="line-1428"></a>~~~~~~~~~~~~~~~~~~~~~~
<a name="line-1429"></a>
<a name="line-1430"></a>A Match can occur in a number of contexts, such as a FunBind, HsCase, HsLam and
<a name="line-1431"></a>so on.
<a name="line-1432"></a>
<a name="line-1433"></a>In order to simplify tooling processing and pretty print output, the provenance
<a name="line-1434"></a>is captured in an HsMatchContext.
<a name="line-1435"></a>
<a name="line-1436"></a>This is particularly important for the API Annotations for a multi-equation
<a name="line-1437"></a>FunBind.
<a name="line-1438"></a>
<a name="line-1439"></a>The parser initially creates a FunBind with a single Match in it for
<a name="line-1440"></a>every function definition it sees.
<a name="line-1441"></a>
<a name="line-1442"></a>These are then grouped together by getMonoBind into a single FunBind,
<a name="line-1443"></a>where all the Matches are combined.
<a name="line-1444"></a>
<a name="line-1445"></a>In the process, all the original FunBind fun_id's bar one are
<a name="line-1446"></a>discarded, including the locations.
<a name="line-1447"></a>
<a name="line-1448"></a>This causes a problem for source to source conversions via API
<a name="line-1449"></a>Annotations, so the original fun_ids and infix flags are preserved in
<a name="line-1450"></a>the Match, when it originates from a FunBind.
<a name="line-1451"></a>
<a name="line-1452"></a>Example infix function definition requiring individual API Annotations
<a name="line-1453"></a>
<a name="line-1454"></a>    (&amp;&amp;&amp;  ) [] [] =  []
<a name="line-1455"></a>    xs    &amp;&amp;&amp;   [] =  xs
<a name="line-1456"></a>    (  &amp;&amp;&amp;  ) [] ys =  ys
<a name="line-1457"></a>
<a name="line-1458"></a>
<a name="line-1459"></a>
<a name="line-1460"></a>-}</span>
<a name="line-1461"></a>
<a name="line-1462"></a>
<a name="line-1463"></a><a name="isInfixMatch"></a><span class='hs-definition'>isInfixMatch</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Match</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-1464"></a><span class='hs-definition'>isInfixMatch</span> <span class='hs-varid'>match</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>m_ctxt</span> <span class='hs-varid'>match</span> <span class='hs-keyword'>of</span>
<a name="line-1465"></a>  <span class='hs-conid'>FunRhs</span> <span class='hs-layout'>{</span><span class='hs-varid'>mc_fixity</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Infix</span><span class='hs-layout'>}</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<a name="line-1466"></a>  <span class='hs-keyword'>_</span>                          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span>
<a name="line-1467"></a>
<a name="line-1468"></a><a name="isEmptyMatchGroup"></a><span class='hs-definition'>isEmptyMatchGroup</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-1469"></a><span class='hs-definition'>isEmptyMatchGroup</span> <span class='hs-layout'>(</span><span class='hs-conid'>MG</span> <span class='hs-layout'>{</span> <span class='hs-varid'>mg_alts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ms</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>null</span> <span class='hs-varop'>$</span> <span class='hs-varid'>unLoc</span> <span class='hs-varid'>ms</span>
<a name="line-1470"></a>
<a name="line-1471"></a><a name="isSingletonMatchGroup"></a><span class='hs-comment'>-- | Is there only one RHS in this list of matches?</span>
<a name="line-1472"></a><span class='hs-definition'>isSingletonMatchGroup</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LMatch</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-1473"></a><span class='hs-definition'>isSingletonMatchGroup</span> <span class='hs-varid'>matches</span>
<a name="line-1474"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>match</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>matches</span>
<a name="line-1475"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Match</span> <span class='hs-layout'>{</span> <span class='hs-varid'>m_grhss</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GRHSs</span> <span class='hs-layout'>{</span> <span class='hs-varid'>grhssGRHSs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-keyword'>_</span><span class='hs-keyglyph'>]</span> <span class='hs-layout'>}</span> <span class='hs-layout'>}</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>match</span>
<a name="line-1476"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-1477"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-1478"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-1479"></a>
<a name="line-1480"></a><a name="matchGroupArity"></a><span class='hs-definition'>matchGroupArity</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Arity</span>
<a name="line-1481"></a><span class='hs-comment'>-- Precondition: MatchGroup is non-empty</span>
<a name="line-1482"></a><span class='hs-comment'>-- This is called before type checking, when mg_arg_tys is not set</span>
<a name="line-1483"></a><span class='hs-definition'>matchGroupArity</span> <span class='hs-layout'>(</span><span class='hs-conid'>MG</span> <span class='hs-layout'>{</span> <span class='hs-varid'>mg_alts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>alts</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-1484"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-varid'>alt1</span><span class='hs-conop'>:</span><span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>alts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>length</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsLMatchPats</span> <span class='hs-varid'>alt1</span><span class='hs-layout'>)</span>
<a name="line-1485"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"matchGroupArity"</span>
<a name="line-1486"></a>
<a name="line-1487"></a><a name="hsLMatchPats"></a><span class='hs-definition'>hsLMatchPats</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LMatch</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span>
<a name="line-1488"></a><span class='hs-definition'>hsLMatchPats</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>Match</span> <span class='hs-layout'>{</span> <span class='hs-varid'>m_pats</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pats</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pats</span>
<a name="line-1489"></a>
<a name="line-1490"></a><span class='hs-comment'>-- | Guarded Right-Hand Sides</span>
<a name="line-1491"></a><span class='hs-comment'>--</span>
<a name="line-1492"></a><span class='hs-comment'>-- GRHSs are used both for pattern bindings and for Matches</span>
<a name="line-1493"></a><span class='hs-comment'>--</span>
<a name="line-1494"></a><span class='hs-comment'>--  - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnVbar',</span>
<a name="line-1495"></a><span class='hs-comment'>--        'ApiAnnotation.AnnEqual','ApiAnnotation.AnnWhere',</span>
<a name="line-1496"></a><span class='hs-comment'>--        'ApiAnnotation.AnnOpen','ApiAnnotation.AnnClose'</span>
<a name="line-1497"></a><span class='hs-comment'>--        'ApiAnnotation.AnnRarrow','ApiAnnotation.AnnSemi'</span>
<a name="line-1498"></a>
<a name="line-1499"></a><a name="GRHSs"></a><span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-1500"></a><a name="GRHSs"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>GRHSs</span> <span class='hs-varid'>p</span> <span class='hs-varid'>body</span>
<a name="line-1501"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GRHSs</span> <span class='hs-layout'>{</span>
<a name="line-1502"></a>      <span class='hs-varid'>grhssGRHSs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LGRHS</span> <span class='hs-varid'>p</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>      <span class='hs-comment'>-- ^ Guarded RHSs</span>
<a name="line-1503"></a>      <span class='hs-varid'>grhssLocalBinds</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsLocalBinds</span> <span class='hs-varid'>p</span> <span class='hs-comment'>-- ^ The where clause</span>
<a name="line-1504"></a>    <span class='hs-layout'>}</span>
<a name="line-1505"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span> <span class='hs-varid'>body</span><span class='hs-layout'>,</span><span class='hs-conid'>DataId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>GRHSs</span> <span class='hs-varid'>p</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1506"></a>
<a name="line-1507"></a><a name="LGRHS"></a><span class='hs-comment'>-- | Located Guarded Right-Hand Side</span>
<a name="line-1508"></a><a name="LGRHS"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LGRHS</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>GRHS</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1509"></a>
<a name="line-1510"></a><a name="GRHS"></a><span class='hs-comment'>-- | Guarded Right Hand Side.</span>
<a name="line-1511"></a><a name="GRHS"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>GRHS</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GRHS</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>GuardLStmt</span> <span class='hs-varid'>id</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- Guards</span>
<a name="line-1512"></a>                         <span class='hs-varid'>body</span>            <span class='hs-comment'>-- Right hand side</span>
<a name="line-1513"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span> <span class='hs-varid'>body</span><span class='hs-layout'>,</span><span class='hs-conid'>DataId</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>GRHS</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1514"></a>
<a name="line-1515"></a><span class='hs-comment'>-- We know the list must have at least one @Match@ in it.</span>
<a name="line-1516"></a>
<a name="line-1517"></a><a name="pprMatches"></a><span class='hs-definition'>pprMatches</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1518"></a>           <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-1519"></a><span class='hs-definition'>pprMatches</span> <span class='hs-conid'>MG</span> <span class='hs-layout'>{</span> <span class='hs-varid'>mg_alts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>matches</span> <span class='hs-layout'>}</span>
<a name="line-1520"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vcat</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>pprMatch</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>unLoc</span> <span class='hs-layout'>(</span><span class='hs-varid'>unLoc</span> <span class='hs-varid'>matches</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1521"></a>      <span class='hs-comment'>-- Don't print the type; it's only a place-holder before typechecking</span>
<a name="line-1522"></a>
<a name="line-1523"></a><a name="pprFunBind"></a><span class='hs-comment'>-- Exported to HsBinds, which can't see the defn of HsMatchContext</span>
<a name="line-1524"></a><span class='hs-definition'>pprFunBind</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1525"></a>           <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>MatchGroup</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-1526"></a><span class='hs-definition'>pprFunBind</span> <span class='hs-varid'>matches</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprMatches</span> <span class='hs-varid'>matches</span>
<a name="line-1527"></a>
<a name="line-1528"></a><a name="pprPatBind"></a><span class='hs-comment'>-- Exported to HsBinds, which can't see the defn of HsMatchContext</span>
<a name="line-1529"></a><span class='hs-definition'>pprPatBind</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>bndr</span> <span class='hs-varid'>p</span> <span class='hs-varid'>body</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>bndr</span><span class='hs-layout'>,</span>
<a name="line-1530"></a>                                   <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>bndr</span><span class='hs-layout'>,</span>
<a name="line-1531"></a>                                   <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span>
<a name="line-1532"></a>                                   <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1533"></a>           <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>LPat</span> <span class='hs-varid'>bndr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GRHSs</span> <span class='hs-varid'>p</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-1534"></a><span class='hs-definition'>pprPatBind</span> <span class='hs-varid'>pat</span> <span class='hs-layout'>(</span><span class='hs-varid'>grhss</span><span class='hs-layout'>)</span>
<a name="line-1535"></a> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>pat</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprGRHSs</span> <span class='hs-layout'>(</span><span class='hs-conid'>PatBindRhs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-layout'>(</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>grhss</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-1536"></a>
<a name="line-1537"></a><a name="pprMatch"></a><span class='hs-definition'>pprMatch</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1538"></a>         <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Match</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-1539"></a><span class='hs-definition'>pprMatch</span> <span class='hs-varid'>match</span>
<a name="line-1540"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>herald</span> <span class='hs-conop'>:</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-varop'>.</span> <span class='hs-varid'>pprParendLPat</span><span class='hs-layout'>)</span> <span class='hs-varid'>other_pats</span><span class='hs-layout'>)</span>
<a name="line-1541"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-varid'>ppr_maybe_ty</span>
<a name="line-1542"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprGRHSs</span> <span class='hs-varid'>ctxt</span> <span class='hs-layout'>(</span><span class='hs-varid'>m_grhss</span> <span class='hs-varid'>match</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>]</span>
<a name="line-1543"></a>  <span class='hs-keyword'>where</span>
<a name="line-1544"></a>    <span class='hs-varid'>ctxt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>m_ctxt</span> <span class='hs-varid'>match</span>
<a name="line-1545"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>herald</span><span class='hs-layout'>,</span> <span class='hs-varid'>other_pats</span><span class='hs-layout'>)</span>
<a name="line-1546"></a>        <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>ctxt</span> <span class='hs-keyword'>of</span>
<a name="line-1547"></a>            <span class='hs-conid'>FunRhs</span> <span class='hs-layout'>{</span><span class='hs-varid'>mc_fun</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>fun</span><span class='hs-layout'>,</span> <span class='hs-varid'>mc_fixity</span><span class='hs-keyglyph'>=</span><span class='hs-varid'>fixity</span><span class='hs-layout'>,</span> <span class='hs-varid'>mc_strictness</span><span class='hs-keyglyph'>=</span><span class='hs-varid'>strictness</span><span class='hs-layout'>}</span>
<a name="line-1548"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-varid'>strictness</span> <span class='hs-varop'>==</span> <span class='hs-conid'>SrcStrict</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ASSERT</span><span class='hs-layout'>(</span><span class='hs-varid'>null</span> <span class='hs-varop'>$</span> <span class='hs-varid'>m_pats</span> <span class='hs-varid'>match</span><span class='hs-layout'>)</span>
<a name="line-1549"></a>                                             <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'!'</span><span class='hs-varop'>&lt;&gt;</span><span class='hs-varid'>pprPrefixOcc</span> <span class='hs-varid'>fun</span><span class='hs-layout'>,</span> <span class='hs-varid'>m_pats</span> <span class='hs-varid'>match</span><span class='hs-layout'>)</span>
<a name="line-1550"></a>                        <span class='hs-comment'>-- a strict variable binding</span>
<a name="line-1551"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-varid'>fixity</span> <span class='hs-varop'>==</span> <span class='hs-conid'>Prefix</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprPrefixOcc</span> <span class='hs-varid'>fun</span><span class='hs-layout'>,</span> <span class='hs-varid'>m_pats</span> <span class='hs-varid'>match</span><span class='hs-layout'>)</span>
<a name="line-1552"></a>                        <span class='hs-comment'>-- f x y z = e</span>
<a name="line-1553"></a>                        <span class='hs-comment'>-- Not pprBndr; the AbsBinds will</span>
<a name="line-1554"></a>                        <span class='hs-comment'>-- have printed the signature</span>
<a name="line-1555"></a>
<a name="line-1556"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-varid'>null</span> <span class='hs-varid'>pats2</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>pp_infix</span><span class='hs-layout'>,</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span>
<a name="line-1557"></a>                        <span class='hs-comment'>-- x &amp;&amp;&amp; y = e</span>
<a name="line-1558"></a>
<a name="line-1559"></a>                <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>parens</span> <span class='hs-varid'>pp_infix</span><span class='hs-layout'>,</span> <span class='hs-varid'>pats2</span><span class='hs-layout'>)</span>
<a name="line-1560"></a>                        <span class='hs-comment'>-- (x &amp;&amp;&amp; y) z = e</span>
<a name="line-1561"></a>                <span class='hs-keyword'>where</span>
<a name="line-1562"></a>                  <span class='hs-varid'>pp_infix</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprParendLPat</span> <span class='hs-varid'>pat1</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprInfixOcc</span> <span class='hs-varid'>fun</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprParendLPat</span> <span class='hs-varid'>pat2</span>
<a name="line-1563"></a>
<a name="line-1564"></a>            <span class='hs-conid'>LambdaExpr</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'\\'</span><span class='hs-layout'>,</span> <span class='hs-varid'>m_pats</span> <span class='hs-varid'>match</span><span class='hs-layout'>)</span>
<a name="line-1565"></a>
<a name="line-1566"></a>            <span class='hs-keyword'>_</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ASSERT2</span><span class='hs-layout'>(</span> <span class='hs-varid'>null</span> <span class='hs-varid'>pats1</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ctxt</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>pat1</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>pats1</span> <span class='hs-layout'>)</span>
<a name="line-1567"></a>                  <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>pat1</span><span class='hs-layout'>,</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span>        <span class='hs-comment'>-- No parens around the single pat</span>
<a name="line-1568"></a>
<a name="line-1569"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>pat1</span><span class='hs-conop'>:</span><span class='hs-varid'>pats1</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>m_pats</span> <span class='hs-varid'>match</span>
<a name="line-1570"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>pat2</span><span class='hs-conop'>:</span><span class='hs-varid'>pats2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pats1</span>
<a name="line-1571"></a>    <span class='hs-varid'>ppr_maybe_ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>m_type</span> <span class='hs-varid'>match</span> <span class='hs-keyword'>of</span>
<a name="line-1572"></a>                        <span class='hs-conid'>Just</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>dcolon</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ty</span>
<a name="line-1573"></a>                        <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>empty</span>
<a name="line-1574"></a>
<a name="line-1575"></a>
<a name="line-1576"></a><a name="pprGRHSs"></a><span class='hs-definition'>pprGRHSs</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1577"></a>         <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>idL</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GRHSs</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-1578"></a><span class='hs-definition'>pprGRHSs</span> <span class='hs-varid'>ctxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>GRHSs</span> <span class='hs-varid'>grhss</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1579"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vcat</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprGRHS</span> <span class='hs-varid'>ctxt</span> <span class='hs-varop'>.</span> <span class='hs-varid'>unLoc</span><span class='hs-layout'>)</span> <span class='hs-varid'>grhss</span><span class='hs-layout'>)</span>
<a name="line-1580"></a>  <span class='hs-comment'>-- Print the "where" even if the contents of the binds is empty. Only</span>
<a name="line-1581"></a>  <span class='hs-comment'>-- EmptyLocalBinds means no "where" keyword</span>
<a name="line-1582"></a> <span class='hs-varop'>$$</span> <span class='hs-varid'>ppUnless</span> <span class='hs-layout'>(</span><span class='hs-varid'>eqEmptyLocalBinds</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span>
<a name="line-1583"></a>      <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"where"</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>nest</span> <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprBinds</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1584"></a>
<a name="line-1585"></a><a name="pprGRHS"></a><span class='hs-definition'>pprGRHS</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1586"></a>        <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>idL</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GRHS</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-1587"></a><span class='hs-definition'>pprGRHS</span> <span class='hs-varid'>ctxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>GRHS</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1588"></a> <span class='hs-keyglyph'>=</span>  <span class='hs-varid'>pp_rhs</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>body</span>
<a name="line-1589"></a>
<a name="line-1590"></a><span class='hs-definition'>pprGRHS</span> <span class='hs-varid'>ctxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>GRHS</span> <span class='hs-varid'>guards</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1591"></a> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>vbar</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>interpp'SP</span> <span class='hs-varid'>guards</span><span class='hs-layout'>,</span> <span class='hs-varid'>pp_rhs</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span>
<a name="line-1592"></a>
<a name="line-1593"></a><a name="pp_rhs"></a><span class='hs-definition'>pp_rhs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>idL</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-1594"></a><span class='hs-definition'>pp_rhs</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>rhs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>matchSeparator</span> <span class='hs-varid'>ctxt</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprDeeper</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>rhs</span><span class='hs-layout'>)</span>
<a name="line-1595"></a>
<a name="line-1596"></a><span class='hs-comment'>{-
<a name="line-1597"></a>************************************************************************
<a name="line-1598"></a>*                                                                      *
<a name="line-1599"></a>\subsection{Do stmts and list comprehensions}
<a name="line-1600"></a>*                                                                      *
<a name="line-1601"></a>************************************************************************
<a name="line-1602"></a>-}</span>
<a name="line-1603"></a>
<a name="line-1604"></a><a name="LStmt"></a><span class='hs-comment'>-- | Located @do@ block Statement</span>
<a name="line-1605"></a><a name="LStmt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LStmt</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtLR</span> <span class='hs-varid'>id</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1606"></a>
<a name="line-1607"></a><a name="LStmtLR"></a><span class='hs-comment'>-- | Located Statement with separate Left and Right id's</span>
<a name="line-1608"></a><a name="LStmtLR"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>LStmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Located</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1609"></a>
<a name="line-1610"></a><a name="Stmt"></a><span class='hs-comment'>-- | @do@ block Statement</span>
<a name="line-1611"></a><a name="Stmt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>Stmt</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>StmtLR</span> <span class='hs-varid'>id</span> <span class='hs-varid'>id</span> <span class='hs-varid'>body</span>
<a name="line-1612"></a>
<a name="line-1613"></a><a name="CmdLStmt"></a><span class='hs-comment'>-- | Command Located Statement</span>
<a name="line-1614"></a><a name="CmdLStmt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>CmdLStmt</span>   <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LStmt</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmd</span>  <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-1615"></a>
<a name="line-1616"></a><a name="CmdStmt"></a><span class='hs-comment'>-- | Command Statement</span>
<a name="line-1617"></a><a name="CmdStmt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>CmdStmt</span>    <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Stmt</span>  <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsCmd</span>  <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-1618"></a>
<a name="line-1619"></a><a name="ExprLStmt"></a><span class='hs-comment'>-- | Expression Located Statement</span>
<a name="line-1620"></a><a name="ExprLStmt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>ExprLStmt</span>  <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LStmt</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-1621"></a>
<a name="line-1622"></a><a name="ExprStmt"></a><span class='hs-comment'>-- | Expression Statement</span>
<a name="line-1623"></a><a name="ExprStmt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>ExprStmt</span>   <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Stmt</span>  <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-1624"></a>
<a name="line-1625"></a><a name="GuardLStmt"></a><span class='hs-comment'>-- | Guard Located Statement</span>
<a name="line-1626"></a><a name="GuardLStmt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>GuardLStmt</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LStmt</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-1627"></a>
<a name="line-1628"></a><a name="GuardStmt"></a><span class='hs-comment'>-- | Guard Statement</span>
<a name="line-1629"></a><a name="GuardStmt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>GuardStmt</span>  <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Stmt</span>  <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-1630"></a>
<a name="line-1631"></a><a name="GhciLStmt"></a><span class='hs-comment'>-- | Ghci Located Statement</span>
<a name="line-1632"></a><a name="GhciLStmt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>GhciLStmt</span>  <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LStmt</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-1633"></a>
<a name="line-1634"></a><a name="GhciStmt"></a><span class='hs-comment'>-- | Ghci Statement</span>
<a name="line-1635"></a><a name="GhciStmt"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>GhciStmt</span>   <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Stmt</span>  <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-1636"></a>
<a name="line-1637"></a><span class='hs-comment'>-- The SyntaxExprs in here are used *only* for do-notation and monad</span>
<a name="line-1638"></a><span class='hs-comment'>-- comprehensions, which have rebindable syntax. Otherwise they are unused.</span>
<a name="line-1639"></a><span class='hs-comment'>-- | API Annotations when in qualifier lists or guards</span>
<a name="line-1640"></a><span class='hs-comment'>--  - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnVbar',</span>
<a name="line-1641"></a><span class='hs-comment'>--         'ApiAnnotation.AnnComma','ApiAnnotation.AnnThen',</span>
<a name="line-1642"></a><span class='hs-comment'>--         'ApiAnnotation.AnnBy','ApiAnnotation.AnnBy',</span>
<a name="line-1643"></a><span class='hs-comment'>--         'ApiAnnotation.AnnGroup','ApiAnnotation.AnnUsing'</span>
<a name="line-1644"></a>
<a name="line-1645"></a><a name="StmtLR"></a><span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-1646"></a><a name="StmtLR"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-comment'>-- body should always be (LHs**** idR)</span>
<a name="line-1647"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LastStmt</span>  <span class='hs-comment'>-- Always the last Stmt in ListComp, MonadComp, PArrComp,</span>
<a name="line-1648"></a>              <span class='hs-comment'>-- and (after the renamer) DoExpr, MDoExpr</span>
<a name="line-1649"></a>              <span class='hs-comment'>-- Not used for GhciStmtCtxt, PatGuard, which scope over other stuff</span>
<a name="line-1650"></a>          <span class='hs-varid'>body</span>
<a name="line-1651"></a>          <span class='hs-conid'>Bool</span>               <span class='hs-comment'>-- True &lt;=&gt; return was stripped by ApplicativeDo</span>
<a name="line-1652"></a>          <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- The return operator, used only for</span>
<a name="line-1653"></a>                             <span class='hs-comment'>-- MonadComp For ListComp, PArrComp, we</span>
<a name="line-1654"></a>                             <span class='hs-comment'>-- use the baked-in 'return' For DoExpr,</span>
<a name="line-1655"></a>                             <span class='hs-comment'>-- MDoExpr, we don't apply a 'return' at</span>
<a name="line-1656"></a>                             <span class='hs-comment'>-- all See Note [Monad Comprehensions] |</span>
<a name="line-1657"></a>                             <span class='hs-comment'>-- - 'ApiAnnotation.AnnKeywordId' :</span>
<a name="line-1658"></a>                             <span class='hs-comment'>-- 'ApiAnnotation.AnnLarrow'</span>
<a name="line-1659"></a>
<a name="line-1660"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-1661"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>BindStmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>idL</span><span class='hs-layout'>)</span>
<a name="line-1662"></a>             <span class='hs-varid'>body</span>
<a name="line-1663"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- The (&gt;&gt;=) operator; see Note [The type of bind in Stmts]</span>
<a name="line-1664"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- The fail operator</span>
<a name="line-1665"></a>             <span class='hs-comment'>-- The fail operator is noSyntaxExpr</span>
<a name="line-1666"></a>             <span class='hs-comment'>-- if the pattern match can't fail</span>
<a name="line-1667"></a>
<a name="line-1668"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>idR</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- result type of the function passed to bind;</span>
<a name="line-1669"></a>                                <span class='hs-comment'>-- that is, S in (&gt;&gt;=) :: Q -&gt; (R -&gt; S) -&gt; T</span>
<a name="line-1670"></a>
<a name="line-1671"></a>  <span class='hs-comment'>-- | 'ApplicativeStmt' represents an applicative expression built with</span>
<a name="line-1672"></a>  <span class='hs-comment'>-- &lt;$&gt; and &lt;*&gt;.  It is generated by the renamer, and is desugared into the</span>
<a name="line-1673"></a>  <span class='hs-comment'>-- appropriate applicative expression by the desugarer, but it is intended</span>
<a name="line-1674"></a>  <span class='hs-comment'>-- to be invisible in error messages.</span>
<a name="line-1675"></a>  <span class='hs-comment'>--</span>
<a name="line-1676"></a>  <span class='hs-comment'>-- For full details, see Note [ApplicativeDo] in RnExpr</span>
<a name="line-1677"></a>  <span class='hs-comment'>--</span>
<a name="line-1678"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ApplicativeStmt</span>
<a name="line-1679"></a>             <span class='hs-keyglyph'>[</span> <span class='hs-layout'>(</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span>
<a name="line-1680"></a>               <span class='hs-layout'>,</span> <span class='hs-conid'>ApplicativeArg</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>]</span>
<a name="line-1681"></a>                      <span class='hs-comment'>-- [(&lt;$&gt;, e1), (&lt;*&gt;, e2), ..., (&lt;*&gt;, en)]</span>
<a name="line-1682"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- 'join', if necessary</span>
<a name="line-1683"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>idR</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- Type of the body</span>
<a name="line-1684"></a>
<a name="line-1685"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>BodyStmt</span> <span class='hs-varid'>body</span>              <span class='hs-comment'>-- See Note [BodyStmt]</span>
<a name="line-1686"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- The (&gt;&gt;) operator</span>
<a name="line-1687"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- The `guard` operator; used only in MonadComp</span>
<a name="line-1688"></a>                               <span class='hs-comment'>-- See notes [Monad Comprehensions]</span>
<a name="line-1689"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>idR</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- Element type of the RHS (used for arrows)</span>
<a name="line-1690"></a>
<a name="line-1691"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnLet'</span>
<a name="line-1692"></a>  <span class='hs-comment'>--          'ApiAnnotation.AnnOpen' @'{'@,'ApiAnnotation.AnnClose' @'}'@,</span>
<a name="line-1693"></a>
<a name="line-1694"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-1695"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LetStmt</span>  <span class='hs-layout'>(</span><span class='hs-conid'>LHsLocalBindsLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span>
<a name="line-1696"></a>
<a name="line-1697"></a>  <span class='hs-comment'>-- ParStmts only occur in a list/monad comprehension</span>
<a name="line-1698"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ParStmt</span>  <span class='hs-keyglyph'>[</span><span class='hs-conid'>ParStmtBlock</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span><span class='hs-keyglyph'>]</span>
<a name="line-1699"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>HsExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span>               <span class='hs-comment'>-- Polymorphic `mzip` for monad comprehensions</span>
<a name="line-1700"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span>           <span class='hs-comment'>-- The `&gt;&gt;=` operator</span>
<a name="line-1701"></a>                                        <span class='hs-comment'>-- See notes [Monad Comprehensions]</span>
<a name="line-1702"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>PostTc</span> <span class='hs-varid'>idR</span> <span class='hs-conid'>Type</span><span class='hs-layout'>)</span>          <span class='hs-comment'>-- S in (&gt;&gt;=) :: Q -&gt; (R -&gt; S) -&gt; T</span>
<a name="line-1703"></a>            <span class='hs-comment'>-- After renaming, the ids are the binders</span>
<a name="line-1704"></a>            <span class='hs-comment'>-- bound by the stmts and used after themp</span>
<a name="line-1705"></a>
<a name="line-1706"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TransStmt</span> <span class='hs-layout'>{</span>
<a name="line-1707"></a>      <span class='hs-varid'>trS_form</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TransForm</span><span class='hs-layout'>,</span>
<a name="line-1708"></a>      <span class='hs-varid'>trS_stmts</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ExprLStmt</span> <span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>   <span class='hs-comment'>-- Stmts to the *left* of the 'group'</span>
<a name="line-1709"></a>                                      <span class='hs-comment'>-- which generates the tuples to be grouped</span>
<a name="line-1710"></a>
<a name="line-1711"></a>      <span class='hs-varid'>trS_bndrs</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>IdP</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- See Note [TransStmt binder map]</span>
<a name="line-1712"></a>
<a name="line-1713"></a>      <span class='hs-varid'>trS_using</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span>
<a name="line-1714"></a>      <span class='hs-varid'>trS_by</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- "by e" (optional)</span>
<a name="line-1715"></a>        <span class='hs-comment'>-- Invariant: if trS_form = GroupBy, then grp_by = Just e</span>
<a name="line-1716"></a>
<a name="line-1717"></a>      <span class='hs-varid'>trS_ret</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span>      <span class='hs-comment'>-- The monomorphic 'return' function for</span>
<a name="line-1718"></a>                                      <span class='hs-comment'>-- the inner monad comprehensions</span>
<a name="line-1719"></a>      <span class='hs-varid'>trS_bind</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span>     <span class='hs-comment'>-- The '(&gt;&gt;=)' operator</span>
<a name="line-1720"></a>      <span class='hs-varid'>trS_bind_arg_ty</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PostTc</span> <span class='hs-varid'>idR</span> <span class='hs-conid'>Type</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- R in (&gt;&gt;=) :: Q -&gt; (R -&gt; S) -&gt; T</span>
<a name="line-1721"></a>      <span class='hs-varid'>trS_fmap</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsExpr</span> <span class='hs-varid'>idR</span>          <span class='hs-comment'>-- The polymorphic 'fmap' function for desugaring</span>
<a name="line-1722"></a>                                      <span class='hs-comment'>-- Only for 'group' forms</span>
<a name="line-1723"></a>                                      <span class='hs-comment'>-- Just a simple HsExpr, because it's</span>
<a name="line-1724"></a>                                      <span class='hs-comment'>-- too polymorphic for tcSyntaxOp</span>
<a name="line-1725"></a>    <span class='hs-layout'>}</span>                                 <span class='hs-comment'>-- See Note [Monad Comprehensions]</span>
<a name="line-1726"></a>
<a name="line-1727"></a>  <span class='hs-comment'>-- Recursive statement (see Note [How RecStmt works] below)</span>
<a name="line-1728"></a>  <span class='hs-comment'>-- | - 'ApiAnnotation.AnnKeywordId' : 'ApiAnnotation.AnnRec'</span>
<a name="line-1729"></a>
<a name="line-1730"></a>  <span class='hs-comment'>-- For details on above see note [Api annotations] in ApiAnnotation</span>
<a name="line-1731"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>RecStmt</span>
<a name="line-1732"></a>     <span class='hs-layout'>{</span> <span class='hs-varid'>recS_stmts</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LStmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span>
<a name="line-1733"></a>
<a name="line-1734"></a>        <span class='hs-comment'>-- The next two fields are only valid after renaming</span>
<a name="line-1735"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>recS_later_ids</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>idR</span><span class='hs-keyglyph'>]</span>
<a name="line-1736"></a>                         <span class='hs-comment'>-- The ids are a subset of the variables bound by the</span>
<a name="line-1737"></a>                         <span class='hs-comment'>-- stmts that are used in stmts that follow the RecStmt</span>
<a name="line-1738"></a>
<a name="line-1739"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>recS_rec_ids</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>idR</span><span class='hs-keyglyph'>]</span>
<a name="line-1740"></a>                         <span class='hs-comment'>-- Ditto, but these variables are the "recursive" ones,</span>
<a name="line-1741"></a>                         <span class='hs-comment'>-- that are used before they are bound in the stmts of</span>
<a name="line-1742"></a>                         <span class='hs-comment'>-- the RecStmt.</span>
<a name="line-1743"></a>        <span class='hs-comment'>-- An Id can be in both groups</span>
<a name="line-1744"></a>        <span class='hs-comment'>-- Both sets of Ids are (now) treated monomorphically</span>
<a name="line-1745"></a>        <span class='hs-comment'>-- See Note [How RecStmt works] for why they are separate</span>
<a name="line-1746"></a>
<a name="line-1747"></a>        <span class='hs-comment'>-- Rebindable syntax</span>
<a name="line-1748"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>recS_bind_fn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span> <span class='hs-comment'>-- The bind function</span>
<a name="line-1749"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>recS_ret_fn</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span> <span class='hs-comment'>-- The return function</span>
<a name="line-1750"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>recS_mfix_fn</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span> <span class='hs-comment'>-- The mfix function</span>
<a name="line-1751"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>recS_bind_ty</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PostTc</span> <span class='hs-varid'>idR</span> <span class='hs-conid'>Type</span>  <span class='hs-comment'>-- S in (&gt;&gt;=) :: Q -&gt; (R -&gt; S) -&gt; T</span>
<a name="line-1752"></a>
<a name="line-1753"></a>        <span class='hs-comment'>-- These fields are only valid after typechecking</span>
<a name="line-1754"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>recS_later_rets</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>PostTcExpr</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- (only used in the arrow version)</span>
<a name="line-1755"></a>     <span class='hs-layout'>,</span> <span class='hs-varid'>recS_rec_rets</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>PostTcExpr</span><span class='hs-keyglyph'>]</span> <span class='hs-comment'>-- These expressions correspond 1-to-1</span>
<a name="line-1756"></a>                                     <span class='hs-comment'>-- with recS_later_ids and recS_rec_ids,</span>
<a name="line-1757"></a>                                     <span class='hs-comment'>-- and are the expressions that should be</span>
<a name="line-1758"></a>                                     <span class='hs-comment'>-- returned by the recursion.</span>
<a name="line-1759"></a>                                     <span class='hs-comment'>-- They may not quite be the Ids themselves,</span>
<a name="line-1760"></a>                                     <span class='hs-comment'>-- because the Id may be *polymorphic*, but</span>
<a name="line-1761"></a>                                     <span class='hs-comment'>-- the returned thing has to be *monomorphic*,</span>
<a name="line-1762"></a>                                     <span class='hs-comment'>-- so they may be type applications</span>
<a name="line-1763"></a>
<a name="line-1764"></a>      <span class='hs-layout'>,</span> <span class='hs-varid'>recS_ret_ty</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PostTc</span> <span class='hs-varid'>idR</span> <span class='hs-conid'>Type</span> <span class='hs-comment'>-- The type of</span>
<a name="line-1765"></a>                                       <span class='hs-comment'>-- do { stmts; return (a,b,c) }</span>
<a name="line-1766"></a>                                   <span class='hs-comment'>-- With rebindable syntax the type might not</span>
<a name="line-1767"></a>                                   <span class='hs-comment'>-- be quite as simple as (m (tya, tyb, tyc)).</span>
<a name="line-1768"></a>      <span class='hs-layout'>}</span>
<a name="line-1769"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span> <span class='hs-varid'>body</span><span class='hs-layout'>,</span> <span class='hs-conid'>DataId</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>DataId</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span>
<a name="line-1770"></a>  <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1771"></a>
<a name="line-1772"></a><a name="TransForm"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>TransForm</span>   <span class='hs-comment'>-- The 'f' below is the 'using' function, 'e' is the by function</span>
<a name="line-1773"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ThenForm</span>     <span class='hs-comment'>-- then f               or    then f by e             (depending on trS_by)</span>
<a name="line-1774"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>GroupForm</span>    <span class='hs-comment'>-- then group using f   or    then group by e using f (depending on trS_by)</span>
<a name="line-1775"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Data</span>
<a name="line-1776"></a>
<a name="line-1777"></a><a name="ParStmtBlock"></a><span class='hs-comment'>-- | Parenthesised Statement Block</span>
<a name="line-1778"></a><a name="ParStmtBlock"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ParStmtBlock</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span>
<a name="line-1779"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ParStmtBlock</span>
<a name="line-1780"></a>        <span class='hs-keyglyph'>[</span><span class='hs-conid'>ExprLStmt</span> <span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span>
<a name="line-1781"></a>        <span class='hs-keyglyph'>[</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>idR</span><span class='hs-keyglyph'>]</span>          <span class='hs-comment'>-- The variables to be returned</span>
<a name="line-1782"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>SyntaxExpr</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- The return operator</span>
<a name="line-1783"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataId</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>DataId</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParStmtBlock</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span>
<a name="line-1784"></a>
<a name="line-1785"></a><a name="ApplicativeArg"></a><span class='hs-comment'>-- | Applicative Argument</span>
<a name="line-1786"></a><a name="ApplicativeArg"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ApplicativeArg</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span>
<a name="line-1787"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ApplicativeArgOne</span>            <span class='hs-comment'>-- pat &lt;- expr (pat must be irrefutable)</span>
<a name="line-1788"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>idL</span><span class='hs-layout'>)</span>
<a name="line-1789"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>idL</span><span class='hs-layout'>)</span>
<a name="line-1790"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ApplicativeArgMany</span>           <span class='hs-comment'>-- do { stmts; return vars }</span>
<a name="line-1791"></a>      <span class='hs-keyglyph'>[</span><span class='hs-conid'>ExprLStmt</span> <span class='hs-varid'>idL</span><span class='hs-keyglyph'>]</span>            <span class='hs-comment'>-- stmts</span>
<a name="line-1792"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>HsExpr</span> <span class='hs-varid'>idL</span><span class='hs-layout'>)</span>               <span class='hs-comment'>-- return (v1,..,vn), or just (v1,..,vn)</span>
<a name="line-1793"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>idL</span><span class='hs-layout'>)</span>                 <span class='hs-comment'>-- (v1,...,vn)</span>
<a name="line-1794"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataId</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>DataId</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>ApplicativeArg</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span>
<a name="line-1795"></a>
<a name="line-1796"></a><span class='hs-comment'>{-
<a name="line-1797"></a>Note [The type of bind in Stmts]
<a name="line-1798"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-1799"></a>Some Stmts, notably BindStmt, keep the (&gt;&gt;=) bind operator.
<a name="line-1800"></a>We do NOT assume that it has type
<a name="line-1801"></a>    (&gt;&gt;=) :: m a -&gt; (a -&gt; m b) -&gt; m b
<a name="line-1802"></a>In some cases (see Trac #303, #1537) it might have a more
<a name="line-1803"></a>exotic type, such as
<a name="line-1804"></a>    (&gt;&gt;=) :: m i j a -&gt; (a -&gt; m j k b) -&gt; m i k b
<a name="line-1805"></a>So we must be careful not to make assumptions about the type.
<a name="line-1806"></a>In particular, the monad may not be uniform throughout.
<a name="line-1807"></a>
<a name="line-1808"></a>Note [TransStmt binder map]
<a name="line-1809"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-1810"></a>The [(idR,idR)] in a TransStmt behaves as follows:
<a name="line-1811"></a>
<a name="line-1812"></a>  * Before renaming: []
<a name="line-1813"></a>
<a name="line-1814"></a>  * After renaming:
<a name="line-1815"></a>          [ (x27,x27), ..., (z35,z35) ]
<a name="line-1816"></a>    These are the variables
<a name="line-1817"></a>       bound by the stmts to the left of the 'group'
<a name="line-1818"></a>       and used either in the 'by' clause,
<a name="line-1819"></a>                or     in the stmts following the 'group'
<a name="line-1820"></a>    Each item is a pair of identical variables.
<a name="line-1821"></a>
<a name="line-1822"></a>  * After typechecking:
<a name="line-1823"></a>          [ (x27:Int, x27:[Int]), ..., (z35:Bool, z35:[Bool]) ]
<a name="line-1824"></a>    Each pair has the same unique, but different *types*.
<a name="line-1825"></a>
<a name="line-1826"></a>Note [BodyStmt]
<a name="line-1827"></a>~~~~~~~~~~~~~~~
<a name="line-1828"></a>BodyStmts are a bit tricky, because what they mean
<a name="line-1829"></a>depends on the context.  Consider the following contexts:
<a name="line-1830"></a>
<a name="line-1831"></a>        A do expression of type (m res_ty)
<a name="line-1832"></a>        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-1833"></a>        * BodyStmt E any_ty:   do { ....; E; ... }
<a name="line-1834"></a>                E :: m any_ty
<a name="line-1835"></a>          Translation: E &gt;&gt; ...
<a name="line-1836"></a>
<a name="line-1837"></a>        A list comprehensions of type [elt_ty]
<a name="line-1838"></a>        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-1839"></a>        * BodyStmt E Bool:   [ .. | .... E ]
<a name="line-1840"></a>                        [ .. | ..., E, ... ]
<a name="line-1841"></a>                        [ .. | .... | ..., E | ... ]
<a name="line-1842"></a>                E :: Bool
<a name="line-1843"></a>          Translation: if E then fail else ...
<a name="line-1844"></a>
<a name="line-1845"></a>        A guard list, guarding a RHS of type rhs_ty
<a name="line-1846"></a>        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-1847"></a>        * BodyStmt E BooParStmtBlockl:   f x | ..., E, ... = ...rhs...
<a name="line-1848"></a>                E :: Bool
<a name="line-1849"></a>          Translation: if E then fail else ...
<a name="line-1850"></a>
<a name="line-1851"></a>        A monad comprehension of type (m res_ty)
<a name="line-1852"></a>        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-1853"></a>        * BodyStmt E Bool:   [ .. | .... E ]
<a name="line-1854"></a>                E :: Bool
<a name="line-1855"></a>          Translation: guard E &gt;&gt; ...
<a name="line-1856"></a>
<a name="line-1857"></a>Array comprehensions are handled like list comprehensions.
<a name="line-1858"></a>
<a name="line-1859"></a>Note [How RecStmt works]
<a name="line-1860"></a>~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-1861"></a>Example:
<a name="line-1862"></a>   HsDo [ BindStmt x ex
<a name="line-1863"></a>
<a name="line-1864"></a>        , RecStmt { recS_rec_ids   = [a, c]
<a name="line-1865"></a>                  , recS_stmts     = [ BindStmt b (return (a,c))
<a name="line-1866"></a>                                     , LetStmt a = ...b...
<a name="line-1867"></a>                                     , BindStmt c ec ]
<a name="line-1868"></a>                  , recS_later_ids = [a, b]
<a name="line-1869"></a>
<a name="line-1870"></a>        , return (a b) ]
<a name="line-1871"></a>
<a name="line-1872"></a>Here, the RecStmt binds a,b,c; but
<a name="line-1873"></a>  - Only a,b are used in the stmts *following* the RecStmt,
<a name="line-1874"></a>  - Only a,c are used in the stmts *inside* the RecStmt
<a name="line-1875"></a>        *before* their bindings
<a name="line-1876"></a>
<a name="line-1877"></a>Why do we need *both* rec_ids and later_ids?  For monads they could be
<a name="line-1878"></a>combined into a single set of variables, but not for arrows.  That
<a name="line-1879"></a>follows from the types of the respective feedback operators:
<a name="line-1880"></a>
<a name="line-1881"></a>        mfix :: MonadFix m =&gt; (a -&gt; m a) -&gt; m a
<a name="line-1882"></a>        loop :: ArrowLoop a =&gt; a (b,d) (c,d) -&gt; a b c
<a name="line-1883"></a>
<a name="line-1884"></a>* For mfix, the 'a' covers the union of the later_ids and the rec_ids
<a name="line-1885"></a>* For 'loop', 'c' is the later_ids and 'd' is the rec_ids
<a name="line-1886"></a>
<a name="line-1887"></a>Note [Typing a RecStmt]
<a name="line-1888"></a>~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-1889"></a>A (RecStmt stmts) types as if you had written
<a name="line-1890"></a>
<a name="line-1891"></a>  (v1,..,vn, _, ..., _) &lt;- mfix (\~(_, ..., _, r1, ..., rm) -&gt;
<a name="line-1892"></a>                                 do { stmts
<a name="line-1893"></a>                                    ; return (v1,..vn, r1, ..., rm) })
<a name="line-1894"></a>
<a name="line-1895"></a>where v1..vn are the later_ids
<a name="line-1896"></a>      r1..rm are the rec_ids
<a name="line-1897"></a>
<a name="line-1898"></a>Note [Monad Comprehensions]
<a name="line-1899"></a>~~~~~~~~~~~~~~~~~~~~~~~~~~~
<a name="line-1900"></a>Monad comprehensions require separate functions like 'return' and
<a name="line-1901"></a>'&gt;&gt;=' for desugaring. These functions are stored in the statements
<a name="line-1902"></a>used in monad comprehensions. For example, the 'return' of the 'LastStmt'
<a name="line-1903"></a>expression is used to lift the body of the monad comprehension:
<a name="line-1904"></a>
<a name="line-1905"></a>  [ body | stmts ]
<a name="line-1906"></a>   =&gt;
<a name="line-1907"></a>  stmts &gt;&gt;= \bndrs -&gt; return body
<a name="line-1908"></a>
<a name="line-1909"></a>In transform and grouping statements ('then ..' and 'then group ..') the
<a name="line-1910"></a>'return' function is required for nested monad comprehensions, for example:
<a name="line-1911"></a>
<a name="line-1912"></a>  [ body | stmts, then f, rest ]
<a name="line-1913"></a>   =&gt;
<a name="line-1914"></a>  f [ env | stmts ] &gt;&gt;= \bndrs -&gt; [ body | rest ]
<a name="line-1915"></a>
<a name="line-1916"></a>BodyStmts require the 'Control.Monad.guard' function for boolean
<a name="line-1917"></a>expressions:
<a name="line-1918"></a>
<a name="line-1919"></a>  [ body | exp, stmts ]
<a name="line-1920"></a>   =&gt;
<a name="line-1921"></a>  guard exp &gt;&gt; [ body | stmts ]
<a name="line-1922"></a>
<a name="line-1923"></a>Parallel statements require the 'Control.Monad.Zip.mzip' function:
<a name="line-1924"></a>
<a name="line-1925"></a>  [ body | stmts1 | stmts2 | .. ]
<a name="line-1926"></a>   =&gt;
<a name="line-1927"></a>  mzip stmts1 (mzip stmts2 (..)) &gt;&gt;= \(bndrs1, (bndrs2, ..)) -&gt; return body
<a name="line-1928"></a>
<a name="line-1929"></a>In any other context than 'MonadComp', the fields for most of these
<a name="line-1930"></a>'SyntaxExpr's stay bottom.
<a name="line-1931"></a>-}</span>
<a name="line-1932"></a>
<a name="line-1933"></a><a name="instance%20Outputable%20(ParStmtBlock%20idL%20idR)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>idL</span><span class='hs-layout'>)</span>
<a name="line-1934"></a>       <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParStmtBlock</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1935"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParStmtBlock</span> <span class='hs-varid'>stmts</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>interpp'SP</span> <span class='hs-varid'>stmts</span>
<a name="line-1936"></a>
<a name="line-1937"></a><a name="instance%20Outputable%20(StmtLR%20idL%20idR%20body)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span>
<a name="line-1938"></a>          <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1939"></a>         <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-1940"></a>    <span class='hs-varid'>ppr</span> <span class='hs-varid'>stmt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprStmt</span> <span class='hs-varid'>stmt</span>
<a name="line-1941"></a>
<a name="line-1942"></a><a name="pprStmt"></a><span class='hs-definition'>pprStmt</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span>
<a name="line-1943"></a>                                  <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span>
<a name="line-1944"></a>                                  <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-1945"></a>        <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-1946"></a><span class='hs-definition'>pprStmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>LastStmt</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>ret_stripped</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
<a name="line-1947"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>whenPprDebug</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"[last]"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span>
<a name="line-1948"></a>       <span class='hs-layout'>(</span><span class='hs-keyword'>if</span> <span class='hs-varid'>ret_stripped</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>text</span> <span class='hs-str'>"return"</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>empty</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span>
<a name="line-1949"></a>       <span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span>
<a name="line-1950"></a><span class='hs-definition'>pprStmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>BindStmt</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>expr</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>pat</span><span class='hs-layout'>,</span> <span class='hs-varid'>larrow</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span><span class='hs-keyglyph'>]</span>
<a name="line-1951"></a><span class='hs-definition'>pprStmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>LetStmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>binds</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hsep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"let"</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprBinds</span> <span class='hs-varid'>binds</span><span class='hs-keyglyph'>]</span>
<a name="line-1952"></a><span class='hs-definition'>pprStmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>BodyStmt</span> <span class='hs-varid'>expr</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>expr</span>
<a name="line-1953"></a><span class='hs-definition'>pprStmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParStmt</span> <span class='hs-varid'>stmtss</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>punctuate</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>" | "</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>stmtss</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1954"></a>
<a name="line-1955"></a><span class='hs-definition'>pprStmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>TransStmt</span> <span class='hs-layout'>{</span> <span class='hs-varid'>trS_stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>stmts</span><span class='hs-layout'>,</span> <span class='hs-varid'>trS_by</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>by</span><span class='hs-layout'>,</span> <span class='hs-varid'>trS_using</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>using</span><span class='hs-layout'>,</span> <span class='hs-varid'>trS_form</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>form</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-1956"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-varop'>$</span> <span class='hs-varid'>punctuate</span> <span class='hs-varid'>comma</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>stmts</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprTransStmt</span> <span class='hs-varid'>by</span> <span class='hs-varid'>using</span> <span class='hs-varid'>form</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-1957"></a>
<a name="line-1958"></a><span class='hs-definition'>pprStmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>RecStmt</span> <span class='hs-layout'>{</span> <span class='hs-varid'>recS_stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>segment</span><span class='hs-layout'>,</span> <span class='hs-varid'>recS_rec_ids</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>rec_ids</span>
<a name="line-1959"></a>                 <span class='hs-layout'>,</span> <span class='hs-varid'>recS_later_ids</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>later_ids</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-1960"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"rec"</span> <span class='hs-varop'>&lt;+&gt;</span>
<a name="line-1961"></a>    <span class='hs-varid'>vcat</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>ppr_do_stmts</span> <span class='hs-varid'>segment</span>
<a name="line-1962"></a>         <span class='hs-layout'>,</span> <span class='hs-varid'>whenPprDebug</span> <span class='hs-layout'>(</span><span class='hs-varid'>vcat</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>text</span> <span class='hs-str'>"rec_ids="</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>rec_ids</span>
<a name="line-1963"></a>                            <span class='hs-layout'>,</span> <span class='hs-varid'>text</span> <span class='hs-str'>"later_ids="</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>later_ids</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-1964"></a>
<a name="line-1965"></a><span class='hs-definition'>pprStmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>ApplicativeStmt</span> <span class='hs-varid'>args</span> <span class='hs-varid'>mb_join</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
<a name="line-1966"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getPprStyle</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>style</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-1967"></a>      <span class='hs-keyword'>if</span> <span class='hs-varid'>userStyle</span> <span class='hs-varid'>style</span>
<a name="line-1968"></a>         <span class='hs-keyword'>then</span> <span class='hs-varid'>pp_for_user</span>
<a name="line-1969"></a>         <span class='hs-keyword'>else</span> <span class='hs-varid'>pp_debug</span>
<a name="line-1970"></a>  <span class='hs-keyword'>where</span>
<a name="line-1971"></a>  <span class='hs-comment'>-- make all the Applicative stuff invisible in error messages by</span>
<a name="line-1972"></a>  <span class='hs-comment'>-- flattening the whole ApplicativeStmt nest back to a sequence</span>
<a name="line-1973"></a>  <span class='hs-comment'>-- of statements.</span>
<a name="line-1974"></a>   <span class='hs-varid'>pp_for_user</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>vcat</span> <span class='hs-varop'>$</span> <span class='hs-varid'>concatMap</span> <span class='hs-varid'>flattenArg</span> <span class='hs-varid'>args</span>
<a name="line-1975"></a>
<a name="line-1976"></a>   <span class='hs-comment'>-- ppr directly rather than transforming here, because we need to</span>
<a name="line-1977"></a>   <span class='hs-comment'>-- inject a "return" which is hard when we're polymorphic in the id</span>
<a name="line-1978"></a>   <span class='hs-comment'>-- type.</span>
<a name="line-1979"></a>   <span class='hs-varid'>flattenStmt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ExprLStmt</span> <span class='hs-varid'>idL</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SDoc</span><span class='hs-keyglyph'>]</span>
<a name="line-1980"></a>   <span class='hs-varid'>flattenStmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>ApplicativeStmt</span> <span class='hs-varid'>args</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>concatMap</span> <span class='hs-varid'>flattenArg</span> <span class='hs-varid'>args</span>
<a name="line-1981"></a>   <span class='hs-varid'>flattenStmt</span> <span class='hs-varid'>stmt</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>stmt</span><span class='hs-keyglyph'>]</span>
<a name="line-1982"></a>
<a name="line-1983"></a>   <span class='hs-varid'>flattenArg</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>ApplicativeArgOne</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-1984"></a>     <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>BindStmt</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>noSyntaxExpr</span> <span class='hs-varid'>noSyntaxExpr</span> <span class='hs-layout'>(</span><span class='hs-varid'>panic</span> <span class='hs-str'>"pprStmt"</span><span class='hs-layout'>)</span>
<a name="line-1985"></a>             <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ExprStmt</span> <span class='hs-varid'>idL</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-1986"></a>   <span class='hs-varid'>flattenArg</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>ApplicativeArgMany</span> <span class='hs-varid'>stmts</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-1987"></a>     <span class='hs-varid'>concatMap</span> <span class='hs-varid'>flattenStmt</span> <span class='hs-varid'>stmts</span>
<a name="line-1988"></a>
<a name="line-1989"></a>   <span class='hs-varid'>pp_debug</span> <span class='hs-keyglyph'>=</span>
<a name="line-1990"></a>     <span class='hs-keyword'>let</span>
<a name="line-1991"></a>         <span class='hs-varid'>ap_expr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>punctuate</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>" |"</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>pp_arg</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-1992"></a>     <span class='hs-keyword'>in</span>
<a name="line-1993"></a>       <span class='hs-keyword'>if</span> <span class='hs-varid'>isNothing</span> <span class='hs-varid'>mb_join</span>
<a name="line-1994"></a>          <span class='hs-keyword'>then</span> <span class='hs-varid'>ap_expr</span>
<a name="line-1995"></a>          <span class='hs-keyword'>else</span> <span class='hs-varid'>text</span> <span class='hs-str'>"join"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>parens</span> <span class='hs-varid'>ap_expr</span>
<a name="line-1996"></a>
<a name="line-1997"></a>   <span class='hs-varid'>pp_arg</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>ApplicativeArgOne</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>expr</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-1998"></a>     <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>BindStmt</span> <span class='hs-varid'>pat</span> <span class='hs-varid'>expr</span> <span class='hs-varid'>noSyntaxExpr</span> <span class='hs-varid'>noSyntaxExpr</span> <span class='hs-layout'>(</span><span class='hs-varid'>panic</span> <span class='hs-str'>"pprStmt"</span><span class='hs-layout'>)</span>
<a name="line-1999"></a>            <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ExprStmt</span> <span class='hs-varid'>idL</span><span class='hs-layout'>)</span>
<a name="line-2000"></a>   <span class='hs-varid'>pp_arg</span> <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>ApplicativeArgMany</span> <span class='hs-varid'>stmts</span> <span class='hs-varid'>return</span> <span class='hs-varid'>pat</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-2001"></a>     <span class='hs-varid'>ppr</span> <span class='hs-varid'>pat</span> <span class='hs-varop'>&lt;+&gt;</span>
<a name="line-2002"></a>     <span class='hs-varid'>text</span> <span class='hs-str'>"&lt;-"</span> <span class='hs-varop'>&lt;+&gt;</span>
<a name="line-2003"></a>     <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsDo</span> <span class='hs-conid'>DoExpr</span> <span class='hs-layout'>(</span><span class='hs-varid'>noLoc</span>
<a name="line-2004"></a>                <span class='hs-layout'>(</span><span class='hs-varid'>stmts</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>noLoc</span> <span class='hs-layout'>(</span><span class='hs-conid'>LastStmt</span> <span class='hs-layout'>(</span><span class='hs-varid'>noLoc</span> <span class='hs-varid'>return</span><span class='hs-layout'>)</span> <span class='hs-conid'>False</span> <span class='hs-varid'>noSyntaxExpr</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-2005"></a>           <span class='hs-layout'>(</span><span class='hs-varid'>error</span> <span class='hs-str'>"pprStmt"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-2006"></a>
<a name="line-2007"></a><a name="pprTransformStmt"></a><span class='hs-definition'>pprTransformStmt</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-2008"></a>                 <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2009"></a><span class='hs-definition'>pprTransformStmt</span> <span class='hs-varid'>bndrs</span> <span class='hs-varid'>using</span> <span class='hs-varid'>by</span>
<a name="line-2010"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>text</span> <span class='hs-str'>"then"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>whenPprDebug</span> <span class='hs-layout'>(</span><span class='hs-varid'>braces</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>bndrs</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-2011"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>using</span><span class='hs-layout'>)</span>
<a name="line-2012"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprBy</span> <span class='hs-varid'>by</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-2013"></a>
<a name="line-2014"></a><a name="pprTransStmt"></a><span class='hs-definition'>pprTransStmt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TransForm</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2015"></a><span class='hs-definition'>pprTransStmt</span> <span class='hs-varid'>by</span> <span class='hs-varid'>using</span> <span class='hs-conid'>ThenForm</span>
<a name="line-2016"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>text</span> <span class='hs-str'>"then"</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>using</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprBy</span> <span class='hs-varid'>by</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-2017"></a><span class='hs-definition'>pprTransStmt</span> <span class='hs-varid'>by</span> <span class='hs-varid'>using</span> <span class='hs-conid'>GroupForm</span>
<a name="line-2018"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>text</span> <span class='hs-str'>"then group"</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprBy</span> <span class='hs-varid'>by</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"using"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>using</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-2019"></a>
<a name="line-2020"></a><a name="pprBy"></a><span class='hs-definition'>pprBy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2021"></a><span class='hs-definition'>pprBy</span> <span class='hs-conid'>Nothing</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<a name="line-2022"></a><span class='hs-definition'>pprBy</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"by"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span>
<a name="line-2023"></a>
<a name="line-2024"></a><a name="pprDo"></a><span class='hs-definition'>pprDo</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-2025"></a>      <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsStmtContext</span> <span class='hs-varid'>any</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LStmt</span> <span class='hs-varid'>p</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2026"></a><span class='hs-definition'>pprDo</span> <span class='hs-conid'>DoExpr</span>        <span class='hs-varid'>stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"do"</span>  <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr_do_stmts</span> <span class='hs-varid'>stmts</span>
<a name="line-2027"></a><span class='hs-definition'>pprDo</span> <span class='hs-conid'>GhciStmtCtxt</span>  <span class='hs-varid'>stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"do"</span>  <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr_do_stmts</span> <span class='hs-varid'>stmts</span>
<a name="line-2028"></a><span class='hs-definition'>pprDo</span> <span class='hs-conid'>ArrowExpr</span>     <span class='hs-varid'>stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"do"</span>  <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr_do_stmts</span> <span class='hs-varid'>stmts</span>
<a name="line-2029"></a><span class='hs-definition'>pprDo</span> <span class='hs-conid'>MDoExpr</span>       <span class='hs-varid'>stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"mdo"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr_do_stmts</span> <span class='hs-varid'>stmts</span>
<a name="line-2030"></a><span class='hs-definition'>pprDo</span> <span class='hs-conid'>ListComp</span>      <span class='hs-varid'>stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>brackets</span>    <span class='hs-varop'>$</span> <span class='hs-varid'>pprComp</span> <span class='hs-varid'>stmts</span>
<a name="line-2031"></a><span class='hs-definition'>pprDo</span> <span class='hs-conid'>PArrComp</span>      <span class='hs-varid'>stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>paBrackets</span>  <span class='hs-varop'>$</span> <span class='hs-varid'>pprComp</span> <span class='hs-varid'>stmts</span>
<a name="line-2032"></a><span class='hs-definition'>pprDo</span> <span class='hs-conid'>MonadComp</span>     <span class='hs-varid'>stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>brackets</span>    <span class='hs-varop'>$</span> <span class='hs-varid'>pprComp</span> <span class='hs-varid'>stmts</span>
<a name="line-2033"></a><span class='hs-definition'>pprDo</span> <span class='hs-keyword'>_</span>             <span class='hs-keyword'>_</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"pprDo"</span> <span class='hs-comment'>-- PatGuard, ParStmtCxt</span>
<a name="line-2034"></a>
<a name="line-2035"></a><a name="ppr_do_stmts"></a><span class='hs-definition'>ppr_do_stmts</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span>
<a name="line-2036"></a>                 <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-2037"></a>             <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LStmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2038"></a><span class='hs-comment'>-- Print a bunch of do stmts</span>
<a name="line-2039"></a><span class='hs-definition'>ppr_do_stmts</span> <span class='hs-varid'>stmts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprDeeperList</span> <span class='hs-varid'>vcat</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>stmts</span><span class='hs-layout'>)</span>
<a name="line-2040"></a>
<a name="line-2041"></a><a name="pprComp"></a><span class='hs-definition'>pprComp</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-2042"></a>        <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LStmt</span> <span class='hs-varid'>p</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2043"></a><span class='hs-definition'>pprComp</span> <span class='hs-varid'>quals</span>     <span class='hs-comment'>-- Prints:  body | qual1, ..., qualn</span>
<a name="line-2044"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>initStmts</span><span class='hs-layout'>,</span> <span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>LastStmt</span> <span class='hs-varid'>body</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>snocView</span> <span class='hs-varid'>quals</span>
<a name="line-2045"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>null</span> <span class='hs-varid'>initStmts</span>
<a name="line-2046"></a>       <span class='hs-comment'>-- If there are no statements in a list comprehension besides the last</span>
<a name="line-2047"></a>       <span class='hs-comment'>-- one, we simply treat it like a normal list. This does arise</span>
<a name="line-2048"></a>       <span class='hs-comment'>-- occasionally in code that GHC generates, e.g., in implementations of</span>
<a name="line-2049"></a>       <span class='hs-comment'>-- 'range' for derived 'Ix' instances for product datatypes with exactly</span>
<a name="line-2050"></a>       <span class='hs-comment'>-- one constructor (e.g., see Trac #12583).</span>
<a name="line-2051"></a>       <span class='hs-keyword'>then</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>body</span>
<a name="line-2052"></a>       <span class='hs-keyword'>else</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>body</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>vbar</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprQuals</span> <span class='hs-varid'>initStmts</span><span class='hs-layout'>)</span>
<a name="line-2053"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-2054"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPanic</span> <span class='hs-str'>"pprComp"</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprQuals</span> <span class='hs-varid'>quals</span><span class='hs-layout'>)</span>
<a name="line-2055"></a>
<a name="line-2056"></a><a name="pprQuals"></a><span class='hs-definition'>pprQuals</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-2057"></a>         <span class='hs-keyglyph'>=&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LStmt</span> <span class='hs-varid'>p</span> <span class='hs-varid'>body</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2058"></a><span class='hs-comment'>-- Show list comprehension qualifiers separated by commas</span>
<a name="line-2059"></a><span class='hs-definition'>pprQuals</span> <span class='hs-varid'>quals</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>interpp'SP</span> <span class='hs-varid'>quals</span>
<a name="line-2060"></a>
<a name="line-2061"></a><span class='hs-comment'>{-
<a name="line-2062"></a>************************************************************************
<a name="line-2063"></a>*                                                                      *
<a name="line-2064"></a>                Template Haskell quotation brackets
<a name="line-2065"></a>*                                                                      *
<a name="line-2066"></a>************************************************************************
<a name="line-2067"></a>-}</span>
<a name="line-2068"></a>
<a name="line-2069"></a><a name="HsSplice"></a><span class='hs-comment'>-- | Haskell Splice</span>
<a name="line-2070"></a><a name="HsSplice"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsSplice</span> <span class='hs-varid'>id</span>
<a name="line-2071"></a>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsTypedSplice</span>       <span class='hs-comment'>--  $$z  or $$(f 4)</span>
<a name="line-2072"></a>        <span class='hs-conid'>SpliceDecoration</span> <span class='hs-comment'>-- Whether $$( ) variant found, for pretty printing</span>
<a name="line-2073"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>         <span class='hs-comment'>-- A unique name to identify this splice point</span>
<a name="line-2074"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- See Note [Pending Splices]</span>
<a name="line-2075"></a>
<a name="line-2076"></a>   <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsUntypedSplice</span>     <span class='hs-comment'>--  $z  or $(f 4)</span>
<a name="line-2077"></a>        <span class='hs-conid'>SpliceDecoration</span> <span class='hs-comment'>-- Whether $( ) variant found, for pretty printing</span>
<a name="line-2078"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>         <span class='hs-comment'>-- A unique name to identify this splice point</span>
<a name="line-2079"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- See Note [Pending Splices]</span>
<a name="line-2080"></a>
<a name="line-2081"></a>   <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsQuasiQuote</span>        <span class='hs-comment'>-- See Note [Quasi-quote overview] in TcSplice</span>
<a name="line-2082"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>         <span class='hs-comment'>-- Splice point</span>
<a name="line-2083"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>         <span class='hs-comment'>-- Quoter</span>
<a name="line-2084"></a>        <span class='hs-conid'>SrcSpan</span>          <span class='hs-comment'>-- The span of the enclosed string</span>
<a name="line-2085"></a>        <span class='hs-conid'>FastString</span>       <span class='hs-comment'>-- The enclosed string</span>
<a name="line-2086"></a>
<a name="line-2087"></a>   <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsSpliced</span>  <span class='hs-comment'>-- See Note [Delaying modFinalizers in untyped splices] in</span>
<a name="line-2088"></a>                <span class='hs-comment'>-- RnSplice.</span>
<a name="line-2089"></a>                <span class='hs-comment'>-- This is the result of splicing a splice. It is produced by</span>
<a name="line-2090"></a>                <span class='hs-comment'>-- the renamer and consumed by the typechecker. It lives only</span>
<a name="line-2091"></a>                <span class='hs-comment'>-- between the two.</span>
<a name="line-2092"></a>        <span class='hs-conid'>ThModFinalizers</span>     <span class='hs-comment'>-- TH finalizers produced by the splice.</span>
<a name="line-2093"></a>        <span class='hs-layout'>(</span><span class='hs-conid'>HsSplicedThing</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- The result of splicing</span>
<a name="line-2094"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Typeable</span>
<a name="line-2095"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataId</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsSplice</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-2096"></a>
<a name="line-2097"></a><a name="SpliceDecoration"></a><span class='hs-comment'>-- | A splice can appear with various decorations wrapped around it. This data</span>
<a name="line-2098"></a><a name="SpliceDecoration"></a><span class='hs-comment'>-- type captures explicitly how it was originally written, for use in the pretty</span>
<a name="line-2099"></a><a name="SpliceDecoration"></a><span class='hs-comment'>-- printer.</span>
<a name="line-2100"></a><a name="SpliceDecoration"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>SpliceDecoration</span>
<a name="line-2101"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HasParens</span> <span class='hs-comment'>-- ^ $( splice ) or $$( splice )</span>
<a name="line-2102"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HasDollar</span> <span class='hs-comment'>-- ^ $splice or $$splice</span>
<a name="line-2103"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>NoParens</span>  <span class='hs-comment'>-- ^ bare splice</span>
<a name="line-2104"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span><span class='hs-layout'>)</span>
<a name="line-2105"></a>
<a name="line-2106"></a><a name="instance%20Outputable%20SpliceDecoration"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>SpliceDecoration</span> <span class='hs-keyword'>where</span>
<a name="line-2107"></a>  <span class='hs-varid'>ppr</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-varop'>$</span> <span class='hs-varid'>show</span> <span class='hs-varid'>x</span>
<a name="line-2108"></a>
<a name="line-2109"></a>
<a name="line-2110"></a><a name="isTypedSplice"></a><span class='hs-definition'>isTypedSplice</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsSplice</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-2111"></a><span class='hs-definition'>isTypedSplice</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTypedSplice</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-2112"></a><span class='hs-definition'>isTypedSplice</span> <span class='hs-keyword'>_</span>                  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>   <span class='hs-comment'>-- Quasi-quotes are untyped splices</span>
<a name="line-2113"></a>
<a name="line-2114"></a><a name="ThModFinalizers"></a><span class='hs-comment'>-- | Finalizers produced by a splice with</span>
<a name="line-2115"></a><a name="ThModFinalizers"></a><span class='hs-comment'>-- 'Language.Haskell.TH.Syntax.addModFinalizer'</span>
<a name="line-2116"></a><a name="ThModFinalizers"></a><span class='hs-comment'>--</span>
<a name="line-2117"></a><a name="ThModFinalizers"></a><span class='hs-comment'>-- See Note [Delaying modFinalizers in untyped splices] in RnSplice. For how</span>
<a name="line-2118"></a><a name="ThModFinalizers"></a><span class='hs-comment'>-- this is used.</span>
<a name="line-2119"></a><a name="ThModFinalizers"></a><span class='hs-comment'>--</span>
<a name="line-2120"></a><a name="ThModFinalizers"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>ThModFinalizers</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ThModFinalizers</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ForeignRef</span> <span class='hs-layout'>(</span><span class='hs-conid'>TH</span><span class='hs-varop'>.</span><span class='hs-conid'>Q</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-2121"></a>
<a name="line-2122"></a><a name="instance%20Data%20ThModFinalizers"></a><span class='hs-comment'>-- A Data instance which ignores the argument of 'ThModFinalizers'.</span>
<a name="line-2123"></a><a name="instance%20Data%20ThModFinalizers"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Data</span> <span class='hs-conid'>ThModFinalizers</span> <span class='hs-keyword'>where</span>
<a name="line-2124"></a>  <span class='hs-varid'>gunfold</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>z</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>z</span> <span class='hs-varop'>$</span> <span class='hs-conid'>ThModFinalizers</span> <span class='hs-conid'>[]</span>
<a name="line-2125"></a>  <span class='hs-varid'>toConstr</span>  <span class='hs-varid'>a</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkConstr</span> <span class='hs-layout'>(</span><span class='hs-varid'>dataTypeOf</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-str'>"ThModFinalizers"</span> <span class='hs-conid'>[]</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Prefix</span>
<a name="line-2126"></a>  <span class='hs-varid'>dataTypeOf</span> <span class='hs-varid'>a</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkDataType</span> <span class='hs-str'>"HsExpr.ThModFinalizers"</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>toConstr</span> <span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span>
<a name="line-2127"></a>
<a name="line-2128"></a><a name="HsSplicedThing"></a><span class='hs-comment'>-- | Haskell Spliced Thing</span>
<a name="line-2129"></a><a name="HsSplicedThing"></a><span class='hs-comment'>--</span>
<a name="line-2130"></a><a name="HsSplicedThing"></a><span class='hs-comment'>-- Values that can result from running a splice.</span>
<a name="line-2131"></a><a name="HsSplicedThing"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsSplicedThing</span> <span class='hs-varid'>id</span>
<a name="line-2132"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>HsSplicedExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Haskell Spliced Expression</span>
<a name="line-2133"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsSplicedTy</span>   <span class='hs-layout'>(</span><span class='hs-conid'>HsType</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Haskell Spliced Type</span>
<a name="line-2134"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-conid'>HsSplicedPat</span>  <span class='hs-layout'>(</span><span class='hs-conid'>Pat</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- ^ Haskell Spliced Pattern</span>
<a name="line-2135"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Typeable</span>
<a name="line-2136"></a>
<a name="line-2137"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataId</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsSplicedThing</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-2138"></a>
<a name="line-2139"></a><a name="SplicePointName"></a><span class='hs-comment'>-- See Note [Pending Splices]</span>
<a name="line-2140"></a><a name="SplicePointName"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>SplicePointName</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Name</span>
<a name="line-2141"></a>
<a name="line-2142"></a><a name="PendingRnSplice"></a><span class='hs-comment'>-- | Pending Renamer Splice</span>
<a name="line-2143"></a><a name="PendingRnSplice"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>PendingRnSplice</span>
<a name="line-2144"></a>  <span class='hs-comment'>-- AZ:TODO: The hard-coded GhcRn feels wrong. How to force the PostRn?</span>
<a name="line-2145"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PendingRnSplice</span> <span class='hs-conid'>UntypedSpliceFlavour</span> <span class='hs-conid'>SplicePointName</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-conid'>GhcRn</span><span class='hs-layout'>)</span>
<a name="line-2146"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Data</span>
<a name="line-2147"></a>
<a name="line-2148"></a><a name="UntypedSpliceFlavour"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>UntypedSpliceFlavour</span>
<a name="line-2149"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>UntypedExpSplice</span>
<a name="line-2150"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>UntypedPatSplice</span>
<a name="line-2151"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>UntypedTypeSplice</span>
<a name="line-2152"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>UntypedDeclSplice</span>
<a name="line-2153"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Data</span>
<a name="line-2154"></a>
<a name="line-2155"></a><a name="PendingTcSplice"></a><span class='hs-comment'>-- | Pending Type-checker Splice</span>
<a name="line-2156"></a><a name="PendingTcSplice"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>PendingTcSplice</span>
<a name="line-2157"></a>  <span class='hs-comment'>-- AZ:TODO: The hard-coded GhcTc feels wrong. How to force the PostTc?</span>
<a name="line-2158"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PendingTcSplice</span> <span class='hs-conid'>SplicePointName</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-conid'>GhcTc</span><span class='hs-layout'>)</span>
<a name="line-2159"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Data</span>
<a name="line-2160"></a>
<a name="line-2161"></a>
<a name="line-2162"></a><span class='hs-comment'>{-
<a name="line-2163"></a>Note [Pending Splices]
<a name="line-2164"></a>~~~~~~~~~~~~~~~~~~~~~~
<a name="line-2165"></a>When we rename an untyped bracket, we name and lift out all the nested
<a name="line-2166"></a>splices, so that when the typechecker hits the bracket, it can
<a name="line-2167"></a>typecheck those nested splices without having to walk over the untyped
<a name="line-2168"></a>bracket code.  So for example
<a name="line-2169"></a>    [| f $(g x) |]
<a name="line-2170"></a>looks like
<a name="line-2171"></a>
<a name="line-2172"></a>    HsBracket (HsApp (HsVar "f") (HsSpliceE _ (g x)))
<a name="line-2173"></a>
<a name="line-2174"></a>which the renamer rewrites to
<a name="line-2175"></a>
<a name="line-2176"></a>    HsRnBracketOut (HsApp (HsVar f) (HsSpliceE sn (g x)))
<a name="line-2177"></a>                   [PendingRnSplice UntypedExpSplice sn (g x)]
<a name="line-2178"></a>
<a name="line-2179"></a>* The 'sn' is the Name of the splice point, the SplicePointName
<a name="line-2180"></a>
<a name="line-2181"></a>* The PendingRnExpSplice gives the splice that splice-point name maps to;
<a name="line-2182"></a>  and the typechecker can now conveniently find these sub-expressions
<a name="line-2183"></a>
<a name="line-2184"></a>* The other copy of the splice, in the second argument of HsSpliceE
<a name="line-2185"></a>                                in the renamed first arg of HsRnBracketOut
<a name="line-2186"></a>  is used only for pretty printing
<a name="line-2187"></a>
<a name="line-2188"></a>There are four varieties of pending splices generated by the renamer,
<a name="line-2189"></a>distinguished by their UntypedSpliceFlavour
<a name="line-2190"></a>
<a name="line-2191"></a> * Pending expression splices (UntypedExpSplice), e.g.,
<a name="line-2192"></a>       [|$(f x) + 2|]
<a name="line-2193"></a>
<a name="line-2194"></a>   UntypedExpSplice is also used for
<a name="line-2195"></a>     * quasi-quotes, where the pending expression expands to
<a name="line-2196"></a>          $(quoter "...blah...")
<a name="line-2197"></a>       (see RnSplice.makePending, HsQuasiQuote case)
<a name="line-2198"></a>
<a name="line-2199"></a>     * cross-stage lifting, where the pending expression expands to
<a name="line-2200"></a>          $(lift x)
<a name="line-2201"></a>       (see RnSplice.checkCrossStageLifting)
<a name="line-2202"></a>
<a name="line-2203"></a> * Pending pattern splices (UntypedPatSplice), e.g.,
<a name="line-2204"></a>       [| \$(f x) -&gt; x |]
<a name="line-2205"></a>
<a name="line-2206"></a> * Pending type splices (UntypedTypeSplice), e.g.,
<a name="line-2207"></a>       [| f :: $(g x) |]
<a name="line-2208"></a>
<a name="line-2209"></a> * Pending declaration (UntypedDeclSplice), e.g.,
<a name="line-2210"></a>       [| let $(f x) in ... |]
<a name="line-2211"></a>
<a name="line-2212"></a>There is a fifth variety of pending splice, which is generated by the type
<a name="line-2213"></a>checker:
<a name="line-2214"></a>
<a name="line-2215"></a>  * Pending *typed* expression splices, (PendingTcSplice), e.g.,
<a name="line-2216"></a>        [||1 + $$(f 2)||]
<a name="line-2217"></a>
<a name="line-2218"></a>It would be possible to eliminate HsRnBracketOut and use HsBracketOut for the
<a name="line-2219"></a>output of the renamer. However, when pretty printing the output of the renamer,
<a name="line-2220"></a>e.g., in a type error message, we *do not* want to print out the pending
<a name="line-2221"></a>splices. In contrast, when pretty printing the output of the type checker, we
<a name="line-2222"></a>*do* want to print the pending splices. So splitting them up seems to make
<a name="line-2223"></a>sense, although I hate to add another constructor to HsExpr.
<a name="line-2224"></a>-}</span>
<a name="line-2225"></a>
<a name="line-2226"></a><a name="instance%20Outputable%20(HsSplicedThing%20p)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-2227"></a>       <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsSplicedThing</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-2228"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsSplicedExpr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_expr</span> <span class='hs-varid'>e</span>
<a name="line-2229"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsSplicedTy</span>   <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>t</span>
<a name="line-2230"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsSplicedPat</span>  <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>p</span>
<a name="line-2231"></a>
<a name="line-2232"></a><a name="instance%20Outputable%20(HsSplice%20p)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsSplice</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-2233"></a>  <span class='hs-varid'>ppr</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprSplice</span> <span class='hs-varid'>s</span>
<a name="line-2234"></a>
<a name="line-2235"></a><a name="pprPendingSplice"></a><span class='hs-definition'>pprPendingSplice</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-2236"></a>                 <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>SplicePointName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2237"></a><span class='hs-definition'>pprPendingSplice</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>angleBrackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>comma</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-2238"></a>
<a name="line-2239"></a><a name="pprSpliceDecl"></a><span class='hs-definition'>pprSpliceDecl</span> <span class='hs-keyglyph'>::</span>  <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-2240"></a>          <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsSplice</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SpliceExplicitFlag</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2241"></a><span class='hs-definition'>pprSpliceDecl</span> <span class='hs-varid'>e</span><span class='hs-keyglyph'>@</span><span class='hs-conid'>HsQuasiQuote</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprSplice</span> <span class='hs-varid'>e</span>
<a name="line-2242"></a><span class='hs-definition'>pprSpliceDecl</span> <span class='hs-varid'>e</span> <span class='hs-conid'>ExplicitSplice</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"$("</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr_splice_decl</span> <span class='hs-varid'>e</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>")"</span>
<a name="line-2243"></a><span class='hs-definition'>pprSpliceDecl</span> <span class='hs-varid'>e</span> <span class='hs-conid'>ImplicitSplice</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_splice_decl</span> <span class='hs-varid'>e</span>
<a name="line-2244"></a>
<a name="line-2245"></a><a name="ppr_splice_decl"></a><span class='hs-definition'>ppr_splice_decl</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsSplice</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2246"></a><span class='hs-definition'>ppr_splice_decl</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsUntypedSplice</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_splice</span> <span class='hs-varid'>empty</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span> <span class='hs-varid'>empty</span>
<a name="line-2247"></a><span class='hs-definition'>ppr_splice_decl</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprSplice</span> <span class='hs-varid'>e</span>
<a name="line-2248"></a>
<a name="line-2249"></a><a name="pprSplice"></a><span class='hs-definition'>pprSplice</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsSplice</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2250"></a><span class='hs-definition'>pprSplice</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTypedSplice</span> <span class='hs-conid'>HasParens</span>  <span class='hs-varid'>n</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-2251"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_splice</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"$$("</span><span class='hs-layout'>)</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>")"</span><span class='hs-layout'>)</span>
<a name="line-2252"></a><span class='hs-definition'>pprSplice</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTypedSplice</span> <span class='hs-conid'>HasDollar</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-2253"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_splice</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"$$"</span><span class='hs-layout'>)</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span> <span class='hs-varid'>empty</span>
<a name="line-2254"></a><span class='hs-definition'>pprSplice</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsTypedSplice</span> <span class='hs-conid'>NoParens</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-2255"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_splice</span> <span class='hs-varid'>empty</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span> <span class='hs-varid'>empty</span>
<a name="line-2256"></a><span class='hs-definition'>pprSplice</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsUntypedSplice</span> <span class='hs-conid'>HasParens</span>  <span class='hs-varid'>n</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-2257"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_splice</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"$("</span><span class='hs-layout'>)</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>")"</span><span class='hs-layout'>)</span>
<a name="line-2258"></a><span class='hs-definition'>pprSplice</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsUntypedSplice</span> <span class='hs-conid'>HasDollar</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-2259"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_splice</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"$"</span><span class='hs-layout'>)</span>  <span class='hs-varid'>n</span> <span class='hs-varid'>e</span> <span class='hs-varid'>empty</span>
<a name="line-2260"></a><span class='hs-definition'>pprSplice</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsUntypedSplice</span> <span class='hs-conid'>NoParens</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-2261"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_splice</span> <span class='hs-varid'>empty</span>  <span class='hs-varid'>n</span> <span class='hs-varid'>e</span> <span class='hs-varid'>empty</span>
<a name="line-2262"></a><span class='hs-definition'>pprSplice</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsQuasiQuote</span> <span class='hs-varid'>n</span> <span class='hs-varid'>q</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_quasi</span> <span class='hs-varid'>n</span> <span class='hs-varid'>q</span> <span class='hs-varid'>s</span>
<a name="line-2263"></a><span class='hs-definition'>pprSplice</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsSpliced</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>thing</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>thing</span>
<a name="line-2264"></a>
<a name="line-2265"></a><a name="ppr_quasi"></a><span class='hs-definition'>ppr_quasi</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FastString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2266"></a><span class='hs-definition'>ppr_quasi</span> <span class='hs-varid'>n</span> <span class='hs-varid'>quoter</span> <span class='hs-varid'>quote</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>whenPprDebug</span> <span class='hs-layout'>(</span><span class='hs-varid'>brackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span>
<a name="line-2267"></a>                           <span class='hs-varid'>char</span> <span class='hs-chr'>'['</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>quoter</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>vbar</span> <span class='hs-varop'>&lt;&gt;</span>
<a name="line-2268"></a>                           <span class='hs-varid'>ppr</span> <span class='hs-varid'>quote</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"|]"</span>
<a name="line-2269"></a>
<a name="line-2270"></a><a name="ppr_splice"></a><span class='hs-definition'>ppr_splice</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-2271"></a>           <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>SDoc</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2272"></a><span class='hs-definition'>ppr_splice</span> <span class='hs-varid'>herald</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span> <span class='hs-varid'>trail</span>
<a name="line-2273"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>herald</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>whenPprDebug</span> <span class='hs-layout'>(</span><span class='hs-varid'>brackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>trail</span>
<a name="line-2274"></a>
<a name="line-2275"></a><a name="HsBracket"></a><span class='hs-comment'>-- | Haskell Bracket</span>
<a name="line-2276"></a><a name="HsBracket"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsBracket</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ExpBr</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>    <span class='hs-comment'>-- [|  expr  |]</span>
<a name="line-2277"></a>                  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PatBr</span> <span class='hs-layout'>(</span><span class='hs-conid'>LPat</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>      <span class='hs-comment'>-- [p| pat   |]</span>
<a name="line-2278"></a>                  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DecBrL</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>LHsDecl</span> <span class='hs-varid'>p</span><span class='hs-keyglyph'>]</span>  <span class='hs-comment'>-- [d| decls |]; result of parser</span>
<a name="line-2279"></a>                  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DecBrG</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsGroup</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- [d| decls |]; result of renamer</span>
<a name="line-2280"></a>                  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TypBr</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsType</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- [t| type  |]</span>
<a name="line-2281"></a>                  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>VarBr</span> <span class='hs-conid'>Bool</span> <span class='hs-layout'>(</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- True: 'x, False: ''T</span>
<a name="line-2282"></a>                                 <span class='hs-comment'>-- (The Bool flag is used only in pprHsBracket)</span>
<a name="line-2283"></a>                  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TExpBr</span> <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- [||  expr  ||]</span>
<a name="line-2284"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsBracket</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-2285"></a>
<a name="line-2286"></a><a name="isTypedBracket"></a><span class='hs-definition'>isTypedBracket</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsBracket</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-2287"></a><span class='hs-definition'>isTypedBracket</span> <span class='hs-layout'>(</span><span class='hs-conid'>TExpBr</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-2288"></a><span class='hs-definition'>isTypedBracket</span> <span class='hs-keyword'>_</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-2289"></a>
<a name="line-2290"></a><a name="instance%20Outputable%20(HsBracket%20p)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsBracket</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-2291"></a>  <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprHsBracket</span>
<a name="line-2292"></a>
<a name="line-2293"></a>
<a name="line-2294"></a><a name="pprHsBracket"></a><span class='hs-definition'>pprHsBracket</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsBracket</span> <span class='hs-varid'>p</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2295"></a><span class='hs-definition'>pprHsBracket</span> <span class='hs-layout'>(</span><span class='hs-conid'>ExpBr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>thBrackets</span> <span class='hs-varid'>empty</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-2296"></a><span class='hs-definition'>pprHsBracket</span> <span class='hs-layout'>(</span><span class='hs-conid'>PatBr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>thBrackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'p'</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-2297"></a><span class='hs-definition'>pprHsBracket</span> <span class='hs-layout'>(</span><span class='hs-conid'>DecBrG</span> <span class='hs-varid'>gp</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>thBrackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'d'</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>gp</span><span class='hs-layout'>)</span>
<a name="line-2298"></a><span class='hs-definition'>pprHsBracket</span> <span class='hs-layout'>(</span><span class='hs-conid'>DecBrL</span> <span class='hs-varid'>ds</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>thBrackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'d'</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>vcat</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>ds</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-2299"></a><span class='hs-definition'>pprHsBracket</span> <span class='hs-layout'>(</span><span class='hs-conid'>TypBr</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>thBrackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>char</span> <span class='hs-chr'>'t'</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span>
<a name="line-2300"></a><span class='hs-definition'>pprHsBracket</span> <span class='hs-layout'>(</span><span class='hs-conid'>VarBr</span> <span class='hs-conid'>True</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-2301"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'\''</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>pprPrefixOcc</span> <span class='hs-varid'>n</span>
<a name="line-2302"></a><span class='hs-definition'>pprHsBracket</span> <span class='hs-layout'>(</span><span class='hs-conid'>VarBr</span> <span class='hs-conid'>False</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span>
<a name="line-2303"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"''"</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>pprPrefixOcc</span> <span class='hs-varid'>n</span>
<a name="line-2304"></a><span class='hs-definition'>pprHsBracket</span> <span class='hs-layout'>(</span><span class='hs-conid'>TExpBr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>thTyBrackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-2305"></a>
<a name="line-2306"></a><a name="thBrackets"></a><span class='hs-definition'>thBrackets</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SDoc</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2307"></a><span class='hs-definition'>thBrackets</span> <span class='hs-varid'>pp_kind</span> <span class='hs-varid'>pp_body</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>char</span> <span class='hs-chr'>'['</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>pp_kind</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>vbar</span> <span class='hs-varop'>&lt;+&gt;</span>
<a name="line-2308"></a>                             <span class='hs-varid'>pp_body</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>text</span> <span class='hs-str'>"|]"</span>
<a name="line-2309"></a>
<a name="line-2310"></a><a name="thTyBrackets"></a><span class='hs-definition'>thTyBrackets</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SDoc</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2311"></a><span class='hs-definition'>thTyBrackets</span> <span class='hs-varid'>pp_body</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"[||"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pp_body</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"||]"</span><span class='hs-layout'>)</span>
<a name="line-2312"></a>
<a name="line-2313"></a><a name="instance%20Outputable%20PendingRnSplice"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>PendingRnSplice</span> <span class='hs-keyword'>where</span>
<a name="line-2314"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>PendingRnSplice</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPendingSplice</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span>
<a name="line-2315"></a>
<a name="line-2316"></a><a name="instance%20Outputable%20PendingTcSplice"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>PendingTcSplice</span> <span class='hs-keyword'>where</span>
<a name="line-2317"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>PendingTcSplice</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPendingSplice</span> <span class='hs-varid'>n</span> <span class='hs-varid'>e</span>
<a name="line-2318"></a>
<a name="line-2319"></a><span class='hs-comment'>{-
<a name="line-2320"></a>************************************************************************
<a name="line-2321"></a>*                                                                      *
<a name="line-2322"></a>\subsection{Enumerations and list comprehensions}
<a name="line-2323"></a>*                                                                      *
<a name="line-2324"></a>************************************************************************
<a name="line-2325"></a>-}</span>
<a name="line-2326"></a>
<a name="line-2327"></a><a name="ArithSeqInfo"></a><span class='hs-comment'>-- | Arithmetic Sequence Information</span>
<a name="line-2328"></a><a name="ArithSeqInfo"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ArithSeqInfo</span> <span class='hs-varid'>id</span>
<a name="line-2329"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>From</span>            <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-2330"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>FromThen</span>        <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-2331"></a>                    <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-2332"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>FromTo</span>          <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-2333"></a>                    <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-2334"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>FromThenTo</span>      <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-2335"></a>                    <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-2336"></a>                    <span class='hs-layout'>(</span><span class='hs-conid'>LHsExpr</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-2337"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>DataId</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>ArithSeqInfo</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-2338"></a>
<a name="line-2339"></a><a name="instance%20Outputable%20(ArithSeqInfo%20p)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span>
<a name="line-2340"></a>         <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>ArithSeqInfo</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-2341"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>From</span> <span class='hs-varid'>e1</span><span class='hs-layout'>)</span>             <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e1</span><span class='hs-layout'>,</span> <span class='hs-varid'>pp_dotdot</span><span class='hs-keyglyph'>]</span>
<a name="line-2342"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>FromThen</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e1</span><span class='hs-layout'>,</span> <span class='hs-varid'>comma</span><span class='hs-layout'>,</span> <span class='hs-varid'>space</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e2</span><span class='hs-layout'>,</span> <span class='hs-varid'>pp_dotdot</span><span class='hs-keyglyph'>]</span>
<a name="line-2343"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>FromTo</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e3</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e1</span><span class='hs-layout'>,</span> <span class='hs-varid'>pp_dotdot</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e3</span><span class='hs-keyglyph'>]</span>
<a name="line-2344"></a>    <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>FromThenTo</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span> <span class='hs-varid'>e3</span><span class='hs-layout'>)</span>
<a name="line-2345"></a>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e1</span><span class='hs-layout'>,</span> <span class='hs-varid'>comma</span><span class='hs-layout'>,</span> <span class='hs-varid'>space</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e2</span><span class='hs-layout'>,</span> <span class='hs-varid'>pp_dotdot</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>e3</span><span class='hs-keyglyph'>]</span>
<a name="line-2346"></a>
<a name="line-2347"></a><a name="pp_dotdot"></a><span class='hs-definition'>pp_dotdot</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SDoc</span>
<a name="line-2348"></a><span class='hs-definition'>pp_dotdot</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>" .. "</span>
<a name="line-2349"></a>
<a name="line-2350"></a><span class='hs-comment'>{-
<a name="line-2351"></a>************************************************************************
<a name="line-2352"></a>*                                                                      *
<a name="line-2353"></a>\subsection{HsMatchCtxt}
<a name="line-2354"></a>*                                                                      *
<a name="line-2355"></a>************************************************************************
<a name="line-2356"></a>-}</span>
<a name="line-2357"></a>
<a name="line-2358"></a><a name="HsMatchContext"></a><span class='hs-comment'>-- | Haskell Match Context</span>
<a name="line-2359"></a><a name="HsMatchContext"></a><span class='hs-comment'>--</span>
<a name="line-2360"></a><a name="HsMatchContext"></a><span class='hs-comment'>-- Context of a pattern match. This is more subtle than it would seem. See Note</span>
<a name="line-2361"></a><a name="HsMatchContext"></a><span class='hs-comment'>-- [Varieties of pattern matches].</span>
<a name="line-2362"></a><a name="HsMatchContext"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span> <span class='hs-comment'>-- Not an extensible tag</span>
<a name="line-2363"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FunRhs</span> <span class='hs-layout'>{</span> <span class='hs-varid'>mc_fun</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Located</span> <span class='hs-varid'>id</span>    <span class='hs-comment'>-- ^ function binder of @f@</span>
<a name="line-2364"></a>           <span class='hs-layout'>,</span> <span class='hs-varid'>mc_fixity</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LexicalFixity</span> <span class='hs-comment'>-- ^ fixing of @f@</span>
<a name="line-2365"></a>           <span class='hs-layout'>,</span> <span class='hs-varid'>mc_strictness</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>SrcStrictness</span> <span class='hs-comment'>-- ^ was @f@ banged?</span>
<a name="line-2366"></a>                                            <span class='hs-comment'>-- See Note [FunBind vs PatBind]</span>
<a name="line-2367"></a>           <span class='hs-layout'>}</span>
<a name="line-2368"></a>                                <span class='hs-comment'>-- ^A pattern matching on an argument of a</span>
<a name="line-2369"></a>                                <span class='hs-comment'>-- function binding</span>
<a name="line-2370"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>LambdaExpr</span>                  <span class='hs-comment'>-- ^Patterns of a lambda</span>
<a name="line-2371"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CaseAlt</span>                     <span class='hs-comment'>-- ^Patterns and guards on a case alternative</span>
<a name="line-2372"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>IfAlt</span>                       <span class='hs-comment'>-- ^Guards of a multi-way if alternative</span>
<a name="line-2373"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ProcExpr</span>                    <span class='hs-comment'>-- ^Patterns of a proc</span>
<a name="line-2374"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PatBindRhs</span>                  <span class='hs-comment'>-- ^A pattern binding  eg [y] &lt;- e = e</span>
<a name="line-2375"></a>
<a name="line-2376"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>RecUpd</span>                      <span class='hs-comment'>-- ^Record update [used only in DsExpr to</span>
<a name="line-2377"></a>                                <span class='hs-comment'>--    tell matchWrapper what sort of</span>
<a name="line-2378"></a>                                <span class='hs-comment'>--    runtime error message to generate]</span>
<a name="line-2379"></a>
<a name="line-2380"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>StmtCtxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsStmtContext</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^Pattern of a do-stmt, list comprehension,</span>
<a name="line-2381"></a>                                <span class='hs-comment'>-- pattern guard, etc</span>
<a name="line-2382"></a>
<a name="line-2383"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ThPatSplice</span>            <span class='hs-comment'>-- ^A Template Haskell pattern splice</span>
<a name="line-2384"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ThPatQuote</span>             <span class='hs-comment'>-- ^A Template Haskell pattern quotation [p| (a,b) |]</span>
<a name="line-2385"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PatSyn</span>                 <span class='hs-comment'>-- ^A pattern synonym declaration</span>
<a name="line-2386"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Functor</span>
<a name="line-2387"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-2388"></a>
<a name="line-2389"></a><a name="instance%20Outputable%20(HsMatchContext%20id)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-2390"></a>  <span class='hs-varid'>ppr</span> <span class='hs-varid'>m</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>FunRhs</span><span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"FunRhs"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-varid'>mc_fun</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-varid'>mc_fixity</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span>
<a name="line-2391"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>LambdaExpr</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"LambdaExpr"</span>
<a name="line-2392"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>CaseAlt</span>               <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"CaseAlt"</span>
<a name="line-2393"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>IfAlt</span>                 <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"IfAlt"</span>
<a name="line-2394"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>ProcExpr</span>              <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"ProcExpr"</span>
<a name="line-2395"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>PatBindRhs</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"PatBindRhs"</span>
<a name="line-2396"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>RecUpd</span>                <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"RecUpd"</span>
<a name="line-2397"></a>  <span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"StmtCtxt _"</span>
<a name="line-2398"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>ThPatSplice</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"ThPatSplice"</span>
<a name="line-2399"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>ThPatQuote</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"ThPatQuote"</span>
<a name="line-2400"></a>  <span class='hs-varid'>ppr</span> <span class='hs-conid'>PatSyn</span>                <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"PatSyn"</span>
<a name="line-2401"></a>
<a name="line-2402"></a><a name="isPatSynCtxt"></a><span class='hs-definition'>isPatSynCtxt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-2403"></a><span class='hs-definition'>isPatSynCtxt</span> <span class='hs-varid'>ctxt</span> <span class='hs-keyglyph'>=</span>
<a name="line-2404"></a>  <span class='hs-keyword'>case</span> <span class='hs-varid'>ctxt</span> <span class='hs-keyword'>of</span>
<a name="line-2405"></a>    <span class='hs-conid'>PatSyn</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>True</span>
<a name="line-2406"></a>    <span class='hs-keyword'>_</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>False</span>
<a name="line-2407"></a>
<a name="line-2408"></a><a name="HsStmtContext"></a><span class='hs-comment'>-- | Haskell Statement Context. It expects to be parameterised with one of</span>
<a name="line-2409"></a><a name="HsStmtContext"></a><span class='hs-comment'>-- 'RdrName', 'Name' or 'Id'</span>
<a name="line-2410"></a><a name="HsStmtContext"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>HsStmtContext</span> <span class='hs-varid'>id</span>
<a name="line-2411"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ListComp</span>
<a name="line-2412"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>MonadComp</span>
<a name="line-2413"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PArrComp</span>                         <span class='hs-comment'>-- ^Parallel array comprehension</span>
<a name="line-2414"></a>
<a name="line-2415"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>DoExpr</span>                           <span class='hs-comment'>-- ^do { ... }</span>
<a name="line-2416"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>MDoExpr</span>                          <span class='hs-comment'>-- ^mdo { ... }  ie recursive do-expression</span>
<a name="line-2417"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ArrowExpr</span>                        <span class='hs-comment'>-- ^do-notation in an arrow-command context</span>
<a name="line-2418"></a>
<a name="line-2419"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>GhciStmtCtxt</span>                     <span class='hs-comment'>-- ^A command-line Stmt in GHCi pat &lt;- rhs</span>
<a name="line-2420"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>PatGuard</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- ^Pattern guard for specified thing</span>
<a name="line-2421"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ParStmtCtxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsStmtContext</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- ^A branch of a parallel stmt</span>
<a name="line-2422"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TransStmtCtxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsStmtContext</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^A branch of a transform stmt</span>
<a name="line-2423"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Functor</span>
<a name="line-2424"></a><span class='hs-keyword'>deriving</span> <span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Data</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsStmtContext</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-2425"></a>
<a name="line-2426"></a><a name="isListCompExpr"></a><span class='hs-definition'>isListCompExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsStmtContext</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-2427"></a><span class='hs-comment'>-- Uses syntax [ e | quals ]</span>
<a name="line-2428"></a><span class='hs-definition'>isListCompExpr</span> <span class='hs-conid'>ListComp</span>          <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-2429"></a><span class='hs-definition'>isListCompExpr</span> <span class='hs-conid'>PArrComp</span>          <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-2430"></a><span class='hs-definition'>isListCompExpr</span> <span class='hs-conid'>MonadComp</span>         <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-2431"></a><span class='hs-definition'>isListCompExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParStmtCtxt</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isListCompExpr</span> <span class='hs-varid'>c</span>
<a name="line-2432"></a><span class='hs-definition'>isListCompExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>TransStmtCtxt</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isListCompExpr</span> <span class='hs-varid'>c</span>
<a name="line-2433"></a><span class='hs-definition'>isListCompExpr</span> <span class='hs-keyword'>_</span>                 <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-2434"></a>
<a name="line-2435"></a><a name="isMonadCompExpr"></a><span class='hs-definition'>isMonadCompExpr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsStmtContext</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-2436"></a><span class='hs-definition'>isMonadCompExpr</span> <span class='hs-conid'>MonadComp</span>            <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-2437"></a><span class='hs-definition'>isMonadCompExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParStmtCtxt</span> <span class='hs-varid'>ctxt</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isMonadCompExpr</span> <span class='hs-varid'>ctxt</span>
<a name="line-2438"></a><span class='hs-definition'>isMonadCompExpr</span> <span class='hs-layout'>(</span><span class='hs-conid'>TransStmtCtxt</span> <span class='hs-varid'>ctxt</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isMonadCompExpr</span> <span class='hs-varid'>ctxt</span>
<a name="line-2439"></a><span class='hs-definition'>isMonadCompExpr</span> <span class='hs-keyword'>_</span>                    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-2440"></a>
<a name="line-2441"></a><a name="isMonadFailStmtContext"></a><span class='hs-comment'>-- | Should pattern match failure in a 'HsStmtContext' be desugared using</span>
<a name="line-2442"></a><span class='hs-comment'>-- 'MonadFail'?</span>
<a name="line-2443"></a><span class='hs-definition'>isMonadFailStmtContext</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsStmtContext</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-2444"></a><span class='hs-definition'>isMonadFailStmtContext</span> <span class='hs-conid'>MonadComp</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-2445"></a><span class='hs-definition'>isMonadFailStmtContext</span> <span class='hs-conid'>DoExpr</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-2446"></a><span class='hs-definition'>isMonadFailStmtContext</span> <span class='hs-conid'>MDoExpr</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-2447"></a><span class='hs-definition'>isMonadFailStmtContext</span> <span class='hs-conid'>GhciStmtCtxt</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-2448"></a><span class='hs-definition'>isMonadFailStmtContext</span> <span class='hs-keyword'>_</span>            <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-2449"></a>
<a name="line-2450"></a><a name="matchSeparator"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2451"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-layout'>(</span><span class='hs-conid'>FunRhs</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"="</span>
<a name="line-2452"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-conid'>CaseAlt</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"-&gt;"</span>
<a name="line-2453"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-conid'>IfAlt</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"-&gt;"</span>
<a name="line-2454"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-conid'>LambdaExpr</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"-&gt;"</span>
<a name="line-2455"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-conid'>ProcExpr</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"-&gt;"</span>
<a name="line-2456"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-conid'>PatBindRhs</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"="</span>
<a name="line-2457"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"&lt;-"</span>
<a name="line-2458"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-conid'>RecUpd</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"="</span> <span class='hs-comment'>-- This can be printed by the pattern</span>
<a name="line-2459"></a>                                       <span class='hs-comment'>-- match checker trace</span>
<a name="line-2460"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-conid'>ThPatSplice</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"unused"</span>
<a name="line-2461"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-conid'>ThPatQuote</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"unused"</span>
<a name="line-2462"></a><span class='hs-definition'>matchSeparator</span> <span class='hs-conid'>PatSyn</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"unused"</span>
<a name="line-2463"></a>
<a name="line-2464"></a><a name="pprMatchContext"></a><span class='hs-definition'>pprMatchContext</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>NameOrRdrName</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span><span class='hs-conid'>Outputable</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-2465"></a>                <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2466"></a><span class='hs-definition'>pprMatchContext</span> <span class='hs-varid'>ctxt</span>
<a name="line-2467"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>want_an</span> <span class='hs-varid'>ctxt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"an"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprMatchContextNoun</span> <span class='hs-varid'>ctxt</span>
<a name="line-2468"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"a"</span>  <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprMatchContextNoun</span> <span class='hs-varid'>ctxt</span>
<a name="line-2469"></a>  <span class='hs-keyword'>where</span>
<a name="line-2470"></a>    <span class='hs-varid'>want_an</span> <span class='hs-layout'>(</span><span class='hs-conid'>FunRhs</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>  <span class='hs-comment'>-- Use "an" in front</span>
<a name="line-2471"></a>    <span class='hs-varid'>want_an</span> <span class='hs-conid'>ProcExpr</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>True</span>
<a name="line-2472"></a>    <span class='hs-varid'>want_an</span> <span class='hs-keyword'>_</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
<a name="line-2473"></a>
<a name="line-2474"></a><a name="pprMatchContextNoun"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>NameOrRdrName</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span><span class='hs-conid'>Outputable</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>
<a name="line-2475"></a>                    <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2476"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-layout'>(</span><span class='hs-conid'>FunRhs</span> <span class='hs-layout'>{</span><span class='hs-varid'>mc_fun</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>fun</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-2477"></a>                                    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"equation for"</span>
<a name="line-2478"></a>                                      <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>quotes</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>fun</span><span class='hs-layout'>)</span>
<a name="line-2479"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-conid'>CaseAlt</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"case alternative"</span>
<a name="line-2480"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-conid'>IfAlt</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"multi-way if alternative"</span>
<a name="line-2481"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-conid'>RecUpd</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"record-update construct"</span>
<a name="line-2482"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-conid'>ThPatSplice</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"Template Haskell pattern splice"</span>
<a name="line-2483"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-conid'>ThPatQuote</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"Template Haskell pattern quotation"</span>
<a name="line-2484"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-conid'>PatBindRhs</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"pattern binding"</span>
<a name="line-2485"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-conid'>LambdaExpr</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"lambda abstraction"</span>
<a name="line-2486"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-conid'>ProcExpr</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"arrow abstraction"</span>
<a name="line-2487"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-varid'>ctxt</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"pattern binding in"</span>
<a name="line-2488"></a>                                      <span class='hs-varop'>$$</span> <span class='hs-varid'>pprStmtContext</span> <span class='hs-varid'>ctxt</span>
<a name="line-2489"></a><span class='hs-definition'>pprMatchContextNoun</span> <span class='hs-conid'>PatSyn</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"pattern synonym declaration"</span>
<a name="line-2490"></a>
<a name="line-2491"></a><a name="pprAStmtContext"></a><span class='hs-comment'>-----------------</span>
<a name="line-2492"></a><span class='hs-definition'>pprAStmtContext</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprStmtContext</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Outputable</span> <span class='hs-varid'>id</span><span class='hs-layout'>,</span>
<a name="line-2493"></a>                                    <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>NameOrRdrName</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-2494"></a>                                <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsStmtContext</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2495"></a><span class='hs-definition'>pprAStmtContext</span> <span class='hs-varid'>ctxt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>article</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprStmtContext</span> <span class='hs-varid'>ctxt</span>
<a name="line-2496"></a>  <span class='hs-keyword'>where</span>
<a name="line-2497"></a>    <span class='hs-varid'>pp_an</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"an"</span>
<a name="line-2498"></a>    <span class='hs-varid'>pp_a</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"a"</span>
<a name="line-2499"></a>    <span class='hs-varid'>article</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>ctxt</span> <span class='hs-keyword'>of</span>
<a name="line-2500"></a>                  <span class='hs-conid'>MDoExpr</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_an</span>
<a name="line-2501"></a>                  <span class='hs-conid'>PArrComp</span>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_an</span>
<a name="line-2502"></a>                  <span class='hs-conid'>GhciStmtCtxt</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_an</span>
<a name="line-2503"></a>                  <span class='hs-keyword'>_</span>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pp_a</span>
<a name="line-2504"></a>
<a name="line-2505"></a>
<a name="line-2506"></a><a name="pprStmtContext"></a><span class='hs-comment'>-----------------</span>
<a name="line-2507"></a><span class='hs-definition'>pprStmtContext</span> <span class='hs-conid'>GhciStmtCtxt</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"interactive GHCi command"</span>
<a name="line-2508"></a><span class='hs-definition'>pprStmtContext</span> <span class='hs-conid'>DoExpr</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"'do' block"</span>
<a name="line-2509"></a><span class='hs-definition'>pprStmtContext</span> <span class='hs-conid'>MDoExpr</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"'mdo' block"</span>
<a name="line-2510"></a><span class='hs-definition'>pprStmtContext</span> <span class='hs-conid'>ArrowExpr</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"'do' block in an arrow command"</span>
<a name="line-2511"></a><span class='hs-definition'>pprStmtContext</span> <span class='hs-conid'>ListComp</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"list comprehension"</span>
<a name="line-2512"></a><span class='hs-definition'>pprStmtContext</span> <span class='hs-conid'>MonadComp</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"monad comprehension"</span>
<a name="line-2513"></a><span class='hs-definition'>pprStmtContext</span> <span class='hs-conid'>PArrComp</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"array comprehension"</span>
<a name="line-2514"></a><span class='hs-definition'>pprStmtContext</span> <span class='hs-layout'>(</span><span class='hs-conid'>PatGuard</span> <span class='hs-varid'>ctxt</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"pattern guard for"</span> <span class='hs-varop'>$$</span> <span class='hs-varid'>pprMatchContext</span> <span class='hs-varid'>ctxt</span>
<a name="line-2515"></a>
<a name="line-2516"></a><span class='hs-comment'>-- Drop the inner contexts when reporting errors, else we get</span>
<a name="line-2517"></a><span class='hs-comment'>--     Unexpected transform statement</span>
<a name="line-2518"></a><span class='hs-comment'>--     in a transformed branch of</span>
<a name="line-2519"></a><span class='hs-comment'>--          transformed branch of</span>
<a name="line-2520"></a><span class='hs-comment'>--          transformed branch of monad comprehension</span>
<a name="line-2521"></a><span class='hs-definition'>pprStmtContext</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParStmtCtxt</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-2522"></a>  <span class='hs-varid'>ifPprDebug</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"parallel branch of"</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprAStmtContext</span> <span class='hs-varid'>c</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-2523"></a>             <span class='hs-layout'>(</span><span class='hs-varid'>pprStmtContext</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-2524"></a><span class='hs-definition'>pprStmtContext</span> <span class='hs-layout'>(</span><span class='hs-conid'>TransStmtCtxt</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-2525"></a>  <span class='hs-varid'>ifPprDebug</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>text</span> <span class='hs-str'>"transformed branch of"</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprAStmtContext</span> <span class='hs-varid'>c</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-2526"></a>             <span class='hs-layout'>(</span><span class='hs-varid'>pprStmtContext</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-2527"></a>
<a name="line-2528"></a><a name="instance%20Outputable%20(HsStmtContext%20p)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Outputable</span> <span class='hs-varid'>p</span><span class='hs-layout'>,</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>NameOrRdrName</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-2529"></a>      <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>HsStmtContext</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-2530"></a>    <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprStmtContext</span>
<a name="line-2531"></a>
<a name="line-2532"></a><a name="matchContextErrString"></a><span class='hs-comment'>-- Used to generate the string for a *runtime* error message</span>
<a name="line-2533"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>id</span>
<a name="line-2534"></a>                      <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsMatchContext</span> <span class='hs-varid'>id</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2535"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>FunRhs</span><span class='hs-layout'>{</span><span class='hs-varid'>mc_fun</span><span class='hs-keyglyph'>=</span><span class='hs-conid'>L</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>fun</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"function"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>fun</span>
<a name="line-2536"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-conid'>CaseAlt</span>                    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"case"</span>
<a name="line-2537"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-conid'>IfAlt</span>                      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"multi-way if"</span>
<a name="line-2538"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-conid'>PatBindRhs</span>                 <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"pattern binding"</span>
<a name="line-2539"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-conid'>RecUpd</span>                     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"record update"</span>
<a name="line-2540"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-conid'>LambdaExpr</span>                 <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"lambda"</span>
<a name="line-2541"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-conid'>ProcExpr</span>                   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"proc"</span>
<a name="line-2542"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-conid'>ThPatSplice</span>                <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"matchContextErrString"</span>  <span class='hs-comment'>-- Not used at runtime</span>
<a name="line-2543"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-conid'>ThPatQuote</span>                 <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"matchContextErrString"</span>  <span class='hs-comment'>-- Not used at runtime</span>
<a name="line-2544"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-conid'>PatSyn</span>                     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>panic</span> <span class='hs-str'>"matchContextErrString"</span>  <span class='hs-comment'>-- Not used at runtime</span>
<a name="line-2545"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>ParStmtCtxt</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-2546"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>TransStmtCtxt</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-2547"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>PatGuard</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"pattern guard"</span>
<a name="line-2548"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-conid'>GhciStmtCtxt</span><span class='hs-layout'>)</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"interactive GHCi command"</span>
<a name="line-2549"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-conid'>DoExpr</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"'do' block"</span>
<a name="line-2550"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-conid'>ArrowExpr</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"'do' block"</span>
<a name="line-2551"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-conid'>MDoExpr</span><span class='hs-layout'>)</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"'mdo' block"</span>
<a name="line-2552"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-conid'>ListComp</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"list comprehension"</span>
<a name="line-2553"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-conid'>MonadComp</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"monad comprehension"</span>
<a name="line-2554"></a><span class='hs-definition'>matchContextErrString</span> <span class='hs-layout'>(</span><span class='hs-conid'>StmtCtxt</span> <span class='hs-conid'>PArrComp</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>text</span> <span class='hs-str'>"array comprehension"</span>
<a name="line-2555"></a>
<a name="line-2556"></a><a name="pprMatchInCtxt"></a><span class='hs-definition'>pprMatchInCtxt</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span>
<a name="line-2557"></a>                   <span class='hs-comment'>-- TODO:AZ these constraints do not make sense</span>
<a name="line-2558"></a>                   <span class='hs-conid'>Outputable</span> <span class='hs-layout'>(</span><span class='hs-conid'>NameOrRdrName</span> <span class='hs-layout'>(</span><span class='hs-conid'>NameOrRdrName</span> <span class='hs-layout'>(</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>idR</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-2559"></a>                   <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-2560"></a>               <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Match</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2561"></a><span class='hs-definition'>pprMatchInCtxt</span> <span class='hs-varid'>match</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"In"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprMatchContext</span> <span class='hs-layout'>(</span><span class='hs-varid'>m_ctxt</span> <span class='hs-varid'>match</span><span class='hs-layout'>)</span>
<a name="line-2562"></a>                                        <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>colon</span><span class='hs-layout'>)</span>
<a name="line-2563"></a>                             <span class='hs-num'>4</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprMatch</span> <span class='hs-varid'>match</span><span class='hs-layout'>)</span>
<a name="line-2564"></a>
<a name="line-2565"></a><a name="pprStmtInCtxt"></a><span class='hs-definition'>pprStmtInCtxt</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>SourceTextX</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span>
<a name="line-2566"></a>                  <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>idL</span><span class='hs-layout'>,</span> <span class='hs-conid'>OutputableBndrId</span> <span class='hs-varid'>idR</span><span class='hs-layout'>,</span>
<a name="line-2567"></a>                  <span class='hs-conid'>Outputable</span> <span class='hs-varid'>body</span><span class='hs-layout'>)</span>
<a name="line-2568"></a>               <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>HsStmtContext</span> <span class='hs-layout'>(</span><span class='hs-conid'>IdP</span> <span class='hs-varid'>idL</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StmtLR</span> <span class='hs-varid'>idL</span> <span class='hs-varid'>idR</span> <span class='hs-varid'>body</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2569"></a><span class='hs-definition'>pprStmtInCtxt</span> <span class='hs-varid'>ctxt</span> <span class='hs-layout'>(</span><span class='hs-conid'>LastStmt</span> <span class='hs-varid'>e</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>
<a name="line-2570"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isListCompExpr</span> <span class='hs-varid'>ctxt</span>      <span class='hs-comment'>-- For [ e | .. ], do not mutter about "stmts"</span>
<a name="line-2571"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"In the expression:"</span><span class='hs-layout'>)</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>
<a name="line-2572"></a>
<a name="line-2573"></a><span class='hs-definition'>pprStmtInCtxt</span> <span class='hs-varid'>ctxt</span> <span class='hs-varid'>stmt</span>
<a name="line-2574"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hang</span> <span class='hs-layout'>(</span><span class='hs-varid'>text</span> <span class='hs-str'>"In a stmt of"</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprAStmtContext</span> <span class='hs-varid'>ctxt</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>colon</span><span class='hs-layout'>)</span>
<a name="line-2575"></a>       <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_stmt</span> <span class='hs-varid'>stmt</span><span class='hs-layout'>)</span>
<a name="line-2576"></a>  <span class='hs-keyword'>where</span>
<a name="line-2577"></a>    <span class='hs-comment'>-- For Group and Transform Stmts, don't print the nested stmts!</span>
<a name="line-2578"></a>    <span class='hs-varid'>ppr_stmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>TransStmt</span> <span class='hs-layout'>{</span> <span class='hs-varid'>trS_by</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>by</span><span class='hs-layout'>,</span> <span class='hs-varid'>trS_using</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>using</span>
<a name="line-2579"></a>                        <span class='hs-layout'>,</span> <span class='hs-varid'>trS_form</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>form</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprTransStmt</span> <span class='hs-varid'>by</span> <span class='hs-varid'>using</span> <span class='hs-varid'>form</span>
<a name="line-2580"></a>    <span class='hs-varid'>ppr_stmt</span> <span class='hs-varid'>stmt</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprStmt</span> <span class='hs-varid'>stmt</span>
</pre></body>
</html>
