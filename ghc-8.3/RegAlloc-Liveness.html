<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>RegAlloc.Liveness</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/RegAlloc-Liveness.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ghc-8.3: The GHC API</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">RegAlloc.Liveness</p></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">type</span> <a href="#t:RegSet">RegSet</a> = <a href="UniqSet.html#t:UniqSet">UniqSet</a> <a href="Reg.html#t:Reg">Reg</a></li><li class="src short"><span class="keyword">type</span> <a href="#t:RegMap">RegMap</a> a = <a href="UniqFM.html#t:UniqFM">UniqFM</a> a</li><li class="src short"><a href="#v:emptyRegMap">emptyRegMap</a> :: <a href="UniqFM.html#t:UniqFM">UniqFM</a> a</li><li class="src short"><span class="keyword">type</span> <a href="#t:BlockMap">BlockMap</a> a = <a href="Hoopl-Label.html#t:LabelMap">LabelMap</a> a</li><li class="src short"><a href="#v:mapEmpty">mapEmpty</a> :: <a href="Hoopl-Collections.html#t:IsMap">IsMap</a> map =&gt; map a</li><li class="src short"><span class="keyword">type</span> <a href="#t:LiveCmmDecl">LiveCmmDecl</a> statics instr = <a href="Cmm.html#t:GenCmmDecl">GenCmmDecl</a> statics <a href="RegAlloc-Liveness.html#t:LiveInfo">LiveInfo</a> [<a href="Digraph.html#t:SCC">SCC</a> (<a href="RegAlloc-Liveness.html#t:LiveBasicBlock">LiveBasicBlock</a> instr)]</li><li class="src short"><span class="keyword">data</span> <a href="#t:InstrSR">InstrSR</a> instr<ul class="subs"><li>= <a href="#v:Instr">Instr</a> instr</li><li>| <a href="#v:SPILL">SPILL</a> <a href="Reg.html#t:Reg">Reg</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></li><li>| <a href="#v:RELOAD">RELOAD</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> <a href="Reg.html#t:Reg">Reg</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:LiveInstr">LiveInstr</a> instr = <a href="#v:LiveInstr">LiveInstr</a> (<a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr) (<a href="../base-4.10.0.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="RegAlloc-Liveness.html#t:Liveness">Liveness</a>)</li><li class="src short"><span class="keyword">data</span> <a href="#t:Liveness">Liveness</a> = <a href="#v:Liveness">Liveness</a> {<ul class="subs"><li><a href="#v:liveBorn">liveBorn</a> :: <a href="RegAlloc-Liveness.html#t:RegSet">RegSet</a></li><li><a href="#v:liveDieRead">liveDieRead</a> :: <a href="RegAlloc-Liveness.html#t:RegSet">RegSet</a></li><li><a href="#v:liveDieWrite">liveDieWrite</a> :: <a href="RegAlloc-Liveness.html#t:RegSet">RegSet</a></li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:LiveInfo">LiveInfo</a> = <a href="#v:LiveInfo">LiveInfo</a> (<a href="Hoopl-Label.html#t:LabelMap">LabelMap</a> <a href="Cmm.html#t:CmmStatics">CmmStatics</a>) [<a href="BlockId.html#t:BlockId">BlockId</a>] (<a href="../base-4.10.0.0/Data-Maybe.html#t:Maybe">Maybe</a> (<a href="RegAlloc-Liveness.html#t:BlockMap">BlockMap</a> <a href="RegAlloc-Liveness.html#t:RegSet">RegSet</a>)) (<a href="RegAlloc-Liveness.html#t:BlockMap">BlockMap</a> <a href="../containers-0.5.10.2/Data-IntSet-Internal.html#t:IntSet">IntSet</a>)</li><li class="src short"><span class="keyword">type</span> <a href="#t:LiveBasicBlock">LiveBasicBlock</a> instr = <a href="Cmm.html#t:GenBasicBlock">GenBasicBlock</a> (<a href="RegAlloc-Liveness.html#t:LiveInstr">LiveInstr</a> instr)</li><li class="src short"><a href="#v:mapBlockTop">mapBlockTop</a> :: (<a href="RegAlloc-Liveness.html#t:LiveBasicBlock">LiveBasicBlock</a> instr -&gt; <a href="RegAlloc-Liveness.html#t:LiveBasicBlock">LiveBasicBlock</a> instr) -&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr -&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr</li><li class="src short"><a href="#v:mapBlockTopM">mapBlockTopM</a> :: <a href="../base-4.10.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; (<a href="RegAlloc-Liveness.html#t:LiveBasicBlock">LiveBasicBlock</a> instr -&gt; m (<a href="RegAlloc-Liveness.html#t:LiveBasicBlock">LiveBasicBlock</a> instr)) -&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr -&gt; m (<a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr)</li><li class="src short"><a href="#v:mapSCCM">mapSCCM</a> :: <a href="../base-4.10.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; (a -&gt; m b) -&gt; <a href="Digraph.html#t:SCC">SCC</a> a -&gt; m (<a href="Digraph.html#t:SCC">SCC</a> b)</li><li class="src short"><a href="#v:mapGenBlockTop">mapGenBlockTop</a> :: (<a href="Cmm.html#t:GenBasicBlock">GenBasicBlock</a> i -&gt; <a href="Cmm.html#t:GenBasicBlock">GenBasicBlock</a> i) -&gt; <a href="Cmm.html#t:GenCmmDecl">GenCmmDecl</a> d h (<a href="Cmm.html#t:ListGraph">ListGraph</a> i) -&gt; <a href="Cmm.html#t:GenCmmDecl">GenCmmDecl</a> d h (<a href="Cmm.html#t:ListGraph">ListGraph</a> i)</li><li class="src short"><a href="#v:mapGenBlockTopM">mapGenBlockTopM</a> :: <a href="../base-4.10.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; (<a href="Cmm.html#t:GenBasicBlock">GenBasicBlock</a> i -&gt; m (<a href="Cmm.html#t:GenBasicBlock">GenBasicBlock</a> i)) -&gt; <a href="Cmm.html#t:GenCmmDecl">GenCmmDecl</a> d h (<a href="Cmm.html#t:ListGraph">ListGraph</a> i) -&gt; m (<a href="Cmm.html#t:GenCmmDecl">GenCmmDecl</a> d h (<a href="Cmm.html#t:ListGraph">ListGraph</a> i))</li><li class="src short"><a href="#v:stripLive">stripLive</a> :: (<a href="Outputable.html#t:Outputable">Outputable</a> statics, <a href="Outputable.html#t:Outputable">Outputable</a> instr, <a href="Instruction.html#t:Instruction">Instruction</a> instr) =&gt; <a href="DynFlags.html#t:DynFlags">DynFlags</a> -&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr -&gt; <a href="Instruction.html#t:NatCmmDecl">NatCmmDecl</a> statics instr</li><li class="src short"><a href="#v:stripLiveBlock">stripLiveBlock</a> :: <a href="Instruction.html#t:Instruction">Instruction</a> instr =&gt; <a href="DynFlags.html#t:DynFlags">DynFlags</a> -&gt; <a href="RegAlloc-Liveness.html#t:LiveBasicBlock">LiveBasicBlock</a> instr -&gt; <a href="Instruction.html#t:NatBasicBlock">NatBasicBlock</a> instr</li><li class="src short"><a href="#v:slurpConflicts">slurpConflicts</a> :: <a href="Instruction.html#t:Instruction">Instruction</a> instr =&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr -&gt; (<a href="Bag.html#t:Bag">Bag</a> (<a href="UniqSet.html#t:UniqSet">UniqSet</a> <a href="Reg.html#t:Reg">Reg</a>), <a href="Bag.html#t:Bag">Bag</a> (<a href="Reg.html#t:Reg">Reg</a>, <a href="Reg.html#t:Reg">Reg</a>))</li><li class="src short"><a href="#v:slurpReloadCoalesce">slurpReloadCoalesce</a> :: <span class="keyword">forall</span> statics instr. <a href="Instruction.html#t:Instruction">Instruction</a> instr =&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr -&gt; <a href="Bag.html#t:Bag">Bag</a> (<a href="Reg.html#t:Reg">Reg</a>, <a href="Reg.html#t:Reg">Reg</a>)</li><li class="src short"><a href="#v:eraseDeltasLive">eraseDeltasLive</a> :: <a href="Instruction.html#t:Instruction">Instruction</a> instr =&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr -&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr</li><li class="src short"><a href="#v:patchEraseLive">patchEraseLive</a> :: <a href="Instruction.html#t:Instruction">Instruction</a> instr =&gt; (<a href="Reg.html#t:Reg">Reg</a> -&gt; <a href="Reg.html#t:Reg">Reg</a>) -&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr -&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr</li><li class="src short"><a href="#v:patchRegsLiveInstr">patchRegsLiveInstr</a> :: <a href="Instruction.html#t:Instruction">Instruction</a> instr =&gt; (<a href="Reg.html#t:Reg">Reg</a> -&gt; <a href="Reg.html#t:Reg">Reg</a>) -&gt; <a href="RegAlloc-Liveness.html#t:LiveInstr">LiveInstr</a> instr -&gt; <a href="RegAlloc-Liveness.html#t:LiveInstr">LiveInstr</a> instr</li><li class="src short"><a href="#v:reverseBlocksInTops">reverseBlocksInTops</a> :: <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr -&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr</li><li class="src short"><a href="#v:regLiveness">regLiveness</a> :: (<a href="Outputable.html#t:Outputable">Outputable</a> instr, <a href="Instruction.html#t:Instruction">Instruction</a> instr) =&gt; <a href="Platform.html#t:Platform">Platform</a> -&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr -&gt; <a href="UniqSupply.html#t:UniqSM">UniqSM</a> (<a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr)</li><li class="src short"><a href="#v:natCmmTopToLive">natCmmTopToLive</a> :: <a href="Instruction.html#t:Instruction">Instruction</a> instr =&gt; <a href="Instruction.html#t:NatCmmDecl">NatCmmDecl</a> statics instr -&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr</li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:RegSet" class="def">RegSet</a> = <a href="UniqSet.html#t:UniqSet">UniqSet</a> <a href="Reg.html#t:Reg">Reg</a> <a href="src/RegAlloc-Liveness.html#RegSet" class="link">Source</a> <a href="#t:RegSet" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:RegMap" class="def">RegMap</a> a = <a href="UniqFM.html#t:UniqFM">UniqFM</a> a <a href="src/RegAlloc-Liveness.html#RegMap" class="link">Source</a> <a href="#t:RegMap" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:emptyRegMap" class="def">emptyRegMap</a> :: <a href="UniqFM.html#t:UniqFM">UniqFM</a> a <a href="src/RegAlloc-Liveness.html#emptyRegMap" class="link">Source</a> <a href="#v:emptyRegMap" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:BlockMap" class="def">BlockMap</a> a = <a href="Hoopl-Label.html#t:LabelMap">LabelMap</a> a <a href="src/RegAlloc-Liveness.html#BlockMap" class="link">Source</a> <a href="#t:BlockMap" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:mapEmpty" class="def">mapEmpty</a> :: <a href="Hoopl-Collections.html#t:IsMap">IsMap</a> map =&gt; map a <a href="src/Hoopl-Collections.html#mapEmpty" class="link">Source</a> <a href="#v:mapEmpty" class="selflink">#</a></p></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:LiveCmmDecl" class="def">LiveCmmDecl</a> statics instr = <a href="Cmm.html#t:GenCmmDecl">GenCmmDecl</a> statics <a href="RegAlloc-Liveness.html#t:LiveInfo">LiveInfo</a> [<a href="Digraph.html#t:SCC">SCC</a> (<a href="RegAlloc-Liveness.html#t:LiveBasicBlock">LiveBasicBlock</a> instr)] <a href="src/RegAlloc-Liveness.html#LiveCmmDecl" class="link">Source</a> <a href="#t:LiveCmmDecl" class="selflink">#</a></p><div class="doc"><p>A top level thing which carries liveness information.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:InstrSR" class="def">InstrSR</a> instr <a href="src/RegAlloc-Liveness.html#InstrSR" class="link">Source</a> <a href="#t:InstrSR" class="selflink">#</a></p><div class="doc"><p>The register allocator also wants to use SPILL/RELOAD meta instructions,
   so we'll keep those here.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Instr" class="def">Instr</a> instr</td><td class="doc"><p>A real machine instruction</p></td></tr><tr><td class="src"><a id="v:SPILL" class="def">SPILL</a> <a href="Reg.html#t:Reg">Reg</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a></td><td class="doc"><p>spill this reg to a stack slot</p></td></tr><tr><td class="src"><a id="v:RELOAD" class="def">RELOAD</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> <a href="Reg.html#t:Reg">Reg</a></td><td class="doc"><p>reload this reg from a stack slot</p></td></tr></table></div><div class="subs instances"><p id="control.i:InstrSR" class="caption collapser" onclick="toggleSection('i:InstrSR')">Instances</p><div id="section.i:InstrSR" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:InstrSR:Outputable:1" class="instance expander" onclick="toggleSection('i:id:InstrSR:Outputable:1')"></span> <a href="Outputable.html#t:Outputable">Outputable</a> instr =&gt; <a href="Outputable.html#t:Outputable">Outputable</a> (<a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr)</span> <a href="#t:InstrSR" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:InstrSR:Outputable:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:ppr">ppr</a> :: <a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr -&gt; <a href="Outputable.html#t:SDoc">SDoc</a> <a href="src/Outputable.html#ppr" class="link">Source</a> <a href="#v:ppr" class="selflink">#</a></p><p class="src"><a href="#v:pprPrec">pprPrec</a> :: <a href="../base-4.10.0.0/Prelude.html#t:Rational">Rational</a> -&gt; <a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr -&gt; <a href="Outputable.html#t:SDoc">SDoc</a> <a href="src/Outputable.html#pprPrec" class="link">Source</a> <a href="#v:pprPrec" class="selflink">#</a></p></div></div></td></tr><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:InstrSR:Instruction:2" class="instance expander" onclick="toggleSection('i:id:InstrSR:Instruction:2')"></span> <a href="Instruction.html#t:Instruction">Instruction</a> instr =&gt; <a href="Instruction.html#t:Instruction">Instruction</a> (<a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr)</span> <a href="#t:InstrSR" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:InstrSR:Instruction:2" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:regUsageOfInstr">regUsageOfInstr</a> :: <a href="Platform.html#t:Platform">Platform</a> -&gt; <a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr -&gt; <a href="Instruction.html#t:RegUsage">RegUsage</a> <a href="src/Instruction.html#regUsageOfInstr" class="link">Source</a> <a href="#v:regUsageOfInstr" class="selflink">#</a></p><p class="src"><a href="#v:patchRegsOfInstr">patchRegsOfInstr</a> :: <a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr -&gt; (<a href="Reg.html#t:Reg">Reg</a> -&gt; <a href="Reg.html#t:Reg">Reg</a>) -&gt; <a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr <a href="src/Instruction.html#patchRegsOfInstr" class="link">Source</a> <a href="#v:patchRegsOfInstr" class="selflink">#</a></p><p class="src"><a href="#v:isJumpishInstr">isJumpishInstr</a> :: <a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr -&gt; <a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a> <a href="src/Instruction.html#isJumpishInstr" class="link">Source</a> <a href="#v:isJumpishInstr" class="selflink">#</a></p><p class="src"><a href="#v:jumpDestsOfInstr">jumpDestsOfInstr</a> :: <a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr -&gt; [<a href="BlockId.html#t:BlockId">BlockId</a>] <a href="src/Instruction.html#jumpDestsOfInstr" class="link">Source</a> <a href="#v:jumpDestsOfInstr" class="selflink">#</a></p><p class="src"><a href="#v:patchJumpInstr">patchJumpInstr</a> :: <a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr -&gt; (<a href="BlockId.html#t:BlockId">BlockId</a> -&gt; <a href="BlockId.html#t:BlockId">BlockId</a>) -&gt; <a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr <a href="src/Instruction.html#patchJumpInstr" class="link">Source</a> <a href="#v:patchJumpInstr" class="selflink">#</a></p><p class="src"><a href="#v:mkSpillInstr">mkSpillInstr</a> :: <a href="DynFlags.html#t:DynFlags">DynFlags</a> -&gt; <a href="Reg.html#t:Reg">Reg</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr <a href="src/Instruction.html#mkSpillInstr" class="link">Source</a> <a href="#v:mkSpillInstr" class="selflink">#</a></p><p class="src"><a href="#v:mkLoadInstr">mkLoadInstr</a> :: <a href="DynFlags.html#t:DynFlags">DynFlags</a> -&gt; <a href="Reg.html#t:Reg">Reg</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr <a href="src/Instruction.html#mkLoadInstr" class="link">Source</a> <a href="#v:mkLoadInstr" class="selflink">#</a></p><p class="src"><a href="#v:takeDeltaInstr">takeDeltaInstr</a> :: <a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr -&gt; <a href="../base-4.10.0.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> <a href="src/Instruction.html#takeDeltaInstr" class="link">Source</a> <a href="#v:takeDeltaInstr" class="selflink">#</a></p><p class="src"><a href="#v:isMetaInstr">isMetaInstr</a> :: <a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr -&gt; <a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a> <a href="src/Instruction.html#isMetaInstr" class="link">Source</a> <a href="#v:isMetaInstr" class="selflink">#</a></p><p class="src"><a href="#v:mkRegRegMoveInstr">mkRegRegMoveInstr</a> :: <a href="Platform.html#t:Platform">Platform</a> -&gt; <a href="Reg.html#t:Reg">Reg</a> -&gt; <a href="Reg.html#t:Reg">Reg</a> -&gt; <a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr <a href="src/Instruction.html#mkRegRegMoveInstr" class="link">Source</a> <a href="#v:mkRegRegMoveInstr" class="selflink">#</a></p><p class="src"><a href="#v:takeRegRegMoveInstr">takeRegRegMoveInstr</a> :: <a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr -&gt; <a href="../base-4.10.0.0/Data-Maybe.html#t:Maybe">Maybe</a> (<a href="Reg.html#t:Reg">Reg</a>, <a href="Reg.html#t:Reg">Reg</a>) <a href="src/Instruction.html#takeRegRegMoveInstr" class="link">Source</a> <a href="#v:takeRegRegMoveInstr" class="selflink">#</a></p><p class="src"><a href="#v:mkJumpInstr">mkJumpInstr</a> :: <a href="BlockId.html#t:BlockId">BlockId</a> -&gt; [<a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr] <a href="src/Instruction.html#mkJumpInstr" class="link">Source</a> <a href="#v:mkJumpInstr" class="selflink">#</a></p><p class="src"><a href="#v:mkStackAllocInstr">mkStackAllocInstr</a> :: <a href="Platform.html#t:Platform">Platform</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr <a href="src/Instruction.html#mkStackAllocInstr" class="link">Source</a> <a href="#v:mkStackAllocInstr" class="selflink">#</a></p><p class="src"><a href="#v:mkStackDeallocInstr">mkStackDeallocInstr</a> :: <a href="Platform.html#t:Platform">Platform</a> -&gt; <a href="../base-4.10.0.0/Data-Int.html#t:Int">Int</a> -&gt; <a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr <a href="src/Instruction.html#mkStackDeallocInstr" class="link">Source</a> <a href="#v:mkStackDeallocInstr" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:LiveInstr" class="def">LiveInstr</a> instr <a href="src/RegAlloc-Liveness.html#LiveInstr" class="link">Source</a> <a href="#t:LiveInstr" class="selflink">#</a></p><div class="doc"><p>An instruction with liveness information.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:LiveInstr" class="def">LiveInstr</a> (<a href="RegAlloc-Liveness.html#t:InstrSR">InstrSR</a> instr) (<a href="../base-4.10.0.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="RegAlloc-Liveness.html#t:Liveness">Liveness</a>)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:LiveInstr" class="caption collapser" onclick="toggleSection('i:LiveInstr')">Instances</p><div id="section.i:LiveInstr" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:LiveInstr:Outputable:1" class="instance expander" onclick="toggleSection('i:id:LiveInstr:Outputable:1')"></span> <a href="Outputable.html#t:Outputable">Outputable</a> instr =&gt; <a href="Outputable.html#t:Outputable">Outputable</a> (<a href="RegAlloc-Liveness.html#t:LiveInstr">LiveInstr</a> instr)</span> <a href="#t:LiveInstr" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:LiveInstr:Outputable:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:ppr">ppr</a> :: <a href="RegAlloc-Liveness.html#t:LiveInstr">LiveInstr</a> instr -&gt; <a href="Outputable.html#t:SDoc">SDoc</a> <a href="src/Outputable.html#ppr" class="link">Source</a> <a href="#v:ppr" class="selflink">#</a></p><p class="src"><a href="#v:pprPrec">pprPrec</a> :: <a href="../base-4.10.0.0/Prelude.html#t:Rational">Rational</a> -&gt; <a href="RegAlloc-Liveness.html#t:LiveInstr">LiveInstr</a> instr -&gt; <a href="Outputable.html#t:SDoc">SDoc</a> <a href="src/Outputable.html#pprPrec" class="link">Source</a> <a href="#v:pprPrec" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Liveness" class="def">Liveness</a> <a href="src/RegAlloc-Liveness.html#Liveness" class="link">Source</a> <a href="#t:Liveness" class="selflink">#</a></p><div class="doc"><p>Liveness information.
   The regs which die are ones which are no longer live in the *next* instruction
   in this sequence.
   (NB. if the instruction is a jump, these registers might still be live
   at the jump target(s) - you have to check the liveness at the destination
   block to find out).</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Liveness" class="def">Liveness</a></td><td class="doc"><p>registers that died because they were clobbered by something.</p></td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><ul><li><dfn class="src"><a id="v:liveBorn" class="def">liveBorn</a> :: <a href="RegAlloc-Liveness.html#t:RegSet">RegSet</a></dfn><div class="doc"><p>registers born in this instruction (written to for first time).</p></div></li><li><dfn class="src"><a id="v:liveDieRead" class="def">liveDieRead</a> :: <a href="RegAlloc-Liveness.html#t:RegSet">RegSet</a></dfn><div class="doc"><p>registers that died because they were read for the last time.</p></div></li><li><dfn class="src"><a id="v:liveDieWrite" class="def">liveDieWrite</a> :: <a href="RegAlloc-Liveness.html#t:RegSet">RegSet</a></dfn><div class="doc empty">&nbsp;</div></li></ul></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:LiveInfo" class="def">LiveInfo</a> <a href="src/RegAlloc-Liveness.html#LiveInfo" class="link">Source</a> <a href="#t:LiveInfo" class="selflink">#</a></p><div class="doc"><p>Stash regs live on entry to each basic block in the info part of the cmm code.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:LiveInfo" class="def">LiveInfo</a> (<a href="Hoopl-Label.html#t:LabelMap">LabelMap</a> <a href="Cmm.html#t:CmmStatics">CmmStatics</a>) [<a href="BlockId.html#t:BlockId">BlockId</a>] (<a href="../base-4.10.0.0/Data-Maybe.html#t:Maybe">Maybe</a> (<a href="RegAlloc-Liveness.html#t:BlockMap">BlockMap</a> <a href="RegAlloc-Liveness.html#t:RegSet">RegSet</a>)) (<a href="RegAlloc-Liveness.html#t:BlockMap">BlockMap</a> <a href="../containers-0.5.10.2/Data-IntSet-Internal.html#t:IntSet">IntSet</a>)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:LiveInfo" class="caption collapser" onclick="toggleSection('i:LiveInfo')">Instances</p><div id="section.i:LiveInfo" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><span id="control.i:id:LiveInfo:Outputable:1" class="instance expander" onclick="toggleSection('i:id:LiveInfo:Outputable:1')"></span> <a href="Outputable.html#t:Outputable">Outputable</a> <a href="RegAlloc-Liveness.html#t:LiveInfo">LiveInfo</a></span> <a href="#t:LiveInfo" class="selflink">#</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div id="section.i:id:LiveInfo:Outputable:1" class="inst-details hide"><div class="subs methods"><p class="caption">Methods</p><p class="src"><a href="#v:ppr">ppr</a> :: <a href="RegAlloc-Liveness.html#t:LiveInfo">LiveInfo</a> -&gt; <a href="Outputable.html#t:SDoc">SDoc</a> <a href="src/Outputable.html#ppr" class="link">Source</a> <a href="#v:ppr" class="selflink">#</a></p><p class="src"><a href="#v:pprPrec">pprPrec</a> :: <a href="../base-4.10.0.0/Prelude.html#t:Rational">Rational</a> -&gt; <a href="RegAlloc-Liveness.html#t:LiveInfo">LiveInfo</a> -&gt; <a href="Outputable.html#t:SDoc">SDoc</a> <a href="src/Outputable.html#pprPrec" class="link">Source</a> <a href="#v:pprPrec" class="selflink">#</a></p></div></div></td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">type</span> <a id="t:LiveBasicBlock" class="def">LiveBasicBlock</a> instr = <a href="Cmm.html#t:GenBasicBlock">GenBasicBlock</a> (<a href="RegAlloc-Liveness.html#t:LiveInstr">LiveInstr</a> instr) <a href="src/RegAlloc-Liveness.html#LiveBasicBlock" class="link">Source</a> <a href="#t:LiveBasicBlock" class="selflink">#</a></p><div class="doc"><p>A basic block with liveness information.</p></div></div><div class="top"><p class="src"><a id="v:mapBlockTop" class="def">mapBlockTop</a> :: (<a href="RegAlloc-Liveness.html#t:LiveBasicBlock">LiveBasicBlock</a> instr -&gt; <a href="RegAlloc-Liveness.html#t:LiveBasicBlock">LiveBasicBlock</a> instr) -&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr -&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr <a href="src/RegAlloc-Liveness.html#mapBlockTop" class="link">Source</a> <a href="#v:mapBlockTop" class="selflink">#</a></p><div class="doc"><p>map a function across all the basic blocks in this code</p></div></div><div class="top"><p class="src"><a id="v:mapBlockTopM" class="def">mapBlockTopM</a> :: <a href="../base-4.10.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; (<a href="RegAlloc-Liveness.html#t:LiveBasicBlock">LiveBasicBlock</a> instr -&gt; m (<a href="RegAlloc-Liveness.html#t:LiveBasicBlock">LiveBasicBlock</a> instr)) -&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr -&gt; m (<a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr) <a href="src/RegAlloc-Liveness.html#mapBlockTopM" class="link">Source</a> <a href="#v:mapBlockTopM" class="selflink">#</a></p><div class="doc"><p>map a function across all the basic blocks in this code (monadic version)</p></div></div><div class="top"><p class="src"><a id="v:mapSCCM" class="def">mapSCCM</a> :: <a href="../base-4.10.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; (a -&gt; m b) -&gt; <a href="Digraph.html#t:SCC">SCC</a> a -&gt; m (<a href="Digraph.html#t:SCC">SCC</a> b) <a href="src/RegAlloc-Liveness.html#mapSCCM" class="link">Source</a> <a href="#v:mapSCCM" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:mapGenBlockTop" class="def">mapGenBlockTop</a> :: (<a href="Cmm.html#t:GenBasicBlock">GenBasicBlock</a> i -&gt; <a href="Cmm.html#t:GenBasicBlock">GenBasicBlock</a> i) -&gt; <a href="Cmm.html#t:GenCmmDecl">GenCmmDecl</a> d h (<a href="Cmm.html#t:ListGraph">ListGraph</a> i) -&gt; <a href="Cmm.html#t:GenCmmDecl">GenCmmDecl</a> d h (<a href="Cmm.html#t:ListGraph">ListGraph</a> i) <a href="src/RegAlloc-Liveness.html#mapGenBlockTop" class="link">Source</a> <a href="#v:mapGenBlockTop" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:mapGenBlockTopM" class="def">mapGenBlockTopM</a> :: <a href="../base-4.10.0.0/Control-Monad.html#t:Monad">Monad</a> m =&gt; (<a href="Cmm.html#t:GenBasicBlock">GenBasicBlock</a> i -&gt; m (<a href="Cmm.html#t:GenBasicBlock">GenBasicBlock</a> i)) -&gt; <a href="Cmm.html#t:GenCmmDecl">GenCmmDecl</a> d h (<a href="Cmm.html#t:ListGraph">ListGraph</a> i) -&gt; m (<a href="Cmm.html#t:GenCmmDecl">GenCmmDecl</a> d h (<a href="Cmm.html#t:ListGraph">ListGraph</a> i)) <a href="src/RegAlloc-Liveness.html#mapGenBlockTopM" class="link">Source</a> <a href="#v:mapGenBlockTopM" class="selflink">#</a></p><div class="doc"><p>map a function across all the basic blocks in this code (monadic version)</p></div></div><div class="top"><p class="src"><a id="v:stripLive" class="def">stripLive</a> :: (<a href="Outputable.html#t:Outputable">Outputable</a> statics, <a href="Outputable.html#t:Outputable">Outputable</a> instr, <a href="Instruction.html#t:Instruction">Instruction</a> instr) =&gt; <a href="DynFlags.html#t:DynFlags">DynFlags</a> -&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr -&gt; <a href="Instruction.html#t:NatCmmDecl">NatCmmDecl</a> statics instr <a href="src/RegAlloc-Liveness.html#stripLive" class="link">Source</a> <a href="#v:stripLive" class="selflink">#</a></p><div class="doc"><p>Strip away liveness information, yielding NatCmmDecl</p></div></div><div class="top"><p class="src"><a id="v:stripLiveBlock" class="def">stripLiveBlock</a> :: <a href="Instruction.html#t:Instruction">Instruction</a> instr =&gt; <a href="DynFlags.html#t:DynFlags">DynFlags</a> -&gt; <a href="RegAlloc-Liveness.html#t:LiveBasicBlock">LiveBasicBlock</a> instr -&gt; <a href="Instruction.html#t:NatBasicBlock">NatBasicBlock</a> instr <a href="src/RegAlloc-Liveness.html#stripLiveBlock" class="link">Source</a> <a href="#v:stripLiveBlock" class="selflink">#</a></p><div class="doc"><p>Strip away liveness information from a basic block,
   and make real spill instructions out of SPILL, RELOAD pseudos along the way.</p></div></div><div class="top"><p class="src"><a id="v:slurpConflicts" class="def">slurpConflicts</a> :: <a href="Instruction.html#t:Instruction">Instruction</a> instr =&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr -&gt; (<a href="Bag.html#t:Bag">Bag</a> (<a href="UniqSet.html#t:UniqSet">UniqSet</a> <a href="Reg.html#t:Reg">Reg</a>), <a href="Bag.html#t:Bag">Bag</a> (<a href="Reg.html#t:Reg">Reg</a>, <a href="Reg.html#t:Reg">Reg</a>)) <a href="src/RegAlloc-Liveness.html#slurpConflicts" class="link">Source</a> <a href="#v:slurpConflicts" class="selflink">#</a></p><div class="doc"><p>Slurp out the list of register conflicts and reg-reg moves from this top level thing.
   Slurping of conflicts and moves is wrapped up together so we don't have
   to make two passes over the same code when we want to build the graph.</p></div></div><div class="top"><p class="src"><a id="v:slurpReloadCoalesce" class="def">slurpReloadCoalesce</a> :: <span class="keyword">forall</span> statics instr. <a href="Instruction.html#t:Instruction">Instruction</a> instr =&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr -&gt; <a href="Bag.html#t:Bag">Bag</a> (<a href="Reg.html#t:Reg">Reg</a>, <a href="Reg.html#t:Reg">Reg</a>) <a href="src/RegAlloc-Liveness.html#slurpReloadCoalesce" class="link">Source</a> <a href="#v:slurpReloadCoalesce" class="selflink">#</a></p><div class="doc"><p>For spill/reloads</p><p>SPILL  v1, slot1
   ...
   RELOAD slot1, v2</p><p>If we can arrange that v1 and v2 are allocated to the same hreg it's more likely
   the spill/reload instrs can be cleaned and replaced by a nop reg-reg move.</p></div></div><div class="top"><p class="src"><a id="v:eraseDeltasLive" class="def">eraseDeltasLive</a> :: <a href="Instruction.html#t:Instruction">Instruction</a> instr =&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr -&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr <a href="src/RegAlloc-Liveness.html#eraseDeltasLive" class="link">Source</a> <a href="#v:eraseDeltasLive" class="selflink">#</a></p><div class="doc"><p>Erase Delta instructions.</p></div></div><div class="top"><p class="src"><a id="v:patchEraseLive" class="def">patchEraseLive</a> :: <a href="Instruction.html#t:Instruction">Instruction</a> instr =&gt; (<a href="Reg.html#t:Reg">Reg</a> -&gt; <a href="Reg.html#t:Reg">Reg</a>) -&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr -&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr <a href="src/RegAlloc-Liveness.html#patchEraseLive" class="link">Source</a> <a href="#v:patchEraseLive" class="selflink">#</a></p><div class="doc"><p>Patch the registers in this code according to this register mapping.
   also erase reg -&gt; reg moves when the reg is the same.
   also erase reg -&gt; reg moves when the destination dies in this instr.</p></div></div><div class="top"><p class="src"><a id="v:patchRegsLiveInstr" class="def">patchRegsLiveInstr</a> :: <a href="Instruction.html#t:Instruction">Instruction</a> instr =&gt; (<a href="Reg.html#t:Reg">Reg</a> -&gt; <a href="Reg.html#t:Reg">Reg</a>) -&gt; <a href="RegAlloc-Liveness.html#t:LiveInstr">LiveInstr</a> instr -&gt; <a href="RegAlloc-Liveness.html#t:LiveInstr">LiveInstr</a> instr <a href="src/RegAlloc-Liveness.html#patchRegsLiveInstr" class="link">Source</a> <a href="#v:patchRegsLiveInstr" class="selflink">#</a></p><div class="doc"><p>Patch registers in this LiveInstr, including the liveness information.</p></div></div><div class="top"><p class="src"><a id="v:reverseBlocksInTops" class="def">reverseBlocksInTops</a> :: <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr -&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr <a href="src/RegAlloc-Liveness.html#reverseBlocksInTops" class="link">Source</a> <a href="#v:reverseBlocksInTops" class="selflink">#</a></p><div class="doc"><p>If we've compute liveness info for this code already we have to reverse
   the SCCs in each top to get them back to the right order so we can do it again.</p></div></div><div class="top"><p class="src"><a id="v:regLiveness" class="def">regLiveness</a> :: (<a href="Outputable.html#t:Outputable">Outputable</a> instr, <a href="Instruction.html#t:Instruction">Instruction</a> instr) =&gt; <a href="Platform.html#t:Platform">Platform</a> -&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr -&gt; <a href="UniqSupply.html#t:UniqSM">UniqSM</a> (<a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr) <a href="src/RegAlloc-Liveness.html#regLiveness" class="link">Source</a> <a href="#v:regLiveness" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:natCmmTopToLive" class="def">natCmmTopToLive</a> :: <a href="Instruction.html#t:Instruction">Instruction</a> instr =&gt; <a href="Instruction.html#t:NatCmmDecl">NatCmmDecl</a> statics instr -&gt; <a href="RegAlloc-Liveness.html#t:LiveCmmDecl">LiveCmmDecl</a> statics instr <a href="src/RegAlloc-Liveness.html#natCmmTopToLive" class="link">Source</a> <a href="#v:natCmmTopToLive" class="selflink">#</a></p><div class="doc"><p>Convert a NatCmmDecl to a LiveCmmDecl, with empty liveness information</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.18.2</p></div></body></html>