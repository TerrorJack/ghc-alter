<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>TcIface</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/TcIface.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ghc-8.3: The GHC API</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">TcIface</p></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:tcLookupImported_maybe">tcLookupImported_maybe</a> :: <a href="Name.html#t:Name">Name</a> -&gt; <a href="TcRnTypes.html#t:TcM">TcM</a> (<a href="Maybes.html#t:MaybeErr">MaybeErr</a> <a href="ErrUtils.html#t:MsgDoc">MsgDoc</a> <a href="Type.html#t:TyThing">TyThing</a>)</li><li class="src short"><a href="#v:importDecl">importDecl</a> :: <a href="Name.html#t:Name">Name</a> -&gt; <a href="TcRnTypes.html#t:IfM">IfM</a> lcl (<a href="Maybes.html#t:MaybeErr">MaybeErr</a> <a href="ErrUtils.html#t:MsgDoc">MsgDoc</a> <a href="Type.html#t:TyThing">TyThing</a>)</li><li class="src short"><a href="#v:checkWiredInTyCon">checkWiredInTyCon</a> :: <a href="TyCon.html#t:TyCon">TyCon</a> -&gt; <a href="TcRnTypes.html#t:TcM">TcM</a> ()</li><li class="src short"><a href="#v:tcHiBootIface">tcHiBootIface</a> :: <a href="DriverPhases.html#t:HscSource">HscSource</a> -&gt; <a href="Module.html#t:Module">Module</a> -&gt; <a href="TcRnTypes.html#t:TcRn">TcRn</a> <a href="TcRnTypes.html#t:SelfBootInfo">SelfBootInfo</a></li><li class="src short"><a href="#v:typecheckIface">typecheckIface</a> :: <a href="HscTypes.html#t:ModIface">ModIface</a> -&gt; <a href="TcRnTypes.html#t:IfG">IfG</a> <a href="HscTypes.html#t:ModDetails">ModDetails</a></li><li class="src short"><a href="#v:typecheckIfacesForMerging">typecheckIfacesForMerging</a> :: <a href="Module.html#t:Module">Module</a> -&gt; [<a href="HscTypes.html#t:ModIface">ModIface</a>] -&gt; <a href="IOEnv.html#t:IORef">IORef</a> <a href="HscTypes.html#t:TypeEnv">TypeEnv</a> -&gt; <a href="TcRnTypes.html#t:IfM">IfM</a> lcl (<a href="HscTypes.html#t:TypeEnv">TypeEnv</a>, [<a href="HscTypes.html#t:ModDetails">ModDetails</a>])</li><li class="src short"><a href="#v:typecheckIfaceForInstantiate">typecheckIfaceForInstantiate</a> :: <a href="TcRnTypes.html#t:NameShape">NameShape</a> -&gt; <a href="HscTypes.html#t:ModIface">ModIface</a> -&gt; <a href="TcRnTypes.html#t:IfM">IfM</a> lcl <a href="HscTypes.html#t:ModDetails">ModDetails</a></li><li class="src short"><a href="#v:tcIfaceDecl">tcIfaceDecl</a> :: <a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a> -&gt; <a href="IfaceSyn.html#t:IfaceDecl">IfaceDecl</a> -&gt; <a href="TcRnTypes.html#t:IfL">IfL</a> <a href="Type.html#t:TyThing">TyThing</a></li><li class="src short"><a href="#v:tcIfaceInst">tcIfaceInst</a> :: <a href="IfaceSyn.html#t:IfaceClsInst">IfaceClsInst</a> -&gt; <a href="TcRnTypes.html#t:IfL">IfL</a> <a href="InstEnv.html#t:ClsInst">ClsInst</a></li><li class="src short"><a href="#v:tcIfaceFamInst">tcIfaceFamInst</a> :: <a href="IfaceSyn.html#t:IfaceFamInst">IfaceFamInst</a> -&gt; <a href="TcRnTypes.html#t:IfL">IfL</a> <a href="FamInstEnv.html#t:FamInst">FamInst</a></li><li class="src short"><a href="#v:tcIfaceRules">tcIfaceRules</a> :: <a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a> -&gt; [<a href="IfaceSyn.html#t:IfaceRule">IfaceRule</a>] -&gt; <a href="TcRnTypes.html#t:IfL">IfL</a> [<a href="CoreSyn.html#t:CoreRule">CoreRule</a>]</li><li class="src short"><a href="#v:tcIfaceVectInfo">tcIfaceVectInfo</a> :: <a href="Module.html#t:Module">Module</a> -&gt; <a href="HscTypes.html#t:TypeEnv">TypeEnv</a> -&gt; <a href="HscTypes.html#t:IfaceVectInfo">IfaceVectInfo</a> -&gt; <a href="TcRnTypes.html#t:IfL">IfL</a> <a href="HscTypes.html#t:VectInfo">VectInfo</a></li><li class="src short"><a href="#v:tcIfaceAnnotations">tcIfaceAnnotations</a> :: [<a href="IfaceSyn.html#t:IfaceAnnotation">IfaceAnnotation</a>] -&gt; <a href="TcRnTypes.html#t:IfL">IfL</a> [<a href="Annotations.html#t:Annotation">Annotation</a>]</li><li class="src short"><a href="#v:tcIfaceCompleteSigs">tcIfaceCompleteSigs</a> :: [<a href="IfaceSyn.html#t:IfaceCompleteMatch">IfaceCompleteMatch</a>] -&gt; <a href="TcRnTypes.html#t:IfL">IfL</a> [<a href="HscTypes.html#t:CompleteMatch">CompleteMatch</a>]</li><li class="src short"><a href="#v:tcIfaceExpr">tcIfaceExpr</a> :: <a href="IfaceSyn.html#t:IfaceExpr">IfaceExpr</a> -&gt; <a href="TcRnTypes.html#t:IfL">IfL</a> <a href="CoreSyn.html#t:CoreExpr">CoreExpr</a></li><li class="src short"><a href="#v:tcIfaceGlobal">tcIfaceGlobal</a> :: <a href="Name.html#t:Name">Name</a> -&gt; <a href="TcRnTypes.html#t:IfL">IfL</a> <a href="Type.html#t:TyThing">TyThing</a></li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:tcLookupImported_maybe" class="def">tcLookupImported_maybe</a> :: <a href="Name.html#t:Name">Name</a> -&gt; <a href="TcRnTypes.html#t:TcM">TcM</a> (<a href="Maybes.html#t:MaybeErr">MaybeErr</a> <a href="ErrUtils.html#t:MsgDoc">MsgDoc</a> <a href="Type.html#t:TyThing">TyThing</a>) <a href="src/LoadIface.html#tcLookupImported_maybe" class="link">Source</a> <a href="#v:tcLookupImported_maybe" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:importDecl" class="def">importDecl</a> :: <a href="Name.html#t:Name">Name</a> -&gt; <a href="TcRnTypes.html#t:IfM">IfM</a> lcl (<a href="Maybes.html#t:MaybeErr">MaybeErr</a> <a href="ErrUtils.html#t:MsgDoc">MsgDoc</a> <a href="Type.html#t:TyThing">TyThing</a>) <a href="src/LoadIface.html#importDecl" class="link">Source</a> <a href="#v:importDecl" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:checkWiredInTyCon" class="def">checkWiredInTyCon</a> :: <a href="TyCon.html#t:TyCon">TyCon</a> -&gt; <a href="TcRnTypes.html#t:TcM">TcM</a> () <a href="src/LoadIface.html#checkWiredInTyCon" class="link">Source</a> <a href="#v:checkWiredInTyCon" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:tcHiBootIface" class="def">tcHiBootIface</a> :: <a href="DriverPhases.html#t:HscSource">HscSource</a> -&gt; <a href="Module.html#t:Module">Module</a> -&gt; <a href="TcRnTypes.html#t:TcRn">TcRn</a> <a href="TcRnTypes.html#t:SelfBootInfo">SelfBootInfo</a> <a href="src/TcIface.html#tcHiBootIface" class="link">Source</a> <a href="#v:tcHiBootIface" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:typecheckIface" class="def">typecheckIface</a> :: <a href="HscTypes.html#t:ModIface">ModIface</a> -&gt; <a href="TcRnTypes.html#t:IfG">IfG</a> <a href="HscTypes.html#t:ModDetails">ModDetails</a> <a href="src/TcIface.html#typecheckIface" class="link">Source</a> <a href="#v:typecheckIface" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:typecheckIfacesForMerging" class="def">typecheckIfacesForMerging</a> :: <a href="Module.html#t:Module">Module</a> -&gt; [<a href="HscTypes.html#t:ModIface">ModIface</a>] -&gt; <a href="IOEnv.html#t:IORef">IORef</a> <a href="HscTypes.html#t:TypeEnv">TypeEnv</a> -&gt; <a href="TcRnTypes.html#t:IfM">IfM</a> lcl (<a href="HscTypes.html#t:TypeEnv">TypeEnv</a>, [<a href="HscTypes.html#t:ModDetails">ModDetails</a>]) <a href="src/TcIface.html#typecheckIfacesForMerging" class="link">Source</a> <a href="#v:typecheckIfacesForMerging" class="selflink">#</a></p><div class="doc"><p>This is a very interesting function.  Like typecheckIface, we want
 to type check an interface file into a ModDetails.  However, the use-case
 for these ModDetails is different: we want to compare all of the
 ModDetails to ensure they define compatible declarations, and then
 merge them together.  So in particular, we have to take a different
 strategy for knot-tying: we first speculatively merge the declarations
 to get the &quot;base&quot; truth for what we believe the types will be
 (this is &quot;type computation.&quot;)  Then we read everything in relative
 to this truth and check for compatibility.</p><p>During the merge process, we may need to nondeterministically
 pick a particular declaration to use, if multiple signatures define
 the declaration (<code>mergeIfaceDecl</code>).  If, for all choices, there
 are no type synonym cycles in the resulting merged graph, then
 we can show that our choice cannot matter. Consider the
 set of entities which the declarations depend on: by assumption
 of acyclicity, we can assume that these have already been shown to be equal
 to each other (otherwise merging will fail).  Then it must
 be the case that all candidate declarations here are type-equal
 (the choice doesn't matter) or there is an inequality (in which
 case merging will fail.)</p><p>Unfortunately, the choice can matter if there is a cycle.  Consider the
 following merge:</p><p>signature H where { type A = C;  type B = A; data C      }
      signature H where { type A = (); data B;     type C = B  }</p><p>If we pick <code>type A = C</code> as our representative, there will be
 a cycle and merging will fail. But if we pick <code>type A = ()</code> as
 our representative, no cycle occurs, and we instead conclude
 that all of the types are unit.  So it seems that we either
 (a) need a stronger acyclicity check which considers *all*
 possible choices from a merge, or (b) we must find a selection
 of declarations which is acyclic, and show that this is always
 the &quot;best&quot; choice we could have made (ezyang conjectures this
 is the case but does not have a proof).  For now this is
 not implemented.</p><p>It's worth noting that at the moment, a data constructor and a
 type synonym are never compatible.  Consider:</p><p>signature H where { type Int=C;         type B = Int; data C = Int}
      signature H where { export Prelude.Int; data B;       type C = B; }</p><p>This will be rejected, because the reexported Int in the second
 signature (a proper data type) is never considered equal to a
 type synonym.  Perhaps this should be relaxed, where a type synonym
 in a signature is considered implemented by a data type declaration
 which matches the reference of the type synonym.</p></div></div><div class="top"><p class="src"><a id="v:typecheckIfaceForInstantiate" class="def">typecheckIfaceForInstantiate</a> :: <a href="TcRnTypes.html#t:NameShape">NameShape</a> -&gt; <a href="HscTypes.html#t:ModIface">ModIface</a> -&gt; <a href="TcRnTypes.html#t:IfM">IfM</a> lcl <a href="HscTypes.html#t:ModDetails">ModDetails</a> <a href="src/TcIface.html#typecheckIfaceForInstantiate" class="link">Source</a> <a href="#v:typecheckIfaceForInstantiate" class="selflink">#</a></p><div class="doc"><p>Typecheck a signature <code><a href="HscTypes.html#t:ModIface">ModIface</a></code> under the assumption that we have
 instantiated it under some implementation (recorded in <code><a href="HscTypes.html#v:mi_semantic_module">mi_semantic_module</a></code>)
 and want to check if the implementation fills the signature.</p><p>This needs to operate slightly differently than <code><a href="TcIface.html#v:typecheckIface">typecheckIface</a></code>
 because (1) we have a <code><a href="TcRnTypes.html#t:NameShape">NameShape</a></code>, from the exports of the
 implementing module, which we will use to give our top-level
 declarations the correct <code><a href="Name.html#t:Name">Name</a></code>s even when the implementor
 provided them with a reexport, and (2) we have to deal with
 DFun silliness (see Note [rnIfaceNeverExported])</p></div></div><div class="top"><p class="src"><a id="v:tcIfaceDecl" class="def">tcIfaceDecl</a> <a href="src/TcIface.html#tcIfaceDecl" class="link">Source</a> <a href="#v:tcIfaceDecl" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a></td><td class="doc"><p>True <a href="=">=</a> discard IdInfo on IfaceId bindings</p></td></tr><tr><td class="src">-&gt; <a href="IfaceSyn.html#t:IfaceDecl">IfaceDecl</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="TcRnTypes.html#t:IfL">IfL</a> <a href="Type.html#t:TyThing">TyThing</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><a id="v:tcIfaceInst" class="def">tcIfaceInst</a> :: <a href="IfaceSyn.html#t:IfaceClsInst">IfaceClsInst</a> -&gt; <a href="TcRnTypes.html#t:IfL">IfL</a> <a href="InstEnv.html#t:ClsInst">ClsInst</a> <a href="src/TcIface.html#tcIfaceInst" class="link">Source</a> <a href="#v:tcIfaceInst" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:tcIfaceFamInst" class="def">tcIfaceFamInst</a> :: <a href="IfaceSyn.html#t:IfaceFamInst">IfaceFamInst</a> -&gt; <a href="TcRnTypes.html#t:IfL">IfL</a> <a href="FamInstEnv.html#t:FamInst">FamInst</a> <a href="src/TcIface.html#tcIfaceFamInst" class="link">Source</a> <a href="#v:tcIfaceFamInst" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:tcIfaceRules" class="def">tcIfaceRules</a> :: <a href="../base-4.10.0.0/Data-Bool.html#t:Bool">Bool</a> -&gt; [<a href="IfaceSyn.html#t:IfaceRule">IfaceRule</a>] -&gt; <a href="TcRnTypes.html#t:IfL">IfL</a> [<a href="CoreSyn.html#t:CoreRule">CoreRule</a>] <a href="src/TcIface.html#tcIfaceRules" class="link">Source</a> <a href="#v:tcIfaceRules" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:tcIfaceVectInfo" class="def">tcIfaceVectInfo</a> :: <a href="Module.html#t:Module">Module</a> -&gt; <a href="HscTypes.html#t:TypeEnv">TypeEnv</a> -&gt; <a href="HscTypes.html#t:IfaceVectInfo">IfaceVectInfo</a> -&gt; <a href="TcRnTypes.html#t:IfL">IfL</a> <a href="HscTypes.html#t:VectInfo">VectInfo</a> <a href="src/TcIface.html#tcIfaceVectInfo" class="link">Source</a> <a href="#v:tcIfaceVectInfo" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:tcIfaceAnnotations" class="def">tcIfaceAnnotations</a> :: [<a href="IfaceSyn.html#t:IfaceAnnotation">IfaceAnnotation</a>] -&gt; <a href="TcRnTypes.html#t:IfL">IfL</a> [<a href="Annotations.html#t:Annotation">Annotation</a>] <a href="src/TcIface.html#tcIfaceAnnotations" class="link">Source</a> <a href="#v:tcIfaceAnnotations" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:tcIfaceCompleteSigs" class="def">tcIfaceCompleteSigs</a> :: [<a href="IfaceSyn.html#t:IfaceCompleteMatch">IfaceCompleteMatch</a>] -&gt; <a href="TcRnTypes.html#t:IfL">IfL</a> [<a href="HscTypes.html#t:CompleteMatch">CompleteMatch</a>] <a href="src/TcIface.html#tcIfaceCompleteSigs" class="link">Source</a> <a href="#v:tcIfaceCompleteSigs" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:tcIfaceExpr" class="def">tcIfaceExpr</a> :: <a href="IfaceSyn.html#t:IfaceExpr">IfaceExpr</a> -&gt; <a href="TcRnTypes.html#t:IfL">IfL</a> <a href="CoreSyn.html#t:CoreExpr">CoreExpr</a> <a href="src/TcIface.html#tcIfaceExpr" class="link">Source</a> <a href="#v:tcIfaceExpr" class="selflink">#</a></p></div><div class="top"><p class="src"><a id="v:tcIfaceGlobal" class="def">tcIfaceGlobal</a> :: <a href="Name.html#t:Name">Name</a> -&gt; <a href="TcRnTypes.html#t:IfL">IfL</a> <a href="Type.html#t:TyThing">TyThing</a> <a href="src/TcIface.html#tcIfaceGlobal" class="link">Source</a> <a href="#v:tcIfaceGlobal" class="selflink">#</a></p></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.18.2</p></div></body></html>