<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Distribution/Types/LocalBuildInfo.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE DeriveGeneric #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE FlexibleContexts #-}</span>
<a name="line-3"></a><span class='hs-comment'>{-# LANGUAGE RankNTypes #-}</span>
<a name="line-4"></a>
<a name="line-5"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span><span class='hs-varop'>.</span><span class='hs-conid'>LocalBuildInfo</span> <span class='hs-layout'>(</span>
<a name="line-6"></a>    <span class='hs-comment'>-- * The type</span>
<a name="line-7"></a>
<a name="line-8"></a>    <span class='hs-conid'>LocalBuildInfo</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-9"></a>
<a name="line-10"></a>    <span class='hs-comment'>-- * Convenience accessors</span>
<a name="line-11"></a>
<a name="line-12"></a>    <span class='hs-varid'>localComponentId</span><span class='hs-layout'>,</span>
<a name="line-13"></a>    <span class='hs-varid'>localUnitId</span><span class='hs-layout'>,</span>
<a name="line-14"></a>    <span class='hs-varid'>localCompatPackageKey</span><span class='hs-layout'>,</span>
<a name="line-15"></a>    <span class='hs-varid'>localPackage</span><span class='hs-layout'>,</span>
<a name="line-16"></a>
<a name="line-17"></a>    <span class='hs-comment'>-- * Build targets of the 'LocalBuildInfo'.</span>
<a name="line-18"></a>
<a name="line-19"></a>    <span class='hs-varid'>componentNameCLBIs</span><span class='hs-layout'>,</span>
<a name="line-20"></a>
<a name="line-21"></a>    <span class='hs-comment'>-- NB: the primes mean that they take a 'PackageDescription'</span>
<a name="line-22"></a>    <span class='hs-comment'>-- which may not match 'localPkgDescr' in 'LocalBuildInfo'.</span>
<a name="line-23"></a>    <span class='hs-comment'>-- More logical types would drop this argument, but</span>
<a name="line-24"></a>    <span class='hs-comment'>-- at the moment, this is the ONLY supported function, because</span>
<a name="line-25"></a>    <span class='hs-comment'>-- 'localPkgDescr' is not guaranteed to match.  At some point</span>
<a name="line-26"></a>    <span class='hs-comment'>-- we will fix it and then we can use the (free) unprimed</span>
<a name="line-27"></a>    <span class='hs-comment'>-- namespace for the correct commands.</span>
<a name="line-28"></a>    <span class='hs-comment'>--</span>
<a name="line-29"></a>    <span class='hs-comment'>-- See https://github.com/haskell/cabal/issues/3606 for more</span>
<a name="line-30"></a>    <span class='hs-comment'>-- details.</span>
<a name="line-31"></a>
<a name="line-32"></a>    <span class='hs-varid'>componentNameTargets'</span><span class='hs-layout'>,</span>
<a name="line-33"></a>    <span class='hs-varid'>unitIdTarget'</span><span class='hs-layout'>,</span>
<a name="line-34"></a>    <span class='hs-varid'>allTargetsInBuildOrder'</span><span class='hs-layout'>,</span>
<a name="line-35"></a>    <span class='hs-varid'>withAllTargetsInBuildOrder'</span><span class='hs-layout'>,</span>
<a name="line-36"></a>    <span class='hs-varid'>neededTargetsInBuildOrder'</span><span class='hs-layout'>,</span>
<a name="line-37"></a>    <span class='hs-varid'>withNeededTargetsInBuildOrder'</span><span class='hs-layout'>,</span>
<a name="line-38"></a>    <span class='hs-varid'>testCoverage</span><span class='hs-layout'>,</span>
<a name="line-39"></a>
<a name="line-40"></a>    <span class='hs-comment'>-- * Functions you SHOULD NOT USE (yet), but are defined here to</span>
<a name="line-41"></a>    <span class='hs-comment'>-- prevent someone from accidentally defining them</span>
<a name="line-42"></a>
<a name="line-43"></a>    <span class='hs-varid'>componentNameTargets</span><span class='hs-layout'>,</span>
<a name="line-44"></a>    <span class='hs-varid'>unitIdTarget</span><span class='hs-layout'>,</span>
<a name="line-45"></a>    <span class='hs-varid'>allTargetsInBuildOrder</span><span class='hs-layout'>,</span>
<a name="line-46"></a>    <span class='hs-varid'>withAllTargetsInBuildOrder</span><span class='hs-layout'>,</span>
<a name="line-47"></a>    <span class='hs-varid'>neededTargetsInBuildOrder</span><span class='hs-layout'>,</span>
<a name="line-48"></a>    <span class='hs-varid'>withNeededTargetsInBuildOrder</span><span class='hs-layout'>,</span>
<a name="line-49"></a>
<a name="line-50"></a>    <span class='hs-comment'>-- * Backwards compatibility.</span>
<a name="line-51"></a>
<a name="line-52"></a>    <span class='hs-varid'>componentsConfigs</span><span class='hs-layout'>,</span>
<a name="line-53"></a>    <span class='hs-varid'>externalPackageDeps</span><span class='hs-layout'>,</span>
<a name="line-54"></a>  <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-55"></a>
<a name="line-56"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Prelude</span> <span class='hs-conid'>()</span>
<a name="line-57"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Compat</span><span class='hs-varop'>.</span><span class='hs-conid'>Prelude</span>
<a name="line-58"></a>
<a name="line-59"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span><span class='hs-varop'>.</span><span class='hs-conid'>PackageDescription</span>
<a name="line-60"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span><span class='hs-varop'>.</span><span class='hs-conid'>ComponentLocalBuildInfo</span>
<a name="line-61"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span><span class='hs-varop'>.</span><span class='hs-conid'>ComponentRequestedSpec</span>
<a name="line-62"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span><span class='hs-varop'>.</span><span class='hs-conid'>ComponentId</span>
<a name="line-63"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span><span class='hs-varop'>.</span><span class='hs-conid'>MungedPackageId</span>
<a name="line-64"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span><span class='hs-varop'>.</span><span class='hs-conid'>PackageId</span>
<a name="line-65"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span><span class='hs-varop'>.</span><span class='hs-conid'>UnitId</span>
<a name="line-66"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span><span class='hs-varop'>.</span><span class='hs-conid'>TargetInfo</span>
<a name="line-67"></a>
<a name="line-68"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Simple</span><span class='hs-varop'>.</span><span class='hs-conid'>InstallDirs</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-varid'>absoluteInstallDirs</span><span class='hs-layout'>,</span>
<a name="line-69"></a>                                               <span class='hs-varid'>prefixRelativeInstallDirs</span><span class='hs-layout'>,</span>
<a name="line-70"></a>                                               <span class='hs-varid'>substPathTemplate</span><span class='hs-layout'>,</span> <span class='hs-layout'>)</span>
<a name="line-71"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Simple</span><span class='hs-varop'>.</span><span class='hs-conid'>Program</span>
<a name="line-72"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>PackageDescription</span>
<a name="line-73"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Simple</span><span class='hs-varop'>.</span><span class='hs-conid'>Compiler</span>
<a name="line-74"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Simple</span><span class='hs-varop'>.</span><span class='hs-conid'>PackageIndex</span>
<a name="line-75"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Simple</span><span class='hs-varop'>.</span><span class='hs-conid'>Setup</span>
<a name="line-76"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span>
<a name="line-77"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>System</span>
<a name="line-78"></a>
<a name="line-79"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Compat</span><span class='hs-varop'>.</span><span class='hs-conid'>Graph</span> <span class='hs-layout'>(</span><span class='hs-conid'>Graph</span><span class='hs-layout'>)</span>
<a name="line-80"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Compat</span><span class='hs-varop'>.</span><span class='hs-conid'>Graph</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Graph</span>
<a name="line-81"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Map</span>
<a name="line-82"></a>
<a name="line-83"></a><a name="LocalBuildInfo"></a><span class='hs-comment'>-- | Data cached after configuration step.  See also</span>
<a name="line-84"></a><a name="LocalBuildInfo"></a><span class='hs-comment'>-- 'Distribution.Simple.Setup.ConfigFlags'.</span>
<a name="line-85"></a><a name="LocalBuildInfo"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-layout'>{</span>
<a name="line-86"></a>        <span class='hs-varid'>configFlags</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ConfigFlags</span><span class='hs-layout'>,</span>
<a name="line-87"></a>        <span class='hs-comment'>-- ^ Options passed to the configuration step.</span>
<a name="line-88"></a>        <span class='hs-comment'>-- Needed to re-run configuration when .cabal is out of date</span>
<a name="line-89"></a>        <span class='hs-varid'>flagAssignment</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FlagAssignment</span><span class='hs-layout'>,</span>
<a name="line-90"></a>        <span class='hs-comment'>-- ^ The final set of flags which were picked for this package</span>
<a name="line-91"></a>        <span class='hs-varid'>componentEnabledSpec</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ComponentRequestedSpec</span><span class='hs-layout'>,</span>
<a name="line-92"></a>        <span class='hs-comment'>-- ^ What components were enabled during configuration, and why.</span>
<a name="line-93"></a>        <span class='hs-varid'>extraConfigArgs</span>     <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>String</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-94"></a>        <span class='hs-comment'>-- ^ Extra args on the command line for the configuration step.</span>
<a name="line-95"></a>        <span class='hs-comment'>-- Needed to re-run configuration when .cabal is out of date</span>
<a name="line-96"></a>        <span class='hs-varid'>installDirTemplates</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>InstallDirTemplates</span><span class='hs-layout'>,</span>
<a name="line-97"></a>                <span class='hs-comment'>-- ^ The installation directories for the various different</span>
<a name="line-98"></a>                <span class='hs-comment'>-- kinds of files</span>
<a name="line-99"></a>        <span class='hs-comment'>--TODO: inplaceDirTemplates :: InstallDirs FilePath</span>
<a name="line-100"></a>        <span class='hs-varid'>compiler</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Compiler</span><span class='hs-layout'>,</span>
<a name="line-101"></a>                <span class='hs-comment'>-- ^ The compiler we're building with</span>
<a name="line-102"></a>        <span class='hs-varid'>hostPlatform</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Platform</span><span class='hs-layout'>,</span>
<a name="line-103"></a>                <span class='hs-comment'>-- ^ The platform we're building for</span>
<a name="line-104"></a>        <span class='hs-varid'>buildDir</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FilePath</span><span class='hs-layout'>,</span>
<a name="line-105"></a>                <span class='hs-comment'>-- ^ Where to build the package.</span>
<a name="line-106"></a>        <span class='hs-varid'>componentGraph</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Graph</span> <span class='hs-conid'>ComponentLocalBuildInfo</span><span class='hs-layout'>,</span>
<a name="line-107"></a>                <span class='hs-comment'>-- ^ All the components to build, ordered by topological</span>
<a name="line-108"></a>                <span class='hs-comment'>-- sort, and with their INTERNAL dependencies over the</span>
<a name="line-109"></a>                <span class='hs-comment'>-- intrapackage dependency graph.</span>
<a name="line-110"></a>                <span class='hs-comment'>-- TODO: this is assumed to be short; otherwise we want</span>
<a name="line-111"></a>                <span class='hs-comment'>-- some sort of ordered map.</span>
<a name="line-112"></a>        <span class='hs-varid'>componentNameMap</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Map</span> <span class='hs-conid'>ComponentName</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ComponentLocalBuildInfo</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>,</span>
<a name="line-113"></a>                <span class='hs-comment'>-- ^ A map from component name to all matching</span>
<a name="line-114"></a>                <span class='hs-comment'>-- components.  These coincide with 'componentGraph'</span>
<a name="line-115"></a>        <span class='hs-varid'>installedPkgs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>InstalledPackageIndex</span><span class='hs-layout'>,</span>
<a name="line-116"></a>                <span class='hs-comment'>-- ^ All the info about the installed packages that the</span>
<a name="line-117"></a>                <span class='hs-comment'>-- current package depends on (directly or indirectly).</span>
<a name="line-118"></a>                <span class='hs-comment'>-- The copy saved on disk does NOT include internal</span>
<a name="line-119"></a>                <span class='hs-comment'>-- dependencies (because we just don't have enough</span>
<a name="line-120"></a>                <span class='hs-comment'>-- information at this point to have an</span>
<a name="line-121"></a>                <span class='hs-comment'>-- 'InstalledPackageInfo' for an internal dep), but we</span>
<a name="line-122"></a>                <span class='hs-comment'>-- will often update it with the internal dependencies;</span>
<a name="line-123"></a>                <span class='hs-comment'>-- see for example 'Distribution.Simple.Build.build'.</span>
<a name="line-124"></a>                <span class='hs-comment'>-- (This admonition doesn't apply for per-component builds.)</span>
<a name="line-125"></a>        <span class='hs-varid'>pkgDescrFile</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span><span class='hs-layout'>,</span>
<a name="line-126"></a>                <span class='hs-comment'>-- ^ the filename containing the .cabal file, if available</span>
<a name="line-127"></a>        <span class='hs-varid'>localPkgDescr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PackageDescription</span><span class='hs-layout'>,</span>
<a name="line-128"></a>                <span class='hs-comment'>-- ^ WARNING WARNING WARNING Be VERY careful about using</span>
<a name="line-129"></a>                <span class='hs-comment'>-- this function; we haven't deprecated it but using it</span>
<a name="line-130"></a>                <span class='hs-comment'>-- could introduce subtle bugs related to</span>
<a name="line-131"></a>                <span class='hs-comment'>-- 'HookedBuildInfo'.</span>
<a name="line-132"></a>                <span class='hs-comment'>--</span>
<a name="line-133"></a>                <span class='hs-comment'>-- In principle, this is supposed to contain the</span>
<a name="line-134"></a>                <span class='hs-comment'>-- resolved package description, that does not contain</span>
<a name="line-135"></a>                <span class='hs-comment'>-- any conditionals.  However, it MAY NOT contain</span>
<a name="line-136"></a>                <span class='hs-comment'>-- the description wtih a 'HookedBuildInfo' applied</span>
<a name="line-137"></a>                <span class='hs-comment'>-- to it; see 'HookedBuildInfo' for the whole sordid saga.</span>
<a name="line-138"></a>                <span class='hs-comment'>-- As much as possible, Cabal library should avoid using</span>
<a name="line-139"></a>                <span class='hs-comment'>-- this parameter.</span>
<a name="line-140"></a>        <span class='hs-varid'>withPrograms</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ProgramDb</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- ^Location and args for all programs</span>
<a name="line-141"></a>        <span class='hs-varid'>withPackageDB</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PackageDBStack</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- ^What package database to use, global\/user</span>
<a name="line-142"></a>        <span class='hs-varid'>withVanillaLib</span><span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- ^Whether to build normal libs.</span>
<a name="line-143"></a>        <span class='hs-varid'>withProfLib</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- ^Whether to build profiling versions of libs.</span>
<a name="line-144"></a>        <span class='hs-varid'>withSharedLib</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- ^Whether to build shared versions of libs.</span>
<a name="line-145"></a>        <span class='hs-varid'>withDynExe</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- ^Whether to link executables dynamically</span>
<a name="line-146"></a>        <span class='hs-varid'>withProfExe</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- ^Whether to build executables for profiling.</span>
<a name="line-147"></a>        <span class='hs-varid'>withProfLibDetail</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ProfDetailLevel</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- ^Level of automatic profile detail.</span>
<a name="line-148"></a>        <span class='hs-varid'>withProfExeDetail</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ProfDetailLevel</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- ^Level of automatic profile detail.</span>
<a name="line-149"></a>        <span class='hs-varid'>withOptimization</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>OptimisationLevel</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- ^Whether to build with optimization (if available).</span>
<a name="line-150"></a>        <span class='hs-varid'>withDebugInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DebugInfoLevel</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- ^Whether to emit debug info (if available).</span>
<a name="line-151"></a>        <span class='hs-varid'>withGHCiLib</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- ^Whether to build libs suitable for use with GHCi.</span>
<a name="line-152"></a>        <span class='hs-varid'>splitObjs</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- ^Use -split-objs with GHC, if available</span>
<a name="line-153"></a>        <span class='hs-varid'>stripExes</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- ^Whether to strip executables during install</span>
<a name="line-154"></a>        <span class='hs-varid'>stripLibs</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- ^Whether to strip libraries during install</span>
<a name="line-155"></a>        <span class='hs-varid'>exeCoverage</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- ^Whether to enable executable program coverage</span>
<a name="line-156"></a>        <span class='hs-varid'>libCoverage</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span><span class='hs-layout'>,</span>  <span class='hs-comment'>-- ^Whether to enable library program coverage</span>
<a name="line-157"></a>        <span class='hs-varid'>progPrefix</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PathTemplate</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- ^Prefix to be prepended to installed executables</span>
<a name="line-158"></a>        <span class='hs-varid'>progSuffix</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PathTemplate</span><span class='hs-layout'>,</span> <span class='hs-comment'>-- ^Suffix to be appended to installed executables</span>
<a name="line-159"></a>        <span class='hs-varid'>relocatable</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span> <span class='hs-comment'>--  ^Whether to build a relocatable package</span>
<a name="line-160"></a>  <span class='hs-layout'>}</span> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Generic</span><span class='hs-layout'>,</span> <span class='hs-conid'>Read</span><span class='hs-layout'>,</span> <span class='hs-conid'>Show</span><span class='hs-layout'>)</span>
<a name="line-161"></a>
<a name="line-162"></a><a name="instance%20Binary%20LocalBuildInfo%20-------------------------------------------------------------------------------%20--%20Accessor%20functions%20--%20TODO:%20Get%20rid%20of%20these%20functions,%20as%20much%20as%20possible.%20They%20are%20--%20a%20bit%20useful%20in%20some%20cases,%20but%20you%20should%20be%20very%20careful!%20--%20%7c%20Extract%20the%20'ComponentId'%20from%20the%20public%20library%20component%20of%20a%20--%20'LocalBuildInfo'%20if%20it%20exists,%20or%20make%20a%20fake%20component%20ID%20based%20--%20on%20the%20package%20ID.%20localComponentId%20::%20LocalBuildInfo%20-%3e%20ComponentId%20localComponentId%20lbi%20=%20case%20componentNameCLBIs%20lbi%20CLibName%20of%20%5bLibComponentLocalBuildInfo%20%7b%20componentComponentId%20=%20cid%20%7d%5d%20-%3e%20cid%20_%20-%3e%20mkComponentId%20(display%20(localPackage%20lbi))%20--%20%7c%20Extract%20the%20'PackageIdentifier'%20of%20a%20'LocalBuildInfo'.%20--%20This%20is%20a%20%22safe%22%20use%20of%20'localPkgDescr'%20localPackage%20::%20LocalBuildInfo%20-%3e%20PackageId%20localPackage%20lbi%20=%20package%20(localPkgDescr%20lbi)%20--%20%7c%20Extract%20the%20'UnitId'%20from%20the%20library%20component%20of%20a%20--%20'LocalBuildInfo'%20if%20it%20exists,%20or%20make%20a%20fake%20unit%20ID%20based%20on%20--%20the%20package%20ID.%20localUnitId%20::%20LocalBuildInfo%20-%3e%20UnitId%20localUnitId%20lbi%20=%20case%20componentNameCLBIs%20lbi%20CLibName%20of%20%5bLibComponentLocalBuildInfo%20%7b%20componentUnitId%20=%20uid%20%7d%5d%20-%3e%20uid%20_%20-%3e%20mkLegacyUnitId%20$%20localPackage%20lbi%20--%20%7c%20Extract%20the%20compatibility%20package%20key%20from%20the%20public%20library%20component%20of%20a%20--%20'LocalBuildInfo'%20if%20it%20exists,%20or%20make%20a%20fake%20package%20key%20based%20--%20on%20the%20package%20ID.%20localCompatPackageKey%20::%20LocalBuildInfo%20-%3e%20String%20localCompatPackageKey%20lbi%20=%20case%20componentNameCLBIs%20lbi%20CLibName%20of%20%5bLibComponentLocalBuildInfo%20%7b%20componentCompatPackageKey%20=%20pk%20%7d%5d%20-%3e%20pk%20_%20-%3e%20display%20(localPackage%20lbi)%20--%20%7c%20Convenience%20function%20to%20generate%20a%20default%20'TargetInfo'%20from%20a%20--%20'ComponentLocalBuildInfo'.%20The%20idea%20is%20to%20call%20this%20once,%20and%20then%20--%20use%20'TargetInfo'%20everywhere%20else.%20Private%20to%20this%20module.%20mkTargetInfo%20::%20PackageDescription%20-%3e%20LocalBuildInfo%20-%3e%20ComponentLocalBuildInfo%20-%3e%20TargetInfo%20mkTargetInfo%20pkg_descr%20_lbi%20clbi%20=%20TargetInfo%20%7b%20targetCLBI%20=%20clbi,%20--%20NB:%20@pkg_descr@,%20not%20@localPkgDescr%20lbi@!%20targetComponent%20=%20getComponent%20pkg_descr%20(componentLocalName%20clbi)%20%7d%20--%20%7c%20Return%20all%20'TargetInfo's%20associated%20with%20'ComponentName'.%20--%20In%20the%20presence%20of%20Backpack%20there%20may%20be%20more%20than%20one!%20--%20Has%20a%20prime%20because%20it%20takes%20a%20'PackageDescription'%20argument%20--%20which%20may%20disagree%20with%20'localPkgDescr'%20in%20'LocalBuildInfo'.%20componentNameTargets'%20::%20PackageDescription%20-%3e%20LocalBuildInfo%20-%3e%20ComponentName%20-%3e%20%5bTargetInfo%5d%20componentNameTargets'%20pkg_descr%20lbi%20cname%20=%20case%20Map.lookup%20cname%20(componentNameMap%20lbi)%20of%20Just%20clbis%20-%3e%20map%20(mkTargetInfo%20pkg_descr%20lbi)%20clbis%20Nothing%20-%3e%20%5b%5d%20unitIdTarget'%20::%20PackageDescription%20-%3e%20LocalBuildInfo%20-%3e%20UnitId%20-%3e%20Maybe%20TargetInfo%20unitIdTarget'%20pkg_descr%20lbi%20uid%20=%20case%20Graph.lookup%20uid%20(componentGraph%20lbi)%20of%20Just%20clbi%20-%3e%20Just%20(mkTargetInfo%20pkg_descr%20lbi%20clbi)%20Nothing%20-%3e%20Nothing%20--%20%7c%20Return%20all%20'ComponentLocalBuildInfo's%20associated%20with%20'ComponentName'.%20--%20In%20the%20presence%20of%20Backpack%20there%20may%20be%20more%20than%20one!%20componentNameCLBIs%20::%20LocalBuildInfo%20-%3e%20ComponentName%20-%3e%20%5bComponentLocalBuildInfo%5d%20componentNameCLBIs%20lbi%20cname%20=%20case%20Map.lookup%20cname%20(componentNameMap%20lbi)%20of%20Just%20clbis%20-%3e%20clbis%20Nothing%20-%3e%20%5b%5d%20--%20TODO:%20Maybe%20cache%20topsort%20(Graph%20can%20do%20this)%20--%20%7c%20Return%20the%20list%20of%20default%20'TargetInfo's%20associated%20with%20a%20--%20configured%20package,%20in%20the%20order%20they%20need%20to%20be%20built.%20--%20Has%20a%20prime%20because%20it%20takes%20a%20'PackageDescription'%20argument%20--%20which%20may%20disagree%20with%20'localPkgDescr'%20in%20'LocalBuildInfo'.%20allTargetsInBuildOrder'%20::%20PackageDescription%20-%3e%20LocalBuildInfo%20-%3e%20%5bTargetInfo%5d%20allTargetsInBuildOrder'%20pkg_descr%20lbi%20=%20map%20(mkTargetInfo%20pkg_descr%20lbi)%20(Graph.revTopSort%20(componentGraph%20lbi))%20--%20%7c%20Execute%20@f@%20for%20every%20'TargetInfo'%20in%20the%20package,%20respecting%20the%20--%20build%20dependency%20order.%20(TODO:%20We%20should%20use%20Shake!)%20--%20Has%20a%20prime%20because%20it%20takes%20a%20'PackageDescription'%20argument%20--%20which%20may%20disagree%20with%20'localPkgDescr'%20in%20'LocalBuildInfo'.%20withAllTargetsInBuildOrder'%20::%20PackageDescription%20-%3e%20LocalBuildInfo%20-%3e%20(TargetInfo%20-%3e%20IO%20())%20-%3e%20IO%20()%20withAllTargetsInBuildOrder'%20pkg_descr%20lbi%20f%20=%20sequence_%20%5b%20f%20target%20%7c%20target%20%3c-%20allTargetsInBuildOrder'%20pkg_descr%20lbi%20%5d%20--%20%7c%20Return%20the%20list%20of%20all%20targets%20needed%20to%20build%20the%20@uids@,%20in%20--%20the%20order%20they%20need%20to%20be%20built.%20--%20Has%20a%20prime%20because%20it%20takes%20a%20'PackageDescription'%20argument%20--%20which%20may%20disagree%20with%20'localPkgDescr'%20in%20'LocalBuildInfo'.%20neededTargetsInBuildOrder'%20::%20PackageDescription%20-%3e%20LocalBuildInfo%20-%3e%20%5bUnitId%5d%20-%3e%20%5bTargetInfo%5d%20neededTargetsInBuildOrder'%20pkg_descr%20lbi%20uids%20=%20case%20Graph.closure%20(componentGraph%20lbi)%20uids%20of%20Nothing%20-%3e%20error%20$%20%22localBuildPlan:%20missing%20uids%20%22%20++%20intercalate%20%22,%20%22%20(map%20display%20uids)%20Just%20clos%20-%3e%20map%20(mkTargetInfo%20pkg_descr%20lbi)%20(Graph.revTopSort%20(Graph.fromDistinctList%20clos))%20--%20%7c%20Execute%20@f@%20for%20every%20'TargetInfo'%20needed%20to%20build%20@uid@s,%20respecting%20--%20the%20build%20dependency%20order.%20--%20Has%20a%20prime%20because%20it%20takes%20a%20'PackageDescription'%20argument%20--%20which%20may%20disagree%20with%20'localPkgDescr'%20in%20'LocalBuildInfo'.%20withNeededTargetsInBuildOrder'%20::%20PackageDescription%20-%3e%20LocalBuildInfo%20-%3e%20%5bUnitId%5d%20-%3e%20(TargetInfo%20-%3e%20IO%20())%20-%3e%20IO%20()%20withNeededTargetsInBuildOrder'%20pkg_descr%20lbi%20uids%20f%20=%20sequence_%20%5b%20f%20target%20%7c%20target%20%3c-%20neededTargetsInBuildOrder'%20pkg_descr%20lbi%20uids%20%5d%20--%20%7c%20Is%20coverage%20enabled%20for%20test%20suites?%20In%20practice,%20this%20requires%20library%20--%20and%20executable%20profiling%20to%20be%20enabled.%20testCoverage%20::%20LocalBuildInfo%20-%3e%20Bool%20testCoverage%20lbi%20=%20exeCoverage%20lbi%20&&%20libCoverage%20lbi%20-------------------------------------------------------------------------------%20--%20Stub%20functions%20to%20prevent%20someone%20from%20accidentally%20defining%20them%20%7b-%23%20WARNING%20componentNameTargets,%20unitIdTarget,%20allTargetsInBuildOrder,%20withAllTargetsInBuildOrder,%20neededTargetsInBuildOrder,%20withNeededTargetsInBuildOrder%20%22By%20using%20this%20function,%20you%20may%20be%20introducing%20a%20bug%20where%20you%20retrieve%20a%20'Component'%20which%20does%20not%20have%20'HookedBuildInfo'%20applied%20to%20it.%20See%20the%20documentation%20for%20'HookedBuildInfo'%20for%20an%20explanation%20of%20the%20issue.%20If%20you%20have%20a%20'PakcageDescription'%20handy%20(NOT%20from%20the%20'LocalBuildInfo'),%20try%20using%20the%20primed%20version%20of%20the%20function,%20which%20takes%20it%20as%20an%20extra%20argument.%22%20%23-%7d%20componentNameTargets%20::%20LocalBuildInfo%20-%3e%20ComponentName%20-%3e%20%5bTargetInfo%5d%20componentNameTargets%20lbi%20=%20componentNameTargets'%20(localPkgDescr%20lbi)%20lbi%20unitIdTarget%20::%20LocalBuildInfo%20-%3e%20UnitId%20-%3e%20Maybe%20TargetInfo%20unitIdTarget%20lbi%20=%20unitIdTarget'%20(localPkgDescr%20lbi)%20lbi%20allTargetsInBuildOrder%20::%20LocalBuildInfo%20-%3e%20%5bTargetInfo%5d%20allTargetsInBuildOrder%20lbi%20=%20allTargetsInBuildOrder'%20(localPkgDescr%20lbi)%20lbi%20withAllTargetsInBuildOrder%20::%20LocalBuildInfo%20-%3e%20(TargetInfo%20-%3e%20IO%20())%20-%3e%20IO%20()%20withAllTargetsInBuildOrder%20lbi%20=%20withAllTargetsInBuildOrder'%20(localPkgDescr%20lbi)%20lbi%20neededTargetsInBuildOrder%20::%20LocalBuildInfo%20-%3e%20%5bUnitId%5d%20-%3e%20%5bTargetInfo%5d%20neededTargetsInBuildOrder%20lbi%20=%20neededTargetsInBuildOrder'%20(localPkgDescr%20lbi)%20lbi%20withNeededTargetsInBuildOrder%20::%20LocalBuildInfo%20-%3e%20%5bUnitId%5d%20-%3e%20(TargetInfo%20-%3e%20IO%20())%20-%3e%20IO%20()%20withNeededTargetsInBuildOrder%20lbi%20=%20withNeededTargetsInBuildOrder'%20(localPkgDescr%20lbi)%20lbi%20-------------------------------------------------------------------------------%20--%20Backwards%20compatibility%20%7b-%23%20DEPRECATED%20componentsConfigs%20%22Use%20'componentGraph'%20instead;%20you%20can%20get%20a%20list%20of%20'ComponentLocalBuildInfo'%20with%20'Distribution.Compat.Graph.toList'.%20There's%20not%20a%20good%20way%20to%20get%20the%20list%20of%20'ComponentName's%20the%20'ComponentLocalBuildInfo'%20depends%20on%20because%20this%20query%20doesn't%20make%20sense;%20the%20graph%20is%20indexed%20by%20'UnitId'%20not%20'ComponentName'.%20Given%20a%20'UnitId'%20you%20can%20lookup%20the%20'ComponentLocalBuildInfo'%20('getCLBI')%20and%20then%20get%20the%20'ComponentName'%20('componentLocalName%5d).%20To%20be%20removed%20in%20Cabal%202.2%22%20%23-%7d%20componentsConfigs%20::%20LocalBuildInfo%20-%3e%20%5b(ComponentName,%20ComponentLocalBuildInfo,%20%5bComponentName%5d)%5d%20componentsConfigs%20lbi%20=%20%5b%20(componentLocalName%20clbi,%20clbi,%20mapMaybe%20(fmap%20componentLocalName%20.%20flip%20Graph.lookup%20g)%20(componentInternalDeps%20clbi))%20%7c%20clbi%20%3c-%20Graph.toList%20g%20%5d"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Binary</span> <span class='hs-conid'>LocalBuildInfo</span>
<a name="line-163"></a>
<a name="line-164"></a><span class='hs-comment'>-------------------------------------------------------------------------------</span>
<a name="line-165"></a><span class='hs-comment'>-- Accessor functions</span>
<a name="line-166"></a>
<a name="line-167"></a><span class='hs-comment'>-- TODO: Get rid of these functions, as much as possible.  They are</span>
<a name="line-168"></a><span class='hs-comment'>-- a bit useful in some cases, but you should be very careful!</span>
<a name="line-169"></a>
<a name="line-170"></a><a name="localComponentId"></a><span class='hs-comment'>-- | Extract the 'ComponentId' from the public library component of a</span>
<a name="line-171"></a><span class='hs-comment'>-- 'LocalBuildInfo' if it exists, or make a fake component ID based</span>
<a name="line-172"></a><span class='hs-comment'>-- on the package ID.</span>
<a name="line-173"></a><span class='hs-definition'>localComponentId</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ComponentId</span>
<a name="line-174"></a><span class='hs-definition'>localComponentId</span> <span class='hs-varid'>lbi</span> <span class='hs-keyglyph'>=</span>
<a name="line-175"></a>    <span class='hs-keyword'>case</span> <span class='hs-varid'>componentNameCLBIs</span> <span class='hs-varid'>lbi</span> <span class='hs-conid'>CLibName</span> <span class='hs-keyword'>of</span>
<a name="line-176"></a>        <span class='hs-keyglyph'>[</span><span class='hs-conid'>LibComponentLocalBuildInfo</span> <span class='hs-layout'>{</span> <span class='hs-varid'>componentComponentId</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>cid</span> <span class='hs-layout'>}</span><span class='hs-keyglyph'>]</span>
<a name="line-177"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>cid</span>
<a name="line-178"></a>        <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mkComponentId</span> <span class='hs-layout'>(</span><span class='hs-varid'>display</span> <span class='hs-layout'>(</span><span class='hs-varid'>localPackage</span> <span class='hs-varid'>lbi</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-179"></a>
<a name="line-180"></a><a name="localPackage"></a><span class='hs-comment'>-- | Extract the 'PackageIdentifier' of a 'LocalBuildInfo'.</span>
<a name="line-181"></a><span class='hs-comment'>-- This is a "safe" use of 'localPkgDescr'</span>
<a name="line-182"></a><span class='hs-definition'>localPackage</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PackageId</span>
<a name="line-183"></a><span class='hs-definition'>localPackage</span> <span class='hs-varid'>lbi</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>package</span> <span class='hs-layout'>(</span><span class='hs-varid'>localPkgDescr</span> <span class='hs-varid'>lbi</span><span class='hs-layout'>)</span>
<a name="line-184"></a>
<a name="line-185"></a><a name="localUnitId"></a><span class='hs-comment'>-- | Extract the 'UnitId' from the library component of a</span>
<a name="line-186"></a><span class='hs-comment'>-- 'LocalBuildInfo' if it exists, or make a fake unit ID based on</span>
<a name="line-187"></a><span class='hs-comment'>-- the package ID.</span>
<a name="line-188"></a><span class='hs-definition'>localUnitId</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>UnitId</span>
<a name="line-189"></a><span class='hs-definition'>localUnitId</span> <span class='hs-varid'>lbi</span> <span class='hs-keyglyph'>=</span>
<a name="line-190"></a>    <span class='hs-keyword'>case</span> <span class='hs-varid'>componentNameCLBIs</span> <span class='hs-varid'>lbi</span> <span class='hs-conid'>CLibName</span> <span class='hs-keyword'>of</span>
<a name="line-191"></a>        <span class='hs-keyglyph'>[</span><span class='hs-conid'>LibComponentLocalBuildInfo</span> <span class='hs-layout'>{</span> <span class='hs-varid'>componentUnitId</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>uid</span> <span class='hs-layout'>}</span><span class='hs-keyglyph'>]</span>
<a name="line-192"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>uid</span>
<a name="line-193"></a>        <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mkLegacyUnitId</span> <span class='hs-varop'>$</span> <span class='hs-varid'>localPackage</span> <span class='hs-varid'>lbi</span>
<a name="line-194"></a>
<a name="line-195"></a><a name="localCompatPackageKey"></a><span class='hs-comment'>-- | Extract the compatibility package key from the public library component of a</span>
<a name="line-196"></a><span class='hs-comment'>-- 'LocalBuildInfo' if it exists, or make a fake package key based</span>
<a name="line-197"></a><span class='hs-comment'>-- on the package ID.</span>
<a name="line-198"></a><span class='hs-definition'>localCompatPackageKey</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-199"></a><span class='hs-definition'>localCompatPackageKey</span> <span class='hs-varid'>lbi</span> <span class='hs-keyglyph'>=</span>
<a name="line-200"></a>    <span class='hs-keyword'>case</span> <span class='hs-varid'>componentNameCLBIs</span> <span class='hs-varid'>lbi</span> <span class='hs-conid'>CLibName</span> <span class='hs-keyword'>of</span>
<a name="line-201"></a>        <span class='hs-keyglyph'>[</span><span class='hs-conid'>LibComponentLocalBuildInfo</span> <span class='hs-layout'>{</span> <span class='hs-varid'>componentCompatPackageKey</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pk</span> <span class='hs-layout'>}</span><span class='hs-keyglyph'>]</span>
<a name="line-202"></a>          <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pk</span>
<a name="line-203"></a>        <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>display</span> <span class='hs-layout'>(</span><span class='hs-varid'>localPackage</span> <span class='hs-varid'>lbi</span><span class='hs-layout'>)</span>
<a name="line-204"></a>
<a name="line-205"></a><a name="mkTargetInfo"></a><span class='hs-comment'>-- | Convenience function to generate a default 'TargetInfo' from a</span>
<a name="line-206"></a><span class='hs-comment'>-- 'ComponentLocalBuildInfo'.  The idea is to call this once, and then</span>
<a name="line-207"></a><span class='hs-comment'>-- use 'TargetInfo' everywhere else.  Private to this module.</span>
<a name="line-208"></a><span class='hs-definition'>mkTargetInfo</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PackageDescription</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ComponentLocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TargetInfo</span>
<a name="line-209"></a><span class='hs-definition'>mkTargetInfo</span> <span class='hs-varid'>pkg_descr</span> <span class='hs-sel'>_lbi</span> <span class='hs-varid'>clbi</span> <span class='hs-keyglyph'>=</span>
<a name="line-210"></a>    <span class='hs-conid'>TargetInfo</span> <span class='hs-layout'>{</span>
<a name="line-211"></a>        <span class='hs-varid'>targetCLBI</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>clbi</span><span class='hs-layout'>,</span>
<a name="line-212"></a>        <span class='hs-comment'>-- NB: @pkg_descr@, not @localPkgDescr lbi@!</span>
<a name="line-213"></a>        <span class='hs-varid'>targetComponent</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getComponent</span> <span class='hs-varid'>pkg_descr</span>
<a name="line-214"></a>                                       <span class='hs-layout'>(</span><span class='hs-varid'>componentLocalName</span> <span class='hs-varid'>clbi</span><span class='hs-layout'>)</span>
<a name="line-215"></a>     <span class='hs-layout'>}</span>
<a name="line-216"></a>
<a name="line-217"></a><a name="componentNameTargets'"></a><span class='hs-comment'>-- | Return all 'TargetInfo's associated with 'ComponentName'.</span>
<a name="line-218"></a><span class='hs-comment'>-- In the presence of Backpack there may be more than one!</span>
<a name="line-219"></a><span class='hs-comment'>-- Has a prime because it takes a 'PackageDescription' argument</span>
<a name="line-220"></a><span class='hs-comment'>-- which may disagree with 'localPkgDescr' in 'LocalBuildInfo'.</span>
<a name="line-221"></a><span class='hs-definition'>componentNameTargets'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PackageDescription</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ComponentName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TargetInfo</span><span class='hs-keyglyph'>]</span>
<a name="line-222"></a><span class='hs-definition'>componentNameTargets'</span> <span class='hs-varid'>pkg_descr</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>cname</span> <span class='hs-keyglyph'>=</span>
<a name="line-223"></a>    <span class='hs-keyword'>case</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>lookup</span> <span class='hs-varid'>cname</span> <span class='hs-layout'>(</span><span class='hs-varid'>componentNameMap</span> <span class='hs-varid'>lbi</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
<a name="line-224"></a>        <span class='hs-conid'>Just</span> <span class='hs-varid'>clbis</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkTargetInfo</span> <span class='hs-varid'>pkg_descr</span> <span class='hs-varid'>lbi</span><span class='hs-layout'>)</span> <span class='hs-varid'>clbis</span>
<a name="line-225"></a>        <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>[]</span>
<a name="line-226"></a>
<a name="line-227"></a><a name="unitIdTarget'"></a><span class='hs-definition'>unitIdTarget'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PackageDescription</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>UnitId</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>TargetInfo</span>
<a name="line-228"></a><span class='hs-definition'>unitIdTarget'</span> <span class='hs-varid'>pkg_descr</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>uid</span> <span class='hs-keyglyph'>=</span>
<a name="line-229"></a>    <span class='hs-keyword'>case</span> <span class='hs-conid'>Graph</span><span class='hs-varop'>.</span><span class='hs-varid'>lookup</span> <span class='hs-varid'>uid</span> <span class='hs-layout'>(</span><span class='hs-varid'>componentGraph</span> <span class='hs-varid'>lbi</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
<a name="line-230"></a>        <span class='hs-conid'>Just</span> <span class='hs-varid'>clbi</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkTargetInfo</span> <span class='hs-varid'>pkg_descr</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>clbi</span><span class='hs-layout'>)</span>
<a name="line-231"></a>        <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<a name="line-232"></a>
<a name="line-233"></a><a name="componentNameCLBIs"></a><span class='hs-comment'>-- | Return all 'ComponentLocalBuildInfo's associated with 'ComponentName'.</span>
<a name="line-234"></a><span class='hs-comment'>-- In the presence of Backpack there may be more than one!</span>
<a name="line-235"></a><span class='hs-definition'>componentNameCLBIs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ComponentName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ComponentLocalBuildInfo</span><span class='hs-keyglyph'>]</span>
<a name="line-236"></a><span class='hs-definition'>componentNameCLBIs</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>cname</span> <span class='hs-keyglyph'>=</span>
<a name="line-237"></a>    <span class='hs-keyword'>case</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>lookup</span> <span class='hs-varid'>cname</span> <span class='hs-layout'>(</span><span class='hs-varid'>componentNameMap</span> <span class='hs-varid'>lbi</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
<a name="line-238"></a>        <span class='hs-conid'>Just</span> <span class='hs-varid'>clbis</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>clbis</span>
<a name="line-239"></a>        <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>[]</span>
<a name="line-240"></a>
<a name="line-241"></a><span class='hs-comment'>-- TODO: Maybe cache topsort (Graph can do this)</span>
<a name="line-242"></a>
<a name="line-243"></a><a name="allTargetsInBuildOrder'"></a><span class='hs-comment'>-- | Return the list of default 'TargetInfo's associated with a</span>
<a name="line-244"></a><span class='hs-comment'>-- configured package, in the order they need to be built.</span>
<a name="line-245"></a><span class='hs-comment'>-- Has a prime because it takes a 'PackageDescription' argument</span>
<a name="line-246"></a><span class='hs-comment'>-- which may disagree with 'localPkgDescr' in 'LocalBuildInfo'.</span>
<a name="line-247"></a><span class='hs-definition'>allTargetsInBuildOrder'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PackageDescription</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TargetInfo</span><span class='hs-keyglyph'>]</span>
<a name="line-248"></a><span class='hs-definition'>allTargetsInBuildOrder'</span> <span class='hs-varid'>pkg_descr</span> <span class='hs-varid'>lbi</span>
<a name="line-249"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkTargetInfo</span> <span class='hs-varid'>pkg_descr</span> <span class='hs-varid'>lbi</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Graph</span><span class='hs-varop'>.</span><span class='hs-varid'>revTopSort</span> <span class='hs-layout'>(</span><span class='hs-varid'>componentGraph</span> <span class='hs-varid'>lbi</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-250"></a>
<a name="line-251"></a><a name="withAllTargetsInBuildOrder'"></a><span class='hs-comment'>-- | Execute @f@ for every 'TargetInfo' in the package, respecting the</span>
<a name="line-252"></a><span class='hs-comment'>-- build dependency order.  (TODO: We should use Shake!)</span>
<a name="line-253"></a><span class='hs-comment'>-- Has a prime because it takes a 'PackageDescription' argument</span>
<a name="line-254"></a><span class='hs-comment'>-- which may disagree with 'localPkgDescr' in 'LocalBuildInfo'.</span>
<a name="line-255"></a><span class='hs-definition'>withAllTargetsInBuildOrder'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PackageDescription</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>TargetInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-256"></a><span class='hs-definition'>withAllTargetsInBuildOrder'</span> <span class='hs-varid'>pkg_descr</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>f</span>
<a name="line-257"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sequence_</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>f</span> <span class='hs-varid'>target</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>target</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>allTargetsInBuildOrder'</span> <span class='hs-varid'>pkg_descr</span> <span class='hs-varid'>lbi</span> <span class='hs-keyglyph'>]</span>
<a name="line-258"></a>
<a name="line-259"></a><a name="neededTargetsInBuildOrder'"></a><span class='hs-comment'>-- | Return the list of all targets needed to build the @uids@, in</span>
<a name="line-260"></a><span class='hs-comment'>-- the order they need to be built.</span>
<a name="line-261"></a><span class='hs-comment'>-- Has a prime because it takes a 'PackageDescription' argument</span>
<a name="line-262"></a><span class='hs-comment'>-- which may disagree with 'localPkgDescr' in 'LocalBuildInfo'.</span>
<a name="line-263"></a><span class='hs-definition'>neededTargetsInBuildOrder'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PackageDescription</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>UnitId</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TargetInfo</span><span class='hs-keyglyph'>]</span>
<a name="line-264"></a><span class='hs-definition'>neededTargetsInBuildOrder'</span> <span class='hs-varid'>pkg_descr</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>uids</span> <span class='hs-keyglyph'>=</span>
<a name="line-265"></a>  <span class='hs-keyword'>case</span> <span class='hs-conid'>Graph</span><span class='hs-varop'>.</span><span class='hs-varid'>closure</span> <span class='hs-layout'>(</span><span class='hs-varid'>componentGraph</span> <span class='hs-varid'>lbi</span><span class='hs-layout'>)</span> <span class='hs-varid'>uids</span> <span class='hs-keyword'>of</span>
<a name="line-266"></a>    <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>error</span> <span class='hs-varop'>$</span> <span class='hs-str'>"localBuildPlan: missing uids "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>intercalate</span> <span class='hs-str'>", "</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>display</span> <span class='hs-varid'>uids</span><span class='hs-layout'>)</span>
<a name="line-267"></a>    <span class='hs-conid'>Just</span> <span class='hs-varid'>clos</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>mkTargetInfo</span> <span class='hs-varid'>pkg_descr</span> <span class='hs-varid'>lbi</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Graph</span><span class='hs-varop'>.</span><span class='hs-varid'>revTopSort</span> <span class='hs-layout'>(</span><span class='hs-conid'>Graph</span><span class='hs-varop'>.</span><span class='hs-varid'>fromDistinctList</span> <span class='hs-varid'>clos</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-268"></a>
<a name="line-269"></a><a name="withNeededTargetsInBuildOrder'"></a><span class='hs-comment'>-- | Execute @f@ for every 'TargetInfo' needed to build @uid@s, respecting</span>
<a name="line-270"></a><span class='hs-comment'>-- the build dependency order.</span>
<a name="line-271"></a><span class='hs-comment'>-- Has a prime because it takes a 'PackageDescription' argument</span>
<a name="line-272"></a><span class='hs-comment'>-- which may disagree with 'localPkgDescr' in 'LocalBuildInfo'.</span>
<a name="line-273"></a><span class='hs-definition'>withNeededTargetsInBuildOrder'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PackageDescription</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>UnitId</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>TargetInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-274"></a><span class='hs-definition'>withNeededTargetsInBuildOrder'</span> <span class='hs-varid'>pkg_descr</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>uids</span> <span class='hs-varid'>f</span>
<a name="line-275"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sequence_</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>f</span> <span class='hs-varid'>target</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>target</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>neededTargetsInBuildOrder'</span> <span class='hs-varid'>pkg_descr</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>uids</span> <span class='hs-keyglyph'>]</span>
<a name="line-276"></a>
<a name="line-277"></a><a name="testCoverage"></a><span class='hs-comment'>-- | Is coverage enabled for test suites? In practice, this requires library</span>
<a name="line-278"></a><span class='hs-comment'>-- and executable profiling to be enabled.</span>
<a name="line-279"></a><span class='hs-definition'>testCoverage</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-280"></a><span class='hs-definition'>testCoverage</span> <span class='hs-varid'>lbi</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>exeCoverage</span> <span class='hs-varid'>lbi</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>libCoverage</span> <span class='hs-varid'>lbi</span>
<a name="line-281"></a>
<a name="line-282"></a><span class='hs-comment'>-------------------------------------------------------------------------------</span>
<a name="line-283"></a><span class='hs-comment'>-- Stub functions to prevent someone from accidentally defining them</span>
<a name="line-284"></a>
<a name="line-285"></a><span class='hs-comment'>{-# WARNING componentNameTargets, unitIdTarget, allTargetsInBuildOrder, withAllTargetsInBuildOrder, neededTargetsInBuildOrder, withNeededTargetsInBuildOrder "By using this function, you may be introducing a bug where you retrieve a 'Component' which does not have 'HookedBuildInfo' applied to it.  See the documentation for 'HookedBuildInfo' for an explanation of the issue.  If you have a 'PakcageDescription' handy (NOT from the 'LocalBuildInfo'), try using the primed version of the function, which takes it as an extra argument." #-}</span>
<a name="line-286"></a>
<a name="line-287"></a><a name="componentNameTargets"></a><span class='hs-definition'>componentNameTargets</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ComponentName</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TargetInfo</span><span class='hs-keyglyph'>]</span>
<a name="line-288"></a><span class='hs-definition'>componentNameTargets</span> <span class='hs-varid'>lbi</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>componentNameTargets'</span> <span class='hs-layout'>(</span><span class='hs-varid'>localPkgDescr</span> <span class='hs-varid'>lbi</span><span class='hs-layout'>)</span> <span class='hs-varid'>lbi</span>
<a name="line-289"></a>
<a name="line-290"></a><a name="unitIdTarget"></a><span class='hs-definition'>unitIdTarget</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>UnitId</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>TargetInfo</span>
<a name="line-291"></a><span class='hs-definition'>unitIdTarget</span> <span class='hs-varid'>lbi</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unitIdTarget'</span> <span class='hs-layout'>(</span><span class='hs-varid'>localPkgDescr</span> <span class='hs-varid'>lbi</span><span class='hs-layout'>)</span> <span class='hs-varid'>lbi</span>
<a name="line-292"></a>
<a name="line-293"></a><a name="allTargetsInBuildOrder"></a><span class='hs-definition'>allTargetsInBuildOrder</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TargetInfo</span><span class='hs-keyglyph'>]</span>
<a name="line-294"></a><span class='hs-definition'>allTargetsInBuildOrder</span> <span class='hs-varid'>lbi</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>allTargetsInBuildOrder'</span> <span class='hs-layout'>(</span><span class='hs-varid'>localPkgDescr</span> <span class='hs-varid'>lbi</span><span class='hs-layout'>)</span> <span class='hs-varid'>lbi</span>
<a name="line-295"></a>
<a name="line-296"></a><a name="withAllTargetsInBuildOrder"></a><span class='hs-definition'>withAllTargetsInBuildOrder</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>TargetInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-297"></a><span class='hs-definition'>withAllTargetsInBuildOrder</span> <span class='hs-varid'>lbi</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>withAllTargetsInBuildOrder'</span> <span class='hs-layout'>(</span><span class='hs-varid'>localPkgDescr</span> <span class='hs-varid'>lbi</span><span class='hs-layout'>)</span> <span class='hs-varid'>lbi</span>
<a name="line-298"></a>
<a name="line-299"></a><a name="neededTargetsInBuildOrder"></a><span class='hs-definition'>neededTargetsInBuildOrder</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>UnitId</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TargetInfo</span><span class='hs-keyglyph'>]</span>
<a name="line-300"></a><span class='hs-definition'>neededTargetsInBuildOrder</span> <span class='hs-varid'>lbi</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>neededTargetsInBuildOrder'</span> <span class='hs-layout'>(</span><span class='hs-varid'>localPkgDescr</span> <span class='hs-varid'>lbi</span><span class='hs-layout'>)</span> <span class='hs-varid'>lbi</span>
<a name="line-301"></a>
<a name="line-302"></a><a name="withNeededTargetsInBuildOrder"></a><span class='hs-definition'>withNeededTargetsInBuildOrder</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>UnitId</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>TargetInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<a name="line-303"></a><span class='hs-definition'>withNeededTargetsInBuildOrder</span> <span class='hs-varid'>lbi</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>withNeededTargetsInBuildOrder'</span> <span class='hs-layout'>(</span><span class='hs-varid'>localPkgDescr</span> <span class='hs-varid'>lbi</span><span class='hs-layout'>)</span> <span class='hs-varid'>lbi</span>
<a name="line-304"></a>
<a name="line-305"></a><span class='hs-comment'>-------------------------------------------------------------------------------</span>
<a name="line-306"></a><span class='hs-comment'>-- Backwards compatibility</span>
<a name="line-307"></a>
<a name="line-308"></a><a name="componentsConfigs"></a><span class='hs-comment'>{-# DEPRECATED componentsConfigs "Use 'componentGraph' instead; you can get a list of 'ComponentLocalBuildInfo' with 'Distribution.Compat.Graph.toList'. There's not a good way to get the list of 'ComponentName's the 'ComponentLocalBuildInfo' depends on because this query doesn't make sense; the graph is indexed by 'UnitId' not 'ComponentName'.  Given a 'UnitId' you can lookup the 'ComponentLocalBuildInfo' ('getCLBI') and then get the 'ComponentName' ('componentLocalName]). To be removed in Cabal 2.2" #-}</span>
<a name="line-309"></a><span class='hs-definition'>componentsConfigs</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>ComponentName</span><span class='hs-layout'>,</span> <span class='hs-conid'>ComponentLocalBuildInfo</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ComponentName</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-310"></a><span class='hs-definition'>componentsConfigs</span> <span class='hs-varid'>lbi</span> <span class='hs-keyglyph'>=</span>
<a name="line-311"></a>    <span class='hs-keyglyph'>[</span> <span class='hs-layout'>(</span><span class='hs-varid'>componentLocalName</span> <span class='hs-varid'>clbi</span><span class='hs-layout'>,</span>
<a name="line-312"></a>       <span class='hs-varid'>clbi</span><span class='hs-layout'>,</span>
<a name="line-313"></a>       <span class='hs-varid'>mapMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-varid'>componentLocalName</span> <span class='hs-varop'>.</span> <span class='hs-varid'>flip</span> <span class='hs-conid'>Graph</span><span class='hs-varop'>.</span><span class='hs-varid'>lookup</span> <span class='hs-varid'>g</span><span class='hs-layout'>)</span>
<a name="line-314"></a>                <span class='hs-layout'>(</span><span class='hs-varid'>componentInternalDeps</span> <span class='hs-varid'>clbi</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-315"></a>    <span class='hs-keyglyph'>|</span> <span class='hs-varid'>clbi</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-conid'>Graph</span><span class='hs-varop'>.</span><span class='hs-varid'>toList</span> <span class='hs-varid'>g</span> <span class='hs-keyglyph'>]</span>
<a name="line-316"></a>  <span class='hs-keyword'>where</span>
<a name="line-317"></a>    <span class='hs-varid'>g</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>componentGraph</span> <span class='hs-varid'>lbi</span>
<a name="line-318"></a>
<a name="line-319"></a><a name="externalPackageDeps"></a><span class='hs-comment'>-- | External package dependencies for the package as a whole. This is the</span>
<a name="line-320"></a><span class='hs-comment'>-- union of the individual 'componentPackageDeps', less any internal deps.</span>
<a name="line-321"></a><span class='hs-comment'>{-# DEPRECATED externalPackageDeps "You almost certainly don't want this function, which agglomerates the dependencies of ALL enabled components.  If you're using this to write out information on your dependencies, read off the dependencies directly from the actual component in question.  To be removed in Cabal 2.2" #-}</span>
<a name="line-322"></a><span class='hs-definition'>externalPackageDeps</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>UnitId</span><span class='hs-layout'>,</span> <span class='hs-conid'>MungedPackageId</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-323"></a><span class='hs-definition'>externalPackageDeps</span> <span class='hs-varid'>lbi</span> <span class='hs-keyglyph'>=</span>
<a name="line-324"></a>    <span class='hs-comment'>-- TODO:  what about non-buildable components?</span>
<a name="line-325"></a>    <span class='hs-varid'>nub</span> <span class='hs-keyglyph'>[</span> <span class='hs-layout'>(</span><span class='hs-varid'>ipkgid</span><span class='hs-layout'>,</span> <span class='hs-varid'>pkgid</span><span class='hs-layout'>)</span>
<a name="line-326"></a>        <span class='hs-keyglyph'>|</span> <span class='hs-varid'>clbi</span>            <span class='hs-keyglyph'>&lt;-</span> <span class='hs-conid'>Graph</span><span class='hs-varop'>.</span><span class='hs-varid'>toList</span> <span class='hs-layout'>(</span><span class='hs-varid'>componentGraph</span> <span class='hs-varid'>lbi</span><span class='hs-layout'>)</span>
<a name="line-327"></a>        <span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varid'>ipkgid</span><span class='hs-layout'>,</span> <span class='hs-varid'>pkgid</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>componentPackageDeps</span> <span class='hs-varid'>clbi</span>
<a name="line-328"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>internal</span> <span class='hs-varid'>ipkgid</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>]</span>
<a name="line-329"></a>  <span class='hs-keyword'>where</span>
<a name="line-330"></a>    <span class='hs-comment'>-- True if this dependency is an internal one (depends on the library</span>
<a name="line-331"></a>    <span class='hs-comment'>-- defined in the same package).</span>
<a name="line-332"></a>    <span class='hs-varid'>internal</span> <span class='hs-varid'>ipkgid</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>any</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>==</span><span class='hs-varid'>ipkgid</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>componentUnitId</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Graph</span><span class='hs-varop'>.</span><span class='hs-varid'>toList</span> <span class='hs-layout'>(</span><span class='hs-varid'>componentGraph</span> <span class='hs-varid'>lbi</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
</pre></body>
</html>
