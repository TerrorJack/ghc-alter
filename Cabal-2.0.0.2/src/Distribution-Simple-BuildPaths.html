<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>Distribution/Simple/BuildPaths.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE FlexibleContexts #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE RankNTypes #-}</span>
<a name="line-3"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-4"></a><span class='hs-comment'>-- |</span>
<a name="line-5"></a><span class='hs-comment'>-- Module      :  Distribution.Simple.BuildPaths</span>
<a name="line-6"></a><span class='hs-comment'>-- Copyright   :  Isaac Jones 2003-2004,</span>
<a name="line-7"></a><span class='hs-comment'>--                Duncan Coutts 2008</span>
<a name="line-8"></a><span class='hs-comment'>-- License     :  BSD3</span>
<a name="line-9"></a><span class='hs-comment'>--</span>
<a name="line-10"></a><span class='hs-comment'>-- Maintainer  :  cabal-devel@haskell.org</span>
<a name="line-11"></a><span class='hs-comment'>-- Portability :  portable</span>
<a name="line-12"></a><span class='hs-comment'>--</span>
<a name="line-13"></a><span class='hs-comment'>-- A bunch of dirs, paths and file names used for intermediate build steps.</span>
<a name="line-14"></a><span class='hs-comment'>--</span>
<a name="line-15"></a>
<a name="line-16"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Simple</span><span class='hs-varop'>.</span><span class='hs-conid'>BuildPaths</span> <span class='hs-layout'>(</span>
<a name="line-17"></a>    <span class='hs-varid'>defaultDistPref</span><span class='hs-layout'>,</span> <span class='hs-varid'>srcPref</span><span class='hs-layout'>,</span>
<a name="line-18"></a>    <span class='hs-varid'>haddockDirName</span><span class='hs-layout'>,</span> <span class='hs-varid'>hscolourPref</span><span class='hs-layout'>,</span> <span class='hs-varid'>haddockPref</span><span class='hs-layout'>,</span>
<a name="line-19"></a>    <span class='hs-varid'>autogenModulesDir</span><span class='hs-layout'>,</span>
<a name="line-20"></a>    <span class='hs-varid'>autogenPackageModulesDir</span><span class='hs-layout'>,</span>
<a name="line-21"></a>    <span class='hs-varid'>autogenComponentModulesDir</span><span class='hs-layout'>,</span>
<a name="line-22"></a>
<a name="line-23"></a>    <span class='hs-varid'>autogenModuleName</span><span class='hs-layout'>,</span>
<a name="line-24"></a>    <span class='hs-varid'>autogenPathsModuleName</span><span class='hs-layout'>,</span>
<a name="line-25"></a>    <span class='hs-varid'>cppHeaderName</span><span class='hs-layout'>,</span>
<a name="line-26"></a>    <span class='hs-varid'>haddockName</span><span class='hs-layout'>,</span>
<a name="line-27"></a>
<a name="line-28"></a>    <span class='hs-varid'>mkLibName</span><span class='hs-layout'>,</span>
<a name="line-29"></a>    <span class='hs-varid'>mkProfLibName</span><span class='hs-layout'>,</span>
<a name="line-30"></a>    <span class='hs-varid'>mkSharedLibName</span><span class='hs-layout'>,</span>
<a name="line-31"></a>
<a name="line-32"></a>    <span class='hs-varid'>exeExtension</span><span class='hs-layout'>,</span>
<a name="line-33"></a>    <span class='hs-varid'>objExtension</span><span class='hs-layout'>,</span>
<a name="line-34"></a>    <span class='hs-varid'>dllExtension</span><span class='hs-layout'>,</span>
<a name="line-35"></a>    <span class='hs-varid'>staticLibExtension</span><span class='hs-layout'>,</span>
<a name="line-36"></a>    <span class='hs-comment'>-- * Source files &amp; build directories</span>
<a name="line-37"></a>    <span class='hs-varid'>getSourceFiles</span><span class='hs-layout'>,</span> <span class='hs-varid'>getLibSourceFiles</span><span class='hs-layout'>,</span> <span class='hs-varid'>getExeSourceFiles</span><span class='hs-layout'>,</span>
<a name="line-38"></a>    <span class='hs-varid'>getFLibSourceFiles</span><span class='hs-layout'>,</span> <span class='hs-varid'>exeBuildDir</span><span class='hs-layout'>,</span> <span class='hs-varid'>flibBuildDir</span><span class='hs-layout'>,</span>
<a name="line-39"></a>  <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-40"></a>
<a name="line-41"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Prelude</span> <span class='hs-conid'>()</span>
<a name="line-42"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Compat</span><span class='hs-varop'>.</span><span class='hs-conid'>Prelude</span>
<a name="line-43"></a>
<a name="line-44"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span><span class='hs-varop'>.</span><span class='hs-conid'>ForeignLib</span>
<a name="line-45"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span><span class='hs-varop'>.</span><span class='hs-conid'>UnqualComponentName</span> <span class='hs-layout'>(</span><span class='hs-varid'>unUnqualComponentName</span><span class='hs-layout'>)</span>
<a name="line-46"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Package</span>
<a name="line-47"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>ModuleName</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>ModuleName</span>
<a name="line-48"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Compiler</span>
<a name="line-49"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>PackageDescription</span>
<a name="line-50"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Simple</span><span class='hs-varop'>.</span><span class='hs-conid'>LocalBuildInfo</span>
<a name="line-51"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Simple</span><span class='hs-varop'>.</span><span class='hs-conid'>Setup</span>
<a name="line-52"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span>
<a name="line-53"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>System</span>
<a name="line-54"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Verbosity</span>
<a name="line-55"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Distribution</span><span class='hs-varop'>.</span><span class='hs-conid'>Simple</span><span class='hs-varop'>.</span><span class='hs-conid'>Utils</span>
<a name="line-56"></a>
<a name="line-57"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>FilePath</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>&lt;/&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-layout'>(</span><span class='hs-varop'>&lt;.&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>normalise</span><span class='hs-layout'>)</span>
<a name="line-58"></a>
<a name="line-59"></a><span class='hs-comment'>-- ---------------------------------------------------------------------------</span>
<a name="line-60"></a><span class='hs-comment'>-- Build directories and files</span>
<a name="line-61"></a>
<a name="line-62"></a><a name="srcPref"></a><span class='hs-definition'>srcPref</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FilePath</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span>
<a name="line-63"></a><span class='hs-definition'>srcPref</span> <span class='hs-varid'>distPref</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>distPref</span> <span class='hs-varop'>&lt;/&gt;</span> <span class='hs-str'>"src"</span>
<a name="line-64"></a>
<a name="line-65"></a><a name="hscolourPref"></a><span class='hs-definition'>hscolourPref</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HaddockTarget</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PackageDescription</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span>
<a name="line-66"></a><span class='hs-definition'>hscolourPref</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>haddockPref</span>
<a name="line-67"></a>
<a name="line-68"></a><a name="haddockDirName"></a><span class='hs-comment'>-- | This is the name of the directory in which the generated haddocks</span>
<a name="line-69"></a><span class='hs-comment'>-- should be stored. It does not include the @&lt;dist&gt;/doc/html@ prefix.</span>
<a name="line-70"></a><span class='hs-definition'>haddockDirName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HaddockTarget</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PackageDescription</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span>
<a name="line-71"></a><span class='hs-definition'>haddockDirName</span> <span class='hs-conid'>ForDevelopment</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>display</span> <span class='hs-varop'>.</span> <span class='hs-varid'>packageName</span>
<a name="line-72"></a><span class='hs-definition'>haddockDirName</span> <span class='hs-conid'>ForHackage</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varop'>++</span> <span class='hs-str'>"-docs"</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>display</span> <span class='hs-varop'>.</span> <span class='hs-varid'>packageId</span>
<a name="line-73"></a>
<a name="line-74"></a><a name="haddockPref"></a><span class='hs-comment'>-- | The directory to which generated haddock documentation should be written.</span>
<a name="line-75"></a><span class='hs-definition'>haddockPref</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>HaddockTarget</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PackageDescription</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span>
<a name="line-76"></a><span class='hs-definition'>haddockPref</span> <span class='hs-varid'>haddockTarget</span> <span class='hs-varid'>distPref</span> <span class='hs-varid'>pkg_descr</span>
<a name="line-77"></a>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>distPref</span> <span class='hs-varop'>&lt;/&gt;</span> <span class='hs-str'>"doc"</span> <span class='hs-varop'>&lt;/&gt;</span> <span class='hs-str'>"html"</span> <span class='hs-varop'>&lt;/&gt;</span> <span class='hs-varid'>haddockDirName</span> <span class='hs-varid'>haddockTarget</span> <span class='hs-varid'>pkg_descr</span>
<a name="line-78"></a>
<a name="line-79"></a><a name="autogenModulesDir"></a><span class='hs-comment'>-- | The directory in which we put auto-generated modules for EVERY</span>
<a name="line-80"></a><span class='hs-comment'>-- component in the package.  See deprecation notice.</span>
<a name="line-81"></a><span class='hs-comment'>{-# DEPRECATED autogenModulesDir "If you can, use 'autogenComponentModulesDir' instead, but if you really wanted package-global generated modules, use 'autogenPackageModulesDir'.  In Cabal 2.0, we avoid using autogenerated files which apply to all components, because the information you often want in these files, e.g., dependency information, is best specified per component, so that reconfiguring a different component (e.g., enabling tests) doesn't force the entire to be rebuilt.  'autogenPackageModulesDir' still provides a place to put files you want to apply to the entire package, but most users of 'autogenModulesDir' should seriously consider 'autogenComponentModulesDir' if you really wanted the module to apply to one component." #-}</span>
<a name="line-82"></a><span class='hs-definition'>autogenModulesDir</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-83"></a><span class='hs-definition'>autogenModulesDir</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>autogenPackageModulesDir</span>
<a name="line-84"></a>
<a name="line-85"></a><a name="autogenPackageModulesDir"></a><span class='hs-comment'>-- | The directory in which we put auto-generated modules for EVERY</span>
<a name="line-86"></a><span class='hs-comment'>-- component in the package.</span>
<a name="line-87"></a><span class='hs-definition'>autogenPackageModulesDir</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-88"></a><span class='hs-definition'>autogenPackageModulesDir</span> <span class='hs-varid'>lbi</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>buildDir</span> <span class='hs-varid'>lbi</span> <span class='hs-varop'>&lt;/&gt;</span> <span class='hs-str'>"global-autogen"</span>
<a name="line-89"></a>
<a name="line-90"></a><a name="autogenComponentModulesDir"></a><span class='hs-comment'>-- | The directory in which we put auto-generated modules for a</span>
<a name="line-91"></a><span class='hs-comment'>-- particular component.</span>
<a name="line-92"></a><span class='hs-definition'>autogenComponentModulesDir</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ComponentLocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-93"></a><span class='hs-definition'>autogenComponentModulesDir</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>clbi</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>componentBuildDir</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>clbi</span> <span class='hs-varop'>&lt;/&gt;</span> <span class='hs-str'>"autogen"</span>
<a name="line-94"></a><span class='hs-comment'>-- NB: Look at 'checkForeignDeps' for where a simplified version of this</span>
<a name="line-95"></a><span class='hs-comment'>-- has been copy-pasted.</span>
<a name="line-96"></a>
<a name="line-97"></a><a name="cppHeaderName"></a><span class='hs-definition'>cppHeaderName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span>
<a name="line-98"></a><span class='hs-definition'>cppHeaderName</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"cabal_macros.h"</span>
<a name="line-99"></a>
<a name="line-100"></a><a name="autogenModuleName"></a><span class='hs-comment'>{-# DEPRECATED autogenModuleName "Use autogenPathsModuleName instead" #-}</span>
<a name="line-101"></a><span class='hs-comment'>-- |The name of the auto-generated module associated with a package</span>
<a name="line-102"></a><span class='hs-definition'>autogenModuleName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PackageDescription</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleName</span>
<a name="line-103"></a><span class='hs-definition'>autogenModuleName</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>autogenPathsModuleName</span>
<a name="line-104"></a>
<a name="line-105"></a><a name="autogenPathsModuleName"></a><span class='hs-comment'>-- | The name of the auto-generated Paths_* module associated with a package</span>
<a name="line-106"></a><span class='hs-definition'>autogenPathsModuleName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PackageDescription</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ModuleName</span>
<a name="line-107"></a><span class='hs-definition'>autogenPathsModuleName</span> <span class='hs-varid'>pkg_descr</span> <span class='hs-keyglyph'>=</span>
<a name="line-108"></a>  <span class='hs-conid'>ModuleName</span><span class='hs-varop'>.</span><span class='hs-varid'>fromString</span> <span class='hs-varop'>$</span>
<a name="line-109"></a>    <span class='hs-str'>"Paths_"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>map</span> <span class='hs-varid'>fixchar</span> <span class='hs-layout'>(</span><span class='hs-varid'>display</span> <span class='hs-layout'>(</span><span class='hs-varid'>packageName</span> <span class='hs-varid'>pkg_descr</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-110"></a>  <span class='hs-keyword'>where</span> <span class='hs-varid'>fixchar</span> <span class='hs-chr'>'-'</span> <span class='hs-keyglyph'>=</span> <span class='hs-chr'>'_'</span>
<a name="line-111"></a>        <span class='hs-varid'>fixchar</span> <span class='hs-varid'>c</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span>
<a name="line-112"></a>
<a name="line-113"></a><a name="haddockName"></a><span class='hs-definition'>haddockName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>PackageDescription</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span>
<a name="line-114"></a><span class='hs-definition'>haddockName</span> <span class='hs-varid'>pkg_descr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>display</span> <span class='hs-layout'>(</span><span class='hs-varid'>packageName</span> <span class='hs-varid'>pkg_descr</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;.&gt;</span> <span class='hs-str'>"haddock"</span>
<a name="line-115"></a>
<a name="line-116"></a><span class='hs-comment'>-- -----------------------------------------------------------------------------</span>
<a name="line-117"></a><span class='hs-comment'>-- Source File helper</span>
<a name="line-118"></a>
<a name="line-119"></a><a name="getLibSourceFiles"></a><span class='hs-definition'>getLibSourceFiles</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Verbosity</span>
<a name="line-120"></a>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LocalBuildInfo</span>
<a name="line-121"></a>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Library</span>
<a name="line-122"></a>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ComponentLocalBuildInfo</span>
<a name="line-123"></a>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>ModuleName</span><span class='hs-varop'>.</span><span class='hs-conid'>ModuleName</span><span class='hs-layout'>,</span> <span class='hs-conid'>FilePath</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-124"></a><span class='hs-definition'>getLibSourceFiles</span> <span class='hs-varid'>verbosity</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>lib</span> <span class='hs-varid'>clbi</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getSourceFiles</span> <span class='hs-varid'>verbosity</span> <span class='hs-varid'>searchpaths</span> <span class='hs-varid'>modules</span>
<a name="line-125"></a>  <span class='hs-keyword'>where</span>
<a name="line-126"></a>    <span class='hs-varid'>bi</span>               <span class='hs-keyglyph'>=</span> <span class='hs-varid'>libBuildInfo</span> <span class='hs-varid'>lib</span>
<a name="line-127"></a>    <span class='hs-varid'>modules</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>allLibModules</span> <span class='hs-varid'>lib</span> <span class='hs-varid'>clbi</span>
<a name="line-128"></a>    <span class='hs-varid'>searchpaths</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>componentBuildDir</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>clbi</span> <span class='hs-conop'>:</span> <span class='hs-varid'>hsSourceDirs</span> <span class='hs-varid'>bi</span> <span class='hs-varop'>++</span>
<a name="line-129"></a>                     <span class='hs-keyglyph'>[</span> <span class='hs-varid'>autogenComponentModulesDir</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>clbi</span>
<a name="line-130"></a>                     <span class='hs-layout'>,</span> <span class='hs-varid'>autogenPackageModulesDir</span> <span class='hs-varid'>lbi</span> <span class='hs-keyglyph'>]</span>
<a name="line-131"></a>
<a name="line-132"></a><a name="getExeSourceFiles"></a><span class='hs-definition'>getExeSourceFiles</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Verbosity</span>
<a name="line-133"></a>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LocalBuildInfo</span>
<a name="line-134"></a>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Executable</span>
<a name="line-135"></a>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ComponentLocalBuildInfo</span>
<a name="line-136"></a>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>ModuleName</span><span class='hs-varop'>.</span><span class='hs-conid'>ModuleName</span><span class='hs-layout'>,</span> <span class='hs-conid'>FilePath</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-137"></a><span class='hs-definition'>getExeSourceFiles</span> <span class='hs-varid'>verbosity</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>exe</span> <span class='hs-varid'>clbi</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-138"></a>    <span class='hs-varid'>moduleFiles</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getSourceFiles</span> <span class='hs-varid'>verbosity</span> <span class='hs-varid'>searchpaths</span> <span class='hs-varid'>modules</span>
<a name="line-139"></a>    <span class='hs-varid'>srcMainPath</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>findFile</span> <span class='hs-layout'>(</span><span class='hs-varid'>hsSourceDirs</span> <span class='hs-varid'>bi</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>modulePath</span> <span class='hs-varid'>exe</span><span class='hs-layout'>)</span>
<a name="line-140"></a>    <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>ModuleName</span><span class='hs-varop'>.</span><span class='hs-varid'>main</span><span class='hs-layout'>,</span> <span class='hs-varid'>srcMainPath</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>moduleFiles</span><span class='hs-layout'>)</span>
<a name="line-141"></a>  <span class='hs-keyword'>where</span>
<a name="line-142"></a>    <span class='hs-varid'>bi</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>buildInfo</span> <span class='hs-varid'>exe</span>
<a name="line-143"></a>    <span class='hs-varid'>modules</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>otherModules</span> <span class='hs-varid'>bi</span>
<a name="line-144"></a>    <span class='hs-varid'>searchpaths</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>autogenComponentModulesDir</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>clbi</span>
<a name="line-145"></a>                <span class='hs-conop'>:</span> <span class='hs-varid'>autogenPackageModulesDir</span> <span class='hs-varid'>lbi</span>
<a name="line-146"></a>                <span class='hs-conop'>:</span> <span class='hs-varid'>exeBuildDir</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>exe</span> <span class='hs-conop'>:</span> <span class='hs-varid'>hsSourceDirs</span> <span class='hs-varid'>bi</span>
<a name="line-147"></a>
<a name="line-148"></a><a name="getFLibSourceFiles"></a><span class='hs-definition'>getFLibSourceFiles</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Verbosity</span>
<a name="line-149"></a>                   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>LocalBuildInfo</span>
<a name="line-150"></a>                   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ForeignLib</span>
<a name="line-151"></a>                   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ComponentLocalBuildInfo</span>
<a name="line-152"></a>                   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>ModuleName</span><span class='hs-varop'>.</span><span class='hs-conid'>ModuleName</span><span class='hs-layout'>,</span> <span class='hs-conid'>FilePath</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-153"></a><span class='hs-definition'>getFLibSourceFiles</span> <span class='hs-varid'>verbosity</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>flib</span> <span class='hs-varid'>clbi</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getSourceFiles</span> <span class='hs-varid'>verbosity</span> <span class='hs-varid'>searchpaths</span> <span class='hs-varid'>modules</span>
<a name="line-154"></a>  <span class='hs-keyword'>where</span>
<a name="line-155"></a>    <span class='hs-varid'>bi</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foreignLibBuildInfo</span> <span class='hs-varid'>flib</span>
<a name="line-156"></a>    <span class='hs-varid'>modules</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>otherModules</span> <span class='hs-varid'>bi</span>
<a name="line-157"></a>    <span class='hs-varid'>searchpaths</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>autogenComponentModulesDir</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>clbi</span>
<a name="line-158"></a>                <span class='hs-conop'>:</span> <span class='hs-varid'>autogenPackageModulesDir</span> <span class='hs-varid'>lbi</span>
<a name="line-159"></a>                <span class='hs-conop'>:</span> <span class='hs-varid'>flibBuildDir</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>flib</span> <span class='hs-conop'>:</span> <span class='hs-varid'>hsSourceDirs</span> <span class='hs-varid'>bi</span>
<a name="line-160"></a>
<a name="line-161"></a><a name="getSourceFiles"></a><span class='hs-definition'>getSourceFiles</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Verbosity</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>FilePath</span><span class='hs-keyglyph'>]</span>
<a name="line-162"></a>                  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ModuleName</span><span class='hs-varop'>.</span><span class='hs-conid'>ModuleName</span><span class='hs-keyglyph'>]</span>
<a name="line-163"></a>                  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-conid'>ModuleName</span><span class='hs-varop'>.</span><span class='hs-conid'>ModuleName</span><span class='hs-layout'>,</span> <span class='hs-conid'>FilePath</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-164"></a><span class='hs-definition'>getSourceFiles</span> <span class='hs-varid'>verbosity</span> <span class='hs-varid'>dirs</span> <span class='hs-varid'>modules</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flip</span> <span class='hs-varid'>traverse</span> <span class='hs-varid'>modules</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>m</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-conid'>(,)</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span>
<a name="line-165"></a>    <span class='hs-varid'>findFileWithExtension</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"hs"</span><span class='hs-layout'>,</span> <span class='hs-str'>"lhs"</span><span class='hs-layout'>,</span> <span class='hs-str'>"hsig"</span><span class='hs-layout'>,</span> <span class='hs-str'>"lhsig"</span><span class='hs-keyglyph'>]</span> <span class='hs-varid'>dirs</span> <span class='hs-layout'>(</span><span class='hs-conid'>ModuleName</span><span class='hs-varop'>.</span><span class='hs-varid'>toFilePath</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span>
<a name="line-166"></a>      <span class='hs-varop'>&gt;&gt;=</span> <span class='hs-varid'>maybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>notFound</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-varop'>.</span> <span class='hs-varid'>normalise</span><span class='hs-layout'>)</span>
<a name="line-167"></a>  <span class='hs-keyword'>where</span>
<a name="line-168"></a>    <span class='hs-varid'>notFound</span> <span class='hs-varid'>module_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>die'</span> <span class='hs-varid'>verbosity</span> <span class='hs-varop'>$</span> <span class='hs-str'>"can't find source for module "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>display</span> <span class='hs-varid'>module_</span>
<a name="line-169"></a>
<a name="line-170"></a><a name="exeBuildDir"></a><span class='hs-comment'>-- | The directory where we put build results for an executable</span>
<a name="line-171"></a><span class='hs-definition'>exeBuildDir</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Executable</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span>
<a name="line-172"></a><span class='hs-definition'>exeBuildDir</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>exe</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>buildDir</span> <span class='hs-varid'>lbi</span> <span class='hs-varop'>&lt;/&gt;</span> <span class='hs-varid'>nm</span> <span class='hs-varop'>&lt;/&gt;</span> <span class='hs-varid'>nm</span> <span class='hs-varop'>++</span> <span class='hs-str'>"-tmp"</span>
<a name="line-173"></a>  <span class='hs-keyword'>where</span>
<a name="line-174"></a>    <span class='hs-varid'>nm</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unUnqualComponentName</span> <span class='hs-varop'>$</span> <span class='hs-varid'>exeName</span> <span class='hs-varid'>exe</span>
<a name="line-175"></a>
<a name="line-176"></a><a name="flibBuildDir"></a><span class='hs-comment'>-- | The directory where we put build results for a foreign library</span>
<a name="line-177"></a><span class='hs-definition'>flibBuildDir</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>LocalBuildInfo</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ForeignLib</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>FilePath</span>
<a name="line-178"></a><span class='hs-definition'>flibBuildDir</span> <span class='hs-varid'>lbi</span> <span class='hs-varid'>flib</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>buildDir</span> <span class='hs-varid'>lbi</span> <span class='hs-varop'>&lt;/&gt;</span> <span class='hs-varid'>nm</span> <span class='hs-varop'>&lt;/&gt;</span> <span class='hs-varid'>nm</span> <span class='hs-varop'>++</span> <span class='hs-str'>"-tmp"</span>
<a name="line-179"></a>  <span class='hs-keyword'>where</span>
<a name="line-180"></a>    <span class='hs-varid'>nm</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unUnqualComponentName</span> <span class='hs-varop'>$</span> <span class='hs-varid'>foreignLibName</span> <span class='hs-varid'>flib</span>
<a name="line-181"></a>
<a name="line-182"></a><span class='hs-comment'>-- ---------------------------------------------------------------------------</span>
<a name="line-183"></a><span class='hs-comment'>-- Library file names</span>
<a name="line-184"></a>
<a name="line-185"></a><a name="mkLibName"></a><span class='hs-comment'>-- TODO: Should this use staticLibExtension?</span>
<a name="line-186"></a><span class='hs-definition'>mkLibName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>UnitId</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-187"></a><span class='hs-definition'>mkLibName</span> <span class='hs-varid'>lib</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"lib"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>getHSLibraryName</span> <span class='hs-varid'>lib</span> <span class='hs-varop'>&lt;.&gt;</span> <span class='hs-str'>"a"</span>
<a name="line-188"></a>
<a name="line-189"></a><a name="mkProfLibName"></a><span class='hs-comment'>-- TODO: Should this use staticLibExtension?</span>
<a name="line-190"></a><span class='hs-definition'>mkProfLibName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>UnitId</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-191"></a><span class='hs-definition'>mkProfLibName</span> <span class='hs-varid'>lib</span> <span class='hs-keyglyph'>=</span>  <span class='hs-str'>"lib"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>getHSLibraryName</span> <span class='hs-varid'>lib</span> <span class='hs-varop'>++</span> <span class='hs-str'>"_p"</span> <span class='hs-varop'>&lt;.&gt;</span> <span class='hs-str'>"a"</span>
<a name="line-192"></a>
<a name="line-193"></a><a name="mkSharedLibName"></a><span class='hs-comment'>-- Implement proper name mangling for dynamical shared objects</span>
<a name="line-194"></a><span class='hs-comment'>-- libHS&lt;packagename&gt;-&lt;compilerFlavour&gt;&lt;compilerVersion&gt;</span>
<a name="line-195"></a><span class='hs-comment'>-- e.g. libHSbase-2.1-ghc6.6.1.so</span>
<a name="line-196"></a><span class='hs-definition'>mkSharedLibName</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CompilerId</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>UnitId</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<a name="line-197"></a><span class='hs-definition'>mkSharedLibName</span> <span class='hs-layout'>(</span><span class='hs-conid'>CompilerId</span> <span class='hs-varid'>compilerFlavor</span> <span class='hs-varid'>compilerVersion</span><span class='hs-layout'>)</span> <span class='hs-varid'>lib</span>
<a name="line-198"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-str'>"lib"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>getHSLibraryName</span> <span class='hs-varid'>lib</span> <span class='hs-varop'>++</span> <span class='hs-str'>"-"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>comp</span> <span class='hs-varop'>&lt;.&gt;</span> <span class='hs-varid'>dllExtension</span>
<a name="line-199"></a>  <span class='hs-keyword'>where</span> <span class='hs-varid'>comp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>display</span> <span class='hs-varid'>compilerFlavor</span> <span class='hs-varop'>++</span> <span class='hs-varid'>display</span> <span class='hs-varid'>compilerVersion</span>
<a name="line-200"></a>
<a name="line-201"></a><span class='hs-comment'>-- ------------------------------------------------------------</span>
<a name="line-202"></a><span class='hs-comment'>-- * Platform file extensions</span>
<a name="line-203"></a><span class='hs-comment'>-- ------------------------------------------------------------</span>
<a name="line-204"></a>
<a name="line-205"></a><a name="exeExtension"></a><span class='hs-comment'>-- | Default extension for executable files on the current platform.</span>
<a name="line-206"></a><span class='hs-comment'>-- (typically @\"\"@ on Unix and @\"exe\"@ on Windows or OS\/2)</span>
<a name="line-207"></a><span class='hs-definition'>exeExtension</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span>
<a name="line-208"></a><span class='hs-definition'>exeExtension</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>buildOS</span> <span class='hs-keyword'>of</span>
<a name="line-209"></a>                   <span class='hs-conid'>Windows</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-str'>"exe"</span>
<a name="line-210"></a>                   <span class='hs-keyword'>_</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-str'>""</span>
<a name="line-211"></a>
<a name="line-212"></a><a name="objExtension"></a><span class='hs-comment'>-- | Extension for object files. For GHC the extension is @\"o\"@.</span>
<a name="line-213"></a><span class='hs-definition'>objExtension</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span>
<a name="line-214"></a><span class='hs-definition'>objExtension</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"o"</span>
<a name="line-215"></a>
<a name="line-216"></a><a name="dllExtension"></a><span class='hs-comment'>-- | Extension for dynamically linked (or shared) libraries</span>
<a name="line-217"></a><span class='hs-comment'>-- (typically @\"so\"@ on Unix and @\"dll\"@ on Windows)</span>
<a name="line-218"></a><span class='hs-definition'>dllExtension</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span>
<a name="line-219"></a><span class='hs-definition'>dllExtension</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>buildOS</span> <span class='hs-keyword'>of</span>
<a name="line-220"></a>                   <span class='hs-conid'>Windows</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-str'>"dll"</span>
<a name="line-221"></a>                   <span class='hs-conid'>OSX</span>     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-str'>"dylib"</span>
<a name="line-222"></a>                   <span class='hs-keyword'>_</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-str'>"so"</span>
<a name="line-223"></a>
<a name="line-224"></a><a name="staticLibExtension"></a><span class='hs-comment'>-- | Extension for static libraries</span>
<a name="line-225"></a><span class='hs-comment'>--</span>
<a name="line-226"></a><span class='hs-comment'>-- TODO: Here, as well as in dllExtension, it's really the target OS that we're</span>
<a name="line-227"></a><span class='hs-comment'>-- interested in, not the build OS.</span>
<a name="line-228"></a><span class='hs-definition'>staticLibExtension</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span>
<a name="line-229"></a><span class='hs-definition'>staticLibExtension</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>buildOS</span> <span class='hs-keyword'>of</span>
<a name="line-230"></a>                       <span class='hs-conid'>Windows</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-str'>"lib"</span>
<a name="line-231"></a>                       <span class='hs-keyword'>_</span>       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-str'>"a"</span>
</pre></body>
</html>
